<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <meta name="keywords" content="quantum,circuit,simulator,quirk">
        <meta name="description" content="Quirk is an open-source drag-and-drop quantum circuit simulator for exploring and understanding small quantum circuits.">
        <title>Quirk: Quantum Circuit Simulator</title>
        <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAJGUlEQVRYw6WXa2xUZRrHf+fM6ZyZdmY6M50yhdJSoLWtWUkLQmvF1W2AaAvpiss2Gy9LrLIJGq/EWyKJbnYDiTHRbDXULWtEN1sNYMuWRaAuKoyASitgOr1bLG1HhplhzrRz6XTOfmjniG3xts/59J7znuf5v+9z+z8CPyBNTU3U1tYCUFFRgc/vswIlQCFQDjimt3qBk0AX0GG32QMul2uWjrlEuNaH5uZmampqKCouShpFNsr3RsPRnLKKsrx0W7pceF1hNkBPb4+il/T+lv0tF2Wj3B0NR/dMq+lwd7oDSV0/GUBjYyN1dXVJ4w/mLMlZs/WRratMVpPV6XTiPuum7NYyPAMeAJyLnZz66BRFy4rweDyEAqFA/av1p4f6h44Cb7g73YGkzpmimwtAd0+31ZHpKF+Qt2D7fXX3bdm2fVvxdddfZ8hakMVA5wCKpFBcWIzP4wMga1EWvaO9iOMiJWUl5OXnGW5ff/vS9PT0m1ApiEVjl10uV8Dr9UZ+FMD0qTevXrP6oYcfebi67NYyvdliBiDoDzIyOsKK0hWkyCn4PX4AbFk2suxZDA8PY7FYMBgNxMZjSDpJnzkv8waz1Zzf4+6RHZkO90wQuquvvbun2wpsvu2O2+599oVny3KX5iLLsra5v78fYpC9OBudqNNuICMrA1Encnn4MoZUA109XTz7xFMcP3WY8+52ll2/PDcj0zGvv7dfdGQ63Dt37oy0tLQAICYDbto/JavXrL7r6e1PL7ekW2YEi4CaUDGZTUiSNMttkiRhMpvQp+nZ9vBjWG8+y7q/DlH90hBvN79Ebl7u8qrfVt0FlNTV1dHc3DwFoKmpSYv2BXkLttx9z92rZxqfQiri9/ixOq3XTClHtoM3X3kL/cJRNj1lwZKlw5wt8OBbaZzo+DcrVq1YXbyseEtRcZG1pqaGpqYmxNraWi3a77zrzg2LixZfI10EImMRzFbzNQFkZmQyOZkgrIQ5dyLM6SaFeFglPqGiTggsK11G5drKDcCDRcVF1tra2ikXACULlyxcs2HTBlMy4GYajxNHVEVMsglp+tGJOnSiTluLiNy4cjme3gm+PDSGIzcFW6qOT5tCqFEjJouJDZs2mPKvz1+TrC3SdIVj6yNbV11tXEBARNSMH3EdQVVVuvq6CIfCRMYjtO5rBaB6YzXGNCPxeJzG3X/H2x/nxD/H6Dk5wZGGELGh+bz8tyew2KZce/+W+1c999hzVFRUIPn8PqtslO81W81WVVUJ+oNcHLmImlDxe/xExiKIqoiqqjAJY74xUuQU7Jl2qmqqprJgXga7d+3mixNfcNp1mrV3rKXugQfoaD+LTtSxueE+iKpc8V3BYrOQZkkz6A363/v8vg4JKImGo0udTidnT54lPBFG1smYzCYKbyjEbDVjkk109XUx5hujdGUpCRIAJMYSSIJEZnYm/X39tH/RzvKVy9n2wjYqVlZwx8bbuXT5EufPnMdkNBGdjGJMMTJ/wfxELBJbBJRI01eic591M2mZpKK0AkOqYVaqhUNhUuQUEiRQUbX3kZQIT/7pST7Y9wGV1ZXc88d7MOgNJEgQJ44tw8Yta24hHo8TGY/ganfhPetN3fLQlryG+oZCCVg3PDL8q9r7azFZTKioCHO0iMh4BHumXVurqEzGJ9n+5Hba2tqoqa3h5V0v4/f6ufzt5TnrRJoljXW3riMUDOH6i2sBsEgCKMgvMHsGPIwyOmd66UQdrftaqaqpIjGWAHUKQOv7rbS1tVFZWcnjzzxO4EIA7xUvB5sPovgUchbmzKlPURQK8gvMhziExC8QSZQYDYyiQ8ejzzzKpt9tIkVIIZ6I/3xdyX6+vna99VoukJCo3liNPdNOQX4B/nE/J988SdnaMuzpdgqWFSAIAgICfb19VG+spvymcuJ8H1BSdygYovVAq5IEcDg3N7fm1EenrD8UhIZUA2ElzDdD3/D5fz+nanMVvl4f8UQcQfgOcHQ8iiHVMOukVwehLqgjOzd7GBiUABrqG3zv/uddvMNeznec19LQ6rRqaWhMMzLoHsTr8XLjb27ElmrjW/VbENBuTERkIjpBmj1tKnCjEZSAQsATIKSEiE5GceqdOJY52P70dh/QJQEdslHu9ng8q0vLS7VCFEvE6DrXpRWiOHFOfXyKmytvxn/JTyQSwa9M8YG+3j6i41EmohOMDo7CEAyeGyQhJDCkGbA5bchWmSXzl2CxWWj/rJ1p6tYh2W32gM/v2xMKhDYKgmBNt6eTbk+fKsU3fFeK9x3ZR9mvy1hUtIjwWBjfJR8Hmw9qpdiQapg6+RAIToHKikokJFTUWbVDCSiBaDi6x26zBySXy0VRcRH1r9afLi0vXZfsByoqk0xqfWHj2o18+P6HFOYXfqfIpwBQflO59m7w3CCVFZUa8FkpGFR47dXXTgO4XC6tG3YM9Q8dPfDegZASVGb9pKIiIZEQEoSiIeLTT87CHHIW5mjrUDREQkhoJ5/L+IH3DoSmyWqHRkjcne4A8Mb+vfsPDLgH5sxXFRVDmgEloFwzp5WAgiHNMKdxgAH3APv37j+QZMoaIWlubsbd6Q4Mfz3c8M7b7xwPXgnO+jlBApvTRsATuCaAgCeAzWnTmtXVErwSZM/be44Pfz3ckJwVNEJSU1NDY2MjQMfxo8f37nhxx5mZIFRUBFEgpISIx+Nz5nlICSGIwqwbCF4JsuPFHWdcR117gY7GxkZtUNFYcUtLC16vN+LIdLgHewfFwcFBkzPDmZtqTtWYsV7SM+oZxZ5hn0XLw6EwIyMjLFm6BIPRoPm868su6l+pP/7J4U/+Bbzp7nQHkox4zrkgCeJC/4XO9o52WVTFxXn5eXpZlpENMr4RH+6LbvLz8r9Hy4+dPIZVbyW3IBdBELSA2/X6rr1fnfnqJeDQdKz9+GS0c+fOyO7G3V/LKXLbZ59+Fjr24THV6XBm+Hw+w7z58/Bd8DFv/jxGvhkhFothtpoZ7h4mZ2mOt6+nL7X7q+7A8089/3HbwbZ/KAHlz+5O9/dmgV88nOqN+j/EwjHH+jvXl07GJ235+flmgK7urouSTlIOthw8Jxvl8f97OP0J4znAuhnbDyeN/pzx/H9hJ0Pb7MiyZAAAAABJRU5ErkJggg==">

        <!-- Whatever is between these start/end analytic tags is stripped by the 'downloading offline copy' code. -->
        <!-- Start Analytics -->
        <!-- End Analytics -->
    </head>
    <body style="margin: 0">
        <!-- Primary content -->
        <div id="inspectorDiv" style="display: none">
            <!-- Buttons -->
            <div style="margin: 5px;">
                <button id="menu-button" style="min-width: 50px; min-height: 30px;">Menu</button>
                &nbsp;
                &nbsp;
                <button id="export-button" style="min-width: 50px; min-height: 30px;">Export</button>
                &nbsp;
                &nbsp;
                <button id="clear-circuit-button" style="min-width: 50px; min-height: 30px;">Clear Circuit</button>
                <button id="clear-all-button" style="min-width: 50px; min-height: 30px;">Clear ALL</button>
                &nbsp;
                &nbsp;
                <button id="undo-button" style="min-width: 50px; min-height: 30px;">Undo</button>
                <button id="redo-button" style="min-width: 50px; min-height: 30px;">Redo</button>
                &nbsp;
                &nbsp;
                <button id="gate-forge-button" style="min-width: 50px; min-height: 30px;">Make Gate</button>
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                <span style="color:#BBB">Version 2.3</span>
            </div>

            <!-- Circuit drawing area -->
            <div id="canvasDiv" style="width: 100%; touch-action: manipulation; tab-index: 0; position: relative;">
                <canvas id="drawCanvas"></canvas>
            </div>

            <div id="export-div" style="display:none;">
    <div id="export-overlay" style="position:fixed; left: 0; top: 0; height: 100vh; width: 100vw; background: rgba(0, 0, 0, 0.7);">
    </div>
    <div style="position: absolute; top: 20px; left: 50px; padding: 20px; background-color: white; border: 1px solid black;">
        <strong>Escaped Link</strong> - Link to current circuit, without special characters that confuse forums.
        <div style="margin: 10px 0 30px 20px;">
            <button tabindex="100" id="export-link-copy-button">Copy to Clipboard</button>&nbsp;&nbsp;<span id="export-link-copy-result"></span>
            <div style="overflow:auto; word-wrap:break-word; max-height:60px; max-width:600px; border: 1px solid black; padding: 10px; margin: 2px;"><a tabindex="101" id="export-escaped-anchor"></a></div>
        </div>

        <strong>Offline Copy</strong> - Html file containing Quirk and the current circuit.
        <div style="margin: 10px 0 30px 20px;">
            <button tabindex="102" id="download-offline-copy-button" style="width:600px; height:60px;">Download ...</button>
        </div>

        <strong>Circuit JSON</strong> - Parsable representation of current circuit.
        <div style="margin: 10px 0 0 20px;">
            <button tabindex="103" id="export-json-copy-button">Copy to Clipboard</button>&nbsp;&nbsp;<span id="export-json-copy-result"></span>
            <br>
            <pre tabindex="104" id="export-circuit-json-pre" style="overflow:auto; max-width:600px; max-height:60px; border: 1px solid black; padding:5px; margin:2px;"></pre>
        </div>

        <br>
        <strong>OpenQASM</strong>
        <div style="margin: 10px 0 0 20px;">
            <button tabindex="105" id="export-qasm-copy-button">Copy to Clipboard</button>&nbsp;&nbsp;<span id="export-qasm-copy-result"></span>
            <br>
            <pre tabindex="106" id="export-qasm-pre" style="overflow:auto; max-width:600px; max-height:200px; border: 1px solid black; padding:5px; margin:2px;"></pre>
        </div>


        <br>
        <strong>Simulation Data JSON</strong> - Output amplitudes, detector results, display data, etc.
        <div style="margin: 10px 0 0 20px;">
            <button tabindex="107" id="export-amplitudes-button">Generate and Copy to Clipboard</button>&nbsp;<span id="export-amplitudes-result"></span>
            <input type="checkbox" tabindex="108" id="export-amplitudes-use-amps" style="float: right; margin-right: 10px;">
            <label style="float: right" for="export-amplitudes-use-amps">Skip output amplitudes</label>
            <br>
            <pre tabindex="109" id="export-amplitudes-pre" style="overflow:auto; max-width:600px; max-height:60px; border: 1px solid black; padding:5px; margin:2px;"></pre>
        </div>
    </div>
</div>


            <div id="gate-forge-div" style="display:none">
    <div id="gate-forge-overlay" style="position:fixed; left: 0; top: 0; height: 100vh; width: 100vw; background: rgba(0, 0, 0, 0.7);">
    </div>
    <div style="position: absolute; top: 20px; left: 50px; padding: 20px; background-color: white; border: 1px solid black;">
        <style scoped>
            th {
                font-size: 20px;
            }
        </style>
        <table cellspacing="0">
            <colgroup>
                <col style="background-color:#EEE;"/>
                <col/>
                <col style="background-color:#EEE;"/>
                <col/>
                <col style="background-color:#EEE;"/>
            </colgroup>
            <tr>
                <th>From Rotation</th>
                <th></th>
                <th>From Matrix</th>
                <th></th>
                <th>From Circuit</th>
            </tr>
            <tr>
                <td>
                    <input tabindex="100" id='gate-forge-rotation-axis' type="text" size="8" placeholder="X+Z"> axis<br/>
                    <input tabindex="101" id='gate-forge-rotation-angle' type="text" size="8" placeholder="45" style="margin:0.5em 0 0 0;">° angle<br/>
                    <input tabindex="102" id='gate-forge-rotation-phase' type="text" size="8" placeholder="0" style="margin:0.5em 0 0 0;">° global phase
                </td>
                <td></td>
                <td>
                    <style scoped>
                        input[id="gate-forge-matrix-fix"]:not(:checked) + label {
                            font-weight: bold;
                            background-color: pink;
                        }
                    </style>

                    <textarea tabindex="200" id="gate-forge-matrix" cols="25" rows="5" placeholder="1, i,  i, 1"></textarea><br/>

                    <input tabindex="201" id="gate-forge-matrix-fix" type="checkbox" checked>
                    <label for="gate-forge-matrix-fix">ensure unitary (by SVD)</label>
                </td>
                <td></td>
                <td>
                    From part of current circuit:<br/>
                    <input tabindex="300" id="gate-forge-circuit-cols" type="text" size="4" placeholder="1:∞" style="margin:0.5em 0 0 0;"> column range<br/>
                    <input tabindex="301" id="gate-forge-circuit-rows" type="text" size="4" placeholder="1:∞" style="margin:0.5em 0 0.5em 0;"> wire range<br/>
                    Inputs: <span id="gate-forge-circuit-inputs">(none)</span>, Weight: <span id="gate-forge-circuit-weight">0</span>
                </td>
            </tr>
            <tr>
                <td>
                    <canvas id="gate-forge-rotation-canvas" style="border:1px black solid;width:195px;height:100px;margin:10px 0 0 0;"></canvas>
                </td>
                <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>OR</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>
                    <canvas id="gate-forge-matrix-canvas" style="border:1px black solid;width:195px;height:100px;margin:10px 0 0 0;"></canvas>
                </td>
                <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>OR</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>
                    <canvas id="gate-forge-circuit-canvas" style="border:1px black solid;width:195px;height:100px;margin:10px 0 0 0;"></canvas>
                </td>
            </tr>
            <tr>
                <td>
                    <br/><input tabindex="110" id='gate-forge-rotation-name' type="text" placeholder="[the matrix]" style="width:7em;">  circuit symbol<br/><br/>
                </td>
                <td></td>
                <td>
                    <br/><input tabindex="210" id='gate-forge-matrix-name' type="text" placeholder="[the matrix]" style="width:7em;"> circuit symbol<br/><br/>
                </td>
                <td></td>
                <td>
                    <br/><input tabindex="310" id='gate-forge-circuit-name' type="text" placeholder="[the circuit]" style="width:7em;"> circuit symbol<br/><br/>
                </td>
            </tr>
            <tr>
                <td>
                    <button tabindex="120" id="gate-forge-rotation-button" style="width:100%;height:30px;">Create Rotation Gate</button>
                </td>
                <td></td>
                <td>
                    <button tabindex="220" id="gate-forge-matrix-button" style="width:100%;height:30px;">Create Matrix Gate</button>
                </td>
                <td></td>
                <td>
                    <button tabindex="320" id="gate-forge-circuit-button" style="width:100%;height:30px;">Create Circuit Gate</button>
                </td>
            </tr>
        </table>
    </div>
</div>

        </div>

        <div id="menu-div" style="display:block;">
    <div id="menu-overlay" style="position:fixed; left: 0; top: 0; height: 100vh; width: 100vw; background: rgba(0, 0, 0, 0.8);">
    </div>
    <div style="position:absolute; top:20px; left:50px; margin:0;">
        <div style="display:inline-block; padding:20px; background-color:white; border:1px solid black; text-align:center;">
            <div style="font-size: 32px;">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAJGUlEQVRYw6WXa2xUZRrHf+fM6ZyZdmY6M50yhdJSoLWtWUkLQmvF1W2AaAvpiss2Gy9LrLIJGq/EWyKJbnYDiTHRbDXULWtEN1sNYMuWRaAuKoyASitgOr1bLG1HhplhzrRz6XTOfmjniG3xts/59J7znuf5v+9z+z8CPyBNTU3U1tYCUFFRgc/vswIlQCFQDjimt3qBk0AX0GG32QMul2uWjrlEuNaH5uZmampqKCouShpFNsr3RsPRnLKKsrx0W7pceF1hNkBPb4+il/T+lv0tF2Wj3B0NR/dMq+lwd7oDSV0/GUBjYyN1dXVJ4w/mLMlZs/WRratMVpPV6XTiPuum7NYyPAMeAJyLnZz66BRFy4rweDyEAqFA/av1p4f6h44Cb7g73YGkzpmimwtAd0+31ZHpKF+Qt2D7fXX3bdm2fVvxdddfZ8hakMVA5wCKpFBcWIzP4wMga1EWvaO9iOMiJWUl5OXnGW5ff/vS9PT0m1ApiEVjl10uV8Dr9UZ+FMD0qTevXrP6oYcfebi67NYyvdliBiDoDzIyOsKK0hWkyCn4PX4AbFk2suxZDA8PY7FYMBgNxMZjSDpJnzkv8waz1Zzf4+6RHZkO90wQuquvvbun2wpsvu2O2+599oVny3KX5iLLsra5v78fYpC9OBudqNNuICMrA1Encnn4MoZUA109XTz7xFMcP3WY8+52ll2/PDcj0zGvv7dfdGQ63Dt37oy0tLQAICYDbto/JavXrL7r6e1PL7ekW2YEi4CaUDGZTUiSNMttkiRhMpvQp+nZ9vBjWG8+y7q/DlH90hBvN79Ebl7u8qrfVt0FlNTV1dHc3DwFoKmpSYv2BXkLttx9z92rZxqfQiri9/ixOq3XTClHtoM3X3kL/cJRNj1lwZKlw5wt8OBbaZzo+DcrVq1YXbyseEtRcZG1pqaGpqYmxNraWi3a77zrzg2LixZfI10EImMRzFbzNQFkZmQyOZkgrIQ5dyLM6SaFeFglPqGiTggsK11G5drKDcCDRcVF1tra2ikXACULlyxcs2HTBlMy4GYajxNHVEVMsglp+tGJOnSiTluLiNy4cjme3gm+PDSGIzcFW6qOT5tCqFEjJouJDZs2mPKvz1+TrC3SdIVj6yNbV11tXEBARNSMH3EdQVVVuvq6CIfCRMYjtO5rBaB6YzXGNCPxeJzG3X/H2x/nxD/H6Dk5wZGGELGh+bz8tyew2KZce/+W+1c999hzVFRUIPn8PqtslO81W81WVVUJ+oNcHLmImlDxe/xExiKIqoiqqjAJY74xUuQU7Jl2qmqqprJgXga7d+3mixNfcNp1mrV3rKXugQfoaD+LTtSxueE+iKpc8V3BYrOQZkkz6A363/v8vg4JKImGo0udTidnT54lPBFG1smYzCYKbyjEbDVjkk109XUx5hujdGUpCRIAJMYSSIJEZnYm/X39tH/RzvKVy9n2wjYqVlZwx8bbuXT5EufPnMdkNBGdjGJMMTJ/wfxELBJbBJRI01eic591M2mZpKK0AkOqYVaqhUNhUuQUEiRQUbX3kZQIT/7pST7Y9wGV1ZXc88d7MOgNJEgQJ44tw8Yta24hHo8TGY/ganfhPetN3fLQlryG+oZCCVg3PDL8q9r7azFZTKioCHO0iMh4BHumXVurqEzGJ9n+5Hba2tqoqa3h5V0v4/f6ufzt5TnrRJoljXW3riMUDOH6i2sBsEgCKMgvMHsGPIwyOmd66UQdrftaqaqpIjGWAHUKQOv7rbS1tVFZWcnjzzxO4EIA7xUvB5sPovgUchbmzKlPURQK8gvMhziExC8QSZQYDYyiQ8ejzzzKpt9tIkVIIZ6I/3xdyX6+vna99VoukJCo3liNPdNOQX4B/nE/J988SdnaMuzpdgqWFSAIAgICfb19VG+spvymcuJ8H1BSdygYovVAq5IEcDg3N7fm1EenrD8UhIZUA2ElzDdD3/D5fz+nanMVvl4f8UQcQfgOcHQ8iiHVMOukVwehLqgjOzd7GBiUABrqG3zv/uddvMNeznec19LQ6rRqaWhMMzLoHsTr8XLjb27ElmrjW/VbENBuTERkIjpBmj1tKnCjEZSAQsATIKSEiE5GceqdOJY52P70dh/QJQEdslHu9ng8q0vLS7VCFEvE6DrXpRWiOHFOfXyKmytvxn/JTyQSwa9M8YG+3j6i41EmohOMDo7CEAyeGyQhJDCkGbA5bchWmSXzl2CxWWj/rJ1p6tYh2W32gM/v2xMKhDYKgmBNt6eTbk+fKsU3fFeK9x3ZR9mvy1hUtIjwWBjfJR8Hmw9qpdiQapg6+RAIToHKikokJFTUWbVDCSiBaDi6x26zBySXy0VRcRH1r9afLi0vXZfsByoqk0xqfWHj2o18+P6HFOYXfqfIpwBQflO59m7w3CCVFZUa8FkpGFR47dXXTgO4XC6tG3YM9Q8dPfDegZASVGb9pKIiIZEQEoSiIeLTT87CHHIW5mjrUDREQkhoJ5/L+IH3DoSmyWqHRkjcne4A8Mb+vfsPDLgH5sxXFRVDmgEloFwzp5WAgiHNMKdxgAH3APv37j+QZMoaIWlubsbd6Q4Mfz3c8M7b7xwPXgnO+jlBApvTRsATuCaAgCeAzWnTmtXVErwSZM/be44Pfz3ckJwVNEJSU1NDY2MjQMfxo8f37nhxx5mZIFRUBFEgpISIx+Nz5nlICSGIwqwbCF4JsuPFHWdcR117gY7GxkZtUNFYcUtLC16vN+LIdLgHewfFwcFBkzPDmZtqTtWYsV7SM+oZxZ5hn0XLw6EwIyMjLFm6BIPRoPm868su6l+pP/7J4U/+Bbzp7nQHkox4zrkgCeJC/4XO9o52WVTFxXn5eXpZlpENMr4RH+6LbvLz8r9Hy4+dPIZVbyW3IBdBELSA2/X6rr1fnfnqJeDQdKz9+GS0c+fOyO7G3V/LKXLbZ59+Fjr24THV6XBm+Hw+w7z58/Bd8DFv/jxGvhkhFothtpoZ7h4mZ2mOt6+nL7X7q+7A8089/3HbwbZ/KAHlz+5O9/dmgV88nOqN+j/EwjHH+jvXl07GJ235+flmgK7urouSTlIOthw8Jxvl8f97OP0J4znAuhnbDyeN/pzx/H9hJ0Pb7MiyZAAAAABJRU5ErkJggg=="/>
                Welcome to Quirk
            </div>

            A drag-and-drop quantum circuit simulator.

            <div style="margin:20px;">
                <div id="loading-div" style="color:#D90; font-size:40px; display:block; height:120px; width:410px;">
                    Loading...
                </div>
                <button tabindex="50" id="close-menu-button" style="width:410px; height:120px; font-size:20px; display:none;">Edit Circuit</button>
            </div>

            <div style="display:inline-block; text-align:center; border:1px solid black; padding:2px;">
                <a tabindex="51" href="https://github.com/Strilanc/Quirk/wiki/How-to-use-Quirk">
                    <div style="width:128px;">
                        <svg version="1.1" viewBox="0 0 20 25" width="48" height="48">
                          <text x="5" y="9" style="font-size: 8px;">???</text>
                          <path d="M0 0 h20 v25 h-20 v-25 M3 13 h14 M3 17 h14 M3 21 h14" stroke="black" fill="transparent"></path>
                        </svg>
                        <div>How to Use</div>
                    </div>
                </a>
            </div>

            <div style="display:inline-block; text-align:center; border:1px solid black; padding:2px;">
                <a tabindex="52" href="https://www.youtube.com/watch?v=aloFwlBUwsQ">
                    <div style="width:128px;">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACt0lEQVQoz+3SP09TYRQG8IOL4RsgSNvbv4C4uMAkLgbippEw6CKwqIuGwW/gZEI6kIiDo0MnEk1MmEBLRQFbCnJLa6WlFK6K2kKrBarH55p7TUWa1vgm8pqe5Jc0vbfneZ+8JWYmmUl9+FqBWoFagf+hwP5Jn/TUQw/cgmG4Dz54DH4IQQwSkIaMgf+Q+bu0sStm7PYbWT4je9g4i36meio3a+2eOrgBGeBDKmOcse63Aql29yiwJO79cvjVE+4+YMn0/SyQbHNPA0tm+sfhV9rcdmBJOehNq2sQWFKDFG91eYEl5aXXLS4fsKR8FPM4A8BCtLq3hO2qToCiHqcKLMJOKrW3NnTzZbTFlRO1swKVlt1ODViEr9ks65NPpQor/VeCyx5XQdTuMjSKuBw5YBHMAvoU9/Z4MxzejvdeDOJZUVTGPjlS8UGUYkkBc/JbW7weCGRi53rm8c43kXk6euV0sCgHFTBv46OmcXp8/F3kTNeCyExadDhYlHIFSm/jbTLJqbGx9aWOjoiITFpw2FmUSgXM2/iwscFaIsHRgf7I32ZS2G5nUaopoM+237+61Nm5JCKT5hU7i1LxLxQKaerprrDITAopCotSrsAXVX0f6e4OiswyUdCmsCj7C+wkk9no+QtzeFYUmVOK5qxKDlgEs8CupuWjly7P4LtdUbvLyNGsVdGARSisJArxq9dmZ232gqidFWg0Y7GpwEJYlbywXdVR6UWzbQpYUlP0vNnmA5aUj6aPW73AkvLSsybrALCkBijQZFWAJaWQPlONlgCwZAJkztNGSy+wZHqpdJ4cs4wAS2KEDprJBssgJIEPqU24DnVUbiYamo/AKeiH23AXHsAjmISQIQ4J0CBjyAJX4bPx/idjh27R2DsBD43MUbgDQ3AWjv52YGaWWq1ArUCtQK3Av/UdR/1BF+14cggAAAAASUVORK5CYII=">
                        <div>Tutorial Video</div>
                    </div>
                </a>
            </div>

            <div style="display:inline-block; text-align:center; border:1px solid black; padding:2px;">
                <a tabindex="53" href="https://github.com/Strilanc/Quirk">
                    <div style="width:128px;">
                        <svg version="1.1" viewBox="0 0 16 16" width="48" height="48">
                            <path fill-rule="evenodd"
                                  d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z">
                            </path>
                        </svg>
                        <div>Source Code</div>
                    </div>
                </a>
            </div>
        </div>
        <div style="display:inline-block; vertical-align:top; line-height:1.8; padding:13px 15px 13px 5px; background-color:#DDD; border:1px solid gray; margin:0 0 0 -5px;">
            Example Circuits<br>
            <a id="example-anchor-grover">Grover Search</a><br>
            <a id="example-anchor-shor">Shor Period Finding</a><br>
            <a id="example-chsh-test">Bell Inequality Test (CHSH)</a><br>
            <a id="example-anchor-teleport">Quantum Teleportation</a><br>
            <a id="example-superdense-coding">Superdense Coding</a><br>
            <a id="example-anchor-delayed-eraser">Delayed Choice Eraser</a><br>
            <a id="example-symmetry-break">Symmetry Breaking</a><br>
            <a id="example-qft">Quantum Fourier Transform</a><br>
            <a id="example-addition">Reversible Addition</a><br>
            <a id="example-anchor-distill">Magic State Distillation</a><br>
        </div>
    </div>
</div>


        <div id="error-div" style="display:none; font-size:24px; font-family:monospace; color:red;">
    <div id="error-happened-div">An error happened. :(</div>
    <div id="error-message-div" style="font-size: 16px;"></div>
    <div id="error-known-div" style="font-size: 18px;">
        <br>
        <a id="error-known-issue-anchor">See more / complain about this issue on github</a>.
        <br>
        <br>
    </div>
    <div id="error-report-div">
        <br>
        Please report it:
        <ul style="font-size: 18px;">
            <li>
                <a id="error-github-anchor">Create an issue on github</a>
                (requires an account)
                (repository: <a href="https://github.com/Strilanc/Quirk">Strilanc/Quirk</a>)
            </li>
            <li>
                or <a id="error-mailto-anchor"></a>
            </li>
        </ul>
        <br>
        <br>
        Useful details to mention (auto-included if you use the create/email links above):
        <div style="font-size: 16px;">
            <br>
            <div id="error-description-div"></div>
            <br>
            PRE-DRAWN
            <br>
            <img id="error-image-pre" src="#" style="max-height: 250px; max-width: 600px"/>
            <br>
            POST-DRAWN
            <br>
            <img id="error-image-post" src="#" style="max-height: 250px; max-width: 600px"/>
        </div>
    </div>
</div>


        <!-- Javascript detection -->
        <div id="noscript-div" class="noscript-warning" style="
                        animation-duration: 3.0s;
                   -moz-animation-duration: 3.0s;
                -webkit-animation-duration: 3.0s;
                     -o-animation-duration: 3.0s;
                        animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                   -moz-animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                -webkit-animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                     -o-animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                      background-color: white;
                                border: 1px solid red;
                               padding: 10px;">
            <style scoped>
                @keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                    from { opacity: 0; }
                    95% { opacity: 0; }
                    to { opacity: 1; }
                }
                @-webkit-keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                    from { opacity: 0; }
                    95% { opacity: 0; }
                    to { opacity: 1; }
                }
                @-moz-keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                    from { opacity: 0; }
                    95% { opacity: 0; }
                    to { opacity: 1; }
                }
                @-o-keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                    from { opacity: 0; }
                    95% { opacity: 0; }
                    to { opacity: 1; }
                }

                .noscript-warning {
                    color: red;
                    font-size: 24px;
                    position: absolute;
                    top: 25%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                }
            </style>
            You appear to have JavaScript blocked. And Quirk is made out of JavaScript... :(
        </div>
        <script>
          document.getElementById('noscript-div').style.display = 'none';
        </script>

        <script>
          document.getElementById('noscript-div').style.display = 'block';
          //noinspection InnerHTMLJS
          document.QUIRK_QUINE_ALL_HTML_ORIGINAL = '<!'+'DOCTYPE html>\n<'+'html>\n    ' +
                  document.documentElement.innerHTML + '\n<' + '/html>';
          document.getElementById('noscript-div').style.display = 'none';
//DEFAULT_CIRCUIT_START
document.DEFAULT_CIRCUIT = undefined;
//DEFAULT_CIRCUIT_END

// UN-MINIFIED SOURCE IS AVAILABLE FROM github.com/Strilanc/Quirk

!function(e){"use strict";function t(e){e.Reflect=e.Reflect||{},e.Reflect.global=e.Reflect.global||e}e.$traceurRuntime||(t(e),e.$traceurRuntime={options:{},setupGlobals:t,typeof:function(e){return typeof e}})}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),function(){var t=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),c={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7};function u(e){return e.match(t)}function d(e){if("/"===e)return"/";for(var t="/"===e[0]?"/":"",r="/"===e.slice(-1)?"/":"",n=e.split("/"),i=[],a=0,o=0;o<n.length;o++){var u=n[o];switch(u){case"":case".":break;case"..":i.length?i.pop():a++;break;default:i.push(u)}}if(!t){for(;0<a--;)i.unshift("..");0===i.length&&i.push(".")}return t+i.join("/")+r}function s(e){var t,r,n,i,a,o,u,s,l=d(l=e[c.PATH]||"");return e[c.PATH]=l,t=e[c.SCHEME],r=e[c.USER_INFO],n=e[c.DOMAIN],i=e[c.PORT],a=e[c.PATH],o=e[c.QUERY_DATA],u=e[c.FRAGMENT],s=[],t&&s.push(t,":"),n&&(s.push("//"),r&&s.push(r,"@"),s.push(n),i&&s.push(":",i)),a&&s.push(a),o&&s.push("?",o),u&&s.push("#",u),s.join("")}$traceurRuntime.canonicalizeUrl=function(e){return s(u(e))},$traceurRuntime.isAbsolute=function(e){return!!e&&("/"===e[0]||!!u(e)[c.SCHEME])},$traceurRuntime.removeDotSegments=d,$traceurRuntime.resolveUrl=function(e,t){var r=u(t),n=u(e);if(r[c.SCHEME])return s(r);r[c.SCHEME]=n[c.SCHEME];for(var i=c.SCHEME;i<=c.PORT;i++)r[i]||(r[i]=n[i]);if("/"==r[c.PATH][0])return s(r);var a=(o=n[c.PATH]).lastIndexOf("/"),o=o.slice(0,a+1)+r[c.PATH];return r[c.PATH]=o,s(r)}}(),function(t){"use strict";var r,e=$traceurRuntime,n=e.canonicalizeUrl,i=e.resolveUrl,a=e.isAbsolute,o=Object.create(null);function u(e,t){this.url=e,this.value_=t}function s(e,t){this.message=this.constructor.name+": "+this.stripCause(t)+" in "+e,t instanceof s||!t.stack?this.stack="":this.stack=this.stripStack(t.stack)}function l(e){for(var t="",r=0;r<e-1;r++)t+="-";return t}function c(e,t){u.call(this,e,null),this.func=t}r=t.location&&t.location.href?i(t.location.href,"./"):"",((s.prototype=Object.create(Error.prototype)).constructor=s).prototype.stripError=function(e){return e.replace(/.*Error:/,this.constructor.name+":")},s.prototype.stripCause=function(e){return e?e.message?this.stripError(e.message):e+"":""},s.prototype.loadedBy=function(e){this.stack+="\n loaded by "+e},s.prototype.stripStack=function(e){var t=[];return e.split("\n").some(function(e){return!!/UncoatedModuleInstantiator/.test(e)||void t.push(e)}),t[0]=this.stripError(t[0]),t.join("\n")},(c.prototype=Object.create(u.prototype)).getUncoatedModule=function(){var e,i,a,o=this;if(this.value_)return this.value_;try{return $traceurRuntime.require&&(e=$traceurRuntime.require.bind(null,this.url)),this.value_=this.func.call(t,e)}catch(e){if(e instanceof s)throw e.loadedBy(this.url),e;throw e.stack&&(i=this.func.toString().split("\n"),a=[],e.stack.split("\n").some(function(e,t){if(0<e.indexOf("UncoatedModuleInstantiator.getUncoatedModule"))return!0;var r,n=/(at\s[^\s]*\s).*>:(\d*):(\d*)\)/.exec(e);n?(r=parseInt(n[2],10),a=a.concat(function(e,t){var r=[],n=t-3;n<0&&(n=0);for(var i=n;i<t;i++)r.push(e[i]);return r}(i,r)),1===t?a.push(l(n[3])+"^ "+o.url):a.push(l(n[3])+"^"),(a=a.concat(function(e,t){var r=t+1;r>e.length-1&&(r=e.length-1);for(var n=[],i=t;i<=r;i++)n.push(e[i]);return n}(i,r))).push("= = = = = = = = =")):a.push(e)}),e.stack=a.join("\n")),new s(this.url,e)}};var d=Object.create(null),m={};function f(i){var a=arguments[1],o=Object.create(null);return Object.getOwnPropertyNames(i).forEach(function(e){var t,r,n;a!==m||(n=Object.getOwnPropertyDescriptor(i,e)).get&&(t=n.get),t||(r=i[e],t=function(){return r}),Object.defineProperty(o,e,{get:t,enumerable:!0})}),Object.preventExtensions(o),o}var h={normalize:function(e,t,r){if("string"!=typeof e)throw new TypeError("module name must be a string, not "+typeof e);if(a(e))return n(e);if(/[^\.]\/\.\.\//.test(e))throw new Error("module name embeds /../: "+e);return"."===e[0]&&t?i(t,e):n(e)},get:function(e){var t=function(e){if(e){var t=h.normalize(e);return o[t]}}(e);if(t){var r=d[t.url];return r?r:(r=f(t.getUncoatedModule(),m),d[t.url]=r)}},set:function(e,t){e=String(e),o[e]=new c(e,function(){return t}),d[e]=t},get baseURL(){return r},set baseURL(e){r=String(e)},registerModule:function(e,t,r){var n=h.normalize(e);if(o[n])throw new Error("duplicate module named "+n);o[n]=new c(n,r)},bundleStore:Object.create(null),register:function(e,t,i){t&&(t.length||i.length)?this.bundleStore[e]={deps:t,execute:function(){var r=arguments,n={};t.forEach(function(e,t){return n[e]=r[t]});var e=i.call(this,n);return e.execute.call(this),e.exports}}:this.registerModule(e,t,i)},getAnonymousModule:function(e){return new f(e(),m)}},g=new f({ModuleStore:h});h.set("@traceur/src/runtime/ModuleStore.js",g);var p=$traceurRuntime.setupGlobals;$traceurRuntime.setupGlobals=function(e){p(e)},$traceurRuntime.ModuleStore=h,$traceurRuntime.registerModule=h.registerModule.bind(h),$traceurRuntime.getModule=h.get,$traceurRuntime.setModule=h.set,$traceurRuntime.normalizeModuleName=h.normalize}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/new-unique-string.js",[],function(){"use strict";var e=Math.random,t=Date.now()%1e9;function r(){return"__$"+(1e9*e()>>>1)+"$"+ ++t+"$__"}return{get default(){return r}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/has-native-symbols.js",[],function(){"use strict";var e=!!Object.getOwnPropertySymbols&&"function"==typeof Symbol;function t(){return e}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/symbols.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../new-unique-string.js","traceur-runtime@0.0.111/src/runtime/modules/symbols.js")).default,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/modules/symbols.js")).default,t=Object.create,n=Object.defineProperty,i=Object.freeze,a=Object.getOwnPropertyNames,o=Object.keys,u=TypeError;function s(e){return{configurable:!0,enumerable:!1,value:e,writable:!0}}var l=r(),c=r(),d=r(),m=t(null),f=function(e){var t=new h(e);if(!(this instanceof f))return t;throw new u("Symbol cannot be new'ed")};function h(e){var t=r();n(this,d,{value:this}),n(this,l,{value:t}),n(this,c,{value:e}),i(this),m[t]=this}function g(e){for(var t,r=[],n=0;n<e.length;n++)t=e[n],m[t]||r.push(e[n]);return r}function p(e){return g(a(e))}function v(e){return g(o(e))}function y(e){for(var t=[],r=a(e),n=0;n<r.length;n++){var i=m[r[n]];i&&t.push(i)}return t}n(f.prototype,"constructor",s(f)),n(f.prototype,"toString",s(function(){return this[d][l]})),n(f.prototype,"valueOf",s(function(){var e=this[d];if(!e)throw u("Conversion from symbol to string");return e[l]})),n(h.prototype,"constructor",s(f)),n(h.prototype,"toString",{value:f.prototype.toString,enumerable:!1}),n(h.prototype,"valueOf",{value:f.prototype.valueOf,enumerable:!1}),i(h.prototype);var b,R,w="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0;R=(b=w).Object,e()||(b.Symbol=f,R.getOwnPropertyNames=p,R.keys=v,n(R,"getOwnPropertySymbols",s(y))),b.Symbol.iterator||(b.Symbol.iterator=b.Symbol("Symbol.iterator")),b.Symbol.observer||(b.Symbol.observer=b.Symbol("Symbol.observer"));var M=e()?function(e){return typeof e}:function(e){return e instanceof h?"symbol":typeof e};return{get typeof(){return M}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/typeof.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./symbols.js","traceur-runtime@0.0.111/src/runtime/modules/typeof.js"));return{get default(){return e.typeof}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/symbols.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/typeof.js","traceur-runtime@0.0.111/src/runtime/symbols.js")).default;return $traceurRuntime.typeof=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createClass.js",[],function(){"use strict";var a=Object,o=TypeError,e=Object,u=e.create,s=e.defineProperties,l=e.defineProperty,n=e.getOwnPropertyDescriptor,r=e.getOwnPropertyNames,i=e.getOwnPropertySymbols;function c(e,t){r(e).forEach(t),i&&i(e).forEach(t)}function d(t){var r={};return c(t,function(e){r[e]=n(t,e),r[e].enumerable=!1}),r}var m={enumerable:!1};function t(e,t,r,n){var i;return l(t,"constructor",{value:e,configurable:!0,enumerable:!1,writable:!0}),3<arguments.length?("function"==typeof n&&(e.__proto__=n),e.prototype=u(function(e){if("function"==typeof e){var t=e.prototype;if(a(t)===t||null===t)return e.prototype;throw new o("super prototype must be an Object or null")}if(null===e)return null;throw new o("Super expression must either be null or a function, not "+typeof e+".")}(n),d(t))):(c(i=t,function(e){l(i,e,m)}),e.prototype=t),l(e,"prototype",{configurable:!1,writable:!1}),s(e,d(r))}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superConstructor.js",[],function(){"use strict";function e(e){return e.__proto__}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superDescriptor.js",[],function(){"use strict";var e=Object,i=e.getOwnPropertyDescriptor,a=e.getPrototypeOf;function t(e,t){var r=a(e);do{var n=i(r,t);if(n)return n;r=a(r)}while(r)}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superGet.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./superDescriptor.js","traceur-runtime@0.0.111/src/runtime/modules/superGet.js")).default;function e(e,t,r){var n=a(t,r);if(n){var i=n.value;return i?i:n.get?n.get.call(e):i}}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superSet.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./superDescriptor.js","traceur-runtime@0.0.111/src/runtime/modules/superSet.js")).default,o=TypeError;function e(e,t,r,n){var i=a(t,r);if(i&&i.set)return i.set.call(e,n),n;throw o("super has no setter '"+r+"'.")}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/classes.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createClass.js","traceur-runtime@0.0.111/src/runtime/classes.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/superConstructor.js","traceur-runtime@0.0.111/src/runtime/classes.js")).default,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/superGet.js","traceur-runtime@0.0.111/src/runtime/classes.js")).default,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/superSet.js","traceur-runtime@0.0.111/src/runtime/classes.js")).default;return $traceurRuntime.createClass=e,$traceurRuntime.superConstructor=t,$traceurRuntime.superGet=r,$traceurRuntime.superSet=n,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/exportStar.js",[],function(){"use strict";var e=Object,o=e.defineProperty,u=e.getOwnPropertyNames;function t(i){for(var a=arguments,e=1;e<arguments.length;e++)!function(e){for(var r=a[e],n=u(r),t=0;t<n.length;t++)(function(e){var t=n[e];if("__esModule"===t||"default"===t)return;o(i,t,{get:function(){return r[t]},enumerable:!0})})(t)}(e);return i}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/exportStar.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/exportStar.js","traceur-runtime@0.0.111/src/runtime/exportStar.js")).default;return $traceurRuntime.exportStar=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/private-symbol.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./new-unique-string.js","traceur-runtime@0.0.111/src/runtime/private-symbol.js")).default,r="function"==typeof Symbol?Symbol:void 0,a=Object.getOwnPropertySymbols,n=(0,Object.create)(null);function o(e){return n[e]}function e(){var e=(r||t)();return n[e]=!0,e}function i(e,t){return hasOwnProperty.call(e,t)}function u(e,t){return!!i(e,t)&&(delete e[t],!0)}function s(e,t,r){e[t]=r}function l(e,t){var r=e[t];if(void 0!==r)return hasOwnProperty.call(e,t)?r:void 0}function c(){a&&(Object.getOwnPropertySymbols=function(e){for(var t=[],r=a(e),n=0;n<r.length;n++){var i=r[n];o(i)||t.push(i)}return t})}return{get isPrivateSymbol(){return o},get createPrivateSymbol(){return e},get hasPrivate(){return i},get deletePrivate(){return u},get setPrivate(){return s},get getPrivate(){return l},get init(){return c}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/private-weak-map.js",[],function(){"use strict";var e="function"==typeof WeakMap?WeakMap:void 0;function t(e){return!1}function r(){return new e}function n(e,t){return t.has(e)}function i(e,t){return t.delete(e)}function a(e,t,r){t.set(e,r)}function o(e,t){return t.get(e)}function u(){}return{get isPrivateSymbol(){return t},get createPrivateSymbol(){return r},get hasPrivate(){return n},get deletePrivate(){return i},get setPrivate(){return a},get getPrivate(){return o},get init(){return u}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/private.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./private-symbol.js","traceur-runtime@0.0.111/src/runtime/private.js")),t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./private-weak-map.js","traceur-runtime@0.0.111/src/runtime/private.js")),r="function"==typeof WeakMap?t:e,n=r.isPrivateSymbol,i=r.createPrivateSymbol,a=r.hasPrivate,o=r.deletePrivate,u=r.setPrivate,s=r.getPrivate;return r.init(),{get isPrivateSymbol(){return n},get createPrivateSymbol(){return i},get hasPrivate(){return a},get deletePrivate(){return o},get setPrivate(){return u},get getPrivate(){return s}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/properTailCalls.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/modules/properTailCalls.js")),t=e.getPrivate,r=e.setPrivate,n=e.createPrivateSymbol,a=Function.prototype.call.bind(Function.prototype.apply),i=Object.create(null),o=null;function u(e,t,r){return[i,e,t,r]}function s(e){return e&&e[0]===i}function l(e,t){return new(function(e,t,r){for(var n=[t],i=0;i<r.length;i++)n[i+1]=r[i];return a(Function.prototype.bind,e,n)}(e,null,t))}function c(e){return t(e,o)}function d(e,t,r){var n=r[0];if(s(n))return n=a(e,t,n[3]);for(n=u(e,t,r);;){if(!s(n=c(e)?a(e,n[2],[n]):a(e,n[2],n[3])))return n;e=n[1]}}function m(){var e=c(this)?l(this,[u(null,null,arguments)]):l(this,arguments);return e}function f(e){return null===o&&(o=n(),Function.prototype.call=f(function(e){return d(function(e){for(var t=[],r=1;r<arguments.length;++r)t[r-1]=arguments[r];return u(this,e,t)},this,arguments)}),Function.prototype.apply=f(function(e,t){return d(function(e,t){return u(this,e,t)},this,arguments)})),r(e,o,!0),e}return{get createContinuation(){return u},get tailCall(){return d},get construct(){return m},get initTailRecursiveFunction(){return f}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/initTailRecursiveFunction.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/initTailRecursiveFunction.js"));return{get default(){return e.initTailRecursiveFunction}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/call.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/call.js"));return{get default(){return e.tailCall}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/continuation.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/continuation.js"));return{get default(){return e.createContinuation}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/construct.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/construct.js"));return{get default(){return e.construct}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/properTailCalls.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/initTailRecursiveFunction.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/call.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js")).default,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/continuation.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js")).default,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/construct.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js")).default;return $traceurRuntime.initTailRecursiveFunction=e,$traceurRuntime.call=t,$traceurRuntime.continuation=r,$traceurRuntime.construct=n,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/relativeRequire.js",[],function(){"use strict";var r;return $traceurRuntime.require=function(e,t){if(r=r||"undefined"!=typeof require&&require("path"),"/"!==t.slice(-1)&&"/"!==t[0])return"."===t[0]?require(r.resolve(r.dirname(e),t)):require(t)},{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/checkObjectCoercible.js",[],function(){"use strict";var t=TypeError;function e(e){if(null==e)throw new t("Value cannot be converted to an Object");return e}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/spread.js",[],function(){"use strict";var o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../checkObjectCoercible.js","traceur-runtime@0.0.111/src/runtime/modules/spread.js")).default;function e(){for(var e,t=[],r=0,n=0;n<arguments.length;n++){var i=o(arguments[n]);if("function"!=typeof i[Symbol.iterator])throw new TypeError("Cannot spread non-iterable object.");for(var a=i[Symbol.iterator]();!(e=a.next()).done;)t[r++]=e.value}return t}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/spread.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/spread.js","traceur-runtime@0.0.111/src/runtime/spread.js")).default;return $traceurRuntime.spread=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/iteratorToArray.js",[],function(){"use strict";function e(e){for(var t,r=[],n=0;!(t=e.next()).done;)r[n++]=t.value;return r}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/destructuring.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/iteratorToArray.js","traceur-runtime@0.0.111/src/runtime/destructuring.js")).default;return $traceurRuntime.iteratorToArray=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/async.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/modules/async.js")),t=e.createPrivateSymbol,n=e.getPrivate,a=e.setPrivate,r=Object,o=r.create,i=r.defineProperty,u=t();function s(){}function l(){}(s.prototype=l).constructor=s,i(l,"constructor",{enumerable:!1});var c=$traceurRuntime.createClass(function(e){var t=this;this.decoratedObserver=y(e,function(){t.done=!0}),this.done=!1,this.inReturn=!1},{throw:function(e){if(!this.inReturn)throw e},yield:function(e){if(this.done)throw void(this.inReturn=!0);var t;try{t=this.decoratedObserver.next(e)}catch(e){throw this.done=!0,e}if(void 0!==t){if(t.done)throw this.done=!0,void(this.inReturn=!0);return t.value}},yieldFor:function(e){var r=this;return f(e[Symbol.observer].bind(e),function(e){if(r.done)this.return();else{var t;try{t=r.decoratedObserver.next(e)}catch(e){throw r.done=!0,e}if(void 0!==t)return t.done&&(r.done=!0),t}})}},{});function d(e){return e.prototype=o(l.prototype),e.__proto__=l,e}function m(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=o(t.prototype);return a(i,u,e),i}function f(e,i){return new Promise(function(t,r){var n=e({next:function(e){return i.call(n,e)},throw:function(e){r(e)},return:function(e){t(e)}})})}function h(e){return Promise.resolve().then(e)}l.prototype[Symbol.observer]=function(e){var t=n(this,u),r=new c(e);return h(function(){return t(r)}).then(function(e){r.done||r.decoratedObserver.return(e)}).catch(function(e){r.done||r.decoratedObserver.throw(e)}),r.decoratedObserver},i(l.prototype,Symbol.observer,{enumerable:!1});var g=Symbol(),p=Symbol(),v=$traceurRuntime.createClass(function(e,t){this[g]=e,this[p]=t},{next:function(e){var t=this[g].next(e);return void 0!==t&&t.done&&this[p].call(this),t},throw:function(e){return this[p].call(this),this[g].throw(e)},return:function(e){return this[p].call(this),this[g].return(e)}},{});function y(e,t){return new v(e,t)}return Array.prototype[Symbol.observer]=function(e){var t=!1,r=y(e,function(){return t=!0}),n=!0,i=!1,a=void 0;try{for(var o,u=this[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;if(r.next(s),t)return}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r.return(),r},i(Array.prototype,Symbol.observer,{enumerable:!1}),{get initAsyncGeneratorFunction(){return d},get createAsyncGeneratorInstance(){return m},get observeForEach(){return f},get schedule(){return h},get createDecoratedGenerator(){return y}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/initAsyncGeneratorFunction.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/initAsyncGeneratorFunction.js"));return{get default(){return e.initAsyncGeneratorFunction}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createAsyncGeneratorInstance.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/createAsyncGeneratorInstance.js"));return{get default(){return e.createAsyncGeneratorInstance}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/observeForEach.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/observeForEach.js"));return{get default(){return e.observeForEach}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/schedule.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/schedule.js"));return{get default(){return e.schedule}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createDecoratedGenerator.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/createDecoratedGenerator.js"));return{get default(){return e.createDecoratedGenerator}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/async.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/initAsyncGeneratorFunction.js","traceur-runtime@0.0.111/src/runtime/async.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createAsyncGeneratorInstance.js","traceur-runtime@0.0.111/src/runtime/async.js")).default,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/observeForEach.js","traceur-runtime@0.0.111/src/runtime/async.js")).default,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/schedule.js","traceur-runtime@0.0.111/src/runtime/async.js")).default,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createDecoratedGenerator.js","traceur-runtime@0.0.111/src/runtime/async.js")).default;return $traceurRuntime.initAsyncGeneratorFunction=e,$traceurRuntime.createAsyncGeneratorInstance=t,$traceurRuntime.observeForEach=r,$traceurRuntime.schedule=n,$traceurRuntime.createDecoratedGenerator=i,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/generators.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/modules/generators.js")),t=e.createPrivateSymbol,r=e.getPrivate,o=e.setPrivate,u=TypeError,n=Object,s=n.create,i=n.defineProperties,a=n.defineProperty;function l(e){return{configurable:!0,enumerable:!1,value:e,writable:!0}}var c=0;function d(e){return new Error("Traceur compiler bug: invalid state in state machine: "+e)}var m={};function f(){this.state=0,this.GState=c,this.storedException=void 0,this.finallyFallThrough=void 0,this.sent_=void 0,this.returnValue=void 0,this.oldReturnValue=void 0,this.tryStack_=[]}function h(t,e,r,n){switch(t.GState){case 1:throw new Error('"'+r+'" on executing generator');case 3:if("next"==r)return{value:void 0,done:!0};if(n===m)return{value:t.returnValue,done:!0};throw n;case c:if("throw"===r){if(t.GState=3,n===m)return{value:t.returnValue,done:!0};throw n}if(void 0!==n)throw u("Sent value to newborn generator");case 2:var i;t.GState=1,t.action=r,t.sent=n;try{i=e(t)}catch(e){if(e!==m)throw e;i=t}var a=i===t;return a&&(i=t.returnValue),t.GState=a?3:2,{value:i,done:a}}}f.prototype={pushTry:function(e,t){if(null!==t){for(var r=null,n=this.tryStack_.length-1;0<=n;n--)if(void 0!==this.tryStack_[n].catch){r=this.tryStack_[n].catch;break}null===r&&(r=-3),this.tryStack_.push({finally:t,finallyFallThrough:r})}null!==e&&this.tryStack_.push({catch:e})},popTry:function(){this.tryStack_.pop()},maybeUncatchable:function(){if(this.storedException===m)throw m},get sent(){return this.maybeThrow(),this.sent_},set sent(e){this.sent_=e},get sentIgnoreThrow(){return this.sent_},maybeThrow:function(){if("throw"===this.action)throw this.action="next",this.sent_},end:function(){switch(this.state){case-2:return this;case-3:throw this.storedException;default:throw d(this.state)}},handleException:function(e){throw this.GState=3,this.state=-2,e},wrapYieldStar:function(r){var n=this;return{next:function(e){return r.next(e)},throw:function(e){var t;if(e===m){if(r.return){if(!(t=r.return(n.returnValue)).done)return n.returnValue=n.oldReturnValue,t;n.returnValue=t.value}throw e}if(r.throw)return r.throw(e);throw r.return&&r.return(),u("Inner iterator does not have a throw method")}}}};var g=t(),p=t();function v(){}function y(){}function b(e,t,r){var n=_(e,r),i=new f,a=s(t.prototype);return o(a,g,i),o(a,p,n),a}function R(e){return e.prototype=s(y.prototype),e.__proto__=y,e}function w(){f.call(this),this.err=void 0;var r=this;r.result=new Promise(function(e,t){r.resolve=e,r.reject=t})}function M(e,t){var r=_(e,t),n=new w;return n.createCallback=function(t){return function(e){n.state=t,n.value=e,r(n)}},n.errback=function(e){x(n,e),r(n)},r(n),n.result}function _(e,r){return function(t){for(;;)try{return e.call(r,t)}catch(e){x(t,e)}}}function x(e,t){e.storedException=t;var r=e.tryStack_[e.tryStack_.length-1];r?(e.state=void 0!==r.catch?r.catch:r.finally,void 0!==r.finallyFallThrough&&(e.finallyFallThrough=r.finallyFallThrough)):e.handleException(t)}return a(v.prototype=y,"constructor",l(v)),i(y.prototype={constructor:y,next:function(e){return h(r(this,g),r(this,p),"next",e)},throw:function(e){return h(r(this,g),r(this,p),"throw",e)},return:function(e){var t=r(this,g);return t.oldReturnValue=t.returnValue,t.returnValue=e,h(t,r(this,p),"throw",m)}},{constructor:{enumerable:!1},next:{enumerable:!1},throw:{enumerable:!1},return:{enumerable:!1}}),Object.defineProperty(y.prototype,Symbol.iterator,l(function(){return this})),(w.prototype=s(f.prototype)).end=function(){switch(this.state){case-2:this.resolve(this.returnValue);break;case-3:this.reject(this.storedException);break;default:this.reject(d(this.state))}},w.prototype.handleException=function(){this.state=-3},{get createGeneratorInstance(){return b},get initGeneratorFunction(){return R},get asyncWrap(){return M}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/asyncWrap.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/modules/asyncWrap.js"));return{get default(){return e.asyncWrap}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/initGeneratorFunction.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/modules/initGeneratorFunction.js"));return{get default(){return e.initGeneratorFunction}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createGeneratorInstance.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/modules/createGeneratorInstance.js"));return{get default(){return e.createGeneratorInstance}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/generators.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/asyncWrap.js","traceur-runtime@0.0.111/src/runtime/generators.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/initGeneratorFunction.js","traceur-runtime@0.0.111/src/runtime/generators.js")).default,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createGeneratorInstance.js","traceur-runtime@0.0.111/src/runtime/generators.js")).default;return $traceurRuntime.asyncWrap=e,$traceurRuntime.initGeneratorFunction=t,$traceurRuntime.createGeneratorInstance=r,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/spawn.js",[],function(){"use strict";function e(e,o,u){return new Promise(function(t,r){function n(e){try{a(u.next(e))}catch(e){r(e)}}function i(e){try{a(u.throw(e))}catch(e){r(e)}}function a(e){e.done?t(e.value):Promise.resolve(e.value).then(n,i)}a((u=u.apply(e,o)).next())})}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/spawn.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/spawn.js","traceur-runtime@0.0.111/src/runtime/spawn.js")).default;return $traceurRuntime.spawn=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/getTemplateObject.js",[],function(){"use strict";var e=Object,i=e.defineProperty,a=e.freeze,o=Array.prototype.slice,u=Object.create(null);function t(e){var t=arguments[1],r=e.join("${}"),n=u[r];return n||(t=t||o.call(e),u[r]=a(i(t,"raw",{value:a(e)})))}return{get default(){return t}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/template.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/getTemplateObject.js","traceur-runtime@0.0.111/src/runtime/template.js")).default;return $traceurRuntime.getTemplateObject=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/spreadProperties.js",[],function(){"use strict";var e=Object,o=e.defineProperty,t=e.getOwnPropertyNames,r=e.getOwnPropertySymbols,u=e.propertyIsEnumerable;function n(i,a){var e;null!=a&&((e=function(e){for(var t=0;t<e.length;t++){var r,n=e[t];u.call(a,n)&&(r=a[n],o(i,n,{configurable:!0,enumerable:!0,value:r,writable:!0}))}})(t(a)),e(r(a)))}function i(){for(var e=arguments[0],t=1;t<arguments.length;t++)n(e,arguments[t]);return e}return{get default(){return i}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/jsx.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/spreadProperties.js","traceur-runtime@0.0.111/src/runtime/jsx.js")).default;return $traceurRuntime.spreadProperties=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/runtime-modules.js",[],function(){"use strict";return $traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./symbols.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./classes.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./exportStar.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./relativeRequire.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./spread.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./destructuring.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./spawn.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./template.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./jsx.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),{}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/runtime-modules.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/frozen-data.js",[],function(){"use strict";function n(e,t){for(var r=0;r<e.length;r+=2)if(e[r]===t)return r;return-1}function e(e,t,r){-1===n(e,t)&&e.push(t,r)}function t(e,t){var r=n(e,t);if(-1!==r)return e[r+1]}function r(e,t){return-1!==n(e,t)}function i(e,t){var r=n(e,t);return-1!==r&&(e.splice(r,2),!0)}return{get setFrozen(){return e},get getFrozen(){return t},get hasFrozen(){return r},get deleteFrozen(){return i}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/utils.js",[],function(){"use strict";var t=Math.ceil,r=Math.floor,n=isFinite,i=isNaN,e=Math.pow,a=Math.min,o=TypeError,u=Object;function s(e){if(null==e)throw o();return u(e)}function l(e){return e>>>0}function c(e){return e&&("object"==typeof e||"function"==typeof e)}function d(e){return"function"==typeof e}function m(e){return"number"==typeof e}function f(e){return i(e=+e)?0:0!==e&&n(e)?(0<e?r:t)(e):e}var h=e(2,53)-1;function g(e){var t=f(e);return t<0?0:a(t,h)}function p(e){return c(e)?e[Symbol.iterator]:void 0}function v(e){return d(e)}function y(e,t){return{value:e,done:t}}function b(e,t,r){t in e||Object.defineProperty(e,t,r)}function R(e,t,r){b(e,t,{value:r,configurable:!0,enumerable:!1,writable:!0})}function w(e,t,r){b(e,t,{value:r,configurable:!1,enumerable:!1,writable:!1})}function M(e,t){for(var r=0;r<t.length;r+=2){R(e,t[r],t[r+1])}}function _(e,t){for(var r=0;r<t.length;r+=2){w(e,t[r],t[r+1])}}function x(e,t,r){r&&r.iterator&&!e[r.iterator]&&(e["@@iterator"]&&(t=e["@@iterator"]),Object.defineProperty(e,r.iterator,{value:t,configurable:!0,enumerable:!1,writable:!0}))}var S=[];function T(e){S.push(e)}function A(t){S.forEach(function(e){return e(t)})}return{get toObject(){return s},get toUint32(){return l},get isObject(){return c},get isCallable(){return d},get isNumber(){return m},get toInteger(){return f},get toLength(){return g},get checkIterable(){return p},get isConstructor(){return v},get createIteratorResultObject(){return y},get maybeDefine(){return b},get maybeDefineMethod(){return R},get maybeDefineConst(){return w},get maybeAddFunctions(){return M},get maybeAddConsts(){return _},get maybeAddIterator(){return x},get registerPolyfill(){return T},get polyfillAll(){return A}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Map.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")),t=e.createPrivateSymbol,r=e.getPrivate,o=e.setPrivate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../frozen-data.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")),i=n.deleteFrozen,a=n.getFrozen,u=n.setFrozen,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")),c=s.isObject,l=s.registerPolyfill,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")).default,m=Object,f=m.defineProperty,h=(m.getOwnPropertyDescriptor,m.hasOwnProperty),g=m.isExtensible,p={},v=1,y=t();function b(e){return r(e,y)}function R(e,t){if("string"==typeof t)return e.stringIndex_[t];if(c(t)){if(!g(t))return a(e.frozenData_,t);var r=b(t);if(void 0===r)return;return e.objectIndex_[r]}return e.primitiveIndex_[t]}function w(e){e.entries_=[],e.objectIndex_=Object.create(null),e.stringIndex_=Object.create(null),e.primitiveIndex_=Object.create(null),e.frozenData_=[],e.deletedCount_=0}var M=$traceurRuntime.createClass(function(){var e,t,r=arguments[0];if(!c(this))throw new TypeError("Map called on incompatible type");if(h.call(this,"entries_"))throw new TypeError("Map can not be reentrantly initialised");if(w(this),null!=r){var n=!0,i=!1,a=void 0;try{for(var o,u=r[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=(t=(e=o.value[Symbol.iterator]()).next()).done?void 0:t.value,l=(t=e.next()).done?void 0:t.value;this.set(s,l)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}},{get size(){return this.entries_.length/2-this.deletedCount_},get:function(e){var t=R(this,e);if(void 0!==t)return this.entries_[t+1]},set:function(e,t){var r,n,i,a=R(this,e);return void 0!==a?this.entries_[a+1]=t:(a=this.entries_.length,this.entries_[a]=e,this.entries_[a+1]=t,c(e)?g(e)?((i=b(n=e))||(i=v++,o(n,y,i)),r=i,this.objectIndex_[r]=a):u(this.frozenData_,e,a):"string"==typeof e?this.stringIndex_[e]=a:this.primitiveIndex_[e]=a),this},has:function(e){return void 0!==R(this,e)},delete:function(e){var t,r=R(this,e);return void 0!==r&&(this.entries_[r]=p,this.entries_[r+1]=void 0,this.deletedCount_++,c(e)?g(e)?(t=b(e),delete this.objectIndex_[t]):i(this.frozenData_,e):"string"==typeof e?delete this.stringIndex_[e]:delete this.primitiveIndex_[e],!0)},clear:function(){w(this)},forEach:function(e){for(var t=arguments[1],r=0;r<this.entries_.length;r+=2){var n=this.entries_[r],i=this.entries_[r+1];n!==p&&e.call(t,i,n,this)}},entries:$traceurRuntime.initGeneratorFunction(function e(){var t,r,n;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=12;break;case 12:e.state=t<this.entries_.length?8:-2;break;case 4:t+=2,e.state=12;break;case 8:r=this.entries_[t],n=this.entries_[t+1],e.state=9;break;case 9:e.state=r===p?4:6;break;case 6:return e.state=2,[r,n];case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)}),keys:$traceurRuntime.initGeneratorFunction(function e(){var t,r;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=12;break;case 12:e.state=t<this.entries_.length?8:-2;break;case 4:t+=2,e.state=12;break;case 8:r=this.entries_[t],this.entries_[t+1],e.state=9;break;case 9:e.state=r===p?4:6;break;case 6:return e.state=2,r;case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)}),values:$traceurRuntime.initGeneratorFunction(function e(){var t,r,n;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=12;break;case 12:e.state=t<this.entries_.length?8:-2;break;case 4:t+=2,e.state=12;break;case 8:r=this.entries_[t],n=this.entries_[t+1],e.state=9;break;case 9:e.state=r===p?4:6;break;case 6:return e.state=2,n;case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)})},{});function _(e){!function(e){var t=e.Map,r=e.Symbol;if(!(t&&d()&&t.prototype[r.iterator]&&t.prototype.entries))return 1;try{return 1!==new t([[]]).size}catch(e){return}}(e)||(e.Map=M)}return f(M.prototype,Symbol.iterator,{configurable:!0,writable:!0,value:M.prototype.entries}),l(_),{get Map(){return M},get polyfillMap(){return _}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Map.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Set.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Set.js")),u=e.isObject,t=e.registerPolyfill,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Map.js","traceur-runtime@0.0.111/src/runtime/polyfills/Set.js")).Map,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/Set.js")).default,l=Object.prototype.hasOwnProperty,r=$traceurRuntime.createClass(function(){var e=arguments[0];if(!u(this))throw new TypeError("Set called on incompatible type");if(l.call(this,"map_"))throw new TypeError("Set can not be reentrantly initialised");if(this.map_=new s,null!=e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.add(o)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{get size(){return this.map_.size},has:function(e){return this.map_.has(e)},add:function(e){return this.map_.set(e,e),this},delete:function(e){return this.map_.delete(e)},clear:function(){return this.map_.clear()},forEach:function(r){var n=arguments[1],i=this;return this.map_.forEach(function(e,t){r.call(n,t,t,i)})},values:$traceurRuntime.initGeneratorFunction(function e(){var t,r;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=e.wrapYieldStar(this.map_.keys()[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:r=t[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=r.done?3:2;break;case 3:e.sent=r.value,e.state=-2;break;case 2:return e.state=12,r.value;default:return e.end()}},e,this)}),entries:$traceurRuntime.initGeneratorFunction(function e(){var t,r;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=e.wrapYieldStar(this.map_.entries()[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:r=t[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=r.done?3:2;break;case 3:e.sent=r.value,e.state=-2;break;case 2:return e.state=12,r.value;default:return e.end()}},e,this)})},{});function i(e){!function(e){var t=e.Set,r=e.Symbol;if(!(t&&n()&&t.prototype[r.iterator]&&t.prototype.values))return 1;try{return 1!==new t([1]).size}catch(e){return}}(e)||(e.Set=r)}return Object.defineProperty(r.prototype,Symbol.iterator,{configurable:!0,writable:!0,value:r.prototype.values}),Object.defineProperty(r.prototype,"keys",{configurable:!0,writable:!0,value:r.prototype.values}),t(i),{get Set(){return r},get polyfillSet(){return i}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Set.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/node_modules/rsvp/lib/rsvp/asap.js",[],function(){"use strict";var t,r=0;function e(e,t){p[r]=e,p[r+1]=t,2===(r+=2)&&l()}var n="undefined"!=typeof window?window:void 0,i=n||{},a=i.MutationObserver||i.WebKitMutationObserver,o="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function s(){return function(){setTimeout(v,1)}}var l,c,d,m,f,h,g,p=new Array(1e3);function v(){for(var e=0;e<r;e+=2){(0,p[e])(p[e+1]),p[e]=void 0,p[e+1]=void 0}r=0}return l=o?(h=process.nextTick,g=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/),Array.isArray(g)&&"0"===g[1]&&"10"===g[2]&&(h=setImmediate),function(){h(v)}):a?(d=0,m=new a(v),f=document.createTextNode(""),m.observe(f,{characterData:!0}),function(){f.data=d=++d%2}):u?((c=new MessageChannel).port1.onmessage=v,function(){c.port2.postMessage(0)}):(void 0===n&&"function"==typeof require?function(){try{var e=require("vertx");return t=e.runOnLoop||e.runOnContext,function(){t(v)}}catch(e){return s()}}:s)(),{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../../../node_modules/rsvp/lib/rsvp/asap.js","traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js")).default,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js")),o=t.isObject,r=t.registerPolyfill,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js")),i=n.createPrivateSymbol,u=n.getPrivate,s=n.setPrivate,a={};function l(e){return e&&"object"==typeof e&&void 0!==e.status_}function c(e){return e}function d(e){throw e}function m(e,t,r){var n=void 0!==t?t:c,i=void 0!==r?r:d,a=f(e.constructor);switch(e.status_){case void 0:throw TypeError;case 0:e.onResolve_.push(n,a),e.onReject_.push(i,a);break;case 1:M(e.value_,[n,a]);break;case-1:M(e.value_,[i,a])}return a.promise}function f(e){if(this===v){var t=g(new v(a));return{promise:t,resolve:function(e){b(t,e)},reject:function(e){R(t,e)}}}var r={};return r.promise=new e(function(e,t){r.resolve=e,r.reject=t}),r}function h(e,t,r,n,i){return e.status_=t,e.value_=r,e.onResolve_=n,e.onReject_=i,e}function g(e){return h(e,0,void 0,[],[])}var p=$traceurRuntime.createClass(function(e){if(e!==a){if("function"!=typeof e)throw new TypeError;var t=g(this);try{e(function(e){b(t,e)},function(e){R(t,e)})}catch(e){R(t,e)}}},{catch:function(e){return this.then(void 0,e)},then:function(t,r){"function"!=typeof t&&(t=c),"function"!=typeof r&&(r=d);var n=this,i=this.constructor;return m(this,function(e){return(e=function(t,r){if(!l(r)&&o(r)){var e;try{e=r.then}catch(e){var n=y.call(t,e);return s(r,_,n),n}if("function"==typeof e){var i=u(r,_);if(i)return i;var a=f(t);s(r,_,a.promise);try{e.call(r,a.resolve,a.reject)}catch(e){a.reject(e)}return a.promise}}return r}(i,e))===n?r(new TypeError):l(e)?e.then(t,r):t(e)},r)}},{resolve:function(r){return this===v?l(r)?r:h(new v(a),1,r):new this(function(e,t){e(r)})},reject:function(r){return this===v?h(new v(a),-1,r):new this(function(e,t){t(r)})},all:function(e){var r=f(this),n=[];try{var i=0,t=0,a=!0,o=!1,u=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,d=function(t){return function(e){n[t]=e,0==--i&&r.resolve(n)}}(t);this.resolve(c).then(d,function(e){r.reject(e)}),++t,++i}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}0===i&&r.resolve(n)}catch(e){r.reject(e)}return r.promise},race:function(e){var t=f(this);try{for(var r=0;r<e.length;r++)this.resolve(e[r]).then(function(e){t.resolve(e)},function(e){t.reject(e)})}catch(e){t.reject(e)}return t.promise}}),v=p,y=v.reject;function b(e,t){w(e,1,t,e.onResolve_)}function R(e,t){w(e,-1,t,e.onReject_)}function w(e,t,r,n){0===e.status_&&(M(r,n),h(e,t,r))}function M(t,r){e(function(){for(var e=0;e<r.length;e+=2)!function(e,t,r){try{var n=t(e);if(n===r.promise)throw new TypeError;l(n)?m(n,r.resolve,r.reject):r.resolve(n)}catch(e){try{r.reject(e)}catch(e){}}}(t,r[e],r[e+1])})}var _=i();function x(e){e.Promise||(e.Promise=p)}return r(x),{get Promise(){return p},get polyfillPromise(){return x}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/StringIterator.js",[],function(){"use strict";var e,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/StringIterator.js")),u=t.createIteratorResultObject,s=t.isObject,l=Object.prototype.hasOwnProperty,c=Symbol("iteratedString"),d=Symbol("stringIteratorNextIndex"),n=$traceurRuntime.createClass(function(){},(e={},Object.defineProperty(e,"next",{value:function(){var e=this;if(!s(e)||!l.call(e,c))throw new TypeError("this must be a StringIterator object");var t=e[c];if(void 0===t)return u(void 0,!0);var r=e[d],n=t.length;if(n<=r)return e[c]=void 0,u(void 0,!0);var i,a,o=t.charCodeAt(r);return a=o<55296||56319<o||r+1===n||(i=t.charCodeAt(r+1))<56320||57343<i?String.fromCharCode(o):String.fromCharCode(o)+String.fromCharCode(i),e[d]=r+a.length,u(a,!1)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(e,Symbol.iterator,{value:function(){return this},configurable:!0,enumerable:!0,writable:!0}),e),{});function r(e){var t=String(e),r=Object.create(n.prototype);return r[c]=t,r[d]=0,r}return{get createStringIterator(){return r}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/String.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../checkObjectCoercible.js","traceur-runtime@0.0.111/src/runtime/polyfills/String.js")).default,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./StringIterator.js","traceur-runtime@0.0.111/src/runtime/polyfills/String.js")).createStringIterator,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/String.js")),i=e.maybeAddFunctions,a=e.maybeAddIterator,t=e.registerPolyfill,s=Object.prototype.toString,u=String.prototype.indexOf,l=String.prototype.lastIndexOf;function o(e){var t=String(this);if(null==this||"[object RegExp]"==s.call(e))throw TypeError();var r=t.length,n=String(e),i=(n.length,1<arguments.length?arguments[1]:void 0),a=i?Number(i):0;isNaN(a)&&(a=0);var o=Math.min(Math.max(a,0),r);return u.call(t,n,a)==o}function c(e){var t=String(this);if(null==this||"[object RegExp]"==s.call(e))throw TypeError();var r,n=t.length,i=String(e),a=i.length,o=n;1<arguments.length&&(void 0!==(r=arguments[1])&&(o=r?Number(r):0,isNaN(o)&&(o=0)));var u=Math.min(Math.max(o,0),n)-a;return!(u<0)&&l.call(t,i,u)==u}function d(e){if(null==this)throw TypeError();var t=String(this);if(e&&"[object RegExp]"==s.call(e))throw TypeError();var r=t.length,n=String(e),i=n.length,a=1<arguments.length?arguments[1]:void 0,o=a?Number(a):0;return o!=o&&(o=0),!(r<i+Math.min(Math.max(o,0),r))&&-1!=u.call(t,n,o)}function m(e){if(null==this)throw TypeError();var t=String(this),r=e?Number(e):0;if(isNaN(r)&&(r=0),r<0||r==1/0)throw RangeError();if(0==r)return"";for(var n="";r--;)n+=t;return n}function f(e){if(null==this)throw TypeError();var t=String(this),r=t.length,n=e?Number(e):0;if(isNaN(n)&&(n=0),!(n<0||r<=n)){var i,a=t.charCodeAt(n);return 55296<=a&&a<=56319&&n+1<r&&56320<=(i=t.charCodeAt(n+1))&&i<=57343?1024*(a-55296)+i-56320+65536:a}}function h(e){var t=e.raw,r=t.length>>>0;if(0==r)return"";for(var n="",i=0;;){if(n+=t[i],i+1===r)return n;n+=arguments[++i]}}function g(e){var t,r,n=[],i=Math.floor,a=-1,o=arguments.length;if(!o)return"";for(;++a<o;){var u=Number(arguments[a]);if(!isFinite(u)||u<0||1114111<u||i(u)!=u)throw RangeError("Invalid code point: "+u);u<=65535?n.push(u):(t=55296+((u-=65536)>>10),r=u%1024+56320,n.push(t,r))}return String.fromCharCode.apply(null,n)}function p(){var e=r(this),t=String(e);return n(t)}function v(e){var t=e.String;i(t.prototype,["codePointAt",f,"endsWith",c,"includes",d,"repeat",m,"startsWith",o]),i(t,["fromCodePoint",g,"raw",h]),a(t.prototype,p,Symbol)}return t(v),{get startsWith(){return o},get endsWith(){return c},get includes(){return d},get repeat(){return m},get codePointAt(){return f},get raw(){return h},get fromCodePoint(){return g},get stringPrototypeIterator(){return p},get polyfillString(){return v}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/String.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/ArrayIterator.js",[],function(){"use strict";var e,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/ArrayIterator.js")),i=t.toObject,a=t.toUint32,o=t.createIteratorResultObject,r=1,u=2,s=3,l=$traceurRuntime.createClass(function(){},(e={},Object.defineProperty(e,"next",{value:function(){var e=i(this),t=e.iteratorObject_;if(!t)throw new TypeError("Object is not an ArrayIterator");var r=e.arrayIteratorNextIndex_,n=e.arrayIterationKind_;return a(t.length)<=r?(e.arrayIteratorNextIndex_=1/0,o(void 0,!0)):(e.arrayIteratorNextIndex_=r+1,o(n==u?t[r]:n==s?[r,t[r]]:r,!1))},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(e,Symbol.iterator,{value:function(){return this},configurable:!0,enumerable:!0,writable:!0}),e),{});function n(e,t){var r=i(e),n=new l;return n.iteratorObject_=r,n.arrayIteratorNextIndex_=0,n.arrayIterationKind_=t,n}function c(){return n(this,s)}function d(){return n(this,r)}function m(){return n(this,u)}return{get entries(){return c},get keys(){return d},get values(){return m}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Array.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ArrayIterator.js","traceur-runtime@0.0.111/src/runtime/polyfills/Array.js")),a=e.entries,o=e.keys,u=e.values,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Array.js")),h=t.checkIterable,g=t.isCallable,p=t.isConstructor,s=t.maybeAddFunctions,l=t.maybeAddIterator,r=t.registerPolyfill,c=t.toInteger,v=t.toLength,y=t.toObject;function d(e){var t,r,n=arguments[1],i=arguments[2],a=y(e),o=void 0!==n,u=0;if(o&&!g(n))throw TypeError();if(h(a)){t=p(this)?new this:[];var s=!0,l=!1,c=void 0;try{for(var d,m=a[Symbol.iterator]();!(s=(d=m.next()).done);s=!0){var f=d.value;t[u]=o?n.call(i,f,u):f,u++}}catch(e){l=!0,c=e}finally{try{s||null==m.return||m.return()}finally{if(l)throw c}}return t.length=u,t}for(r=v(a.length),t=new(p(this)?this:Array)(r);u<r;u++)t[u]=o?void 0===i?n(a[u],u):n.call(i,a[u],u):a[u];return t.length=r,t}function m(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e.length,n=new(p(this)?this:Array)(r),i=0;i<r;i++)n[i]=e[i];return n.length=r,n}function f(e){for(var t=void 0!==arguments[1]?arguments[1]:0,r=arguments[2],n=y(this),i=v(n.length),a=c(t),o=void 0!==r?c(r):i,a=a<0?Math.max(i+a,0):Math.min(a,i),o=o<0?Math.max(i+o,0):Math.min(o,i);a<o;)n[a]=e,a++;return n}function b(e){return n(this,e,arguments[1])}function R(e){return n(this,e,arguments[1],!0)}function n(e,t,r,n){var i=r,a=void 0!==n&&n,o=y(e),u=v(o.length);if(!g(t))throw TypeError();for(var s=0;s<u;s++){var l=o[s];if(t.call(i,l,s,o))return a?s:l}return a?-1:void 0}function i(e){var t=e.Array,r=e.Object,n=e.Symbol,i=u;n&&n.iterator&&t.prototype[n.iterator]&&(i=t.prototype[n.iterator]),s(t.prototype,["entries",a,"keys",o,"values",i,"fill",f,"find",b,"findIndex",R]),s(t,["from",d,"of",m]),l(t.prototype,i,n),l(r.getPrototypeOf([].values()),function(){return this},n)}return r(i),{get from(){return d},get of(){return m},get fill(){return f},get find(){return b},get findIndex(){return R},get polyfillArray(){return i}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Array.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/assign.js",[],function(){"use strict";var u=Object.keys;function e(e){for(var t=1;t<arguments.length;t++)for(var r=arguments[t],n=null==r?[]:u(r),i=void 0,a=n.length,i=0;i<a;i++){var o=n[i];e[o]=r[o]}return e}return{get default(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Object.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Object.js")),r=e.maybeAddFunctions,t=e.registerPolyfill,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./assign.js","traceur-runtime@0.0.111/src/runtime/polyfills/Object.js")).default,i=Object,o=i.defineProperty,u=i.getOwnPropertyDescriptor,s=i.getOwnPropertyNames;function a(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function l(e,t){for(var r=s(t),n=r.length,i=0;i<n;i++){r[i];var a=u(t,r[i]);o(e,r[i],a)}return e}function c(e){var t=e.Object;r(t,["assign",n,"is",a,"mixin",l])}return t(c),{get assign(){return n},get is(){return a},get mixin(){return l},get polyfillObject(){return c}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Object.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Number.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Number.js")),t=e.isNumber,r=e.maybeAddConsts,n=e.maybeAddFunctions,i=e.registerPolyfill,a=e.toInteger,o=Math.abs,u=isFinite,s=isNaN,l=Math.pow(2,53)-1,c=1-Math.pow(2,53),d=Math.pow(2,-52);function m(e){return t(e)&&u(e)}function f(e){return m(e)&&a(e)===e}function h(e){return t(e)&&s(e)}function g(e){if(m(e)){var t=a(e);if(t===e)return o(t)<=l}return!1}function p(e){var t=e.Number;r(t,["MAX_SAFE_INTEGER",l,"MIN_SAFE_INTEGER",c,"EPSILON",d]),n(t,["isFinite",m,"isInteger",f,"isNaN",h,"isSafeInteger",g])}return i(p),{get MAX_SAFE_INTEGER(){return l},get MIN_SAFE_INTEGER(){return c},get EPSILON(){return d},get isFinite(){return m},get isInteger(){return f},get isNaN(){return h},get isSafeInteger(){return g},get polyfillNumber(){return p}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Number.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/fround.js",[],function(){"use strict";var t=isFinite,r=isNaN,e=Math,m=e.LN2,f=e.abs,h=e.floor,g=e.log,p=e.min,v=e.pow;function n(e){return function(e,t,r){for(var n,i,a,o,u,s,l,c=[],d=e.length;d;--d)for(i=e[d-1],n=8;n;--n)c.push(i%2?1:0),i>>=1;return c.reverse(),a=c.join(""),o=(1<<t-1)-1,u=parseInt(a.substring(0,1),2)?-1:1,s=parseInt(a.substring(1,1+t),2),l=parseInt(a.substring(1+t),2),s===(1<<t)-1?0!==l?NaN:1/0*u:0<s?u*v(2,s-o)*(1+l/v(2,r)):0!==l?u*v(2,-(o-1))*(l/v(2,r)):u<0?-0:0}(e,8,23)}function i(e){return function(e,t,r){var n,i,a,o,u,s,l,c=(1<<t-1)-1;function d(e){var t=h(e),r=e-t;return!(r<.5)&&(.5<r||t%2)?t+1:t}for(e!=e?(i=(1<<t)-1,a=v(2,r-1),n=0):e===1/0||e===-1/0?(i=(1<<t)-1,n=e<(a=0)?1:0):0===e?n=1/e==-1/(a=i=0)?1:0:(n=e<0,(e=f(e))>=v(2,1-c)?(i=p(h(g(e)/m),1023),2<=(a=d(e/v(2,i)*v(2,r)))/v(2,r)&&(i+=1,a=1),c<i?(i=(1<<t)-1,a=0):(i+=c,a-=v(2,r))):(i=0,a=d(e/v(2,1-c-r)))),u=[],o=r;o;--o)u.push(a%2?1:0),a=h(a/2);for(o=t;o;--o)u.push(i%2?1:0),i=h(i/2);for(u.push(n?1:0),u.reverse(),s=u.join(""),l=[];s.length;)l.push(parseInt(s.substring(0,8),2)),s=s.substring(8);return l}(e,8,23)}function a(e){return 0===e||!t(e)||r(e)?e:n(i(Number(e)))}return{get fround(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Math.js",[],function(){"use strict";var r,t,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./fround.js","traceur-runtime@0.0.111/src/runtime/polyfills/Math.js")).fround,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Math.js")),i=n.maybeAddFunctions,a=n.registerPolyfill,o=n.toUint32,u=isFinite,s=isNaN,l=Math,d=l.abs,c=l.ceil,m=l.exp,f=l.floor,h=l.log,g=l.pow,p=l.sqrt;function v(e){if(0==(e=o(+e)))return 32;var t=0;return 0==(4294901760&e)&&(e<<=16,t+=16),0==(4278190080&e)&&(e<<=8,t+=8),0==(4026531840&e)&&(e<<=4,t+=4),0==(3221225472&e)&&(e<<=2,t+=2),0==(2147483648&e)&&(e<<=1,t+=1),t}function y(e,t){var r=65535&(e=o(+e)),n=65535&(t=o(+t));return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0}function b(e){return 0<(e=+e)?1:e<0?-1:e}function R(e){return.4342944819032518*h(e)}function w(e){return 1.4426950408889634*h(e)}function M(e){if((e=+e)<-1||s(e))return NaN;if(0===e||e===1/0)return e;if(-1===e)return-1/0;var t=0;if(e<0||1<e)return h(1+e);for(var r=1;r<50;r++)r%2==0?t-=g(e,r)/r:t+=g(e,r)/r;return t}function _(e){return(e=+e)===-1/0?-1:u(e)&&0!==e?m(e)-1:e}function x(e){return 0===(e=+e)?1:s(e)?NaN:u(e)?(e<0&&(e=-e),21<e?m(e)/2:(m(e)+m(-e))/2):1/0}function S(e){return u(e=+e)&&0!==e?(m(e)-m(-e))/2:e}function T(e){if(0===(e=+e))return e;if(!u(e))return b(e);var t=m(e),r=m(-e);return(t-r)/(t+r)}function A(e){return(e=+e)<1?NaN:u(e)?h(e+p(e+1)*p(e-1)):e}function C(e){return 0!==(e=+e)&&u(e)?0<e?h(e+p(e*e+1)):-h(-e+p(e*e+1)):e}function E(e){return-1===(e=+e)?-1/0:1===e?1/0:0===e?e:s(e)||e<-1||1<e?NaN:.5*h((1+e)/(1-e))}function I(e,t){for(var r=arguments.length,n=new Array(r),i=0,a=0;a<r;a++){if((s=+(s=arguments[a]))===1/0||s===-1/0)return 1/0;i<(s=d(s))&&(i=s),n[a]=s}0===i&&(i=1);for(var o=0,u=0,a=0;a<r;a++)var s,l=(s=n[a]/i)*s-u,c=o+l,u=c-o-l,o=c;return p(o)*i}function j(e){return 0<(e=+e)?f(e):e<0?c(e):e}function $(e){if(0===(e=+e))return e;var t=e<0;t&&(e=-e);var r=g(e,1/3);return t?-r:r}function P(e){var t=e.Math;i(t,["acosh",A,"asinh",C,"atanh",E,"cbrt",$,"clz32",v,"cosh",x,"expm1",_,"fround",r,"hypot",I,"imul",y,"log10",R,"log1p",M,"log2",w,"sign",b,"sinh",S,"tanh",T,"trunc",j])}return r="function"==typeof Float32Array?(t=new Float32Array(1),function(e){return t[0]=Number(e),t[0]}):e,a(P),{get clz32(){return v},get imul(){return y},get sign(){return b},get log10(){return R},get log2(){return w},get log1p(){return M},get expm1(){return _},get cosh(){return x},get sinh(){return S},get tanh(){return T},get acosh(){return A},get asinh(){return C},get atanh(){return E},get hypot(){return I},get trunc(){return j},get fround(){return r},get cbrt(){return $},get polyfillMath(){return P}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Math.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")),t=e.createPrivateSymbol,r=e.deletePrivate,n=e.getPrivate,i=e.hasPrivate,a=e.setPrivate,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../frozen-data.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")),u=o.deleteFrozen,s=o.getFrozen,l=o.hasFrozen,c=o.setFrozen,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")),m=d.isObject,f=d.registerPolyfill,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")).default,g=Object,p=(g.defineProperty,g.getOwnPropertyDescriptor,g.isExtensible),v=TypeError,y=(Object.prototype.hasOwnProperty,$traceurRuntime.createClass(function(){this.name_=t(),this.frozenData_=[]},{set:function(e,t){if(!m(e))throw new v("key must be an object");return p(e)?a(e,this.name_,t):c(this.frozenData_,e,t),this},get:function(e){if(m(e))return p(e)?n(e,this.name_):s(this.frozenData_,e)},delete:function(e){return!!m(e)&&(p(e)?r(e,this.name_):u(this.frozenData_,e))},has:function(e){return!!m(e)&&(p(e)?i(e,this.name_):l(this.frozenData_,e))}},{}));function b(e){!function(e){var t=e.WeakMap;if(e.Symbol,!t||!h())return 1;try{var r={};return new t([[r,!1]]).get(r)}catch(e){return}}(e)||(e.WeakMap=y)}return f(b),{get WeakMap(){return y},get polyfillWeakMap(){return b}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")),t=e.createPrivateSymbol,r=e.deletePrivate,n=(e.getPrivate,e.hasPrivate),i=e.setPrivate,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../frozen-data.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")),o=a.deleteFrozen,u=a.getFrozen,s=a.setFrozen,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")),c=l.isObject,d=l.registerPolyfill,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")).default,f=Object,h=(f.defineProperty,f.isExtensible),g=TypeError,p=(Object.prototype.hasOwnProperty,$traceurRuntime.createClass(function(){this.name_=t(),this.frozenData_=[]},{add:function(e){if(!c(e))throw new g("value must be an object");return h(e)?i(e,this.name_,!0):s(this.frozenData_,e,e),this},delete:function(e){return!!c(e)&&(h(e)?r(e,this.name_):o(this.frozenData_,e))},has:function(e){return!!c(e)&&(h(e)?n(e,this.name_):u(this.frozenData_,e)===e)}},{}));function v(e){!function(e){var t=e.WeakSet;if(e.Symbol,!t||!m())return 1;try{var r={};return!new t([[r]]).has(r)}catch(e){return}}(e)||(e.WeakSet=p)}return d(v),{get WeakSet(){return p},get polyfillWeakSet(){return v}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/polyfills.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/polyfills.js")).polyfillAll;t(Reflect.global);var r=$traceurRuntime.setupGlobals;return $traceurRuntime.setupGlobals=function(e){r(e),t(e)},{}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/polyfills.js"),$traceurRuntime.registerModule("src/base/CooldownThrottle.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(e,t){var r=void 0!==arguments[2]?arguments[2]:0,n=void 0!==arguments[3]&&arguments[3];this.action=e,this.cooldownDuration=t,this.slowActionCooldownPumpupFactor=r,this._waitWithRequestAnimationFrame=n,this._state="idle",this._cooldownStartTime=-1/0},{_triggerIdle:function(){var e=this.cooldownDuration-(performance.now()-this._cooldownStartTime);if(0<e)this._forceIdleTriggerAfter(e);else{this._state="running";var t=performance.now();try{this.action()}finally{var r=performance.now()-t;this._cooldownStartTime=performance.now()+r*this.slowActionCooldownPumpupFactor,"running-and-triggered"===this._state?this._forceIdleTriggerAfter(this.cooldownDuration):this._state="idle"}}},trigger:function(){switch(this._state){case"idle":this._triggerIdle();break;case"waiting":break;case"running":this._state="running-and-triggered";break;case"running-and-triggered":break;default:throw new Error("Unrecognized throttle state: "+this._state)}},_forceIdleTriggerAfter:function(e){var t,r,n=this;this._state="waiting",this._waitWithRequestAnimationFrame?(t=performance.now(),(r=function(){performance.now()<t+e?requestAnimationFrame(r):(n._state="idle",n._cooldownStartTime=-1/0,n.trigger())})()):setTimeout(function(){n._state="idle",n._cooldownStartTime=-1/0,n.trigger()},e)}},{});return{get CooldownThrottle(){return e}}}),$traceurRuntime.registerModule("src/base/Describe.js",[],function(){"use strict";var g=1e3,n=(new function(){}).toString(),r="!recursion-limit!",i=10;function a(e,t){return 0===t?r:e instanceof Map?function(e,t){var r,n,i=[],a=!0,o=!1,u=void 0;try{for(var s=void 0,l=e.entries()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,d=(r=c[Symbol.iterator](),(n=r.next()).done?void 0:n.value),m=(n=r.next()).done?void 0:n.value;if(i.length>g){i.push("[...]");break}var f=p(d,t-1),h=p(m,t-1);i.push(f+": "+h)}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}return"Map{"+i.join(", ")+"}"}(e,t):e instanceof Set?function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o=void 0,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;if(r.length>g){r.push("[...]");break}r.push(p(s,t-1))}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return"Set{"+r.join(", ")+"}"}(e,t):void 0!==e[Symbol.iterator]?function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o=void 0,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;if(r.length>g){r.push("[...]");break}r.push(p(s,t-1))}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return(Array.isArray(e)?"":e.constructor.name)+"["+r.join(", ")+"]"}(e,t):void 0}function o(e,t){var r=String(e);return r!==n?r:function(e,t){var r,n=[];for(r in e)if(e.hasOwnProperty(r)){if(n.length>g){n.push("[...]");break}var i=e[r],a=p(r,t-1),o=p(i,t-1);n.push(a+": "+o)}var u=e.constructor.name;return(u==={}.constructor.name?"":"(Type: "+u+")")+"{"+n.join(", ")+"}"}(e,t)}function p(e){var t,r=void 0!==arguments[1]?arguments[1]:i;return(null===(t=e)?"null":void 0===t?"undefined":"string"==typeof t?'"'+t+'"':"number"==typeof t?""+t:void 0)||a(e,r)||o(e,r)}return{get describe(){return p}}}),$traceurRuntime.registerModule("src/base/DetailedError.js",[],function(){"use strict";var e,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/base/DetailedError.js")).describe,n=0,t=(e=Error,$traceurRuntime.createClass(i,{toString:function(){return $traceurRuntime.superGet(this,i.prototype,"toString").call(this)+"\nDetails: "+this.details}},{},e));function i(e,t){$traceurRuntime.superConstructor(i).call(this,e),this.detailsObj=t,this.name="Error",this.message=e,this.stack=(new Error).stack,void 0!==this.stack&&(this.stack=this.stack.replace(/^Error\n\s+at new DetailedError (\S+)\s?\n\s+at /,"\n    ")),n++;try{this.details=1===n?r(this.detailsObj):"(failed to describe detailsObj due to possibly re-entrancy)"}catch(e){console.error(e),this.details="(failed to describe detailsObj, see the console for details)"}finally{n--}}return{get DetailedError(){return t}}}),$traceurRuntime.registerModule("src/base/Equate.js",[],function(){"use strict";function d(e,t){if(e===t||o(e)&&o(t))return!0;var r,n,i=function(e,t){if(!u(e)&&e.constructor.prototype.hasOwnProperty("isEqualTo"))return e.isEqualTo(t);if(u(t)||!t.constructor.prototype.hasOwnProperty("isEqualTo"))return;return t.isEqualTo(e)}(e,t);return void 0!==i?i:!u(e)&&!u(t)&&(r=t,e.constructor.name===r.constructor.name)&&(e instanceof Map?s(e,t):e instanceof Set?m(e,t):(n=e,(Array.isArray(n)||!a.every(function(e){return!(n instanceof e)})?function(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!d(e[r],t[r]))return!1;return!0}:function(e,t){var r=f(e);if(!m(r,f(t)))return!1;var n=!0,i=!1,a=void 0;try{for(var o=void 0,u=r[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;if(s!==Symbol.iterator&&!d(e[s],t[s]))return!1}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}var l=void 0!==e[Symbol.iterator],c=void 0!==t[Symbol.iterator];if(l!=c)return!1;if(l&&c&&!function(e,t){var r=t[Symbol.iterator](),n=!0,i=!1,a=void 0;try{for(var o=void 0,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=r.next();if(l.done||!d(s,l.value))return!1}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r.next().done}(e,t))return!1;return!0})(e,t)))}var a=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray];function o(e){return"number"==typeof e&&isNaN(e)}function u(e){return null==e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e}function s(e,t){var r,n;if(e.size!==t.size)return!1;var i=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=(n=(r=u.value[Symbol.iterator]()).next()).done?void 0:n.value,c=(n=r.next()).done?void 0:n.value;if(!t.has(l))return!1;if(!d(c,t.get(l)))return!1}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}return!0}function m(e,t){if(e.size!==t.size)return!1;var r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;if(!t.has(u))return!1}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return!0}function f(e){var t,r=new Set;for(t in e)e.hasOwnProperty(t)&&r.add(t);return r}return{get equate(){return d},get equate_Maps(){return s}}}),$traceurRuntime.registerModule("src/base/Format.js",[],function(){"use strict";var e=$traceurRuntime.createClass(a,{formatFloat:function(e){return this.allowAbbreviation?function e(t){var r=void 0!==arguments[1]?arguments[1]:0;var n=arguments[2];if(Math.abs(t)<r)return"0";if(t<0)return"-"+e(-t,r,n);var i=u(o,function(e){return Math.abs(e.value-t)<=r});if(void 0!==i)return i.character;var a=u(o,function(e){return Math.abs(Math.sqrt(e.value)-t)<=r});if(void 0!==a)return"√"+a.character;if(t%1!=0&&void 0!==n)return t.toFixed(n);return t.toString()}(e,this.maxAbbreviationError,this.fixedDigits):void 0!==this.fixedDigits?e.toFixed(this.fixedDigits):e+""}},{parseFloat:function(t){if(0===t.length)throw new Error("Not a number: '"+t+"'");if("-"===t[0])return-a.parseFloat(t.substr(1));if("√"===t[0])return Math.sqrt(a.parseFloat(t.substr(1)));var e=u(o,function(e){return e.character===t});if(void 0!==e)return e.value;var r=parseFloat(t);if(isNaN(r))throw new Error("Not a number: '"+t+"'");return r},simplifyByRounding:function(t,r){if(t<0)return-a.simplifyByRounding(-t,r);var e=t%1;if(e<=r||1-e<=r)return Math.round(t);var n=u(o,function(e){return Math.abs(e.value-t)<=r});if(void 0!==n)return n.value;var i=u(o,function(e){return Math.abs(Math.sqrt(e.value)-t)<=r});return void 0!==i?Math.sqrt(i.value):t}});function a(e,t,r,n){this.allowAbbreviation=e,this.maxAbbreviationError=t,this.fixedDigits=r,this.itemSeparator=n}var o=[{character:"½",ref:"½",expanded:"1/2",value:.5},{character:"¼",ref:"¼",expanded:"1/4",value:.25},{character:"¾",ref:"¾",expanded:"3/4",value:.75},{character:"⅓",ref:"⅓",expanded:"1/3",value:1/3},{character:"⅔",ref:"⅔",expanded:"2/3",value:2/3},{character:"⅕",ref:"⅕",expanded:"1/5",value:.2},{character:"⅖",ref:"⅖",expanded:"2/5",value:.4},{character:"⅗",ref:"⅗",expanded:"3/5",value:.6},{character:"⅘",ref:"⅘",expanded:"4/5",value:.8},{character:"⅙",ref:"⅙",expanded:"1/6",value:1/6},{character:"⅚",ref:"⅚",expanded:"5/6",value:5/6},{character:"⅐",ref:"⅐",expanded:"1/7",value:1/7},{character:"⅛",ref:"⅛",expanded:"1/8",value:1/8},{character:"⅜",ref:"⅜",expanded:"3/8",value:3/8},{character:"⅝",ref:"⅝",expanded:"5/8",value:5/8},{character:"⅞",ref:"⅞",expanded:"7/8",value:7/8},{character:"⅑",ref:"⅑",expanded:"1/9",value:1/9},{character:"⅒",ref:"⅒",expanded:"1/10",value:.1}],u=function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;if(t(u))return u}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}};return e.EXACT=new e(!0,0,void 0,", "),e.MINIFIED=new e(!0,0,void 0,","),e.SIMPLIFIED=new e(!0,5e-4,3,", "),e.CONSISTENT=new e(!1,0,2,", "),{get Format(){return e},get UNICODE_FRACTIONS(){return o}}}),$traceurRuntime.registerModule("src/base/Obs.js",[],function(){"use strict";var u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/CooldownThrottle.js","src/base/Obs.js")).CooldownThrottle,n=$traceurRuntime.createClass(c,{subscribe:function(e){return this._subscribe(e)},snapshot:function(){var t=[];return this.subscribe(function(e){return t.push(e)})(),t},map:function(r){var e=this;return new c(function(t){return e.subscribe(function(e){return t(r(e))})})},filter:function(r){var e=this;return new c(function(t){return e.subscribe(function(e){r(e)&&t(e)})})},zipLatest:function(u,s){var l=this;return new c(function(t){var r,n,i=!1,a=!1,e=l.subscribe(function(e){r=e,i=!0,a&&t(s(r,n))}),o=u.subscribe(function(e){n=e,a=!0,i&&t(s(r,n))});return function(){e(),o()}})},flattenLatest:function(){var t=this;return new c(function(r){var n=function(){},i=!1,e=t.subscribe(function(e){var t;i||(t=n,n=e.subscribe(r),t())});return function(){i=!0,n(),e()}})},peek:function(t){return this.map(function(e){return t(e),e})},flatten:function(){var e=this;return new c(function(t){var a=[];return a.push(e.subscribe(function(e){return a.push(e.subscribe(t))})),function(){var e=!0,t=!1,r=void 0;try{for(var n,i=a[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){(0,n.value)()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}}})},throttleLatest:function(a){var o=this;return new c(function(e){var t=void 0,r=!1,n=new u(function(){r||e(t)},a),i=o.subscribe(function(e){t=e,n.trigger()});return function(){r=!0,i()}})},skip:function(e){var n=this;return new c(function(t){var r=e;return n.subscribe(function(e){0<r?--r:t(e)})})},whenDifferent:function(){var e=this,i=arguments[0]||function(e,t){return e===t};return new c(function(t){var r=!1,n=void 0;return e.subscribe(function(e){r&&i(n,e)||(r=!0,t(n=e))})})}},{of:function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return new c(function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=o[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){e(i.value)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return function(){}})},requestAnimationTicker:function(){return new c(function(e){var t=!1,r=function(){t||(e(void 0),window.requestAnimationFrame(r))};return r(),function(){t=!0}})},elementEvent:function(t,r){return new c(function(e){return t.addEventListener(r,e),function(){return t.removeEventListener(r,e)}})}});function c(e){this._subscribe=e}var r=$traceurRuntime.createClass(function(){var r=this;this._observers=[],this._observable=new n(function(e){r._observers.push(e);var t=!1;return function(){t||(t=!0,r._observers.splice(r._observers.indexOf(e),1))}})},{observable:function(){return this._observable},send:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this._observers[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){(0,i.value)(e)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{}),e=$traceurRuntime.createClass(function(){var e=arguments[0],t=this;this._value=e,this._source=new r,this._observable=new n(function(e){return e(t._value),t._source.observable().subscribe(e)})},{observable:function(){return this._observable},set:function(e){this._value=e,this._source.send(e)},get:function(){return this._value}},{});return{get Observable(){return n},get ObservableSource(){return r},get ObservableValue(){return e}}}),$traceurRuntime.registerModule("src/base/RestartableRng.js",[],function(){"use strict";var e=$traceurRuntime.createClass(t,{restarted:function(){var e=new t;return e._cache=this._cache,e},random:function(){var e=this._next++;return e>=this._cache.length&&this._cache.push(Math.random()),this._cache[e]}},{});function t(){this._cache=[],this._next=0}return{get RestartableRng(){return e}}}),$traceurRuntime.registerModule("src/base/Revision.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/base/Revision.js")).describe,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Equate.js","src/base/Revision.js")).equate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/base/Revision.js")).DetailedError,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/base/Revision.js")),i=r.ObservableSource,a=r.ObservableValue,o=$traceurRuntime.createClass(u,{changes:function(){return this._changes.observable()},latestActiveCommit:function(){return this._latestActiveCommit.observable()},peekActiveCommit:function(){return this._latestActiveCommit.get()},isAtBeginningOfHistory:function(){return 0===this.index&&!this.isWorkingOnCommit},isAtEndOfHistory:function(){return this.index===this.history.length-1},clear:function(e){this.history=[e],this.index=0,this.isWorkingOnCommit=!1,this._changes.send(e),this._latestActiveCommit.set(e)},startedWorkingOnCommit:function(){this.isWorkingOnCommit=!0,this._changes.send(void 0)},cancelCommitBeingWorkedOn:function(){this.isWorkingOnCommit=!1;var e=this.history[this.index];return this._changes.send(e),this._latestActiveCommit.set(e),e},commit:function(e){e!==this.history[this.index]?(this.isWorkingOnCommit=!1,this.index+=1,this.history.splice(this.index,this.history.length-this.index),this.history.push(e),this._changes.send(e),this._latestActiveCommit.set(e)):this.cancelCommitBeingWorkedOn()},undo:function(){if(!this.isWorkingOnCommit){if(0===this.index)return;--this.index}this.isWorkingOnCommit=!1;var e=this.history[this.index];return this._changes.send(e),this._latestActiveCommit.set(e),e},redo:function(){if(this.index+1!==this.history.length){this.index+=1,this.isWorkingOnCommit=!1;var e=this.history[this.index];return this._changes.send(e),this._latestActiveCommit.set(e),e}},toString:function(){return"Revision("+e({index:this.index,count:this.history.length,workingOnCommit:this.isWorkingOnCommit,head:this.history[this.index]})+")"},isEqualTo:function(e){return e instanceof u&&this.index===e.index&&this.isWorkingOnCommit===e.isWorkingOnCommit&&t(this.history,e.history)}},{startingAt:function(e){return new u([e],0,!1)}});function u(e,t,r){if(t<0||t>=e.length)throw new n("Bad index",{history:e,index:t,isWorkingOnCommit:r});if(!Array.isArray(e))throw new n("Bad history",{history:e,index:t,isWorkingOnCommit:r});this.history=e,this.index=t,this.isWorkingOnCommit=r,this._changes=new i,this._latestActiveCommit=new a(this.history[this.index])}return{get Revision(){return o}}}),$traceurRuntime.registerModule("src/base/Seq.js",[],function(){"use strict";function m(e,t,r){if(e!==h)return e;if(t===f)throw new Error(r);return t}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/base/Seq.js")).DetailedError,f={if_same_instance_as_this_then_throw:!0},h={not_a_normal_value:!0},r=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray],c=function(e){return"function"==typeof Object(e)[Symbol.iterator]},t=$traceurRuntime.createClass(u,{isEqualTo:function(e){var t=void 0!==arguments[1]?arguments[1]:function(e,t){return e===t};if(!c(e))return!1;if(e===this)return!0;var r=e[Symbol.iterator](),n=!0,i=!1,a=void 0;try{for(var o,u=this._iterable[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=r.next();if(l.done||!t(s,l.value))return!1}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r.next().done},toArray:function(){return Array.from(this._iterable)},toFloat32Array:function(){var e=this.tryPeekCount();if(void 0===e)return new Float32Array(this.toArray());var t=new Float32Array(e),r=0,n=!0,i=!1,a=void 0;try{for(var o,u=this._iterable[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;t[r++]=s}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return t},toSet:function(){return new Set(this._iterable)},join:function(e){return this.toArray().join(e)},toString:function(){return"Seq["+this.join(", ")+"]"},solidify:function(){var e=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array];if(Array.isArray(this._iterable))return this;var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(this._iterable instanceof o)return this}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return new u(this.toArray())},map:function(s){var l=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=24;break;case 24:e.pushTry(10,11),e.state=13;break;case 13:i=void 0,a=l[Symbol.iterator](),e.state=9;break;case 9:e.state=(t=(i=a.next()).done)?7:5;break;case 4:t=!0,e.state=9;break;case 5:o=i.value,e.state=6;break;case 6:return e.state=2,s(o);case 2:e.maybeThrow(),e.state=4;break;case 7:e.popTry(),e.state=11,e.finallyFallThrough=-2;break;case 10:e.popTry(),e.maybeUncatchable(),u=e.storedException,e.state=16;break;case 16:r=!0,n=u,e.state=11,e.finallyFallThrough=-2;break;case 11:e.popTry(),e.state=22;break;case 22:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=20;break;case 20:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},mapWithIndex:function(l){var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=!(t=0)),i=void 0,e.state=26;break;case 26:e.pushTry(12,13),e.state=15;break;case 15:a=void 0,o=c[Symbol.iterator](),e.state=11;break;case 11:e.state=(r=(a=o.next()).done)?9:7;break;case 6:r=!0,e.state=11;break;case 7:u=a.value,e.state=8;break;case 8:return e.state=2,l(u,t);case 2:e.maybeThrow(),e.state=4;break;case 4:t+=1,e.state=6;break;case 9:e.popTry(),e.state=13,e.finallyFallThrough=-2;break;case 12:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=18;break;case 18:n=!0,i=s,e.state=13,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.state=24;break;case 24:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=22;break;case 22:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},flatMap:function(c){var d=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=32;break;case 32:e.pushTry(18,19),e.state=21;break;case 21:i=void 0,a=d[Symbol.iterator](),e.state=17;break;case 17:e.state=(t=(i=a.next()).done)?15:13;break;case 10:t=!0,e.state=17;break;case 13:o=i.value,e.state=14;break;case 14:u=e.wrapYieldStar(c(o)[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:s=u[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=s.done?3:2;break;case 3:e.sent=s.value,e.state=10;break;case 2:return e.state=12,s.value;case 15:e.popTry(),e.state=19,e.finallyFallThrough=-2;break;case 18:e.popTry(),e.maybeUncatchable(),l=e.storedException,e.state=24;break;case 24:r=!0,n=l,e.state=19,e.finallyFallThrough=-2;break;case 19:e.popTry(),e.state=30;break;case 30:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=28;break;case 28:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},filter:function(s){var l=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=25;break;case 25:e.pushTry(11,12),e.state=14;break;case 14:i=void 0,a=l[Symbol.iterator](),e.state=10;break;case 10:e.state=(t=(i=a.next()).done)?8:6;break;case 4:t=!0,e.state=10;break;case 6:o=i.value,e.state=7;break;case 7:e.state=s(o)?1:4;break;case 1:return e.state=2,o;case 2:e.maybeThrow(),e.state=4;break;case 8:e.popTry(),e.state=12,e.finallyFallThrough=-2;break;case 11:e.popTry(),e.maybeUncatchable(),u=e.storedException,e.state=17;break;case 17:r=!0,n=u,e.state=12,e.finallyFallThrough=-2;break;case 12:e.popTry(),e.state=23;break;case 23:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=21;break;case 21:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},filterWithIndex:function(l){var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=!(t=0)),i=void 0,e.state=27;break;case 27:e.pushTry(13,14),e.state=16;break;case 16:a=void 0,o=c[Symbol.iterator](),e.state=12;break;case 12:e.state=(r=(a=o.next()).done)?10:8;break;case 7:r=!0,e.state=12;break;case 8:u=a.value,e.state=9;break;case 9:e.state=l(u,t)?1:4;break;case 1:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=7;break;case 10:e.popTry(),e.state=14,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=19;break;case 19:n=!0,i=s,e.state=14,e.finallyFallThrough=-2;break;case 14:e.popTry(),e.state=25;break;case 25:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=23;break;case 23:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},fold:function(e){var t=void 0!==arguments[1]?arguments[1]:f,r=h,n=!0,i=!1,a=void 0;try{for(var o,u=this._iterable[Symbol.iterator]();!(n=(o=u.next()).done);n=!0)var s=o.value,r=r===h?s:e(r,s)}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return m(r,t,"Folded empty sequence without providing an alternative result.")},aggregate:function(e,t){var r=e,n=!0,i=!1,a=void 0;try{for(var o,u=this._iterable[Symbol.iterator]();!(n=(o=u.next()).done);n=!0)r=t(r,o.value)}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r},zip:function(c,d){var m=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=c[Symbol.iterator](),n=!(r=!0),i=void 0,e.state=29;break;case 29:e.pushTry(15,16),e.state=18;break;case 18:a=void 0,o=m[Symbol.iterator](),e.state=14;break;case 14:e.state=(r=(a=o.next()).done)?12:10;break;case 7:r=!0,e.state=14;break;case 10:u=a.value,e.state=11;break;case 11:s=t.next(),e.state=9;break;case 9:e.state=s.done?12:2;break;case 2:return e.state=5,d(u,s.value);case 5:e.maybeThrow(),e.state=7;break;case 12:e.popTry(),e.state=16,e.finallyFallThrough=-2;break;case 15:e.popTry(),e.maybeUncatchable(),l=e.storedException,e.state=21;break;case 21:n=!0,i=l,e.state=16,e.finallyFallThrough=-2;break;case 16:e.popTry(),e.state=27;break;case 27:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=25;break;case 25:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},max:function(){var e=void 0!==arguments[0]?arguments[0]:f;return this.fold(function(e,t){return e<t?t:e},e)},min:function(){var e=void 0!==arguments[0]?arguments[0]:f;return this.fold(function(e,t){return e<t?e:t},e)},maxBy:function(e){var t=void 0!==arguments[1]?arguments[1]:f,r=void 0!==arguments[2]?arguments[2]:function(e,t){return e<t},n=h,i=h,a=!0,o=!1,u=void 0;try{for(var s,l=this._iterable[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c,d=s.value;n!==h?(i===h&&(i=e(n)),r(i,c=e(d))&&(n=d,i=c)):n=d}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}return m(n,t,"Can't maxBy an empty sequence.")},minBy:function(e){var t=void 0!==arguments[1]?arguments[1]:f,r=void 0!==arguments[2]?arguments[2]:function(e,t){return e<t};return this.maxBy(e,t,function(e,t){return r(t,e)})},any:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this._iterable[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){if(e(i.value))return!0}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return!1},every:function(t){return!this.any(function(e){return!t(e)})},contains:function(t){return this.any(function(e){return e===t})},sum:function(){var e=0,t=!0,r=!0,n=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)var u=a.value,e=t?u:e+u,t=!1}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return e},product:function(){return this.fold(function(e,t){return e*t},1)},scan:function(l,c){var d=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=l,e.state=30;break;case 30:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;case 4:n=!(r=!0),i=void 0,e.state=32;break;case 32:e.pushTry(16,17),e.state=19;break;case 19:a=void 0,o=d[Symbol.iterator](),e.state=15;break;case 15:e.state=(r=(a=o.next()).done)?13:11;break;case 8:r=!0,e.state=15;break;case 11:u=a.value,e.state=12;break;case 12:t=c(t,u),e.state=10;break;case 10:return e.state=6,t;case 6:e.maybeThrow(),e.state=8;break;case 13:e.popTry(),e.state=17,e.finallyFallThrough=-2;break;case 16:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=22;break;case 22:n=!0,i=s,e.state=17,e.finallyFallThrough=-2;break;case 17:e.popTry(),e.state=28;break;case 28:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=26;break;case 26:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},reverse:function(){return new u(this.toArray().reverse())},flatten:function(){var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=32;break;case 32:e.pushTry(18,19),e.state=21;break;case 21:i=void 0,a=c[Symbol.iterator](),e.state=17;break;case 17:e.state=(t=(i=a.next()).done)?15:13;break;case 10:t=!0,e.state=17;break;case 13:o=i.value,e.state=14;break;case 14:u=e.wrapYieldStar(o[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:s=u[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=s.done?3:2;break;case 3:e.sent=s.value,e.state=10;break;case 2:return e.state=12,s.value;case 15:e.popTry(),e.state=19,e.finallyFallThrough=-2;break;case 18:e.popTry(),e.maybeUncatchable(),l=e.storedException,e.state=24;break;case 24:r=!0,n=l,e.state=19,e.finallyFallThrough=-2;break;case 19:e.popTry(),e.state=30;break;case 30:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=28;break;case 28:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},concat:function(a){var o=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=e.wrapYieldStar(o[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:r=t[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=r.done?3:2;break;case 3:e.sent=r.value,e.state=10;break;case 2:return e.state=12,r.value;case 10:n=e.wrapYieldStar(a[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=24;break;case 24:i=n[e.action](e.sentIgnoreThrow),e.state=21;break;case 21:e.state=i.done?15:14;break;case 15:e.sent=i.value,e.state=-2;break;case 14:return e.state=24,i.value;default:return e.end()}},e,this)}))},withOverlayedItem:function(l,c){if(l<0)throw new Error("needed index >= 0");var d=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:if(void 0!==d.tryPeekCount()&&l>=d.tryPeekCount())throw new Error("needed index <= count");n=!(r=!(t=0)),i=void 0,e.state=26;break;case 26:e.pushTry(12,13),e.state=15;break;case 15:a=void 0,o=d._iterable[Symbol.iterator](),e.state=11;break;case 11:e.state=(r=(a=o.next()).done)?9:7;break;case 6:r=!0,e.state=11;break;case 7:u=a.value,e.state=8;break;case 8:return e.state=2,t===l?c:u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=6;break;case 9:e.popTry(),e.state=13,e.finallyFallThrough=17;break;case 12:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=18;break;case 18:n=!0,i=s,e.state=13,e.finallyFallThrough=17;break;case 13:e.popTry(),e.state=24;break;case 24:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=22;break;case 17:if(t<=l)throw new Error("sequence ended before overlay [withOverlayedItem(${index}, ${overlayedItem})]");e.state=-2;break;case 22:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},withTransformedItem:function(l,c){if(l<0)throw new Error("needed index >= 0");var d=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:if(void 0!==d.tryPeekCount()&&l>=d.tryPeekCount())throw new Error("needed index <= count");n=!(r=!(t=0)),i=void 0,e.state=26;break;case 26:e.pushTry(12,13),e.state=15;break;case 15:a=void 0,o=d._iterable[Symbol.iterator](),e.state=11;break;case 11:e.state=(r=(a=o.next()).done)?9:7;break;case 6:r=!0,e.state=11;break;case 7:u=a.value,e.state=8;break;case 8:return e.state=2,t===l?c(u):u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=6;break;case 9:e.popTry(),e.state=13,e.finallyFallThrough=17;break;case 12:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=18;break;case 18:n=!0,i=s,e.state=13,e.finallyFallThrough=17;break;case 13:e.popTry(),e.state=24;break;case 24:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=22;break;case 17:if(t<=l)throw new Error("sequence ended before transformation [withTransformedItem(${index}, ${itemTransformation})]");e.state=-2;break;case 22:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},withInsertedItem:function(l,c){if(l<0)throw new Error("needed index >= 0");var d=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:if(void 0!==d.tryPeekCount()&&l>d.tryPeekCount())throw new Error("needed index <= count");n=!(r=!(t=0)),i=void 0,e.state=36;break;case 36:e.pushTry(17,18),e.state=20;break;case 20:a=void 0,o=d._iterable[Symbol.iterator](),e.state=16;break;case 16:e.state=(r=(a=o.next()).done)?14:12;break;case 9:r=!0,e.state=16;break;case 12:u=a.value,e.state=13;break;case 13:e.state=t===l?1:4;break;case 1:return e.state=2,c;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=11;break;case 11:return e.state=7,u;case 7:e.maybeThrow(),e.state=9;break;case 14:e.popTry(),e.state=18,e.finallyFallThrough=22;break;case 17:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=23;break;case 23:n=!0,i=s,e.state=18,e.finallyFallThrough=22;break;case 18:e.popTry(),e.state=29;break;case 29:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=27;break;case 22:e.state=t===l?30:33;break;case 30:return e.state=31,c;case 31:e.maybeThrow(),e.state=33;break;case 33:if(t<l)throw new Error("sequence ended before insertion [withInsertedItem(${index}, ${item})]");e.state=-2;break;case 27:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},takeWhile:function(s){var l=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:r=!(t=!0),n=void 0,e.state=27;break;case 27:e.pushTry(13,14),e.state=16;break;case 16:i=void 0,a=l[Symbol.iterator](),e.state=12;break;case 12:e.state=(t=(i=a.next()).done)?10:8;break;case 7:t=!0,e.state=12;break;case 8:o=i.value,e.state=9;break;case 9:e.state=s(o)?2:10;break;case 2:return e.state=5,o;case 5:e.maybeThrow(),e.state=7;break;case 10:e.popTry(),e.state=14,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.maybeUncatchable(),u=e.storedException,e.state=19;break;case 19:r=!0,n=u,e.state=14,e.finallyFallThrough=-2;break;case 14:e.popTry(),e.state=25;break;case 25:try{t||null==a.return||a.return()}finally{if(r)throw n}e.state=23;break;case 23:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},skipTailWhile:function(d){var m=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l,c;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=[],n=!(r=!0),i=void 0,e.state=41;break;case 41:e.pushTry(27,28),e.state=30;break;case 30:a=void 0,o=m[Symbol.iterator](),e.state=26;break;case 26:e.state=(r=(a=o.next()).done)?24:22;break;case 20:r=!0,e.state=26;break;case 22:u=a.value,e.state=23;break;case 23:e.state=d(u)?19:11;break;case 19:t.push(u),e.state=20;break;case 11:s=e.wrapYieldStar(t[Symbol.iterator]()),e.sent=void 0,e.action="next",e.state=12;break;case 12:l=s[e.action](e.sentIgnoreThrow),e.state=9;break;case 9:e.state=l.done?3:2;break;case 3:e.sent=l.value,e.state=10;break;case 2:return e.state=12,l.value;case 10:t=[],e.state=18;break;case 18:return e.state=14,u;case 14:e.maybeThrow(),e.state=20;break;case 24:e.popTry(),e.state=28,e.finallyFallThrough=-2;break;case 27:e.popTry(),e.maybeUncatchable(),c=e.storedException,e.state=33;break;case 33:n=!0,i=c,e.state=28,e.finallyFallThrough=-2;break;case 28:e.popTry(),e.state=39;break;case 39:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=37;break;case 37:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},skipWhile:function(l){var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=t=!0),i=void 0,e.state=27;break;case 27:e.pushTry(13,14),e.state=16;break;case 16:a=void 0,o=c[Symbol.iterator](),e.state=12;break;case 12:e.state=(r=(a=o.next()).done)?10:8;break;case 4:r=!0,e.state=12;break;case 8:u=a.value,e.state=9;break;case 9:t=t&&l(u),e.state=7;break;case 7:e.state=t?4:1;break;case 1:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 10:e.popTry(),e.state=14,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=19;break;case 19:n=!0,i=s,e.state=14,e.finallyFallThrough=-2;break;case 14:e.popTry(),e.state=25;break;case 25:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=23;break;case 23:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},take:function(l){if(l<0)throw new Error("needed maxTakeCount >= 0");if(0===l)return new u([]);var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=!(t=0)),i=void 0,e.state=29;break;case 29:e.pushTry(15,16),e.state=18;break;case 18:a=void 0,o=c[Symbol.iterator](),e.state=14;break;case 14:e.state=(r=(a=o.next()).done)?12:10;break;case 6:r=!0,e.state=14;break;case 10:u=a.value,e.state=11;break;case 11:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=9;break;case 9:e.state=l<=t?12:6;break;case 12:e.popTry(),e.state=16,e.finallyFallThrough=-2;break;case 15:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=21;break;case 21:n=!0,i=s,e.state=16,e.finallyFallThrough=-2;break;case 16:e.popTry(),e.state=27;break;case 27:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=25;break;case 25:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},skip:function(l){if(l<0)throw new Error("needed maxSkipCount >= 0");if(0===l)return this;var c=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:n=!(r=!(t=0)),i=void 0,e.state=27;break;case 27:e.pushTry(13,14),e.state=16;break;case 16:a=void 0,o=c[Symbol.iterator](),e.state=12;break;case 12:e.state=(r=(a=o.next()).done)?10:8;break;case 7:r=!0,e.state=12;break;case 8:u=a.value,e.state=9;break;case 9:e.state=l<=t?1:4;break;case 1:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=7;break;case 10:e.popTry(),e.state=14,e.finallyFallThrough=-2;break;case 13:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=19;break;case 19:n=!0,i=s,e.state=14,e.finallyFallThrough=-2;break;case 14:e.popTry(),e.state=25;break;case 25:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=23;break;case 23:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},distinctBy:function(n){var e=this;return u.fromGenerator(function(){var r=new Set;return e.filter(function(e){var t=n(e);return!r.has(t)&&(r.add(t),!0)})[Symbol.iterator]()})},distinct:function(){return this.distinctBy(function(e){return e})},segmentBy:function(d){var m=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l,c;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=[],i=!(n=!(r=void 0)),a=void 0,e.state=36;break;case 36:e.pushTry(17,18),e.state=20;break;case 20:o=void 0,u=m[Symbol.iterator](),e.state=16;break;case 16:e.state=(n=(o=u.next()).done)?14:12;break;case 11:n=!0,e.state=16;break;case 12:s=o.value,e.state=13;break;case 13:l=d(s),e.state=9;break;case 9:e.state=0<t.length&&l!==r?1:6;break;case 1:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;case 4:t=[],e.state=6;break;case 6:t.push(s),r=l,e.state=11;break;case 14:e.popTry(),e.state=18,e.finallyFallThrough=22;break;case 17:e.popTry(),e.maybeUncatchable(),c=e.storedException,e.state=23;break;case 23:i=!0,a=c,e.state=18,e.finallyFallThrough=22;break;case 18:e.popTry(),e.state=29;break;case 29:try{n||null==u.return||u.return()}finally{if(i)throw a}e.state=27;break;case 22:e.state=0<t.length?30:-2;break;case 30:return e.state=31,t;case 31:e.maybeThrow(),e.state=-2;break;case 27:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},single:function(){var e=void 0!==arguments[0]?arguments[0]:f,t=this[Symbol.iterator](),r=t.next();if(!r.done&&t.next().done)return r.value;if(e===f)throw r.done?new Error("Empty sequence doesn't contain a single item."):new Error("Sequence contains more than a single item.");return e},first:function(){var e=void 0!==arguments[0]?arguments[0]:f,t=this[Symbol.iterator]().next();if(!t.done)return t.value;if(e===f)throw new Error("Empty sequence has no first item.");return e},last:function(){var e=void 0!==arguments[0]?arguments[0]:f,t=h,r=!0,n=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)t=a.value}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return m(t,e,"Empty sequence has no last item.")},tryPeekCount:function(){var t=this;return Array.isArray(this._iterable)||!r.every(function(e){return!(t._iterable instanceof e)})?this._iterable.length:this._iterable instanceof Map||this._iterable instanceof Set?this._iterable.size:void 0},count:function(){var e=this.tryPeekCount();if(void 0!==e)return e;var t=0,r=!0,n=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){a.value;t++}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t},padded:function(l){var c=arguments[1];if(l<0)throw new Error("needed minCount >= 0");var d=this._iterable;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=l,n=!(r=!0),i=void 0,e.state=33;break;case 33:e.pushTry(12,13),e.state=15;break;case 15:a=void 0,o=d[Symbol.iterator](),e.state=11;break;case 11:e.state=(r=(a=o.next()).done)?9:7;break;case 6:r=!0,e.state=11;break;case 7:u=a.value,e.state=8;break;case 8:return e.state=2,u;case 2:e.maybeThrow(),e.state=4;break;case 4:--t,e.state=6;break;case 9:e.popTry(),e.state=13,e.finallyFallThrough=17;break;case 12:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=18;break;case 18:n=!0,i=s,e.state=13,e.finallyFallThrough=17;break;case 13:e.popTry(),e.state=24;break;case 24:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=22;break;case 17:e.state=0<t?25:-2;break;case 25:return e.state=26,c;case 26:e.maybeThrow(),e.state=28;break;case 28:--t,e.state=17;break;case 22:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},sorted:function(){return n(this.toArray().sort())},sortedBy:function(i){return n(this.toArray().sort(function(e,t){var r=i(e),n=i(t);return r<n?-1:n<r?1:0}))},ifThen:function(e,t){return e?new u(t(this)):this},toMap:function(e,t){var r=new Map,n=!0,i=!1,a=void 0;try{for(var o,u=this._iterable[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=e(s),c=t(s);if(r.has(l))throw new Error("Duplicate key <"+l+">. Came from item <"+s+">.");r.set(l,c)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r},keyedBy:function(e){return this.toMap(e,function(e){return e})},groupBy:function(e){var t=new Map,r=!0,n=!1,i=void 0;try{for(var a,o=this._iterable[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value,s=e(u);t.has(s)||t.set(s,[]),t.get(s).push(u)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t},partitioned:function(l){if(l<=0)throw new Error("need partitionSize > 0");var c=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=[],n=!(r=!0),i=void 0,e.state=34;break;case 34:e.pushTry(15,16),e.state=18;break;case 18:a=void 0,o=c[Symbol.iterator](),e.state=14;break;case 14:e.state=(r=(a=o.next()).done)?12:10;break;case 6:r=!0,e.state=14;break;case 10:u=a.value,e.state=11;break;case 11:t.push(u),e.state=9;break;case 9:e.state=t.length>=l?1:6;break;case 1:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;case 4:t=[],e.state=6;break;case 12:e.popTry(),e.state=16,e.finallyFallThrough=20;break;case 15:e.popTry(),e.maybeUncatchable(),s=e.storedException,e.state=21;break;case 21:n=!0,i=s,e.state=16,e.finallyFallThrough=20;break;case 16:e.popTry(),e.state=27;break;case 27:try{r||null==o.return||o.return()}finally{if(n)throw i}e.state=25;break;case 20:e.state=0<t.length?28:-2;break;case 28:return e.state=29,t;case 29:e.maybeThrow(),e.state=-2;break;case 25:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},stride:function(r){return this.filterWithIndex(function(e,t){return t%r==0})},breadthFirstSearch:function(m){var f=void 0!==arguments[1]?arguments[1]:function(e){return e},h=this;return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,i,a,o,u,s,l,c,d;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=new Set,r=h.toArray(),e.state=16;break;case 16:n=0,e.state=14;break;case 14:e.state=n<r.length?8:-2;break;case 7:n++,e.state=14;break;case 8:i=r[n],a=f(i),e.state=9;break;case 9:e.state=t.has(a)?7:2;break;case 2:t.add(a),u=!(o=!0),s=void 0;try{for(c=m(i)[Symbol.iterator]();!(o=(l=c.next()).done);o=!0)d=l.value,r.push(d)}catch(e){u=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(u)throw s}}e.state=11;break;case 11:return e.state=5,i;case 5:e.maybeThrow(),e.state=7;break;default:return e.end()}},e,this)}))}},{fromGenerator:function(e){return new u(e,!0)},range:function(r){if(!Number.isInteger(r)||r<0)throw new e("bad count",{count:r});return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=7;break;case 7:e.state=t<r?1:-2;break;case 4:t++,e.state=7;break;case 1:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)}))},naturals:function(){return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=9;break;case 9:e.state=1;break;case 1:return e.state=2,t;case 2:e.maybeThrow(),e.state=4;break;case 4:t++,e.state=9;break;default:return e.end()}},e,this)}))},repeat:function(r,n){if(n<0)throw new Error("needed repeatCount >= 0");return u.fromGenerator($traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=7;break;case 7:e.state=t<n?1:-2;break;case 4:t++,e.state=7;break;case 1:return e.state=2,r;case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)}))}});function u(e){var t,r,n,i=void 0!==arguments[1]&&arguments[1];if(e instanceof u)r=e._iterable,n=e[Symbol.iterator];else if(i)t={},Object.defineProperty(t,Symbol.iterator,{value:e,configurable:!0,enumerable:!0,writable:!0}),r=t,n=e;else{if(!c(e))throw new Error("Not iterable: "+e);n=(r=e)[Symbol.iterator].bind(e)}this._iterable=r,this[Symbol.iterator]=n}var n=function(e){return new t(e)};return{get THROW_IF_EMPTY(){return f},get seq(){return n},get Seq(){return t}}}),$traceurRuntime.registerModule("src/base/Util.js",[],function(){"use strict";var n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/base/Util.js")).DetailedError,e=$traceurRuntime.createClass(d,{},{need:function(e,t,r){if(!0!==e){var n=void 0===r?"(not provided)":"["+Array.prototype.slice.call(r).join(", ")+"]";throw new Error("Precondition failed\n\nMessage: "+(void 0===t?"(not provided)":t)+"\n\nArgs: "+n)}},numberOfSetBits:function(e){if(e<0)throw new Error("i < 0");if(!Number.isInteger(e))throw new Error("!Number.isInteger(i)");if(4294967295<e)throw new Error("i > 0xFFFFFFFF");return e=(e=(858993459&(e=(1431655765&e)+(e>>1&1431655765)))+(e>>2&858993459))+(e>>4)&252645135,e+=e>>8,255&(e+=e>>16)},bin:function(e,t){return("0".repeat(t)+e.toString(2)).slice(-t).split("").join("")},notNull:function(e){return d.need(null!==e,"notNull"),e},isPowerOf2:function(e){return 0<e&&0==(e-1&e)},bitSize:function(e){return d.need(0<=e,"bitSize: n >= 0"),0===e?0:d.floorLg2(e)+1},ceilingPowerOf2:function(e){return e<=1?1:1<<d.ceilLg2(e)},ceilLg2:function(e){if(e<=1)return 0;var t=Math.ceil(Math.log2(e));return 1<<t<e?t+1:e<=1<<t-1?t-1:t},floorLg2:function(e){if(e<=1)return 0;var t=Math.floor(Math.log2(e));return 1<<t+1<=e?t+1:e<1<<t?t-1:t},popcnt:function(e){if(e<0)return Math.POSITIVE_INFINITY;for(var t=0;0<e;)e&=e-1,t++;return t},powerOfTwoness:function(e){var t=void 0!==arguments[1]?arguments[1]:Math.POSITIVE_INFINITY;return 0===e?t:e<0?d.powerOfTwoness(-e,t):Math.round(Math.log2(e&~(e-1)))},reverseGroupMap:function(e){var t,r,n=void 0!==arguments[1]&&arguments[1],i=new Map;if(n){var a=!0,o=!1,u=void 0;try{for(var s,l=e.keys()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;i.set(c,[])}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}}var d=!0,m=!1,f=void 0;try{for(var h,g=e[Symbol.iterator]();!(d=(h=g.next()).done);d=!0){var p=(r=(t=h.value[Symbol.iterator]()).next()).done?void 0:r.value,v=(r=t.next()).done?void 0:r.value,y=!0,b=!1,R=void 0;try{for(var w,M=v[Symbol.iterator]();!(y=(w=M.next()).done);y=!0){var _=w.value;i.has(_)||i.set(_,[]),i.get(_).push(p)}}catch(e){b=!0,R=e}finally{try{y||null==M.return||M.return()}finally{if(b)throw R}}}}catch(e){m=!0,f=e}finally{try{d||null==g.return||g.return()}finally{if(m)throw f}}return i},binarySearchForTransitionFromTrueToFalse:function(e,t){for(var r=0;r<e;){var n=r+Math.floor((e-r)/2);t(n)?r=n+1:e=n}return r},breakLine:function(t,r,n){if(""===t)return[""];for(var e=[],i=0;i<t.length;){var a=d.binarySearchForTransitionFromTrueToFalse(t.length-i+1,function(e){return n(t.substr(i,e))<=r})-1,a=Math.max(1,a),o=t.substr(i,a);if(!(i+a===t.length||null!==t.substr(i+a,1).match(/\s/))){var u=/^(.*\S)(\s+)\S*$/.exec(o);if(null!==u){var s=u[1],l=u[2];e.push(s.trim()),i+=s.length+l.length;continue}}e.push(o.trim()),i+=o.length,i+=t.substr(i).match(/^\s*/)[0].length}return e},decomposeObjectValues:function(e){var u=[],s=function(e){if(Array.isArray(e)){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;s(o)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}else u.push(e)},t=!0,r=!1,n=void 0;try{for(var i,a=Object.keys(e).sort()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;s(e[o],u)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return u},recomposedObjectValues:function(e,s){var t={},l=0,c=function(e){if(Array.isArray(e)){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;t.push(c(u))}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t}return s[l++]},r=!0,n=!1,i=void 0;try{for(var a,o=Object.keys(e).sort()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;t[u]=c(e[u])}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return d.need(l===s.length,"Mismatched field value count."),t},objectifyArrayFunc:function(t){return function(e){return d.recomposedObjectValues(e,t(d.decomposeObjectValues(e)))}},snappedCosSin:function(e){var t=Math.PI/4,r=Math.round(e/t);if(r*t!==e)return[Math.cos(e),Math.sin(e)];var n=Math.sqrt(.5);return[[1,0],[n,n],[0,1],[-n,n],[-1,0],[-n,-n],[0,-1],[n,-n]][7&r]},properMod:function(e,t){if(t<=0)throw new n("denominator <= 0",{numerator:e,denominator:t});var r=e%t;return r+(r<0?t:0)},mergeMaps:function(){for(var e,t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=new Map,a=!0,o=!1,u=void 0;try{for(var s,l=r[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,d=!0,m=!1,f=void 0;try{for(var h,g=c.entries()[Symbol.iterator]();!(d=(h=g.next()).done);d=!0){var p=(t=(e=h.value[Symbol.iterator]()).next()).done?void 0:t.value,v=(t=e.next()).done?void 0:t.value;i.set(p,v)}}catch(e){m=!0,f=e}finally{try{d||null==g.return||g.return()}finally{if(m)throw f}}}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}return i},modular_multiplicative_inverse:function(e,t){var r=d.extended_gcd(e,t),n=r.x;if(1===r.gcd)return(n%=t)<0&&(n+=t),n},extended_gcd:function(e,t){for(var r,n,i,a=0,o=1,u=t,s=1,l=0,c=e;0!==u;)var d,m,f,h=Math.floor(c/u),c=(r=(d=[u,c-h*u][Symbol.iterator]()).next()).done?void 0:r.value,u=(r=d.next()).done?void 0:r.value,s=(n=(m=[a,s-h*a][Symbol.iterator]()).next()).done?void 0:n.value,a=(n=m.next()).done?void 0:n.value,l=(i=(f=[o,l-h*o][Symbol.iterator]()).next()).done?void 0:i.value,o=(i=f.next()).done?void 0:i.value;return{x:s,y:l,gcd:c}},digits_to_superscript_digits:function(e){for(var t=0;t<10;t++)e=e.split("0123456789"[t]).join("⁰¹²³⁴⁵⁶⁷⁸⁹"[t]);return e}});function d(){}return e.STRICT_EQUALITY=function(e,t){return e===t},e.CUSTOM_IS_EQUAL_TO_EQUALITY=function(e,t){return null===e?null===t:void 0===e?void 0===t:e.isEqualTo(t)},{get Util(){return e}}}),$traceurRuntime.registerModule("src/browser/Clipboard.js",[],function(){"use strict";function e(e){var t,r;if(document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((r=document.createRange()).selectNodeContents(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(r)),!document.execCommand("copy"))throw new Error("execCommand failed")}return{get selectAndCopyToClipboard(){return e}}}),$traceurRuntime.registerModule("src/browser/EventUtil.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/browser/EventUtil.js")).Observable;function t(t){return e.of(e.elementEvent(t,"change"),e.elementEvent(t,"keyup"),e.elementEvent(t,"click"),e.elementEvent(t,"paste"),e.elementEvent(t,"input")).flatten().map(function(e){return t.value}).whenDifferent()}return{get textEditObservable(){return t}}}),$traceurRuntime.registerModule("src/browser/HistoryPusher.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/browser/HistoryPusher.js")).DetailedError,e=$traceurRuntime.createClass(function(){this._historyActionsNotWorking=!1,this._currentMemorableStateObj=void 0},{currentStateIsMemorableButUnknown:function(){this._currentMemorableStateObj={wont_equal_this:!0}},currentStateIsMemorableAndEqualTo:function(e){this._currentMemorableStateObj=e},currentStateIsNotMemorable:function(){this._currentMemorableStateObj=void 0},stateChange:function(e,t){if(!t.startsWith("#"))throw new r("Expected a hash URL.",{stateObj:e,stateUrlHash:t});if(this._currentMemorableStateObj!==e)if(this._historyActionsNotWorking)document.location.hash=t;else try{void 0===this._currentMemorableStateObj?history.replaceState(e,"",t):(history.pushState(e,"",t),this._currentMemorableStateObj=void 0)}catch(e){console.warn("Calling 'history.replaceState/pushState' failed. Falling back to setting location.hash.",e),this._historyActionsNotWorking=!0,document.location.hash=t}}},{});return{get HistoryPusher(){return e}}}),$traceurRuntime.registerModule("src/browser/MouseWatcher.js",[],function(){"use strict";function n(e){return void 0!==window.TouchEvent&&e instanceof TouchEvent||1===e.which}function e(e){return 2===e.which}var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/browser/MouseWatcher.js")).Point;function t(e,t){var r=t.getBoundingClientRect();return new i(e.clientX-r.left,e.clientY-r.top)}function r(e,t,r,n,i){return new a(e,t,r,n,i).addListenersUntilResultInvoked()}function o(e,t,r){return e.addEventListener(t,r),function(){return e.removeEventListener(t,r)}}var a=$traceurRuntime.createClass(function(e,t,r,n,i){this._element=e,this._grabHandler=t,this._cancelHandler=r,this._dragHandler=n,this._dropHandler=i,this._grabPointerId=void 0,this._grabActivityTime=window.performance.now(),this._lastPos=void 0,this._lastEv=void 0},{addListenersUntilResultInvoked:function(){var t=this,e=this._element,a=[o(e,"mousedown",function(e){return t.handleMouseEventWith(e,t.onDown)}),o(document,"mousemove",function(e){return t.handleMouseEventWith(e,t.onMove)}),o(document,"mouseup",function(e){return t.handleMouseEventWith(e,t.onUp)}),o(document,"mouseleave",function(e){return t.handleMouseEventWith(e,t.onLeave)}),o(document,"mouseenter",function(e){return t.handleMouseEventWith(e,t.onEnter)}),o(e,"touchstart",function(e){return t.handleTouchEventWith(e,t.onDown)}),o(e,"touchmove",function(e){return t.handleTouchEventWith(e,t.onMove)}),o(e,"touchend",function(e){return t.handleTouchEventWith(e,t.onUp)}),o(e,"touchcancel",function(e){return t.handleTouchEventWith(e,t.onCancel)})];return function(){var e=!0,t=!1,r=void 0;try{for(var n,i=a[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){(0,n.value)()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}}},canRegrab:function(){return window.performance.now()>=this._grabActivityTime+5e3},onDown:function(e,t,r){if(n(r)){if(void 0!==this._grabPointerId){if(!this.canRegrab())return;this._dropHandler(this._lastPos,this._lastEv)}this._grabPointerId=t,this._grabActivityTime=window.performance.now(),this._lastPos=e,this._lastEv=r,this._grabHandler(e,r)}},onMove:function(e,t,r){if(this._grabPointerId===t){if(!n(r))return this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,void this._dropHandler(void 0,r);this._grabActivityTime=window.performance.now(),this._lastPos=e,this._lastEv=r,this._dragHandler(e,r)}},onCancel:function(e,t,r){this._grabPointerId===t&&(this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,this._cancelHandler(r))},onUp:function(e,t,r){n(r)&&this._grabPointerId===t&&(this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,this._dropHandler(e,r))},onLeave:function(e,t,r){n(r)&&this._grabPointerId===t&&(this._grabActivityTime=window.performance.now(),this._lastPos=void 0,this._lastEv=r,this._dragHandler(void 0,r))},onEnter:function(e,t,r){n(r)||this._grabPointerId!==t||(this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,this._dropHandler(void 0,r))},relativeEventPos:function(e){return t(e,this._element)},handleTouchEventWith:function(e,t){for(var r=0;r<e.changedTouches.length;r++){var n=e.changedTouches[r];t.call(this,this.relativeEventPos(n),n.identifier,e)}},handleMouseEventWith:function(e,t){t.call(this,this.relativeEventPos(e),"mouse!",e)}},{});return{get watchDrags(){return r},get isLeftClicking(){return n},get isMiddleClicking(){return e},get eventPosRelativeTo(){return t}}}),$traceurRuntime.registerModule("src/browser/Polyfills.js",[],function(){"use strict";Float32Array.prototype.slice=Float32Array.prototype.slice||function(e,t){return new Float32Array(Array.from(this).slice(e,t))},Float64Array.prototype.slice=Float64Array.prototype.slice||function(e,t){return new Float64Array(Array.from(this).slice(e,t))},Uint32Array.prototype.slice=Uint32Array.prototype.slice||function(e,t){return new Uint32Array(Array.from(this).slice(e,t))},Int32Array.prototype.slice=Int32Array.prototype.slice||function(e,t){return new Int32Array(Array.from(this).slice(e,t))},Uint16Array.prototype.slice=Uint16Array.prototype.slice||function(e,t){return new Uint16Array(Array.from(this).slice(e,t))},Int16Array.prototype.slice=Int16Array.prototype.slice||function(e,t){return new Int16Array(Array.from(this).slice(e,t))},Uint8Array.prototype.slice=Uint8Array.prototype.slice||function(e,t){return new Uint8Array(Array.from(this).slice(e,t))},Int8Array.prototype.slice=Int8Array.prototype.slice||function(e,t){return new Int8Array(Array.from(this).slice(e,t))};function e(){var r=this;return $traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=0,e.state=7;break;case 7:e.state=t<r.length?1:-2;break;case 4:t++,e.state=7;break;case 1:return e.state=2,r[t];case 2:e.maybeThrow(),e.state=4;break;default:return e.end()}},e,this)})()}Float32Array.prototype[Symbol.iterator]=Float32Array.prototype[Symbol.iterator]||e,Float64Array.prototype[Symbol.iterator]=Float64Array.prototype[Symbol.iterator]||e,Uint32Array.prototype[Symbol.iterator]=Uint32Array.prototype[Symbol.iterator]||e,Uint16Array.prototype[Symbol.iterator]=Uint16Array.prototype[Symbol.iterator]||e,Uint8Array.prototype[Symbol.iterator]=Uint8Array.prototype[Symbol.iterator]||e,Int32Array.prototype[Symbol.iterator]=Int32Array.prototype[Symbol.iterator]||e,Int16Array.prototype[Symbol.iterator]=Int16Array.prototype[Symbol.iterator]||e,Int8Array.prototype[Symbol.iterator]=Int8Array.prototype[Symbol.iterator]||e,window.performance=window.performance||{},window.performance.now=window.performance.now||function(){return Date.now()};var t=WebGLRenderingContext;if(void 0!==t&&void 0===t.INVALID_ENUM){var r=document.createElement("canvas").getContext("webgl");if(null!=r){var n=!0,i=!1,a=void 0;try{for(var o,u=["ARRAY_BUFFER","CLAMP_TO_EDGE","COLOR_ATTACHMENT0","COMPILE_STATUS","ELEMENT_ARRAY_BUFFER","FLOAT","FRAGMENT_SHADER","FRAMEBUFFER","FRAMEBUFFER_COMPLETE","HIGH_FLOAT","LINK_STATUS","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MEDIUM_FLOAT","NEAREST","NO_ERROR","RGBA","STATIC_DRAW","TEXTURE_2D","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE0","TRIANGLES","UNSIGNED_SHORT","UNSIGNED_BYTE","VALIDATE_STATUS","VERTEX_SHADER"][Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;t[s]=t[s]||r[s]}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}}return{}}),$traceurRuntime.registerModule("src/browser/SaveFile.js",[],function(){"use strict";function e(e,t){if(navigator.msSaveBlob)navigator.msSaveBlob(new Blob([t],{type:"text/html;charset=UTF-8"}),e);else{var r=document.createElement("a");r.href=void 0!==window.URL?window.URL.createObjectURL(new Blob([t],{type:"text/html;charset=UTF-8"})):"data:application/octet-stream,"+encodeURI(moddedHtml),r.download=e;try{document.body.appendChild(r),r.click()}finally{document.body.removeChild(r)}}}return{get saveFile(){return e}}}),$traceurRuntime.registerModule("src/browser/TouchScrollBlocker.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/browser/TouchScrollBlocker.js")).Rect;var e=$traceurRuntime.createClass(function(e){this._parentElement=e,this._curBlockers=[],this._curShowing=0},{setBlockers:function(e,t){for(;this._curBlockers.length<e.length;){var r=document.createElement("div");r.style.touchAction="none",r.style.position="absolute",r.style.opacity=1e-4,this._parentElement.appendChild(r),this._curBlockers.push({div:r,area:void 0})}for(var n=0;n<e.length;n++){var i=e[n].rect,a=t||e[n].cursor||"auto",o=this._curBlockers[n],u=o.div.style;i.isEqualTo(o.area)||(o.area=i,u.left=i.x+"px",u.top=i.y+"px",u.width=i.w+"px",u.height=i.h+"px"),u.cursor!==a&&(u.cursor=a)}for(;this._curShowing<e.length;)this._curBlockers[this._curShowing].div.style.display="inline",this._curShowing++;for(;this._curShowing>e.length;)this._curShowing--,this._curBlockers[this._curShowing].div.style.display="none"}},{});return{get TouchScrollBlocker(){return e}}}),$traceurRuntime.registerModule("src/circuit/CircuitComputeUtil.js",[],function(){"use strict";var R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitEvalContext.js","src/circuit/CircuitComputeUtil.js")).CircuitEvalContext,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/circuit/CircuitComputeUtil.js")).CircuitShaders,M=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/CircuitComputeUtil.js")).DetailedError,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetTextureUtil.js","src/circuit/CircuitComputeUtil.js")).KetTextureUtil),_=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/CircuitComputeUtil.js")).Controls,o=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/circuit/CircuitComputeUtil.js")).GateBuilder,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/circuit/CircuitComputeUtil.js")).Gates),x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/CircuitComputeUtil.js")).Util;function e(e,a){return e.setActualEffectToUpdateFunc(function(e){return t(e,a.withDisabledReasonsForEmbeddedContext(e.row,e.customContextFromGates),!1)}).setKnownEffectToCircuit(a).setExtraDisableReasonFinder(function(e){for(var t=a.withDisabledReasonsForEmbeddedContext(e.outerRow,e.context),r=0;r<t.numWires;r++)for(var n=0;n<t.columns.length;n++){var i=t.gateAtLocIsDisabledReason(n,r);if(void 0!==i)return i;if(t.gateInSlot(n,r)===o.Special.Measurement)return"hidden\nmeasure\nbroken"}})}function t(e,h,g){function t(f){return function(e){if(g){var t=function(e,t,r){var n=[],i=!0,a=!1,o=void 0;try{for(var u=void 0,s=t.customStatRowsInCol(r)[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value,c=new R(e.time,l,t.numWires,e.controls,e.controlsTexture,e.controls,e.stateTrader,x.mergeMaps(e.customContextFromGates,t.colCustomContextFromGates(r,l))),d=t.columns[r].gates[l].customStatTexturesMaker(c);n.push({row:l,stat:d})}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}var m=M.superpositionToQubitDensities(e.stateTrader.currentTexture,e.controls,t.colDesiredSingleQubitStatsMask(r)),f=void 0!==t.columns[r].indexOfNonUnitaryGate(),h=M.superpositionToNorm(e.stateTrader.currentTexture,f);return{qubitDensities:m,norm:h,customGateStats:n}}(e,h,f),r=t.qubitDensities,n=t.norm,i=t.customGateStats;p.push(r),y.push(n);var a=!0,o=!1,u=void 0;try{for(var s,l=i[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,d=c.row,m=c.stat;b.push({col:f,row:d,out:v.length}),v.push(m)}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}}}}var p=[],v=[],y=[],b=[];h.applyInitialStateOperations(e);for(var r,n,i,a,o,u,s,l,c,d,m,f=0;f<h.columns.length;f++)n=h,a=t(i=f),d=c=l=s=u=o=void 0,o=(r=e).controls.and(n.colControls(i).shift(r.row)),u=w.controlMask(o).toBoolTexture(r.wireCount),s=x.mergeMaps(r.customContextFromGates,n.colCustomContextFromGates(i,r.row)),l=r.stateTrader,c=new R(r.time,r.row,r.wireCount,r.controls,r.controlsTexture,o,l,s),d=new R(r.time,r.row,r.wireCount,o,u,o,l,s),n.applyBeforeOperationsInCol(i,c),n.applyMainOperationsInCol(i,d),a(d),n.applyAfterOperationsInCol(i,c),u.deallocByDepositingInPool("controlTex in _advanceStateWithCircuitDefinitionColumn");return g&&(m=(1<<h.numWires)-1,p.push(M.superpositionToQubitDensities(e.stateTrader.currentTexture,_.NONE,m))),{colQubitDensities:p,colNorms:y,customStats:v,customStatsMap:b}}return{get setGateBuilderEffectToCircuit(){return e},get advanceStateWithCircuit(){return t}}}),$traceurRuntime.registerModule("src/circuit/CircuitDefinition.js",[],function(){"use strict";var u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/circuit/CircuitDefinition.js")).CircuitShaders,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/circuit/CircuitDefinition.js")).Config,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/CircuitDefinition.js")).Controls,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CustomGateSet.js","src/circuit/CircuitDefinition.js")).CustomGateSet,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/CircuitDefinition.js")).DetailedError,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Equate.js","src/circuit/CircuitDefinition.js")).equate_Maps,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/circuit/CircuitDefinition.js")).Gate,E=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/circuit/CircuitDefinition.js")).GateColumn,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/circuit/CircuitDefinition.js")).GateShaders,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/circuit/CircuitDefinition.js")),h=e.Gates,d=e.INITIAL_STATES_TO_GATES,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/circuit/CircuitDefinition.js")).Point,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/CircuitDefinition.js")),m=n.seq,f=n.Seq,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/CircuitDefinition.js")).Util,a=$traceurRuntime.createClass(p,{gateWeight:function(){return m(this.columns).flatMap(function(e){return e.gates}).filter(function(e){return void 0!==e}).map(function(e){return void 0===e.knownCircuit?1:e.knownCircuit.gateWeight()}).sum()},hasControls:function(){return!this.columns.every(function(e){return!e.hasControl(-1)})},withSwitchedInitialStateOn:function(e){var t=arguments[1],r=new Map($traceurRuntime.spread(this.customInitialValues.entries())),n=r.get(e),i=$traceurRuntime.spread(d.keys()),a=i[(i.indexOf(n)+1)%i.length];return void 0!==t&&(a=t),void 0===a||0===a?r.delete(e):r.set(e,a),this.withInitialStates(r)},withInitialStates:function(e){return new p(this.numWires,this.columns,this.outerRowOffset,this.outerContext,this.customGateSet,this.isNested,e)},hasOnlyUnitaryGates:function(){return this.columns.every(function(e){return void 0===e.indexOfNonUnitaryGate()})},hasNonControlGates:function(){return!this.columns.every(function(e){return!!e.gates.every(function(e){return void 0===e||e.isControl()})})},countGatesUpTo:function(e){var t=0,r=!0,n=!1,i=void 0;try{for(var a,o=this.columns[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value,s=!0,l=!1,c=void 0;try{for(var d,m=u.gates[Symbol.iterator]();!(s=(d=m.next()).done);s=!0){if(void 0!==d.value&&e<=++t)return t}}catch(e){l=!0,c=e}finally{try{s||null==m.return||m.return()}finally{if(l)throw c}}}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t},getUnmetContextKeys:function(){for(var e=new Set,t=0;t<this.columns.length;t++){var r=this.columns[t],n=this.colCustomContextFromGates(t,0),i=!0,a=!1,o=void 0;try{for(var u,s=r.gates[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value,c=!0,d=!1,m=void 0;try{for(var f,h=(void 0===l?[]:l.getUnmetContextKeys())[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var g=f.value,p=g.replace("Input Range ","Input Default ").replace("Input NO_DEFAULT Range ","Input Range ");n.has(g)||n.has(p)||e.add(g)}}catch(e){d=!0,m=e}finally{try{c||null==h.return||h.return()}finally{if(d)throw m}}}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}}return e},withDisabledReasonsForEmbeddedContext:function(e,t){return new p(this.numWires,this.columns,e,t,this.customGateSet,!0,this.customInitialValues)},_computeGateSlotCoverMap:function(){for(var e=new Map,t=0;t<this.columns.length;t++)for(var r=0;r<this.numWires;r++){var n=this.columns[t].gates[r];if(void 0!==n)for(var i=0;i<n.width;i++)for(var a=0;a<n.height;a++)e.set(t+i+":"+(r+a),{col:t,row:r,gate:n})}return e},isEmpty:function(){return 0===this.columns.length},isEqualTo:function(e){return this===e||e instanceof p&&this.numWires===e.numWires&&m(this.columns).isEqualTo(m(e.columns),i.CUSTOM_IS_EQUAL_TO_EQUALITY)&&t(this.customInitialValues,e.customInitialValues)},toString:function(){function o(e){return"─".repeat(e)}var u=this,s=f.range(this.columns.length).map(function(e){return m(u.columns[e].gates).map(function(e){return void 0===e?0:e.serializedId.length}).max()}).toArray();return"CircuitDefinition ("+this.numWires+" wires, "+this.columns.length+" cols):\n\t"+f.range(this.numWires).map(function(a){return o(1)+f.range(u.columns.length).map(function(e){var t,r,n=u.columns[e].gates[a],i=void 0===n?"":n.serializedId;return t=s[e],r=i,o(Math.floor(t-r.length)/2)+r+o(Math.ceil(t-r.length)/2)}).join(o(1))+o(1)}).join("\n\t")},stableDuration:function(){return m(this.columns).flatMap(function(e){return e.gates}).filter(function(e){return void 0!==e}).map(function(e){return e.stableDuration()}).min(1/0)},readableHash:function(){var e=m(this.columns).flatMap(function(e){return e.gates}).filter(function(e){return void 0!==e}).map(function(e){return e.symbol}).toArray();if(0===e.length)return r.EMPTY_CIRCUIT_TITLE;var t=this.numWires+" wires, "+e.length+" ops, "+e.join("").split("^").join("");return t.length<=40?t:t.substring(0,40)+"…"},withColumns:function(e){return new p(this.numWires,e,this.outerRowOffset,this.outerContext,this.customGateSet,!1,this.customInitialValues)},_usedColumns:function(){for(var e=new Set,t=0;t<this.columns.length;t++)for(var r=0;r<this.columns[t].maximumGateWidth();r++)e.add(t+r);return e},_findWidthWiseOverlapInRect:function(e,t,r,n){for(var i=1;i<r&&e+i<this.columns.length;i++)for(var a=0;a<n;a++){var o=this.findGateCoveringSlot(e+i,t+a);if(void 0!==o&&o.col!==e)return{col:o.col,row:o.row}}},withWidthOverlapsFixed:function(){for(var i=this,r=[],a=this,e=0;e<this.columns.length;e++)!function(n){var e=f.range(a.numWires).map(function(e){var t=i.columns[n].gates[e];if(void 0===t)return 0;var r=i._findWidthWiseOverlapInRect(n,e,t.width,t.height);return void 0===r?0:t.width-(r.col-n)}).max(0);r.push(a.columns[n]);for(var t=0;t<e;t++)r.push(E.empty(a.numWires))}(e);return this.withColumns(r)},_findHeightWiseOverlapsInCol:function(e){for(var t=new Set,r=0,n=0;n<this.numWires;n++){--r;var i=this.gateInSlot(e,n);void 0!==i&&(0<r&&t.add(n),r=Math.max(r,i.height))}return t},withHeightOverlapsFixed:function(){for(var e=void 0!==arguments[0]?arguments[0]:5,i=[],a=this,t=0;t<this.columns.length;t++)(function(e){var r=a._findHeightWiseOverlapsInCol(e);if(0===r.size)return i.push(a.columns[e]);var t=m(a.columns[e].gates).mapWithIndex(function(e,t){return r.has(t)?void 0:e}).toArray(),n=m(a.columns[e].gates).mapWithIndex(function(e,t){return void 0!==e&&(e.isControl()||r.has(t))?e:void 0}).toArray();i.push(new E(t)),i.push(new E(n))})(t);var r=this.withColumns(i);return i.length>this.columns.length&&0<e&&(r=r.withHeightOverlapsFixed(e-1)),r},withTrailingSpacersIncluded:function(){var e=void 0!==arguments[0]?arguments[0]:0;return this.withColumns($traceurRuntime.spread(this.columns,new Array(Math.max(0,this.minimumRequiredColCount()+e-this.columns.length)).fill(E.empty(this.numWires))))},trimEmptyColumnsAtEndIgnoringGateWidths:function(){for(var e=this.columns.length;;e--)if(0===e||!this.columns[e-1].isEmpty())return this.withColumns(this.columns.slice(0,e))},withUncoveredColumnsRemoved:function(){var r=this._usedColumns();return new p(this.numWires,m(this.columns).filterWithIndex(function(e,t){return r.has(t)}).toArray(),this.outerRowOffset,this.outerContext,this.customGateSet,!1,this.customInitialValues)},withWireCount:function(t){return t===this.numWires?this:new p(t,this.columns.map(function(e){return new E($traceurRuntime.spread(e.gates.slice(0,t),new Array(Math.max(0,t-e.gates.length)).fill(void 0)))}),this.outerRowOffset,this.outerContext,this.customGateSet,!1,this.customInitialValues)},minimumRequiredWireCount:function(){var e=1,t=!0,r=!1,n=void 0;try{for(var i,a=this.columns[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)var o=i.value,e=Math.max(e,o.minimumRequiredWireCount())}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var u=!0,s=!1,l=void 0;try{for(var c,d=this.customInitialValues.keys()[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var m=c.value;e=Math.max(e,m+1)}}catch(e){s=!0,l=e}finally{try{u||null==d.return||d.return()}finally{if(s)throw l}}return e},withMinimumWireCount:function(){return this.withWireCount(this.minimumRequiredWireCount())},minimumRequiredColCount:function(){for(var e=0,t=0;t<this.columns.length;t++)e=Math.max(e,this.columns[t].maximumGateWidth()+t);return e},colIsMeasuredMask:function(e){return e<0?0:this._measureMasks[Math.min(e,this.columns.length)]},colDesiredSingleQubitStatsMask:function(e){if(e<0||e>=this.columns.length)return 0;for(var t=this.columns[e],r=0,n=0;n<t.gates.length;n++)void 0!==t.gates[n]&&t.gates[n].isSingleQubitDisplay&&void 0===this.gateAtLocIsDisabledReason(e,n)&&(r|=1<<n);return r},colCustomContextFromGates:function(e,t){if(e<0||e>=this.columns.length)return new Map;var r=""+t,n=this._cachedColumnContexts.get(r);return void 0===n&&(n=this._uncached_customContextFromGates(t),this._cachedColumnContexts.set(r,n)),n[e]},_uncached_customContextFromGates:function(e){for(var t=[],r=new Map,n=0;n<this.columns.length;n++){for(var i=new Map(r),a=this.columns[n],o=0;o<a.gates.length;o++){var u=a.gates[o];if(void 0!==u&&void 0===this.gateAtLocIsDisabledReason(n,o)){var s=!0,l=!1,c=void 0;try{for(var d,m=u.customColumnContextProvider(e+o,u)[Symbol.iterator]();!(s=(d=m.next()).done);s=!0){var f=d.value,h=f.key,g=f.val;i.set(h,g),u.isContextTemporary||r.set(h,g)}}catch(e){l=!0,c=e}finally{try{s||null==m.return||m.return()}finally{if(l)throw c}}}}t.push(i)}return t},locIsMeasured:function(e){var t=e.y;return!(t<0||t>=this.numWires)&&0!=(this.colIsMeasuredMask(e.x)&1<<t)},locClassifyMeasuredIncludingGateExtension:function(e){var t=e.y;if(t<0||t>=this.numWires)return!1;var r=this.columns[e.x].gates[t],n=void 0===r?1:r.height,i=this.colIsMeasuredMask(e.x)>>t&(1<<n)-1;return 0!=i&&(i==(1<<n)-1||void 0)},gateInSlot:function(e,t){if(!(e<0||e>=this.columns.length||t<0||t>=this.numWires)){var r=this.columns[e].gates[t];return void 0===r?void 0:r}},findGateCoveringSlot:function(e,t){var r=e+":"+t;if(this._gateSlotCoverMap.has(r))return this._gateSlotCoverMap.get(r)},locIsControlWireStarter:function(e){var t=this.gateInSlot(e.x,e.y);return void 0!==t&&t.isControlWireSource},locStartsSingleControlWire:function(e){return this.locIsControlWireStarter(e)&&!0!==this.locClassifyMeasuredIncludingGateExtension(e)&&void 0===this.gateAtLocIsDisabledReason(e.x,e.y)},locStartsDoubleControlWire:function(e){return this.locIsControlWireStarter(e)&&!1!==this.locClassifyMeasuredIncludingGateExtension(e)&&void 0===this.gateAtLocIsDisabledReason(e.x,e.y)},colGetEnabledSwapGate:function(e){if(!(e<0||e>=this.columns.length)){for(var t=[],r=0;r<this.numWires;r++)if(this.gateInSlot(e,r)===h.Special.SwapHalf){if(void 0!==this.gateAtLocIsDisabledReason(e,r))return;t.push(r)}if(2===t.length)return t}},locProvidesStat:function(e,t){var r=this.gateInSlot(e.x,e.y);return void 0!==r&&!r.customColumnContextProvider(0,r).every(function(e){return e.key!==t})},locNeedsStat:function(e,t){var r=this.gateInSlot(e.x,e.y);return void 0!==r&&r.getUnmetContextKeys().has(t)},locHasControllableGate:function(e){var t=this.gateInSlot(e.x,e.y);return void 0!==t&&t.interestedInControls},colHasControls:function(e){return!(e<0||e>=this.columns.length)&&this.columns[e].hasControl()},colHasSingleWireControl:function(e){return!(e<0||e>=this.columns.length)&&this.columns[e].hasCoherentControl(this._measureMasks[e])},colHasDoubleWireControl:function(e){return!(e<0||e>=this.columns.length)&&this.columns[e].hasMeasuredControl(this._measureMasks[e])},colControls:function(e){if(e<0||e>=this.columns.length)return l.NONE;for(var t,r=this.columns[e],n=0,i=0,a=0,o=0;o<r.gates.length;o++){var u,s=r.gates[o];void 0!==s&&void 0===this.gateAtLocIsDisabledReason(e,o)&&("parity"===(u=s.controlBit())?a|=1<<o:void 0!==u&&(n|=1<<o,u&&(i|=1<<o)))}return 0!==a&&(i|=t=a&~(a-1),n|=t),new l(n,i,a)},gateAtLocIsDisabledReason:function(e,t){if(!(e<0||t<0||e>=this._colRowDisabledReason.length||t>=this.numWires))return this._colRowDisabledReason[e][t]},applyInitialStateOperations:function(e){for(var t=0;t<this.numWires;t++){var r=this.customInitialValues.get(t);if(!d.has(r))throw new C("Unrecognized initial state.",{state:r});var n=!0,i=!1,a=void 0;try{for(var o,u=d.get(r)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;c.applyMatrixOperation(e.withRow(e.row+t),s.knownMatrixAt(e.time))}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}},applyMainOperationsInCol:function(e,t){var r,n,i,a,o;e<0||e>=this.columns.length||(this._applyOpsInCol(e,t,function(t){if(!t.definitelyHasNoEffect()&&t!==h.Special.SwapHalf)return void 0!==t.customOperation?t.customOperation:function(e){return c.applyMatrixOperation(e,t.knownMatrixAt(e.time))}}),void 0!==(i=this.colGetEnabledSwapGate(e))&&(a=(n=(r=i[Symbol.iterator]()).next()).done?void 0:n.value,o=(n=r.next()).done?void 0:n.value,t.applyOperation(u.swap(t.withRow(a+t.row),o+t.row))))},applyBeforeOperationsInCol:function(e,t){this._applyOpsInCol(e,t,function(e){return e.customBeforeOperation})},applyAfterOperationsInCol:function(e,t){this._applyOpsInCol(e,t,function(e){return e.customAfterOperation})},_applyOpsInCol:function(e,t,r){if(!(e<0||e>=this.columns.length))for(var n=this.columns[e],i=0;i<this.numWires;i++){var a,o=n.gates[i];void 0!==o&&void 0===this.gateAtLocIsDisabledReason(e,i)&&(void 0!==(a=r(o))&&a(t.withRow(t.row+i)))}},customStatRowsInCol:function(e){if(e<0||e>=this.columns.length)return[];for(var t=this.columns[e],r=[],n=0;n<t.gates.length;n++)void 0!==t.gates[n]&&void 0!==t.gates[n].customStatTexturesMaker&&void 0===this.gateAtLocIsDisabledReason(e,n)&&r.push(n);return r},isSlotRectCoveredByGateInSameColumn:function(e,t,r){for(var n=0;n<r;n++){var i=this.findGateCoveringSlot(e,t+n);if(void 0!==i&&i.col===e)return!0}return!1},withCustomGate:function(e){return new p(this.numWires,this.columns,this.outerRowOffset,this.outerContext,this.customGateSet.withGate(e),!1,this.customInitialValues)},controlLinesRanges:function(t){function o(e){return new g(t,e)}function e(e){return u.locHasControllableGate(o(e))}function r(e){return void 0!==n&&-1!==n.indexOf(e)}var u=this,s=this.columns[t].gates.length,n=this.colGetEnabledSwapGate(t),l=[v(s,r,r,!1),v(s,e,function(e){return u.locStartsSingleControlWire(o(e))},!1),v(s,e,function(e){return u.locStartsDoubleControlWire(o(e))},!0)],i=!0,a=!1,c=void 0;try{for(var d=function(){function r(e){return u.locProvidesStat(o(e),n)||u.locProvidesStat(o(e),i)}function e(e){return u.locNeedsStat(o(e),n)||u.locNeedsStat(o(e),a)}var t=m.value,n="Input Range "+t,i="Input Default "+t,a="Input NO_DEFAULT Range "+t;l.push(v(s,function(e){return r(e)&&(t=e,!0!==u.locClassifyMeasuredIncludingGateExtension(o(t)));var t},e,!1),v(s,function(e){return r(e)&&(t=e,!1!==u.locClassifyMeasuredIncludingGateExtension(o(t)));var t},e,!0))},m=void 0,f=h.InputGates.Letters[Symbol.iterator]();!(i=(m=f.next()).done);i=!0)d()}catch(e){a=!0,c=e}finally{try{i||null==f.return||f.return()}finally{if(a)throw c}}return l.filter(function(e){return void 0!==e})}},{fromTextDiagram:function(a,e){var o=m(e.split("\n")).map(function(e){return e.trim()}).filter(function(e){return""!==e}).toArray();if(1<m(o.map(function(e){return e.length})).distinct().count())throw new C("Uneven diagram",{diagram:e});var t=o.length,r=0<o.length?o[0].length:0;return new p(t,f.range(r).map(function(i){return new E(m(o).mapWithIndex(function(e,t){var r=e[i];if(!a.has(r))throw new C("Unspecified gate",{char:r});var n=a.get(r);if(null!=n){if(n.hasOwnProperty("ofSize"))return n.ofSize(function(e,t){for(var r=1;t+r<o.length;r++)if(null!==a.get(o[t+r][e]))return r;return o.length-t}(i,t));if(n instanceof s)return n;throw new C("Not a gate",n)}}).toArray())}).toArray())}});function p(t,e){var r,n,i=void 0!==arguments[2]?arguments[2]:0,a=void 0!==arguments[3]?arguments[3]:new Map,o=void 0!==arguments[4]?arguments[4]:new A,u=void 0!==arguments[5]&&arguments[5],s=void 0!==arguments[6]?arguments[6]:new Map;if(t<0)throw new C("Bad numWires",{numWires:t});if(!Array.isArray(e))throw new C("Bad columns",{numWires:t,columns:e});if(!e.every(function(e){return e instanceof E}))throw new C("Not a GateColumn",{columns:e});if(!e.every(function(e){return e.gates.length===t}))throw new C("Wrong gate count in a column",{numWires:t,columns:e});this.numWires=t,this.columns=e,this.customGateSet=o,this.outerRowOffset=i,this.outerContext=a,this.isNested=u,this.customInitialValues=new Map;var l=!0,c=!1,d=void 0;try{for(var m,f=s.entries()[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var h=(n=(r=m.value[Symbol.iterator]()).next()).done?void 0:n.value,g=(n=r.next()).done?void 0:n.value;if(!Number.isInteger(h)||h<0)throw new C("Initial state key out of range.",{customInitialValues:s,numWires:t});h>=this.numWires||this.customInitialValues.set(h,g)}}catch(e){c=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw d}}this._colRowDisabledReason=[],this._measureMasks=[0];var p=0,v=new Map,y=!0,b=!1,R=void 0;try{for(var w,M=e[Symbol.iterator]();!(y=(w=M.next()).done);y=!0){var _=w.value,x=_.perRowDisabledReasons(p,i,a,v,u),S=x.allReasons,T=x.stickyCtx,p=_.nextMeasureMask(p,S);this._colRowDisabledReason.push(S),this._measureMasks.push(p),v=T}}catch(e){b=!0,R=e}finally{try{y||null==M.return||M.return()}finally{if(b)throw R}}this._gateSlotCoverMap=this._computeGateSlotCoverMap(),this._cachedColumnContexts=new Map}function v(e,t,r,n){var i,a,o,u,s=(a=(i=y(e,t)[Symbol.iterator]()).next()).done?void 0:a.value,l=(a=i.next()).done?void 0:a.value,c=(u=(o=y(e,r)[Symbol.iterator]()).next()).done?void 0:u.value,d=(u=o.next()).done?void 0:u.value;if(void 0!==c&&void 0!==s)return{first:Math.min(s,c),last:Math.max(l,d),measured:n}}function y(e,t){for(var r=void 0,n=void 0,i=0;i<e;i++)t(i)&&(void 0===r&&(r=i),n=i);return[r,n]}return a.EMPTY=new a(0,[]),{get CircuitDefinition(){return a}}}),$traceurRuntime.registerModule("src/circuit/CircuitEvalContext.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/circuit/CircuitEvalContext.js")).WglConfiguredShader,e=$traceurRuntime.createClass(t,{applyOperation:function(e){var t=e instanceof r?e:e(this);this.stateTrader.shadeAndTrade(t)},_clone:function(){return new t(this.time,this.row,this.wireCount,this.controls,this.controlsTexture,this.rawControls,this.stateTrader,this.customContextFromGates)},withRow:function(e){var t=this._clone();return t.row=e,t},withInputSetToRange:function(e,t,r){var n=this._clone();return n.customContextFromGates=new Map(n.customContextFromGates),n.customContextFromGates.set("Input Range "+e,{offset:t,length:r}),n},withInputSetToConstant:function(e,t){var r=this._clone();return r.customContextFromGates=new Map(r.customContextFromGates),r.customContextFromGates.delete("Input Range "+e),r.customContextFromGates.set("Input Default "+e,t),r},withInputSetToOtherInput:function(e,t){var r=this._clone();r.customContextFromGates=new Map(r.customContextFromGates);var n=!0,i=!1,a=void 0;try{for(var o,u=["Range","Default"][Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=r.customContextFromGates.get("Input "+s+" "+t);void 0!==l?r.customContextFromGates.set("Input "+s+" "+e,l):r.customContextFromGates.delete("Input "+s+" "+e)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r}},{});function t(e,t,r,n,i,a,o,u){this.time=e,this.row=t,this.wireCount=r,this.controls=n,this.rawControls=a,this.controlsTexture=i,this.stateTrader=o,this.customContextFromGates=u}return{get CircuitEvalContext(){return e}}}),$traceurRuntime.registerModule("src/circuit/CircuitShaders.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/circuit/CircuitShaders.js")).Config,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/CircuitShaders.js")).Controls,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/circuit/CircuitShaders.js")),n=t.ketArgs,i=t.ketShaderPermute,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/circuit/CircuitShaders.js")).Shaders,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/CircuitShaders.js")).Util,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/circuit/CircuitShaders.js")).WglArg,s=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/circuit/CircuitShaders.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/CircuitShaders.js"))),l=s.currentShaderCoder,c=s.makePseudoShaderWithInputsAndOutputAndCode,d=s.Inputs,m=s.Outputs,f=$traceurRuntime.createClass(function(){},{},{});f.classicalState=function(e){return h(u.float("state",e))};var h=c([],m.vec2(),"\n    uniform float state;\n    vec2 outputFor(float k) {\n        return vec2(float(k == state), 0.0);\n    }");f.linearOverlay=function(e,t,r){return g(r,t,u.float("offset",e))};var g=c([d.vec4("back"),d.vec4("fore")],m.vec4(),"\n    uniform float offset;\n    vec4 outputFor(float k) {\n        // Note: can't use multiplication to combine because it spreads NaNs from the background into the foreground.\n        return k >= offset && k < offset + len_fore() ? read_fore(k - offset) : read_back(k);\n    }");f.controlMask=function(e){return e.isEqualTo(r.NONE)?a.color(1,0,0,0):p(u.float("used",e.inclusionMask),u.float("desired",e.desiredValueMask))};var p=c([],m.bool(),"\n    uniform float used;\n    uniform float desired;\n\n    bool outputFor(float k) {\n        float pass = 1.0;\n        float bit = 1.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            float v = mod(floor(k/bit), 2.0);\n            float u = mod(floor(used/bit), 2.0);\n            float d = mod(floor(desired/bit), 2.0);\n            pass *= 1.0 - abs(v-d)*u;\n            bit *= 2.0;\n        }\n        return pass == 1.0;\n    }");f.controlSelect=function(e,t){return e.isEqualTo(r.NONE)?a.passthrough(t):v(t,u.float("used",e.inclusionMask),u.float("desired",e.desiredValueMask))};var v=c([d.vec2("input")],m.vec2(),"\n    uniform float used;\n    uniform float desired;\n\n    /**\n     * Inserts bits from the given value into the holes between used bits in the desired mask.\n     */\n    float scatter(float k) {\n        float maskPos = 1.0;\n        float coordPos = 1.0;\n        float result = 0.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            float v = mod(floor(k/coordPos), 2.0);\n            float u = mod(floor(used/maskPos), 2.0);\n            float d = mod(floor(desired/maskPos), 2.0);\n            result += (v + u*(d-v)) * maskPos;\n            coordPos *= 2.0-u;\n            maskPos *= 2.0;\n        }\n        return result;\n    }\n\n    vec2 outputFor(float k) {\n        return read_input(scatter(k));\n    }");f.swap=function(e,t){return y.withArgs.apply(y,$traceurRuntime.spread(n(e,t-e.row+1)))};var y=i("","\n    float low_bit = mod(out_id, 2.0);\n    float mid_bits = floor(mod(out_id, span*0.5)*0.5);\n    float high_bit = floor(out_id*2.0/span);\n    return high_bit + mid_bits*2.0 + low_bit*span*0.5;");f.qubitDensities=function(e){var t=arguments[1];void 0===t&&(t=(1<<l().vec2.arrayPowerSizeOfTexture(e))-1);var r=o.ceilingPowerOf2(o.numberOfSetBits(t));return b(e,u.float("keptCount",r),u.float("keptBitMask",t))};var b=c([d.vec2("input")],m.vec4(),"\n    uniform float keptCount;\n    uniform float keptBitMask;\n\n    float scatter(float val, float used) {\n        float result = 0.0;\n        float posUsed = 1.0;\n        float posVal = 1.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            float u = mod(floor(used/posUsed), 2.0);\n            float v = mod(floor(val/posVal), 2.0);\n            result += u * v * posUsed;\n            posVal *= 1.0+u;\n            posUsed *= 2.0;\n        }\n        return result;\n    }\n\n    vec4 outputFor(float k) {\n        float bitIndex = mod(k, keptCount);\n        float otherBits = floor(k / keptCount);\n        float bit = scatter(exp2(bitIndex), keptBitMask);\n\n        // Indices of the two complex values making up the current conditional ket.\n        float srcIndex0 = mod(otherBits, bit) + floor(otherBits / bit) * bit * 2.0;\n        float srcIndex1 = srcIndex0 + bit;\n\n        // Grab the two complex values.\n        vec2 w1 = read_input(srcIndex0);\n        vec2 w2 = read_input(srcIndex1);\n\n        // Compute density matrix components.\n        float a = dot(w1, w1);\n        float br = dot(w1, w2);\n        float bi = dot(vec2(-w1.y, w1.x), w2);\n        float d = dot(w2, w2);\n\n        return vec4(a, br, bi, d);\n    }");return{get CircuitShaders(){return f}}}),$traceurRuntime.registerModule("src/circuit/CircuitStats.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/circuit/CircuitStats.js")).CircuitDefinition,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitEvalContext.js","src/circuit/CircuitStats.js")).CircuitEvalContext,T=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/circuit/CircuitStats.js")).CircuitShaders,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetTextureUtil.js","src/circuit/CircuitStats.js")).KetTextureUtil,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/CircuitStats.js")).Controls,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/CircuitStats.js")).DetailedError,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/CircuitStats.js")),l=t.Matrix,r=t.complexVectorToReadableJson,E=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/circuit/CircuitStats.js")).Shaders,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/circuit/CircuitStats.js")).Serializer,I=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/CircuitStats.js")).Util,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/circuit/CircuitStats.js")).notifyAboutRecoveryFromUnexpectedError,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitComputeUtil.js","src/circuit/CircuitStats.js")).advanceStateWithCircuit,$=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/CircuitStats.js")).currentShaderCoder,P=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/circuit/CircuitStats.js")).WglTextureTrader,o=$traceurRuntime.createClass(G,{qubitDensityMatrix:function(e,t){if(t<0)throw new i("Bad wireIndex",{wireIndex:t,colIndex:e});if(e<0||t>=this.circuitDefinition.numWires){if(t>=this.circuitDefinition.numWires&&this.qubitDensityMatrix(e,0).hasNaN())return l.zero(2,2).times(NaN);var r=new Float32Array(8);return r[0]=1,new l(2,2,r)}var n=Math.min(e,this._qubitDensities.length-1);return n<0||t>=this._qubitDensities[n].length?l.zero(2,2).times(NaN):this._qubitDensities[n][t]},toReadableJson:function(){var e=void 0===arguments[0]||arguments[0],t={time_parameter:this.time,circuit:n.toJson(this.circuitDefinition),chance_of_surviving_to_each_column:this._survivalRates,computed_bloch_vectors_by_column_then_wire:this._qubitDensities.map(function(e){return e.map(u)}),displays:this._customStatsToReadableJson()};return e&&(t.output_amplitudes=r(this.finalState.getColumn(0))),t},_customStatsToReadableJson:function(){var e,t,r,n,i=[],a=!0,o=!1,u=void 0;try{for(var s,l=this._customStatsProcessed.entries()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=(t=(e=s.value[Symbol.iterator]()).next()).done?void 0:t.value,d=(t=e.next()).done?void 0:t.value,m=(n=(r=c.split(":")[Symbol.iterator]()).next()).done?void 0:n.value,f=(n=r.next()).done?void 0:n.value,f=parseInt(f),m=parseInt(m),h=this.circuitDefinition.columns[m].gates[f];void 0!==h.processedStatsToJsonFunc&&(d=h.processedStatsToJsonFunc(d)),i.push({location:{wire:f,column:m},type:{serialized_id:h.serializedId,name:h.name},data:d})}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}return i},survivalRate:function(e){return(e=Math.min(e,this._survivalRates.length-1))<0?1:this._survivalRates[e]},customStatsForSlot:function(e,t){var r=e+":"+t;return this._customStatsProcessed.has(r)?this._customStatsProcessed.get(r):void 0},controlledWireProbabilityJustAfter:function(e,t){return this.qubitDensityMatrix(t,e).rawBuffer()[6]},withTime:function(e){return new G(this.circuitDefinition,e,this._survivalRates,this._qubitDensities,this.finalState,this._customStatsProcessed)}},{withNanDataFromCircuitAtTime:function(e,t){return new G(e,t,[1],[],l.zero(1,1<<e.numWires).times(NaN),new Map)},fromCircuitAtTime:function(t,r){try{return G._fromCircuitAtTime_noFallback(t,r)}catch(e){return a("Defaulted to NaN results. Computing circuit values failed.",{circuitDefinition:n.toJson(t)},e),G.withNanDataFromCircuitAtTime(t,r)}},decohereMeasuredBitsInDensityMatrix:function(e,t){if(0===t)return e;for(var r=new Float32Array(e.rawBuffer()),n=e.width(),i=0;i<n;i++)for(var a,o=0;o<n;o++){0!=((i^o)&t)&&(r[a=2*(i*n+o)]=0,r[1+a]=0)}return new l(n,n,r)},scatterAndDecohereDensities:function(e,t,r,n,i){for(var a=l.zero(1<<r,1<<r).times(NaN),o=0,u=[],s=0;s<t-r+1;s++)0==(i&1<<s)?u.push(a):u.push(G.decohereMeasuredBitsInDensityMatrix(e[o++],n>>s&(1<<r)-1));return u},_extractColumnQubitStatsFromPixelDatas:function(e,t){for(var r=[],n=0;n<t.length;n++){var i=n===e.columns.length?-1:e.colDesiredSingleQubitStatsMask(n);r.push(G.scatterAndDecohereDensities(A.pixelsToQubitDensityMatrices(t[n]),e.numWires,1,e.colIsMeasuredMask(n),i))}return r},_extractColumnSurvivalRateStatsFromPixelDatas:function(e){for(var t=1,r=[],n=0;n<e.length;n++)0<e[n].length&&(t=e[n][0]),r.push(t);return r},_fromCircuitAtTime_noFallback:function(e,t){var r=(e=e.withMinimumWireCount()).numWires,n=new P(T.classicalState(0).toVec2Texture(r)),i=T.controlMask(C.NONE).toBoolTexture(r),a=j(new S(t,0,r,C.NONE,i,C.NONE,n,new Map),e,!0),o=a.colQubitDensities,u=a.colNorms,s=a.customStats,l=a.customStatsMap;i.deallocByDepositingInPool("controlTex in _fromCircuitAtTime_noFallback"),$().vec2.needRearrangingToBeInVec4Format&&n.shadeHalveAndTrade(E.packVec2IntoVec4);var c=I.objectifyArrayFunc(A.mergedReadFloats)({output:n.currentTexture,colQubitDensities:o,colNorms:u,customStats:s}),d=G._extractColumnQubitStatsFromPixelDatas(e,c.colQubitDensities),m=G._extractColumnSurvivalRateStatsFromPixelDatas(c.colNorms),f=A.pixelsToAmplitudes(c.output,0===m.length?1:m[m.length-1]),h=new Map,g=!0,p=!1,v=void 0;try{for(var y,b=l[Symbol.iterator]();!(g=(y=b.next()).done);g=!0){var R=y.value,w=R.col,M=R.row,_=R.out,x=e.gateInSlot(w,M).customStatPostProcesser||function(e){return e};h.set(w+":"+M,x(c.customStats[_],e,w,M))}}catch(e){p=!0,v=e}finally{try{g||null==b.return||b.return()}finally{if(p)throw v}}return new G(e,t,m,d,f,h)}});function G(e,t,r,n,i,a){this.circuitDefinition=e,this.time=t,this._survivalRates=r,this._qubitDensities=n,this.finalState=i,this._customStatsProcessed=a}function u(e){var t,r;if(e.hasNaN())return null;var n=(r=(t=e.qubitDensityMatrixToBlochVector()[Symbol.iterator]()).next()).done?void 0:r.value,i=(r=t.next()).done?void 0:r.value,a=(r=t.next()).done?void 0:r.value;return{x:n*=-1,y:i,z:a*=-1}}return o.EMPTY=o.withNanDataFromCircuitAtTime(e.EMPTY,0),{get CircuitStats(){return o}}}),$traceurRuntime.registerModule("src/circuit/Controls.js",[],function(){"use strict";var n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/Controls.js")).DetailedError,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/Controls.js")).Seq,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/Controls.js")).Util,e=$traceurRuntime.createClass(r,{isEqualTo:function(e){return e instanceof r&&this.inclusionMask===e.inclusionMask&&this.desiredValueMask===e.desiredValueMask&&this.parityMask===e.parityMask},toString:function(){var t=this;if(0===this.inclusionMask)return"No Controls";var e=i.naturals().takeWhile(function(e){return 1<<e<=(t.inclusionMask|t.parityMask)}),r="Controls: ...__"+e.map(function(e){return t.desiredValueFor(e)}).map(function(e){return void 0===e?"_":e?"1":"0"}).reverse().join("");return 0!==this.parityMask&&(r+="\n  parity: ...__"+e.map(function(e){return t.parityMask&1<<e}).map(function(e){return e?"1":"_"}).reverse().join("")),r},allowsState:function(e){return(this.inclusionMask&e)===this.desiredValueMask},desiredValueFor:function(e){if(0!=(this.inclusionMask&1<<e))return 0!=(this.desiredValueMask&1<<e)},includedBitCount:function(){return this.inclusionMask<0?1/0:a.numberOfSetBits(this.inclusionMask)},and:function(e){if((e.desiredValueMask&this.inclusionMask)!=(this.desiredValueMask&e.inclusionMask))throw new n("Contradictory controls.",{this:this,other:e});if(0!=(e.parityMask&this.inclusionMask)||0!=(this.parityMask&e.inclusionMask))throw new n("Can't intersect parity controls.",{this:this,other:e});return new r(this.inclusionMask|e.inclusionMask,this.desiredValueMask|e.desiredValueMask,this.parityMask|e.parityMask)},shift:function(e){return new r(this.inclusionMask<<e,this.desiredValueMask<<e,this.parityMask<<e)}},{bit:function(e,t){if(e<0)throw new n("Out of range",{bitIndex:e});return new r(1<<e,t?1<<e:0)}});function r(e,t){var r=void 0!==arguments[2]?arguments[2]:0;if(0!=(t&~e))throw new n("Desired un-included bits",{inclusionMask:e,desiredValueMask:t});if(0!==r&&1!==a.popcnt(e&r))throw new n("Exactly one parity bit must be in the inclusion mask",{inclusionMask:e,parityMask:r});this.inclusionMask=e,this.desiredValueMask=t,this.parityMask=r}return e.NONE=new e(0,0),{get Controls(){return e}}}),$traceurRuntime.registerModule("src/circuit/CustomGateSet.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/CustomGateSet.js")).DetailedError,e=$traceurRuntime.createClass(r,{withGate:function(e){if(!e.serializedId.startsWith("~"))throw new t("Custom gates' serialized id must start with '~'.",{id:e.serializedId,gate:e});if(this.findGateWithSerializedId(e.serializedId))throw new t("Duplicate serialized id.",{gate:e});return new(Function.prototype.bind.apply(r,$traceurRuntime.spread([null],this.gates,[e])))},findGateWithSerializedId:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this.gates[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(o.serializedId===e)return o}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{});function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.gates=e}return{get CustomGateSet(){return e}}}),$traceurRuntime.registerModule("src/circuit/Gate.js",[],function(){"use strict";var u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/Gate.js")).DetailedError,r=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/circuit/Gate.js")).GateDrawParams,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/circuit/Gate.js")).Complex),s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/Gate.js")).Matrix,e=$traceurRuntime.createClass(t,{_copy:function(){var e=new t;return e.symbol=this.symbol,e.name=this.name,e.blurb=this.blurb,e.alternate=this.alternate,e.serializedId=this.serializedId,e.onClickGateFunc=this.onClickGateFunc,e.tag=this.tag,e.param=this.param,e.customDrawer=this.customDrawer,e.interestedInControls=this.interestedInControls,e.customBeforeOperation=this.customBeforeOperation,e.knownBitPermutationFunc=this.knownBitPermutationFunc,e.customOperation=this.customOperation,e.customAfterOperation=this.customAfterOperation,e.customStatTexturesMaker=this.customStatTexturesMaker,e.customStatPostProcesser=this.customStatPostProcesser,e.processedStatsToJsonFunc=this.processedStatsToJsonFunc,e.width=this.width,e.height=this.height,e.isSingleQubitDisplay=this.isSingleQubitDisplay,e._knownMatrix=this._knownMatrix,e.knownCircuit=this.knownCircuit,e._showAsReachesOtherWires=this._showAsReachesOtherWires,e.isContextTemporary=this.isContextTemporary,e.knownCircuitNested=this.knownCircuitNested,e._requiredContextKeys=this._requiredContextKeys,e._knownMatrixFunc=this._knownMatrixFunc,e._stableDuration=this._stableDuration,e._withParamRecomputeFunc=this._withParamRecomputeFunc,e._hasNoEffect=this._hasNoEffect,e._effectPermutesStates=this._effectPermutesStates,e._effectCreatesSuperpositions=this._effectCreatesSuperpositions,e._affectsOtherWires=this._affectsOtherWires,e._controlBit=this._controlBit,e._isClassicalControl=this._isClassicalControl,e.isControlWireSource=this.isControlWireSource,e._isDefinitelyUnitary=this._isDefinitelyUnitary,e.knownPhaseTurnsFunc=this.knownPhaseTurnsFunc,e.knownPermutationFuncTakingInputs=this.knownPermutationFuncTakingInputs,e.customColumnContextProvider=this.customColumnContextProvider,e.customDisableReasonFinder=this.customDisableReasonFinder,e.knownBitPermutationGroupMasks=this.knownBitPermutationGroupMasks,e},withParam:function(e){var t=this._copy();return t.param=e,t._withParamRecomputeFunc(t),t},getUnmetContextKeys:function(){var e=new Set(this._requiredContextKeys);if(void 0!==this.knownCircuit){var t=!0,r=!1,n=void 0;try{for(var i,a=this.knownCircuit.getUnmetContextKeys()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.add(o)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}return e},shouldShowAsHavingGlobalEffect:function(){return this._showAsReachesOtherWires||!this._isDefinitelyUnitary},canChangeInSize:function(){return 1<this.gateFamily.length},canIncreaseInSize:function(){var t=this;return!this.gateFamily.every(function(e){return e.height!==t.height+1})},canDecreaseInSize:function(){var t=this;return!this.gateFamily.every(function(e){return e.height!==t.height-1})},knownMatrixAt:function(e){return void 0!==this._knownMatrix?this._knownMatrix:void 0!==this._knownMatrixFunc?this._knownMatrixFunc(e,this.param):void 0},isControl:function(){return void 0!==this._controlBit},isClassicalControl:function(){return this._isClassicalControl},controlBit:function(){return this._controlBit},effectMightPermutesStates:function(){return void 0!==this._effectPermutesStates?this._effectPermutesStates:void 0===this._knownMatrix||!this._knownMatrix.isDiagonal()},effectMightCreateSuperpositions:function(){return void 0!==this._effectCreatesSuperpositions?this._effectCreatesSuperpositions:void 0===this._knownMatrix||!this._knownMatrix.isPhasedPermutation()},definitelyHasNoEffect:function(){return this._hasNoEffect},isDefinitelyUnitary:function(){return this._isDefinitelyUnitary},stableDuration:function(){return void 0!==this._stableDuration?this._stableDuration:void 0!==this._knownMatrix||this._hasNoEffect?1/0:0},toString:function(){return"Gate("+this.symbol+")"}},{fromKnownMatrix:function(e,t){var r=void 0!==arguments[2]?arguments[2]:"",n=void 0!==arguments[3]?arguments[3]:"",i=arguments[4],a=arguments[5];if(!(t instanceof s))throw new u("Bad matrix.",{symbol:e,matrix:t,name:r,blurb:n});var o=(new l).setSymbol(e).setSerializedId(void 0===i?e:i).setTitle(r).setBlurb(n).setKnownEffectToMatrix(t);return void 0!==a&&(o=o.setAlternate(a)),o.gate},buildFamily:function(e,t,r){for(var u=[],n=e;n<=t;n++){var i=new l;i.setHeight(n),r(n,i),(i.gate.gateFamily=u).push(i.gate)}return{all:u,ofSize:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=u[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(o.height===e)return o}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}}}});function t(){this.symbol="",this.serializedId="",this.name="",this.blurb="",this.width=1,this.height=1,this.param=void 0,this._withParamRecomputeFunc=function(e){},this.customDrawer=void 0,this.onClickGateFunc=void 0,this.tag=void 0,this.customBeforeOperation=void 0,this.customOperation=void 0,this.customAfterOperation=void 0,this.customStatTexturesMaker=void 0,this.customStatPostProcesser=void 0,this.processedStatsToJsonFunc=void 0,this.gateFamily=[this],this.interestedInControls=!0,this._stableDuration=void 0,this._knownMatrix=void 0,this._knownMatrixFunc=void 0,this._hasNoEffect=!1,this._effectPermutesStates=void 0,this._effectCreatesSuperpositions=void 0,this.isControlWireSource=!1,this.knownCircuit=void 0,this.knownCircuitNested=void 0,this._requiredContextKeys=[],this.isSingleQubitDisplay=!1,this._controlBit=void 0,this._isClassicalControl=!1,this._isDefinitelyUnitary=!1,(this.alternate=this).customColumnContextProvider=function(e,t){return[]},this.isContextTemporary=!0,this.customDisableReasonFinder=function(e){},this.knownBitPermutationFunc=void 0,this.knownBitPermutationGroupMasks=void 0,this.knownPhaseTurnsFunc=void 0,this.knownPermutationFuncTakingInputs=void 0,this._showAsReachesOtherWires=!1}var l=$traceurRuntime.createClass(function(){this.gate=new e},{setSerializedIdAndSymbol:function(e){return this.gate.symbol=e,this.gate.serializedId=e,this},setSymbol:function(e){return this.gate.symbol=e,this},setAlternateFromFamily:function(e){return this.setAlternate(e.ofSize(this.gate.height))},setAlternate:function(e){if(void 0===e)throw new Error("alternate === undefined");if(e.height!==this.gate.height)throw new Error("alternate.height !== this.gate.height");if(e.alternate!==e)throw new Error("alternate.alternate !== alternate");return e.alternate=this.gate,this.gate.alternate=e,this},setSerializedId:function(e){return this.gate.serializedId=e,this},setTitle:function(e){return this.gate.name=e,this},setBlurb:function(e){return this.gate.blurb=e,this},setHeight:function(e){return this.gate.height=e,this},setWidth:function(e){return this.gate.width=e,this},setDrawer:function(e){return this.gate.customDrawer=e,this},setOnClickGateFunc:function(e){return this.gate.onClickGateFunc=e,this},setKnownEffectToMatrix:function(e){if(!(e instanceof s))throw new u("Bad matrix.",{matrix:e});return this.gate._isDefinitelyUnitary=e.isUnitary(.01),this.gate._hasNoEffect=e.isIdentity(),this.gate._stableDuration=1/0,this.gate._knownMatrix=e,this},setKnownEffectToPermutation:function(t){var r=this;return this.gate.knownPermutationFuncTakingInputs=t,this.gate._knownMatrixFunc=function(e){return s.generateTransition(1<<r.gate.height,t)},this.gate._stableDuration=1/0,this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!0,this.gate._effectCreatesSuperpositions=!1,this.gate._isDefinitelyUnitary=!0,this},setKnownEffectToBitPermutation:function(e){return this.gate.knownBitPermutationFunc=e,this.gate.knownBitPermutationGroupMasks=function(e,t){for(var r=new Set,n=[],i=0;i<t;i++){for(var a=0,o=i;!r.has(o);)r.add(o),a|=1<<o,o=e(o);0!==a&&n.push(a)}return n}(e,this.gate.height),this.gate._isDefinitelyUnitary=!0,this.gate._stableDuration=1/0,this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!0,this.gate._effectCreatesSuperpositions=!1,this},setKnownEffectToTimeVaryingPermutation:function(r){var e=this.gate;return e._stableDuration=0,e._knownMatrixFunc=function(t){return s.generateTransition(1<<e.height,function(e){return r(t,e)})},e._hasNoEffect=!1,e._effectPermutesStates=!0,e._effectCreatesSuperpositions=!1,e._isDefinitelyUnitary=!0,this},setKnownEffectToParametrizedPermutation:function(e){var t=this.gate;return t.knownPermutationFuncTakingInputs=e,t._knownMatrixFunc=void 0,t._stableDuration=1/0,t._hasNoEffect=!1,t._effectPermutesStates=!0,t._effectCreatesSuperpositions=!1,t._isDefinitelyUnitary=!0,this},setKnownEffectToPhaser:function(t){var e=this;return this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!1,this.gate._effectCreatesSuperpositions=!1,this.gate._isDefinitelyUnitary=!0,this.gate._stableDuration=1/0,this.gate.knownPhaseTurnsFunc=t,this.gate._knownMatrixFunc=function(){return s.generateDiagonal(1<<e.gate.height,function(e){return r.polar(1,2*Math.PI*t(e))})},this},setTooltipMatrixFunc:function(t){return this.gate._knownMatrixFunc=function(e){return t()},this.gate._stableDuration=1/0,this},setKnownEffectToCircuit:function(e){return this.gate.knownCircuit=e,this.gate.knownCircuitNested=e.withDisabledReasonsForEmbeddedContext(0,new Map),this.gate._isDefinitelyUnitary=e.hasOnlyUnitaryGates(),this.gate._stableDuration=e.stableDuration(),this.gate.height=e.numWires,this},setEffectToTimeVaryingMatrix:function(e){return this.gate._stableDuration=0,this.gate._knownMatrixFunc=e,this.gate._hasNoEffect=!1,this},setWithParamPropertyRecomputeFunc:function(e){return this.gate._withParamRecomputeFunc=e,this},setActualEffectToUpdateFunc:function(e){if(void 0!==e&&"function"!=typeof e)throw new u("Bad customOperation",{circuitUpdateFunc:e});return this.gate.customOperation=e,this},setActualEffectToShaderProvider:function(t){return this.setActualEffectToUpdateFunc(function(e){return e.applyOperation(t)})},promiseEffectOnlyPermutesAndPhases:function(){return this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!0,this.gate._effectCreatesSuperpositions=!1,this.gate._isDefinitelyUnitary=!0,this},promiseEffectIsDiagonal:function(){return this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!1,this.gate._effectCreatesSuperpositions=!1,this},promiseEffectOnlyPhases:function(){return this.gate._hasNoEffect=!1,this.gate._effectPermutesStates=!1,this.gate._effectCreatesSuperpositions=!1,this.gate._isDefinitelyUnitary=!0,this},promiseEffectIsUnitary:function(){return this.gate._isDefinitelyUnitary=!0,this},promiseEffectIsStable:function(){return this.gate._stableDuration=1/0,this},promiseHasNoNetEffectOnStateVector:function(){return this.gate._stableDuration=1/0,this.gate._hasNoEffect=!0,this.gate._isDefinitelyUnitary=!0,this.gate._effectPermutesStates=!1,this.gate._effectCreatesSuperpositions=!1,this},promiseHasNoNetEffectOnStateVectorButStillRequiresDynamicRedraw:function(){return this.promiseHasNoNetEffectOnStateVector(),this.gate._stableDuration=0,this},markAsNotInterestedInControls:function(){return this.gate.interestedInControls=!1,this},markAsControlExpecting:function(e){var t=void 0!==arguments[1]&&arguments[1];return this.gate._controlBit=e,this.gate.isControlWireSource=!0,this.gate.interestedInControls=!1,this.gate._isClassicalControl=t,this},markAsReachingOtherWires:function(){return this.gate._showAsReachesOtherWires=!0,this},markAsDrawerNeedsSingleQubitDensityStats:function(){return this.gate.isSingleQubitDisplay=!0,this},setRequiredContextKeys:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.gate._requiredContextKeys=e,this},setContextProvider:function(e){return this.gate.customColumnContextProvider=e,this.gate.isContextTemporary=!0,this},setStickyContextProvider:function(e){return this.gate.customColumnContextProvider=e,this.gate.isContextTemporary=!1,this},setSetupCleanupEffectsToShaderProviders:function(t,r){return this.setSetupCleanupEffectToUpdateFunc(void 0===t?void 0:function(e){return e.applyOperation(t)},void 0===r?void 0:function(e){return e.applyOperation(r)})},setSetupCleanupEffectToUpdateFunc:function(e,t){if(void 0!==e&&"function"!=typeof e)throw new u("Bad beforeColumnUpdateFunc",{customOperation:customOperation});if(void 0!==t&&"function"!=typeof t)throw new u("Bad afterColumnUpdateFunc",{customOperation:customOperation});return this.gate.customBeforeOperation=e,this.gate.customAfterOperation=t,this},setExtraDisableReasonFinder:function(e){return this.gate.customDisableReasonFinder=e,this},setStatTexturesMaker:function(e){return this.gate.customStatTexturesMaker=e,this},setStatPixelDataPostProcessor:function(e){return this.gate.customStatPostProcesser=e,this},setProcessedStatsToJsonFunc:function(e){return this.gate.processedStatsToJsonFunc=e,this},setTag:function(e){return this.gate.tag=e,this}},{});return{get Gate(){return e},get GateBuilder(){return l}}}),$traceurRuntime.registerModule("src/circuit/GateCheckArgs.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(e,t,r,n,i,a){this.gate=e,this.innerColumn=t,this.outerRow=r,this.measuredMask=n,this.context=i,this.isNested=a},{},{});return{get GateCheckArgs(){return e}}}),$traceurRuntime.registerModule("src/circuit/GateColumn.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/GateColumn.js")).DetailedError,u=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/circuit/GateColumn.js")).Gate,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateCheckArgs.js","src/circuit/GateColumn.js")).GateCheckArgs),o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/circuit/GateColumn.js")).Gates,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/GateColumn.js")),t=e.seq,b=(e.Seq,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/GateColumn.js")).Util),r=$traceurRuntime.createClass(s,{isEqualTo:function(e){return this===e||e instanceof s&&t(this.gates).isEqualTo(t(e.gates),b.STRICT_EQUALITY)},stableDuration:function(){var e;return(e=Math).min.apply(e,$traceurRuntime.spread([1/0],this.gates.filter(function(e){return void 0!==e}).map(function(e){return e.stableDuration()})))},isEmpty:function(){return this.gates.every(function(e){return void 0===e})},hasControl:function(){var e=void 0!==arguments[0]?arguments[0]:0,t=void 0!==arguments[1]?arguments[1]:0;return this.hasCoherentControl(e|t)||this.hasMeasuredControl(e&~t)},hasCoherentControl:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this.gates.length;t++)if(0==(e&1<<t)&&void 0!==this.gates[t]&&this.gates[t].isControl()&&!this.gates[t].isClassicalControl())return!0;return!1},hasMeasuredControl:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this.gates.length;t++)if(0!=(e&1<<t)&&void 0!==this.gates[t]&&this.gates[t].definitelyHasNoEffect()&&this.gates[t].isControl())return!0;return!1},controlMask:function(){for(var e=0,t=0;t<this.gates.length;t++)void 0!==this.gates[t]&&this.gates[t].definitelyHasNoEffect()&&this.gates[t].isControl()&&(e|=1<<t);return e},_disabledReason:function(e,t,r,n,i){var a=this.gates[t];if(void 0!==a){var o=new u(a,this,r+t,e,n,i);return a.customDisableReasonFinder(o)||s._disabledReason_inputs(o)||this._disabledReason_controlInside(t)||this._disabledReason_remixing(t,e)||this._disabledReason_overlappingTags(r,t)}},_disabledReason_overlappingTags:function(e,t){var r=new Set(this.gates[t].customColumnContextProvider(e+t,this.gates[t]).map(function(e){return e.key}));if(0!==r.length)for(var n=0;n<t;n++){var i=this.gates[n],a=!0,o=!1,u=void 0;try{for(var s,l=(void 0===i?[]:i.customColumnContextProvider(e+n,i))[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value.key;if(r.has(c))return"already\ndefined"}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}}},_disabledReason_remixing:function(e,t){var r=this.gates[e],n=(1<<r.height)-1<<e,i=n&t;if(0!=i&&void 0===r.knownBitPermutationFunc){if(r.effectMightCreateSuperpositions())return"no\nremix\n(sorry)";if(r.effectMightPermutesStates()&&(i!=n||this.hasCoherentControl(t)))return"no\nremix\n(sorry)"}if(void 0!==r.knownBitPermutationGroupMasks){var a=!0,o=!1,u=void 0;try{for(var s,l=r.knownBitPermutationGroupMasks[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(0!=(c-1&c)){var d=((c<<=e)&t)!=c,m=0!=(c&t),f=this.hasCoherentControl(t),h=this.hasControl(t);if(m&&f||d&&m&&h)return"no\nremix\n(sorry)"}}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}}},hasGatesWithGlobalEffects:function(){for(var e=0;e<this.gates.length;e++){var t=this.gates[e];if(void 0!==t&&t.shouldShowAsHavingGlobalEffect())return!0}return!1},indexOfNonUnitaryGate:function(){for(var e=0;e<this.gates.length;e++){var t=this.gates[e];if(void 0!==t&&!t.isDefinitelyUnitary())return e}},_disabledReason_controlInside:function(e){for(var t=this.gates[e],r=1;r<t.height&&e+r<this.gates.length;r++)if(void 0!==this.gates[e+r]&&this.gates[e+r].isControl())return"control\ninside"},minimumRequiredWireCount:function(){for(var e=0,t=0;t<this.gates.length;t++)void 0!==this.gates[t]&&(e=Math.max(e,this.gates[t].height+t));return e},maximumGateWidth:function(){var e=-1/0,t=!0,r=!1,n=void 0;try{for(var i,a=this.gates[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;void 0!==o&&(e=Math.max(e,o.width))}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return e},perRowDisabledReasons:function(e,t,r,n,i){for(var a=b.mergeMaps(r,n),o=new Map(n),u=this.gates.length-1;0<=u;u--){var s=this.gates[u];if(void 0!==s){var l=!0,c=!1,d=void 0;try{for(var m,f=s.customColumnContextProvider(u+t,s)[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var h=m.value,g=h.key,p=h.val;a.set(g,p),s.isContextTemporary||o.set(g,p)}}catch(e){c=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw d}}}}for(var v=[],y=0;y<this.gates.length;y++)v.push(this._disabledReason(e,y,t,a,i));return{allReasons:v,stickyCtx:o}},_updateMeasureMask_gateStep:function(e,t,r){var n,i;void 0!==r[t]||void 0!==(n=this.gates[t])&&(n!==o.Special.Measurement?(i=n===o.PostSelectionGates.PostSelectOn||n===o.PostSelectionGates.PostSelectOff||n===o.Detectors.ZDetector||n===o.Detectors.ZDetectControlClear,this.hasControl(0,1<<t)||!i?(s._updateMeasureMask_swapGate(n,e,t),s._updateMeasureMask_customPermute(n,e,t)):e.measureMask&=~(1<<t)):e.measureMask|=1<<t)},nextMeasureMask:function(e,t){for(var r={measureMask:e,earlierRowWithSwapGate:void 0},n=0;n<this.gates.length;n++)this._updateMeasureMask_gateStep(r,n,t);return r.measureMask},withGatesAdded:function(e,t){if(!Number.isInteger(e)||e<0||e>this.gates.length-t.gates.length)throw new i("Bad start index",{baseCol:this,startIndex:e,insertedCol:t});for(var r=this.gates.map(function(e){return e}),n=0;n<t.gates.length;n++)r[e+n]=t.gates[n];return new s(r)}},{empty:function(e){return new s(new Array(e).fill(void 0))},_disabledReason_inputs:function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=e.gate.getUnmetContextKeys()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;u.startsWith("Input Range ")&&e.context.has(u)&&t.push(e.context.get(u))}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return s._disabledReason_inputs_missing(e)||s._disabledReason_inputs_inside(e,t)||s._disabledReason_inputs_coherenceMismatch(e,t)},_disabledReason_inputs_missing:function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=e.gate.getUnmetContextKeys()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value,s=u.replace("Input Range ","Input Default ").replace("Input NO_DEFAULT Range ","Input Range ");e.context.has(u)||e.context.has(s)||e.isNested||t.push(u)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}if(0<t.length)return"Need\nInput\n "+t.map(function(e){return e.replace("Input NO_DEFAULT Range ","").replace("Input Range ","")}).join(", ")},_disabledReason_inputs_inside:function(e,t){var r=e.outerRow,n=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=s.offset;if(r<l+s.length&&r+e.gate.height>l)return"input\ninside"}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}},_disabledReason_inputs_coherenceMismatch:function(e,t){var r=e.outerRow;if(e.gate.effectMightPermutesStates()&&0!=(e.measuredMask>>r&(1<<e.gate.height)-1)){var n=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=s.offset,c=s.length;if(0!=(~e.measuredMask>>l&(1<<c)-1))return"no\nremix\n(sorry)"}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}},_updateMeasureMask_swapGate:function(e,t,r){var n,i,a;e===o.Special.SwapHalf&&(void 0!==t.earlierRowWithSwapGate?(n=1<<t.earlierRowWithSwapGate,i=r-t.earlierRowWithSwapGate,a=1<<r,t.measureMask=t.measureMask&~(n|a)|(t.measureMask&n)<<i|(t.measureMask&a)>>i,t.earlierRowWithSwapGate=void 0):t.earlierRowWithSwapGate=r)},_updateMeasureMask_customPermute:function(e,t,r){if(void 0!==e.knownBitPermutationFunc){var n=(1<<e.height)-1<<r,i=t.measureMask&n;t.measureMask&=~n;for(var a,o=0;o<e.height;o++){0!=(i&1<<r+o)&&(a=1<<r+e.knownBitPermutationFunc(o),t.measureMask|=a)}}}});function s(e){this.gates=e}return{get GateColumn(){return r}}}),$traceurRuntime.registerModule("src/circuit/GateShaders.js",[],function(){"use strict";var m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/GateShaders.js")).DetailedError,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/circuit/GateShaders.js")),f=e.ketArgs,t=e.ketShader,o=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/GateShaders.js")).Matrix,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/circuit/GateShaders.js")).Shaders),u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/GateShaders.js")).Util,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/circuit/GateShaders.js")).WglArg,r=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/circuit/GateShaders.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/GateShaders.js"))),n=r.Inputs,i=r.Outputs,s=r.currentShaderCoder,a=r.makePseudoShaderWithInputsAndOutputAndCode,l=$traceurRuntime.createClass(function(){},{},{});function c(e){return t("uniform vec4 coefs["+(1<<2*e-1)+"];","\n        int row = int(out_id);\n        vec2 t = vec2(0.0, 0.0);\n        for (int d = 0; d < "+(1<<e)+"; d++) {\n            // Can't index by row, since it's not a constant, so we do a const brute force loop searching for it.\n            if (d == row) {\n                for (int k = 0; k < "+(1<<e-1)+"; k++) {\n                    vec4 u = coefs[d*"+(1<<e-1)+" + k];\n                    t += cmul(inp(float(k*2)), u.xy);\n                    t += cmul(inp(float(k*2+1)), u.zw);\n                }\n            }\n        }\n        return t;\n    ",e)}var d,g=t("uniform vec2 a, b, c, d;","return cmul(inp(0.0), a+(c-a)*out_id) + cmul(inp(1.0), b+(d-b)*out_id);",1),p=[void 0,void 0,c(2),c(3),t("","\n        vec2 t = vec2(0.0, 0.0);\n        for (int k = 0; k < "+(1<<(d=4))+"; k++) {\n            t += cmul(inp(float(k)),\n                      read_coefs(out_id * "+(1<<d)+".0 + float(k)));\n        }\n        return t;\n    ",d,[n.vec2("coefs")])];l.applyMatrixOperation=function(e,t){var r,n;if(!u.isPowerOf2(t.width()))throw new m("Matrix size isn't a power of 2.",{ctx:e,matrix:t});if(2!==t.width()){var i=Math.round(Math.log2(t.width()));if(i<=3)e.applyOperation((r=p[i]).withArgs.apply(r,$traceurRuntime.spread(f(e),[h.vec4_array("coefs",t.rawBuffer())])));else{if(!(i<=4))throw new m("Matrix is past 4 qubits. Too expensive.",{ctx:e,matrix:t});var a=o.data(s().vec2.dataToPixels(t.rawBuffer())).toVec2Texture(2*i);try{e.applyOperation((n=p[i]).withArgs.apply(n,$traceurRuntime.spread([a],f(e))))}finally{a.deallocByDepositingInPool()}}}else!function(e,t){var r,n;if(2!==t.width()||2!==t.height())throw new m("Not a single-qubit operation.",{matrix:t});var i=(n=(r=t.rawBuffer()[Symbol.iterator]()).next()).done?void 0:n.value,a=(n=r.next()).done?void 0:n.value,o=(n=r.next()).done?void 0:n.value,u=(n=r.next()).done?void 0:n.value,s=(n=r.next()).done?void 0:n.value,l=(n=r.next()).done?void 0:n.value,c=(n=r.next()).done?void 0:n.value,d=(n=r.next()).done?void 0:n.value;e.applyOperation(g.withArgs.apply(g,$traceurRuntime.spread(f(e),[h.vec2("a",i,a),h.vec2("b",o,u),h.vec2("c",s,l),h.vec2("d",c,d)])))}(e,t)},l.cycleAllBits=function(e,t){var r=s().vec2.arrayPowerSizeOfTexture(e);return v(e,h.float("shiftAmount",1<<u.properMod(-t,r)))};var v=a([n.vec2("input")],i.vec2(),"\n    uniform float shiftAmount;\n\n    vec2 outputFor(float k) {\n        float span = len_input();\n        float shiftedState = k * shiftAmount;\n        float cycledState = mod(shiftedState, span) + floor(shiftedState / span);\n        return read_input(cycledState);\n    }");l.cycleAllBitsFloat=function(e,t){var r=s().float.arrayPowerSizeOfTexture(e);return y(e,h.float("shiftAmount",1<<u.properMod(-t,r)))};var y=a([n.float("input")],i.float(),"\n    uniform float shiftAmount;\n\n    float outputFor(float k) {\n        float span = len_input();\n        float shiftedState = k * shiftAmount;\n        float cycledState = mod(shiftedState, span) + floor(shiftedState / span);\n        return read_input(cycledState);\n    }");return{get GateShaders(){return l}}}),$traceurRuntime.registerModule("src/circuit/KetShaderUtil.js",[],function(){"use strict";function r(e,t){var r=void 0!==arguments[2]?arguments[2]:null,n=void 0!==arguments[3]?arguments[3]:[];return{withArgs:i($traceurRuntime.spread(n,[a.vec2("ketgen_ket"),a.bool("ketgen_control")]),o.vec2(),"\n    uniform float _ketgen_step;\n    "+(null===r?"uniform float span;":"")+"\n    float _ketgen_off;\n    float full_out_id;\n\n    "+(t.match(/\bcmul\b/)?"vec2 cmul(vec2 c1, vec2 c2) { return mat2(c1.x, c1.y, -c1.y, c1.x) * c2; }":"")+"\n    "+(t.match(/\binp\b/)?"vec2 inp(float k) { return read_ketgen_ket(_ketgen_off + _ketgen_step*k); }":"")+"\n\n    "+e+"\n\n    vec2 _ketgen_output_for(float out_id, vec2 amp) {\n        "+t+"\n    }\n\n    vec2 outputFor(float k) {\n        full_out_id = k;\n\n        float relevant_out_id = mod(floor(full_out_id / _ketgen_step), "+(null===r?"span":(1<<r)+".0")+");\n        _ketgen_off = full_out_id - relevant_out_id*_ketgen_step;\n\n        float c = read_ketgen_control(full_out_id);\n        vec2 vc = read_ketgen_ket(full_out_id);\n        vec2 vt = _ketgen_output_for(relevant_out_id, vc);\n        return (1.0-c)*vc + c*vt;\n    }")}}function e(e,t){return r(e+"float _ketgen_input_for(float out_id) { "+t+" }","return inp(_ketgen_input_for(out_id));",void 0!==arguments[2]?arguments[2]:null)}function t(e,t){return r(e+"\n        float _ketgen_phase_for(float out_id) {\n            "+t+"\n        }\n    ","\n        float angle = _ketgen_phase_for(out_id);\n        return cmul(amp, vec2(cos(angle), sin(angle)));\n    ",void 0!==arguments[2]?arguments[2]:null)}var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/circuit/KetShaderUtil.js")).WglArg,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/KetShaderUtil.js")),i=n.makePseudoShaderWithInputsAndOutputAndCode,a=n.Inputs,o=n.Outputs;function u(e){var t=arguments[1],r=void 0!==arguments[2]?arguments[2]:[],n=[e.stateTrader.currentTexture,e.controlsTexture,c.float("_ketgen_step",1<<e.row)];void 0!==t&&n.push(c.float("span",1<<t));var i=!0,a=!1,o=void 0;try{for(var u,s=r[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value;n.push.apply(n,$traceurRuntime.spread(d(e,l)))}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}return n}function s(e){return"\n        //////// INPUT GATE "+e+" ////////\n        uniform float _gen_input_default_"+e+";\n        uniform float _gen_input_offset_"+e+";\n        uniform float _gen_input_span_"+e+";\n        \n        float read_input_"+e+"() {\n            return _gen_input_span_"+e+" == 0.0\n                ? _gen_input_default_"+e+"\n                : mod(floor(full_out_id / _gen_input_offset_"+e+"), _gen_input_span_"+e+");\n        }"}function d(e,t){var r=0,n=-1,i=e.customContextFromGates.get("Input Default "+t)||0,a=e.customContextFromGates.get("Input Range "+t);return void 0!==a&&(r=a.offset,n=a.length),[c.float("_gen_input_default_"+t,i),c.float("_gen_input_offset_"+t,1<<r),c.float("_gen_input_span_"+t,-1===n?0:1<<n)]}return{get ketArgs(){return u},get ketShader(){return r},get ketShaderPermute(){return e},get ketShaderPhase(){return t},get ketInputGateShaderCode(){return s},get ketInputGateArgs(){return d}}}),$traceurRuntime.registerModule("src/circuit/KetTextureUtil.js",[],function(){"use strict";var R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/circuit/KetTextureUtil.js")).CircuitShaders,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/KetTextureUtil.js")).Controls,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/KetTextureUtil.js")).DetailedError,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/KetTextureUtil.js")).Matrix,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/circuit/KetTextureUtil.js")).Shaders,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/KetTextureUtil.js")).Util,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/circuit/KetTextureUtil.js")).WglTexture,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/KetTextureUtil.js")),_=e.seq,t=e.Seq,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/KetTextureUtil.js")),i=r.outputShaderCoder,x=r.currentShaderCoder,n=r.makePseudoShaderWithInputsAndOutputAndCode,a=r.Inputs,o=r.Outputs,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/circuit/KetTextureUtil.js")).WglTexturePool,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/circuit/KetTextureUtil.js")).WglTextureTrader,T=$traceurRuntime.createClass(function(){},{},{});T.tradeTextureForVec2Output=function(e){return x().vec2.needRearrangingToBeInVec4Format&&e.shadeHalveAndTrade(w.packVec2IntoVec4),T.tradeTextureForVec4Output(e)},T.tradeTextureForVec4Output=function(e){if(i()===x()){var t=x().vec4.pixelsToData(e.currentTexture.readPixels());return e.currentTexture.deallocByDepositingInPool("tradeTextureForVec4Output"),t}var r=x().vec4.arrayPowerSizeOfTexture(e.currentTexture)+i().vec4.powerSizeOverhead;e.shadeAndTrade(w.convertVec4CodingForOutput,d.take(r,i().vec4.pixelType));var n=i().vec4.pixelsToData(e.currentTexture.readPixels());return e.currentTexture.deallocByDepositingInPool("tradeTextureForVec4Output"),n},T.mergedReadFloats=function(e){function r(e){return 0===e.width?0:1<<x().vec4.arrayPowerSizeOfTexture(e)}var t=Math.round(Math.log2(M.ceilingPowerOf2(_(e).map(r).sum()))),n=new S(w.color(0,0,0,0).toVec4Texture(t)),i=0,a=!0,o=!1,u=void 0;try{for(var s=void 0,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0)!function(){var t=s.value;0<t.width&&n.shadeAndTrade(function(e){return R.linearOverlay(i,t,e)}),i+=r(t)}()}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}var c=T.tradeTextureForVec4Output(n),d=[],m=0,f=!0,h=!1,g=void 0;try{for(var p,v=e[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var y=p.value,b=r(y)<<2;d.push(c.subarray(m,m+b)),m+=b,y.deallocByDepositingInPool()}}catch(e){h=!0,g=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw g}}return d},T.pixelsToAmplitudes=function(e,t){t<1e-6&&(t=NaN);for(var r=Math.sqrt(t),n=e.length>>1,i=new Float32Array(2*n),a=0;a<e.length;a++)i[a]=e[a]/r;return new u(1,n,i)},T.superpositionToQubitDensities=function(e,t,r){if(0===r)return new c(0,0,x().vec4.pixelType);var n,i=!t.isEqualTo(s.NONE),a=new S(e);a.dontDeallocCurrentTexture(),i&&(n=x().vec2.arrayPowerSizeOfTexture(e)-t.includedBitCount(),a.shadeAndTrade(function(e){return R.controlSelect(t,e)},d.takeVec2Tex(n)));for(var o=1,u=1;u<=t.inclusionMask;u<<=1)0==(t.inclusionMask&u)?o<<=1:r=r&o-1|(r&~(o-1))>>1;return function(e,t){if(0===t)throw new l("keptBitMask === 0",{trader:e,keptBitMask:t});var r=x().vec2.arrayPowerSizeOfTexture(e.currentTexture),n=M.numberOfSetBits(t);e.shadeAndTrade(function(e){return R.qubitDensities(e,t)},d.takeVec4Tex(r-1+M.ceilLg2(n)))}(a,r),function(e,t){var r=M.ceilLg2(t),n=x().vec4.arrayPowerSizeOfTexture(e.currentTexture);for(;r<n;)e.shadeHalveAndTrade(w.sumFoldVec4),--n}(a,M.numberOfSetBits(r)),a.currentTexture},T.pixelsToQubitDensityMatrices=function(o){var e=o.length/4;return t.range(e).map(function(e){var t=o[4*e],r=o[4*e+3],n=t+r;if(n<1e-7||isNaN(n))return new u(2,2,new Float32Array([NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN]));var i=o[4*e+1]/n,a=o[4*e+2]/n;return new u(2,2,new Float32Array([t/n,0,i,a,i,-a,r/n,0]))}).toArray()};var m=n([a.vec2("input")],o.float(),"float outputFor(float k) {\n        vec2 amp = read_input(k);\n        return dot(amp, amp);\n    }");return T.superpositionToNorm=function(e,t){if(!t)return new c(0,0,x().vec4.pixelType);var r=new S(e);r.dontDeallocCurrentTexture();var n=x().vec2.arrayPowerSizeOfTexture(e);for(r.shadeAndTrade(m,d.takeVecFloatTex(n));0<n;)--n,r.shadeHalveAndTrade(w.sumFoldFloat);return r.shadeAndTrade(w.packFloatIntoVec4,d.takeVec4Tex(0)),r.currentTexture},{get KetTextureUtil(){return T}}}),$traceurRuntime.registerModule("src/circuit/Serializer.js",[],function(){"use strict";var h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/circuit/Serializer.js")).CircuitDefinition,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/circuit/Serializer.js")).Complex,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/circuit/Serializer.js")).Config,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CustomGateSet.js","src/circuit/Serializer.js")).CustomGateSet,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/circuit/Serializer.js")).describe,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/Serializer.js")).DetailedError,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/circuit/Serializer.js")).Format,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/circuit/Serializer.js")),n=e.Gate,u=e.GateBuilder,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/circuit/Serializer.js")).GateColumn,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/circuit/Serializer.js")),s=i.Gates,R=i.INITIAL_STATES_TO_GATES,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/Serializer.js")).Matrix,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/Serializer.js")).Util,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/circuit/Serializer.js")).notifyAboutRecoveryFromUnexpectedError,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_MysteryGate.js","src/circuit/Serializer.js")),d=c.MysteryGateSymbol,m=c.MysteryGateMakerWithMatrix,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/Serializer.js")).seq,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitComputeUtil.js","src/circuit/Serializer.js")).setGateBuilderEffectToCircuit,M=void 0,_=void 0,x=void 0,S=void 0;function T(e,t,r,n){x=e,M=t,_=r,S=n}function A(e){return e.toString(r.MINIFIED)}function C(e){if("string"!=typeof e)throw new Error("Not a packed matrix string: "+e);return a.parse(e)}function E(e){var t=void 0!==arguments[1]?arguments[1]:new p,r=s.findKnownGateById(e.serializedId,t);if(r===e)return e.serializedId;if(void 0!==r&&void 0!==r.param)return{id:e.serializedId,arg:e.param};if("Parse Error"===e.name)return e.tag;var n={};if(""!==e.serializedId&&(n.id=e.serializedId),(e.serializedId.startsWith("~")?""!==e.symbol:e.symbol!==e.serializedId)&&(n.name=e.symbol),e.stableDuration()===1/0&&void 0!==e.knownMatrixAt(0))n.matrix=A(e.knownMatrixAt(.25));else{if(void 0===e.knownCircuit)throw new y("Don't known how to serialize gate's function.",{gate:e});n.circuit=N(e.knownCircuit,t)}return n}var I=$traceurRuntime.createClass(function(){},{},{toJson:function(e){var t,r,n=arguments[1],i=!0,a=!1,o=void 0;try{for(var u,s=B[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=(r=(t=u.value[Symbol.iterator]()).next()).done?void 0:r.value,c=(r=t.next()).done?void 0:r.value;(r=t.next()).done||r.value;if(e instanceof l)return c(e,n)}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}throw new Error("Don't know how to convert "+v(e)+" to JSON.")},fromJson:function(e,t){var r,n,i=arguments[2],a=!0,o=!1,u=void 0;try{for(var s,l=B[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=(n=(r=s.value[Symbol.iterator]()).next()).done?void 0:n.value,d=((n=r.next()).done||n.value,(n=r.next()).done?void 0:n.value);if(c===e)return d(t,i)}}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}throw new Error("Don't know how to deserialize JSON "+v(t)+" into an instance of "+e+".")}});function j(e){if(void 0===e)throw new Error("Unrecognized gate id, but no matrix specified.");var t=C(e);if(t.width()!==t.height())throw new Error("Gate matrix must be square.");if(t.width()<2||16<t.width()||!o.isPowerOf2(t.width()))throw new Error("Supported gate matrix sizes are 2, 4, 8, and 16.");return t}function $(e){var t,r,n=void 0===(r="string"==typeof(t=e)?t:t.id)?"":"string"!=typeof r?v(r):r,i=e.matrix,a=e.circuit,o=e.arg,u=void 0!==e.name?e.name:n.startsWith("~")?"":n,s=n.startsWith("~")?(u||"Custom")+" Gate ["+n.substring(1)+"]":""!==u?u:n;return{id:n,matrix:i,circuit:a,symbol:u,name:s,param:o}}var P=function(t){var e,r,n,i=void 0!==arguments[1]?arguments[1]:new p,a=$(t);try{if(void 0!==a.matrix)return function(e){var t=j(e.matrix);if(e.id===d)return m(t);var r=Math.round(Math.log2(t.height())),n=""===e.symbol?r:1,i=j(e.matrix),a=(new u).setSerializedId(e.id).setSymbol(e.symbol).setTitle(e.name).setHeight(r).setWidth(n).setDrawer(""===e.symbol?M:i.isIdentity()?x:i.isScaler()?S:void 0).setKnownEffectToMatrix(i);return i.isIdentity()&&a.markAsNotInterestedInControls(),a.gate}(a);if(void 0!==a.circuit)return r=i,n=z((e=a).circuit,r).withMinimumWireCount(),w(new u,n).setSerializedId(e.id).setSymbol(e.symbol).setTitle(e.name).setDrawer(_).gate;var o=s.findKnownGateById(a.id,i);if(void 0===o)throw new y("No gate with the id '"+a.id+"'.",{json:t});if(void 0!==a.param){if(void 0===o.param)throw new y("Arg for gate without arg.",{json:t});o=o.withParam(a.param)}return o}catch(e){return l("Defaulted to a do-nothing 'parse error' gate. Failed to understand the json defining a gate.",{gate_json:t},e),(new u).setSerializedIdAndSymbol(a.id).setTitle("Parse Error").setBlurb(v(e)).promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(){return"parse\nerror"}).setTag(t).gate}};function G(e){var t=void 0!==arguments[1]?arguments[1]:new p;return e.gates.map(function(e){return void 0===e?1:E(e,t)})}var k=function(e){var t=void 0!==arguments[1]?arguments[1]:new p;if(!Array.isArray(e))throw new Error("GateColumn json should be an array. Json: "+v(e));return new b(e.map(function(e){return 1===e||void 0===e?void 0:P(e,t)}))};var N=function(t,r){var e={cols:t.trimEmptyColumnsAtEndIgnoringGateWidths().columns.map(function(e){return G(e,r||t.customGateSet)}).map(function(e){return f(e).skipTailWhile(function(e){return 1===e}).toArray()})};if(void 0===r&&0<t.customGateSet.gates.length&&(e.gates=function(e){for(var t=[],r=0;r<e.gates.length;r++)t.push(E(e.gates[r],new(Function.prototype.bind.apply(p,$traceurRuntime.spread([null],e.gates.slice(0,r))))));return t}(t.customGateSet)),0<t.customInitialValues.size){e.init=[];for(var n=f(t.customInitialValues.keys()).max(),i=0;i<=n;i++){var a=t.customInitialValues.get(i);e.init.push(void 0===a?0:"1"===a?1:a)}}return e},D=void 0,F=void 0;function O(e){return F===e?D:(F=e,D=z(JSON.parse(e),void 0))}function z(e){var t,r=arguments[1],n=e.cols,i=r||(void 0===e.gates?new p:function(e){if(!Array.isArray(e))throw new y("Expected an array of gates.",{json:e});var t=new p,r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)var u=a.value,t=t.withGate(P(u,t))}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t}(e.gates));if(!Array.isArray(n))throw new Error("CircuitDefinition json should contain an array of cols. Json: "+v(e));var a=n.map(function(e){return k(e,i)}),o=function(e){var t=e.init;if(void 0===t)return new Map;if(!Array.isArray(t))throw new y("Initial states must be an array.",{json:e});for(var r=new Map,n=0;n<t.length;n++){var i=t[n];if(0!==i)if(1===i)r.set(n,"1");else{if(!R.has(i))throw new y("Unrecognized initial state key.",{v:i,json:e});r.set(n,i)}}return r}(e),u=0,s=!0,l=!1,c=void 0;try{for(var d,m=a[Symbol.iterator]();!(s=(d=m.next()).done);s=!0)var f=d.value,u=Math.max(u,f.minimumRequiredWireCount())}catch(e){l=!0,c=e}finally{try{s||null==m.return||m.return()}finally{if(l)throw c}}return u=(t=Math).max.apply(t,$traceurRuntime.spread([g.MIN_WIRE_COUNT,Math.min(u,g.MAX_WIRE_COUNT)],$traceurRuntime.spread(o.keys()).map(function(e){return e+1}))),a=a.map(function(e){return new b($traceurRuntime.spread(e.gates,new Array(Math.max(0,u-e.gates.length)).fill(void 0)).slice(0,u))}),new h(u,a,void 0,void 0,i,!1,o).withTrailingSpacersIncluded()}var B=[[t,function(e){return e.toString(r.MINIFIED)},function(e){if("string"==typeof e)return t.parse(e);throw new Error("Not a packed complex string: "+e)}],[n,E,P],[a,A,C],[b,G,k],[h,N,z]];return{get Serializer(){return I},get initSerializer(){return T},get fromJsonText_CircuitDefinition(){return O}}}),$traceurRuntime.registerModule("src/Config.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(){},{},{});return e.EMPTY_CIRCUIT_TITLE="Quirk: Quantum Circuit Simulator",e.MAX_WIRE_COUNT=16,e.SIMPLE_SUPERPOSITION_DRAWING_WIRE_THRESHOLD=14,e.MIN_WIRE_COUNT=2,e.MIN_COL_COUNT=5,e.URL_CIRCUIT_PARAM_KEY="circuit",e.GATE_FILL_COLOR="white",e.HIGHLIGHTED_GATE_FILL_COLOR="#FB7",e.TIME_DEPENDENT_HIGHLIGHT_COLOR="#FFC",e.DISPLAY_GATE_IN_TOOLBOX_FILL_COLOR="#4F4",e.DISPLAY_GATE_BACK_COLOR="#EFE",e.DISPLAY_GATE_FORE_COLOR="#3F3",e.OPERATION_BACK_COLOR="#FFE",e.OPERATION_FORE_COLOR="#FF0",e.SUPERPOSITION_BACK_COLOR="#EFF",e.SUPERPOSITION_MID_COLOR="#8FF",e.SUPERPOSITION_FORE_COLOR="#0BB",e.CYCLE_DURATION_MS=8e3,e.TIME_CACHE_GRANULARITY=196,e.REDRAW_COOLDOWN_MILLIS=10,e.GATE_RADIUS=20,e.WIRE_SPACING=50,e.BACKGROUND_COLOR="white",e.BACKGROUND_COLOR_CIRCUIT="white",e.BACKGROUND_COLOR_TOOLBOX="#CCC",e.TOOLBOX_GATE_SPACING=2,e.TOOLBOX_GROUP_SPACING=24-e.TOOLBOX_GATE_SPACING,e.TOOLBOX_GATE_SPAN=2*e.GATE_RADIUS+e.TOOLBOX_GATE_SPACING,e.TOOLBOX_GROUP_SPAN=2*e.TOOLBOX_GATE_SPAN+e.TOOLBOX_GROUP_SPACING,e.TOOLBOX_MARGIN_X=35,e.TOOLBOX_MARGIN_Y=18,e.MINIMUM_CANVAS_HEIGHT=400,e.SUPPRESSED_GLSL_WARNING_PATTERNS=[],e.DEFAULT_FILL_COLOR="white",e.DEFAULT_STROKE_COLOR="black",e.DEFAULT_TEXT_COLOR="black",e.DEFAULT_FONT_SIZE=12,e.DEFAULT_FONT_FAMILY="sans-serif",e.DEFAULT_STROKE_THICKNESS=1,e.CHECK_WEB_GL_ERRORS_EVEN_ON_HOT_PATHS=!1,e.SEMI_STABLE_RANDOM_VALUE_LIFETIME_MILLIS=300,e.IGNORED_WEBGL_INFO_TERMS=[],{get Config(){return e}}}),$traceurRuntime.registerModule("src/draw/CachablePainting.js",[],function(){"use strict";var s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/draw/CachablePainting.js")).Painter,l=new($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/RestartableRng.js","src/draw/CachablePainting.js")).RestartableRng),e=$traceurRuntime.createClass(function(e,t){this.sizeFunc=e,this._drawingFunc=t,this._cachedCanvases=new Map},{paint:function(e,t,r){var n,i,a,o,u=arguments[3];this._cachedCanvases.has(u)||(n=document.createElement("canvas"),a=(i=this.sizeFunc(u)).width,o=i.height,n.width=a,n.height=o,this._drawingFunc(new s(n,l.restarted()),u),this._cachedCanvases.set(u,n)),r.ctx.drawImage(this._cachedCanvases.get(u),e,t)}},{});return{get CachablePainting(){return e}}}),$traceurRuntime.registerModule("src/draw/GateDrawParams.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(e,t,r,n,i,a,o,u,s,l,c,d){this.painter=e,this.hand=t,this.isInToolbox=r,this.isHighlighted=n,this.isResizeShowing=i,this.isResizeHighlighted=a,this.rect=o,this.gate=u,this.stats=s,this.positionInCircuit=l,this.focusPoints=c,this.customStats=d},{getGateContext:function(e){if(void 0!==this.positionInCircuit)return this.stats.circuitDefinition.colCustomContextFromGates(this.positionInCircuit.col,0).get(e)}},{});return{get GateDrawParams(){return e}}}),$traceurRuntime.registerModule("src/draw/GatePainting.js",[],function(){"use strict";var w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/draw/GatePainting.js")).Config,r=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/draw/GatePainting.js")).GateDrawParams,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/draw/GatePainting.js")).MathPainter),M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/draw/GatePainting.js")).Point,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/draw/GatePainting.js")).Rect,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/draw/GatePainting.js")).Util,y=$traceurRuntime.createClass(function(){},{},{}),b="16px sans-serif";y.paintOutline=function(e){var t;e.isInToolbox&&(t=e.rect.shiftedBy(.5,.5),e.painter.strokeLine(t.topRight(),t.bottomRight()),e.painter.strokeLine(t.bottomLeft(),t.bottomRight())),e.painter.strokeRect(e.rect,"black")},y.paintBackground=function(e){var t=void 0!==arguments[1]?arguments[1]:w.GATE_FILL_COLOR,r=void 0!==arguments[2]?arguments[2]:w.GATE_FILL_COLOR,n=e.isInToolbox?t:r;e.isHighlighted&&(n=w.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.fillRect(e.rect,n)},y.LABEL_DRAWER=function(e){var t;void 0===e.positionInCircuit||e.isHighlighted?y.DEFAULT_DRAWER(e):(t=Math.max(0,e.rect.h-2*w.GATE_RADIUS)/2,e.painter.fillRect(e.rect.skipTop(t).skipBottom(t),w.GATE_FILL_COLOR),y.paintGateSymbol(e))},y.MAKE_HIGHLIGHTED_DRAWER=function(){var t=void 0!==arguments[0]?arguments[0]:w.GATE_FILL_COLOR,r=void 0!==arguments[1]?arguments[1]:w.GATE_FILL_COLOR;return function(e){y.paintBackground(e,t,r),y.paintOutline(e),y.paintResizeTab(e),y.paintGateSymbol(e)}},y.DEFAULT_DRAWER=y.MAKE_HIGHLIGHTED_DRAWER(),y.rectForResizeTab=function(e){var t=Math.min(w.GATE_RADIUS,e.h/4);return new n(e.x,e.bottom()-t,e.w,2*w.GATE_RADIUS)},y.paintResizeTab=function(f){var h,e,t,g,p,r,n;f.isResizeShowing&&f.gate.canChangeInSize()&&(h=w.GATE_RADIUS,t=(e=y.rectForResizeTab(f.rect).skipLeft(2).skipRight(2)).center(),g=t.x,p=t.y,r=f.isResizeHighlighted?w.HIGHLIGHTED_GATE_FILL_COLOR:w.GATE_FILL_COLOR,n=f.isResizeHighlighted?"#222":"gray",f.painter.ctx.save(),f.painter.ctx.globalAlpha*=f.isResizeHighlighted?1:.7,f.painter.fillRect(e,r),f.painter.strokeRect(e,"gray"),f.painter.ctx.restore(),f.painter.print("resize",g,p,"center","middle",n,"monospace",e.w-4,e.h-4),f.painter.trace(function(e){var t=[f.gate.canIncreaseInSize()?1:-1,f.gate.canDecreaseInSize()?-1:1],r=[1,-1],n=!0,i=!1,a=void 0;try{for(var o,u=[-1,1][Symbol.iterator]();!(n=(o=u.next()).done);n=!0)for(var s=o.value,l=0;l<2;l++){var c=p+h*r[l]*5/8,d=c+h*t[l]/8,m=c-h*t[l]/8;e.line(g,d,g+h*s*.3,m)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}).thenStroke(n))},y.paintGateSymbol=function(e){var t,r,n=arguments[1],i=void 0===arguments[2]||arguments[2],a=e.painter,o=e.rect.paddedBy(-2);void 0===n&&(n=e.gate.symbol);var u=function(e,t,r){for(var n=t.split("\n"),i=1;i<n.length;i++)e.print(n[i],r.x+r.w/2,r.y+r.h/2+9*i,"center","hanging","black",b,r.w,16);return{symbol:n[0],offsetY:1<n.length?-5:0}}(e.painter,n,o),s=u.symbol,l=u.offsetY;a.ctx.font=b;var c,d,m,f,h,g,p=i?s.indexOf("^"):-1,v=-1===p?[s]:[s.substr(0,p),s.substr(p+1)];2===v.length&&""!==v[0]&&""!==v[1]?(d=(r=(t=v[Symbol.iterator]()).next()).done?void 0:r.value,c=(r=t.next()).done?void 0:r.value,d=d.split("\n")[0],m=a.ctx.measureText(d).width,f=a.ctx.measureText(c).width,h=Math.min(o.w,m+f)/(m+f),g=o.w/2+(m-f)*h/2,a.print(d,o.x+g,o.y+o.h/2+l,"right","hanging","black",b,g,o.h),a.print(c,o.x+g,o.y+o.h/2+l,"left","alphabetic","black",b,o.w-g,o.h)):a.print(s,o.x+o.w/2,o.y+o.h/2+l,"center","middle","black",b,o.w,o.h)},y.traceLocationIndependentOutline=function(e,t){var r,n,i=(n=(r=[e.rect.x,e.rect.right(),e.rect.y,e.rect.bottom()][Symbol.iterator]()).next()).done?void 0:n.value,a=(n=r.next()).done?void 0:n.value,o=(n=r.next()).done?void 0:n.value,u=(n=r.next()).done?void 0:n.value,s=Math.min(e.rect.h,e.rect.w,2*w.GATE_RADIUS)/(2+Math.sqrt(2));t.polygon([i,o+s,i+s,o,a-s,o,a,o+s,a,u-s,a-s,u,i+s,u,i,u-s])},y.paintLocationIndependentFrame=function(t){var e=void 0!==arguments[1]?arguments[1]:w.GATE_FILL_COLOR,r=void 0!==arguments[2]?arguments[2]:w.GATE_FILL_COLOR;if(t.isInToolbox)return y.paintBackground(t,r,e),void y.paintOutline(t);var n=t.isHighlighted?w.HIGHLIGHTED_GATE_FILL_COLOR:e;t.painter.trace(function(e){return y.traceLocationIndependentOutline(t,e)}).thenFill(n).thenStroke("black")},y.makeLocationIndependentGateDrawer=function(t){return function(e){y.paintLocationIndependentFrame(e,t),y.paintGateSymbol(e)}},y.LOCATION_INDEPENDENT_GATE_DRAWER=y.makeLocationIndependentGateDrawer(w.GATE_FILL_COLOR),y.SECTIONED_DRAWER_MAKER=function(o,u){return function(e){if(e.isInToolbox)y.DEFAULT_DRAWER(e);else{var t=e.isHighlighted?w.HIGHLIGHTED_GATE_FILL_COLOR:w.GATE_FILL_COLOR;e.painter.fillRect(e.rect,t);for(var r=0,n=0;n<o.length;n++){var i,a=void 0;n<o.length-1?(a=r+u[n],i=e.rect.y+e.rect.h*a,e.painter.strokeLine(new M(e.rect.x,i),new M(e.rect.right(),i),"#BBB")):a=1,e.painter.print(o[n],e.rect.x+e.rect.w/2,e.rect.y+e.rect.h*(r+a)/2,"center","middle","black","16px sans-serif",e.rect.w-2,e.rect.h*(a-r)),r=a}e.painter.strokeRect(e.rect),y.paintResizeTab(e)}}};var i=y.MAKE_HIGHLIGHTED_DRAWER(w.DISPLAY_GATE_IN_TOOLBOX_FILL_COLOR);function _(e,t){return e.rect.center().y+(t-e.gate.height/2+.5)*w.WIRE_SPACING}return y.makeDisplayDrawer=function(t){return function(e){void 0!==e.positionInCircuit?(y.paintResizeTab(e),t(e),e.isHighlighted&&e.painter.strokeRect(e.rect,"black",1.5),e.painter.ctx.save(),e.painter.ctx.globalAlpha*=.25,y.paintResizeTab(e),e.painter.ctx.restore()):i(e)}},y.MATRIX_DRAWER=function(e){var t=e.gate.knownMatrixAt(e.stats.time);void 0!==t?(e.painter.fillRect(e.rect,e.isHighlighted?w.HIGHLIGHTED_GATE_FILL_COLOR:w.GATE_FILL_COLOR),r.paintMatrix(e.painter,t,e.rect,w.OPERATION_FORE_COLOR,"black",void 0,w.OPERATION_BACK_COLOR,void 0,"transparent"),e.isHighlighted&&(e.painter.ctx.save(),e.painter.ctx.globalAlpha*=.9,e.painter.fillRect(e.rect,w.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.ctx.restore()),y.paintOutline(e)):y.DEFAULT_DRAWER(e)},y.makeCycleDrawer=function(){var t=void 0!==arguments[0]?arguments[0]:1,r=void 0!==arguments[1]?arguments[1]:1,n=void 0!==arguments[2]?arguments[2]:1,i=void 0!==arguments[3]?arguments[3]:0;return function(e){y.MAKE_HIGHLIGHTED_DRAWER(w.TIME_DEPENDENT_HIGHLIGHT_COLOR)(e),e.isInToolbox&&!e.isHighlighted||y.paintCycleState(e,2*e.stats.time*Math.PI*n,t,r,i)}},y.paintCycleState=function(e,t){var r=void 0!==arguments[2]?arguments[2]:1,n=void 0!==arguments[3]?arguments[3]:1,i=void 0!==arguments[4]?arguments[4]:0,a=u.properMod(-t,2*Math.PI),o=e.rect.center();e.painter.ctx.save(),e.painter.ctx.translate(o.x,o.y),e.painter.ctx.scale(-r,-n),e.painter.ctx.rotate(i),e.painter.ctx.strokeStyle="black",e.painter.ctx.fillStyle="yellow",e.painter.ctx.globalAlpha*=.4,e.painter.ctx.beginPath(),e.painter.ctx.moveTo(0,0),e.painter.ctx.lineTo(0,16),e.painter.ctx.arc(0,0,16,Math.PI/2,Math.PI/2+a,!0),e.painter.ctx.lineTo(0,0),e.painter.ctx.closePath(),e.painter.ctx.stroke(),e.painter.ctx.fill(),e.painter.ctx.restore()},y.MATRIX_SYMBOL_DRAWER_EXCEPT_IN_TOOLBOX=function(e){e.isInToolbox?y.DEFAULT_DRAWER(e):y.MATRIX_DRAWER(e)},y.gateButtonRect=function(e){return 50<e.h?e.bottomHalf().skipTop(6).paddedBy(-7):e.bottomHalf().paddedBy(2)},y.paintGateButton=function(e){var t,r;!e.isHighlighted||e.isInToolbox||e.hand.isHoldingSomething()||(t=y.gateButtonRect(e.rect),r=!e.focusPoints.every(function(e){return!t.containsPoint(e)}),e.painter.fillRect(t,r?"red":"orange"),e.painter.print("change",t.center().x,t.center().y,"center","middle","black","12px sans-serif",t.w,t.h),e.painter.strokeRect(t,"black"))},y.PERMUTATION_DRAWER=function(e){var t,r;if(void 0!==e.positionInCircuit){e.isHighlighted||e.isResizeHighlighted||e.stats.circuitDefinition.colHasControls(e.positionInCircuit.col)?(y.paintBackground(e,"#F3F3F3","#F3F3F3"),y.paintOutline(e),y.paintResizeTab(e)):function(e){for(var t=0;t<e.gate.height;t++){var r=_(e,t),n=new M(e.rect.x,r),i=new M(e.rect.x+w.GATE_RADIUS,r),a=new M(e.rect.right(),r),o=new M(e.positionInCircuit.col,e.positionInCircuit.row+t),u=e.stats.circuitDefinition.locIsMeasured(o),s=e.stats.circuitDefinition.locIsMeasured(o.offsetBy(1,0)),l=!0,c=!1,d=void 0;try{for(var m,f=(u?[-1,1]:[0])[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var h=m.value;e.painter.strokeLine(n.offsetBy(0,h),i.offsetBy(1,h),"white")}}catch(e){c=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw d}}var g=!0,p=!1,v=void 0;try{for(var y,b=(s?[-1,1]:[0])[Symbol.iterator]();!(g=(y=b.next()).done);g=!0){var R=y.value;e.painter.strokeLine(i.offsetBy(-1,R),a.offsetBy(0,R),"white")}}catch(e){p=!0,v=e}finally{try{g||null==b.return||b.return()}finally{if(p)throw v}}}}(e);var n=e.rect.x,i=e.rect.right();e.painter.ctx.strokeStyle="black";for(var a=0;a<e.gate.height;a++){var o=e.gate.knownBitPermutationFunc(a),u=new M(e.positionInCircuit.col,e.positionInCircuit.row+a),s=e.stats.circuitDefinition.locIsMeasured(u),l=_(e,a),c=_(e,o);e.painter.ctx.beginPath();var d=!0,m=!1,f=void 0;try{for(var h,g=(s?[[a<o?1:-1,-1],[0,1]]:[[0,0]])[Symbol.iterator]();!(d=(h=g.next()).done);d=!0){var p=(r=(t=h.value[Symbol.iterator]()).next()).done?void 0:r.value,v=(r=t.next()).done?void 0:r.value;e.painter.ctx.moveTo(Math.min(n,n+p),l+v),e.painter.ctx.lineTo(n+p,l+v),e.painter.ctx.lineTo(i+p,c+v),e.painter.ctx.lineTo(Math.max(i,i+p),c+v)}}catch(e){m=!0,f=e}finally{try{d||null==g.return||g.return()}finally{if(m)throw f}}e.painter.ctx.stroke()}}else y.DEFAULT_DRAWER(e)},{get GatePainting(){return y}}}),$traceurRuntime.registerModule("src/draw/MathPainter.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/draw/MathPainter.js")).Painter;var p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/draw/MathPainter.js")).Format,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/draw/MathPainter.js")).Point,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/draw/MathPainter.js")).Rect,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/draw/MathPainter.js")),T=e.seq,A=e.Seq,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/draw/MathPainter.js")).Util,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/draw/MathPainter.js")).Config,E=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/draw/MathPainter.js")).Complex,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/draw/MathPainter.js")).Matrix),t=$traceurRuntime.createClass(I,{},{describeProbability:function(e,t){var r=100*e,n=Math.pow(10,-t);return 100-n/2<r?"On":r<n/2?"Off":Math.min(Math.max(r,n),100-n).toFixed(t)+"%"},paintProbabilityBox:function(e,t,r){var n=void 0!==arguments[3]?arguments[3]:[],i=void 0!==arguments[4]?arguments[4]:C.DISPLAY_GATE_BACK_COLOR,a=void 0!==arguments[5]?arguments[5]:C.DISPLAY_GATE_FORE_COLOR;e.fillRect(r,i);var o=r.center();isNaN(t)?(e.fillPolygon([r.bottomLeft(),r.topLeft(),r.topRight()],a),e.print("NaN",o.x,o.y,"center","middle","red","9pt sans-serif",r.w,r.h)):(e.fillRect(r.takeBottomProportion(t),a),e.print(I.describeProbability(t,1),o.x,o.y,"center","middle","black","9pt sans-serif",r.w,r.h)),e.strokeRect(r,"lightgray"),T(n).any(function(e){return r.containsPoint(e)})&&(e.strokeRect(r,"orange",2),I.paintDeferredValueTooltip(e,r.right(),r.y,"Chance of being ON if measured",(100*t).toFixed(5)+"%"))},paintMatrixTooltip:function(e,t,r,n,i,a){var o=void 0!==arguments[6]?arguments[6]:function(){},u=t.width(),s=t.height(),l=r.x,c=r.y,d=Math.min(r.w/u,r.h/s),m=!0,f=!1,h=void 0;try{for(var g,p=n[Symbol.iterator]();!(m=(g=p.next()).done);m=!0){var v,y=g.value,b=Math.floor((y.x-l)/d),R=Math.floor((y.y-c)/d);0<=b&&b<t.width()&&0<=R&&R<t.height()&&(e.strokeRect(new w(l+d*b,c+d*R,d,d),"orange",2),v=t.cell(b,R),I.paintDeferredValueTooltip(e,l+d*b+d,c+d*R,i(b,R),a(b,R,v),o(b,R,v)))}}catch(e){f=!0,h=e}finally{try{m||null==p.return||p.return()}finally{if(f)throw h}}},_traceAmplitudeProbabilitySquare:function(e,t,r,n,i,a){var o=t*t+r*r;.001<o&&e.polygon([n,i+a*(1-o),n+a,i+a*(1-o),n+a,i+a,n,i+a])},_traceProbabilitySquare:function(e,t,r,n,i,a){.1<a*t&&e.polygon([n,i+a*(1-t),n+a,i+a*(1-t),n+a,i+a,n,i+a])},_traceAmplitudeProbabilityCircle:function(e,t,r,n,i,a){var o=Math.sqrt(t*t+r*r);.5<a*o&&e.circle(n+a/2,i+a/2,o*a/2)},_traceAmplitudeLogarithmCircle:function(e,t,r,n,i,a){var o=1+Math.log(t*t+r*r)/15;0<o&&e.circle(n+a/2,i+a/2,o*a/2)},_traceAmplitudePhaseDirection:function(e,t,r,n,i,a){var o,u,s=Math.sqrt(t*t+r*r),l=1+Math.log(s)/10,c=Math.max(1,l/s)*Math.max(a/2,5);c<.1||(o=n+a/2,u=i+a/2,e.line(o,u,o+t*c,u-r*c))},paintMatrix:function(e,t,r,n,i,a){var o=void 0!==arguments[6]?arguments[6]:C.DISPLAY_GATE_BACK_COLOR,u=arguments[7],s=void 0!==arguments[8]?arguments[8]:"#AAA",l=t.width(),c=t.height(),d=t.rawBuffer(),m=Math.min(r.w/l,r.h/c),f=(r=r.withW(m*l).withH(m*c)).x,h=r.y,g=t.hasNaN(),u=u||i;e.fillRect(r,o);function p(i){return e.trace(function(e){for(var t=0;t<c;t++)for(var r=0;r<l;r++){var n=2*(t*l+r);i(e,d[n],d[1+n],f+m*r,h+m*t,m)}})}g||(void 0!==a&&p(I._traceAmplitudeProbabilitySquare).thenFill(a).thenStroke("lightgray",.5),void 0!==n&&(p(I._traceAmplitudeProbabilityCircle).thenFill(n).thenStroke(i,.5),p(I._traceAmplitudeLogarithmCircle).thenStroke(s,.5))),e.trace(function(e){return e.grid(f,h,r.w,r.h,l,c)}).thenStroke("lightgray"),g||void 0!==s&&p(I._traceAmplitudePhaseDirection).thenStroke(u),g&&e.print("NaN",r.x+r.w/2,r.y+r.h/2,"center","middle","red","16px sans-serif",r.w,r.h)},paintDeferredValueTooltip:function(s,l,c,d,m){var f=arguments[5],h=void 0!==arguments[6]?arguments[6]:C.DISPLAY_GATE_BACK_COLOR,g="12px sans-serif",p="bold 12px monospace";s.defer(function(){s.ctx.font=g;var e=s.ctx.measureText(d).width;s.ctx.font=p;function i(a,o){s.print(d,u.x,u.bottom()-o,"left","bottom","black",g,u.w,20,function(e,t){return r=Math.max(a,e),n=o+t,i=new w(u.x,u.bottom()-n,r,n).paddedBy(4),void s.trace(function(e){return e.rect(i.x,i.y,i.w,i.h)}).thenFill(h).thenStroke("black");var r,n,i})}function t(r,n){s.print(m,u.x,u.bottom()-n,"left","bottom","black",p,u.w,20,function(e,t){return i(Math.max(r,e),n+t)})}var r=s.ctx.measureText(m).width,n=void 0===f?0:s.ctx.measureText(f).width,a=40+(void 0===f?0:20),o=Math.max(Math.max(e,r),n),u=new w(l,c-a,o,a).snapInside(new w(0,0,s.ctx.canvas.clientWidth,s.ctx.canvas.clientHeight));void 0===f?t(0,0):s.print(f,u.x,u.bottom(),"left","bottom","black",p,u.w,20,t)})},coordinateSystem:function(e){return{dx:new S(e/3,-e/3),dy:new S(e,0),dz:new S(0,e)}},paintBlochSphereRotation:function(e,t,r){function s(e){var t=m.times(e);return new S(t.cell(0,0).real,t.cell(0,1).real)}var n=void 0!==arguments[3]?arguments[3]:C.DISPLAY_GATE_BACK_COLOR,i=void 0!==arguments[4]?arguments[4]:C.DISPLAY_GATE_FORE_COLOR,l=r.center(),c=Math.min(r.w,r.h)/2,a=I.coordinateSystem(c),o=a.dx,u=a.dy,d=a.dz,m=E.fromRows([[-o.x,-o.y],[u.x,u.y],[-d.x,-d.y]]).adjoint(),f=A.range(3).map(function(r){return E.generate(1,3,function(e,t){return e===r?1:0})}).toArray();e.fillCircle(l,c,n),e.trace(function(e){e.circle(l.x,l.y,c),e.ellipse(l.x,l.y,c,c/3),e.ellipse(l.x,l.y,c/3,c);var t=!0,r=!1,n=void 0;try{for(var i,a=f[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,u=s(o);e.line(l.x-u.x,l.y-u.y,l.x+u.x,l.y+u.y)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}).thenStroke("#BBB");var h=t.qubitOperationToAngleAxisRotation(),g=h.angle,p=h.axis,v=E.col.apply(E,$traceurRuntime.spread(p)),y=s(v),b=[E.col(p[0],p[1],0),v,E.col(0,0,p[2])].map(s);e.strokePolygon(T(b).reverse().concat(b.map(function(e){return e.times(-1)})).map(function(e){return l.plus(e)}).toArray(),"#666"),e.strokeLine(l.plus(y),l.plus(y.times(-1)),"black",2);function R(e){return Math.sqrt(e.adjoint().times(e).cell(0,0).real)}var w=T(f).mapWithIndex(function(e,t){return e.times([-3,-2,1][t])}).map(function(e){return v.cross3(e)}).maxBy(R),M=v.cross3(w),w=w.times(.15/R(w)),M=M.times(.15/R(M)),_=s(w),x=s(M);I._paintBlochSphereRotation_rotationGuideArrows(e,l,g,y,_,x,i)},_paintBlochSphereRotation_rotationGuideArrows:function(u,s,r,l,n,i,c){var d=A.range(Math.floor(32*Math.abs(r))).map(function(e){var t=r<0?Math.PI-e/32:e/32;return n.times(Math.cos(t)).plus(i.times(Math.sin(t)))}).toArray();if(!(d.length<=1)){var e=!0,t=!1,a=void 0;try{for(var m=void 0,o=[-.55,0,.55][Symbol.iterator]();!(e=(m=o.next()).done);e=!0)!function(){var e=m.value,t=s.plus(l.times(e)),r=d.map(function(e){return t.plus(e)}),n=r[r.length-1],i=n.plus(r[r.length-2].times(-1)),a=[l.times(.15),i.times(30),l.times(-.15)].map(function(e){return n.plus(e)}),o=[].concat.apply([],a.map(function(e){return[e.x,e.y]}));u.strokePath(r,"#444"),u.trace(function(e){return e.polygon(o)}).thenFill(c).thenStroke("#444")}()}catch(e){t=!0,a=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw a}}}},paintDensityMatrix:function(e,n,t){function r(i){return e.trace(function(e){for(var t=0;t<l;t++)for(var r=0;r<s;r++){var n=2*(t*s+r);i(e,c[n],c[1+n],m+d*r,f+d*t,d)}})}var i,a=void 0!==arguments[3]?arguments[3]:[],o=void 0!==arguments[4]?arguments[4]:C.DISPLAY_GATE_BACK_COLOR,u=void 0!==arguments[5]?arguments[5]:C.DISPLAY_GATE_FORE_COLOR,s=n.width(),l=n.height(),c=n.rawBuffer(),d=Math.min(t.w/s,t.h/l),m=t.x,f=t.y,h=n.hasNaN();e.fillRect(t,o),h||(i=I._traceProbabilitySquare,e.trace(function(e){for(var t=0;t<l;t++){var r=t*(s+1)*2;i(e,c[r],c[1+r],m+d*t,f+d*t,d)}}).thenFill(u).thenStroke("#040",.5),r(I._traceAmplitudeProbabilityCircle).thenFill(u).thenStroke("#040",.5),r(I._traceAmplitudeLogarithmCircle).thenStroke("#BBB",.5),r(I._traceAmplitudePhaseDirection).thenStroke("black")),2<t.w/s?e.trace(function(e){return e.grid(m,f,t.w,t.h,s,l)}).thenStroke("lightgray",Math.min(1,2/Math.log(s))):(e.ctx.save(),e.ctx.globalAlpha*=.2,e.fillRect(t,"lightgray"),e.ctx.restore()),h&&e.print("NaN",t.x+t.w/2,t.y+t.h/2,"center","middle","red","16px sans-serif",t.w,t.h);var g=Math.round(Math.log2(l));I.paintMatrixTooltip(e,n,t,a,function(e,t){return e===t?"Probability of |"+v.bin(e,g)+"⟩ (decimal "+e+")":"Coupling of |"+v.bin(t,g)+"⟩ to ⟨"+v.bin(e,g)+"| (decimal "+t+" to "+e+")"},function(e,t,r){return e===t?(100*n.cell(e,t).real).toFixed(4)+"%":n.cell(e,t).toString(new p(!1,0,6,", "))})}});function I(){}return{get MathPainter(){return t}}}),$traceurRuntime.registerModule("src/draw/Painter.js",[],function(){"use strict";var M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/draw/Painter.js")).Config,_=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/draw/Painter.js")).Point,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/draw/Painter.js")).Rect,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/RestartableRng.js","src/draw/Painter.js")).RestartableRng,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/draw/Painter.js")),S=e.seq,T=e.Seq,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/draw/Painter.js")).Util,t=$traceurRuntime.createClass(function(e){var t=void 0!==arguments[1]?arguments[1]:new r;this.canvas=e,this.ctx=e.getContext("2d"),this._deferredPaintActions=[],this._traceAction=new i(this.ctx),this._tracer=new n(this.ctx),this.desiredCursorStyle=void 0,this.touchBlockers=[],this.rng=t,this._ignoringTouchBlockers=0},{startIgnoringIncomingTouchBlockers:function(){this._ignoringTouchBlockers+=1},stopIgnoringIncomingTouchBlockers:function(){--this._ignoringTouchBlockers},noteTouchBlocker:function(e){0===this._ignoringTouchBlockers&&this.touchBlockers.push(e)},setDesiredCursor:function(e){this.desiredCursorStyle=e},defer:function(e){this._deferredPaintActions.push(e)},paintDeferred:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._deferredPaintActions[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){(0,n.value)()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this._deferredPaintActions=[]},paintableArea:function(){return new x(0,0,this.canvas.width,this.canvas.height)},clear:function(){var e=void 0!==arguments[0]?arguments[0]:M.DEFAULT_FILL_COLOR;this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)},strokeLine:function(e,t){var r=void 0!==arguments[2]?arguments[2]:M.DEFAULT_STROKE_COLOR,n=void 0!==arguments[3]?arguments[3]:1;this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle=r,this.ctx.lineWidth=n,this.ctx.stroke()},strokeRect:function(e){var t=void 0!==arguments[1]?arguments[1]:"black",r=void 0!==arguments[2]?arguments[2]:1;this.ctx.strokeStyle=t,this.ctx.lineWidth=r,this.ctx.strokeRect(e.x,e.y,e.w,e.h)},fillRect:function(e){var t=void 0!==arguments[1]?arguments[1]:M.DEFAULT_FILL_COLOR;this.ctx.fillStyle=t,this.ctx.fillRect(e.x,e.y,e.w,e.h)},strokeCircle:function(e,t){var r=void 0!==arguments[2]?arguments[2]:M.DEFAULT_STROKE_COLOR,n=void 0!==arguments[3]?arguments[3]:M.DEFAULT_STROKE_THICKNESS;this.ctx.beginPath(),this.ctx.strokeStyle=r,this.ctx.lineWidth=n,this.ctx.arc(e.x,e.y,Math.max(t-.5,0),0,2*Math.PI),this.ctx.stroke()},trace:function(e){return this.ctx.beginPath(),e(this._tracer),this._traceAction},fillCircle:function(e,t){var r=void 0!==arguments[2]?arguments[2]:M.DEFAULT_FILL_COLOR;this.ctx.beginPath(),this.ctx.arc(e.x,e.y,Math.max(t-.5,0),0,2*Math.PI),this.ctx.fillStyle=r,this.ctx.fill()},print:function(e,t,r,n,i,a,o,u,s){var l=arguments[9],c=void 0!==arguments[10]&&arguments[10];this.ctx.font=o;var d=this.ctx.measureText(e).width,m=2.5*this.ctx.measureText("0").width,f=Math.min(Math.min(u/d,s/m),1);void 0!==l&&l(d*f,m*f),this.ctx.save(),this.ctx.textAlign=n,this.ctx.textBaseline=i,this.ctx.font=o,this.ctx.fillStyle=a,this.ctx.translate(t,r),this.ctx.scale(f,f),c&&this.ctx.strokeText(e,0,0),this.ctx.fillText(e,0,0),this.ctx.restore()},printParagraph:function(e,t){for(var r,n,i,a,o=void 0!==arguments[2]?arguments[2]:new _(0,0),u=void 0!==arguments[3]?arguments[3]:M.DEFAULT_TEXT_COLOR,s=void 0!==arguments[4]?arguments[4]:M.DEFAULT_FONT_SIZE,l=void 0!==arguments[5]?arguments[5]:M.DEFAULT_FONT_FAMILY,c=this,d=function(e){var t=e.fontBoundingBoxAscent;return void 0===t?.75*r:t},m=function(e){var t=e.fontBoundingBoxDescent;return void 0===t?.25*r:t},f=function(e){return d(e)+m(e)},h=S(e.split("\n")),g=0;r=s-g,this.ctx.font=r+"px "+l,i=(n=h.flatMap(function(e){return A.breakLine(e,t.w,function(e){return c.ctx.measureText(e).width})}).toArray()).map(function(e){return c.ctx.measureText(e)}),!((a=S(i.map(f)).sum())<=t.h||r<=4);g++);function p(e){return t.x+(t.w-e)*o.x}var v,y=(v=a,t.y+(t.h-v)*o.y);this.ctx.fillStyle=u;for(var b=0,R=0;R<n.length;R++)b+=d(i[R]),this.ctx.fillText(n[R],p(i[R].width),y+b),b+=m(i[R]);var w=new T(i).map(function(e){return e.width}).max(0);return new x(p(w),y,w,a)},printLine:function(e,t){for(var r,n,i=void 0!==arguments[2]?arguments[2]:0,a=void 0!==arguments[3]?arguments[3]:M.DEFAULT_TEXT_COLOR,o=void 0!==arguments[4]?arguments[4]:M.DEFAULT_FONT_SIZE,u=void 0!==arguments[5]?arguments[5]:M.DEFAULT_FONT_FAMILY,s=arguments[6],l=function(e){var t=e.fontBoundingBoxAscent;return void 0===t?.75*r:t},c=function(e){return l(e)+(void 0===(t=e.fontBoundingBoxDescent)?.25*r:t);var t},d=0;r=o-d,this.ctx.font=r+"px "+u,!((n=this.ctx.measureText(e)).width<=t.w&&c(n)<=t.h||r<=4);d++);var m=c(n),f=void 0===s?l(n)/m:s,h=t.x+(t.w-n.width)*i,g=t.y+(t.h-m)*f;return this.ctx.fillStyle=a,this.ctx.fillText(e,h,g+l(n)),new x(h,g,n.width,m)},strokePolygon:function(e){var t=void 0!==arguments[1]?arguments[1]:M.DEFAULT_STROKE_COLOR,r=void 0!==arguments[2]?arguments[2]:M.DEFAULT_STROKE_THICKNESS;if(0!==e.length){var n=e[e.length-1];this.ctx.beginPath(),this.ctx.moveTo(n.x,n.y);var i=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value;this.ctx.lineTo(l.x,l.y)}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}this.ctx.strokeStyle=t,this.ctx.lineWidth=r,this.ctx.stroke()}},strokePath:function(e){var t=void 0!==arguments[1]?arguments[1]:M.DEFAULT_STROKE_COLOR,r=void 0!==arguments[2]?arguments[2]:M.DEFAULT_STROKE_THICKNESS;if(0!==e.length){this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);var n=!0,i=!1,a=void 0;try{for(var o,u=e.slice(1)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;this.ctx.lineTo(s.x,s.y)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}this.ctx.strokeStyle=t,this.ctx.lineWidth=r,this.ctx.stroke()}},fillPolygon:function(e,t){var r=e[e.length-1];this.ctx.beginPath(),this.ctx.moveTo(r.x,r.y);var n=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;this.ctx.lineTo(s.x,s.y)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}this.ctx.fillStyle=t,this.ctx.fill()}},{}),n=$traceurRuntime.createClass(function(e){this.ctx=e},{line:function(e,t,r,n){this.ctx.moveTo(e,t),this.ctx.lineTo(r,n)},rect:function(e,t,r,n){this.ctx.moveTo(e,t),this.ctx.lineTo(e+r,t),this.ctx.lineTo(e+r,t+n),this.ctx.lineTo(e,t+n),this.ctx.lineTo(e,t)},circle:function(e,t,r){this.ctx.moveTo(e+r,t),this.ctx.arc(e,t,r,0,2*Math.PI,!1)},ellipse:function(e,t,r,n){this.ctx.save(),this.ctx.translate(e-r,t-n),this.ctx.scale(r,n),this.ctx.moveTo(2,1),this.ctx.arc(1,1,1,0,2*Math.PI,!1),this.ctx.restore()},grid:function(e,t,r,n,i,a){for(var o=r/i,u=n/a,s=e+i*o,l=t+a*u,c=0;c<=i;c++)this.ctx.moveTo(e+c*o,t),this.ctx.lineTo(e+c*o,l);for(var d=0;d<=a;d++)this.ctx.moveTo(e,t+d*u),this.ctx.lineTo(s,t+d*u)},polygon:function(e){if(0!==e.length){var t=e.length;this.ctx.moveTo(e[t-2],e[t-1]);for(var r=0;r<t;r+=2)this.ctx.lineTo(e[r],e[r+1])}},arrowHead:function(e,t,r,n,i){var a=n+i/2+Math.PI,o=n-i/2+Math.PI;this.polygon([e+Math.cos(n)*r,t+Math.sin(n)*r,e+Math.cos(a)*r,t+Math.sin(a)*r,e+Math.cos(o)*r,t+Math.sin(o)*r])}},{}),i=$traceurRuntime.createClass(function(e){this.ctx=e},{thenFill:function(e){return this.ctx.fillStyle=e,this.ctx.fill(),this},thenStroke:function(e){var t=void 0!==arguments[1]?arguments[1]:1;return this.ctx.strokeStyle=e,this.ctx.lineWidth=t,this.ctx.stroke(),this}},{});return{get Painter(){return t}}}),$traceurRuntime.registerModule("src/draw/WidgetPainter.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/draw/WidgetPainter.js")).Complex,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/draw/WidgetPainter.js")).Config,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/draw/WidgetPainter.js")).Format,v=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/draw/WidgetPainter.js")).Gate,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/draw/WidgetPainter.js")).MathPainter),y=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/draw/WidgetPainter.js")).Matrix,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/draw/WidgetPainter.js")).Painter,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/draw/WidgetPainter.js")).Point),b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/draw/WidgetPainter.js")).Rect,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/draw/WidgetPainter.js")).Seq,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedCircuit.js","src/draw/WidgetPainter.js")).drawCircuitTooltip,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/draw/WidgetPainter.js")).Util,e=$traceurRuntime.createClass(w,{},{describeGateTransformations:function(i,a){var o=i.height(),u=Math.round(Math.log2(o));return R.range(o).map(function(t){var e=w.describeKet(u,t,1,p.SIMPLIFIED),r=i.getColumn(t);if(r.every(function(e){return e.isEqualTo(0)}))return"discards "+e;if(R.range(o).every(function(e){return r[e].isEqualTo(e===t?1:0)})){if(a!==p.CONSISTENT)return"doesn't affect "+e}else if(R.range(o).every(function(e){return e===t||r[e].isEqualTo(0)})){var n=180*r[t].ln().imag/Math.PI;return"phases "+e+" by "+a.formatFloat(n)+"°"}return"transforms "+e+" into "+new R(r).mapWithIndex(function(e,t){return w.describeKet(u,t,e,a)}).filter(function(e){return""!==e}).join(" + ").split(" + -").join(" - ").split(" + +").join(" + ")}).toArray()},_paintGateTooltip_matrix:function(e,t,r,n,i,a,o,u){if(void 0!==r){o(new b(0,u(),1,0),2*n),o(e.printParagraph("As matrix:",new b(n,u(),a,18),new y(0,0),"black",12),0);var s=new b(n,u(),i,i),l=new b(0,s.y,a-n,i).skipLeft(s.right()+n);v.paintMatrix(e,r,s,g.OPERATION_FORE_COLOR,"black",void 0,g.OPERATION_BACK_COLOR,void 0,"transparent"),o(s);var c=r.height();if(c<=4)for(var d=t.stableDuration()<.2?p.CONSISTENT:p.SIMPLIFIED,m=w.describeGateTransformations(r,d),f=l.h/c,h=0;h<c;h++)o(e.printParagraph(m[h],l.skipTop(h*f).takeTop(f),new y(0,.5),"black",12))}},_paintGateTooltip_rotation:function(e,t,r,n,i,a,o,u){var s,l,c,d,m,f,h;void 0!==r&&2===r.width()&&r.isUnitary(.001)&&(o(new b(0,u(),1,0),2*n),o(e.printParagraph("As rotation:",new b(n,u(),a,18),new y(0,0),"black",12),0),l=(s=r.qubitOperationToAngleAxisRotation()).angle,c=s.axis,d=s.phase,m=new b(n,u(),i,i),v.paintBlochSphereRotation(e,r,m,g.OPERATION_BACK_COLOR,g.OPERATION_FORE_COLOR),o(m),f=t.stableDuration()<.2?p.CONSISTENT:p.SIMPLIFIED,h=new R(["rotates: "+f.formatFloat(180*l/Math.PI)+"°","around: "+w.describeAxis(c,f),"","global phase: exp("+f.formatFloat(180*d/Math.PI)+"°i)",""]).join("\n"),o(e.printParagraph(h,new b(0,m.y,a-n,i).skipLeft(m.right()+n),new y(0,.5),"black",12)))},_paintGateTooltip_circuit:function(e,t,r,n,i,a,o,u){var s,l,c,d,m;void 0!==t&&(s=t.gateWeight(),a(new b(0,o(),1,0),2*r),a(e.printParagraph("As circuit (gate weight = "+s+"):",new b(r,o(),i,18),new y(0,0),"black",12),0),l=new b(r,o(),i,n),d=(c=f(e,t,l,!0,u)).maxW,m=c.maxH,a(l.withW(d).withH(m)))},paintGateTooltipHelper:function(e,t,r,n){function i(e){var t=void 0!==arguments[1]?arguments[1]:l;m=Math.max(m,e.bottom()+t),d=Math.max(d,e.right()+t)}var a,o,u,s,l=(o=(a=[4,65][Symbol.iterator]()).next()).done?void 0:o.value,c=(o=a.next()).done?void 0:o.value,d=(s=(u=[0,l][Symbol.iterator]()).next()).done?void 0:s.value,m=(s=u.next()).done?void 0:s.value;i(e.printLine(r.name,new b(l,m,t,18),0,"blue",24)),""!==r.blurb&&i(e.printParagraph(r.blurb,new b(l,m,t,50),new y(0,0),"black",14));var f=r.knownMatrixAt(n);return r.definitelyHasNoEffect()||(w._paintGateTooltip_matrix(e,r,f,l,c,t,i,function(){return m}),w._paintGateTooltip_rotation(e,r,f,l,c,t,i,function(){return m}),w._paintGateTooltip_circuit(e,r.knownCircuitNested,l,c,t,i,function(){return m},n)),{maxX:d,maxY:m}},paintGateTooltip:function(e,t,r,n){var i=void 0===arguments[4]||arguments[4];e.ctx.save(),e.ctx.translate(t.x,t.y),t=t.withX(0).withY(0);var a=Math.min(t.w/500,t.h/300);i&&a<1&&(e.ctx.scale(a,a),t=t.withH(t.h/a).withW(t.w/a));var o=t.w,u=w.paintGateTooltipHelper(e,o,r,n),s=u.maxX,l=u.maxY,c=new b(0,0,s,l);return e.fillRect(c,"#F9FFF9"),e.strokeRect(c,"black"),w.paintGateTooltipHelper(e,o,r,n),e.ctx.restore(),{maxW:s,maxH:l}},describeKet:function(e,t,r,n){return(r=i.from(r)).isEqualTo(0)?"":(r.isEqualTo(1)?"":r.isEqualTo(-1)?"-":r.isEqualTo(i.I)?"i":r.isEqualTo(i.I.times(-1))?"-i":0!==r.real&&0!==r.imag||n===p.CONSISTENT?"("+r.toString(n)+")·":r.toString(n))+"|"+a.bin(t,e)+"⟩"},describeAxis:function(e,r){var t=new R(e).map(Math.abs).max();return new R(e).map(function(e){return e/t}).zip(["X","Y","Z"],function(e,t){return 0===e?"":1===e?t:-1===e?"-"+t:r.formatFloat(e)+"·"+t}).filter(function(e){return""!==e}).join(" + ").replace(" + -"," - ").replace(" + +"," + ")}});function w(){}return{get WidgetPainter(){return e}}}),$traceurRuntime.registerModule("src/fallback.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/fallback.js")).describe,d=[],o=!1;function e(){o=!0,window.onerror=n}function t(e,t,r){if(!o)throw r;console.error("Recovered from unexpected error",{recovery:e,context:t,error:r});var n=r.stack||"unknown",i=[e,"","URL",document.location,"","BROWSER",window.navigator.userAgent,window.navigator.appName,window.navigator.appVersion,"","RECOVERY DETAILS",a(t),"","ERROR OBJECT",a(r),"","ERROR LOCATION",u(n)].join("\n");c("Recovered from an error. :(",e+" ("+(r.message||"")+")",i,"(Recovered) "+e+" @ "+n.substr(0,200)+"[...]")}function r(e,t,r){function n(){return c("A known problem is happening. :(",e,"",e,t)}var i=!0,a=!1,o=void 0;try{for(var u,s=r[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value;d.push({regex:l,handler:n})}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}n()}var m=[],f=[],c=function(e,t,r,n){var i,a,o,u,s,l=arguments[4],c=document.getElementById("error-div").style;c.opacity<.7&&(m=[],f=[]),c.backgroundColor="#FFA",c.opacity=1,c.display="block",-1===m.indexOf(r)&&(m.push(r),0<f.length&&(r+="\n\nCOVERED\n"+f.join("\n-------------\n")),-1===f.indexOf(n)&&f.push(n),void 0===(i=function(e,t){if(void 0===t){var r=!0,n=!1,i=void 0;try{for(var a,o=d[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value,s=u.regex,l=u.handler;if(s.test(e))return l}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}}(t,l))?(a=e,o=t,u=r,s=l,document.getElementById("error-happened-div").innerText=a,document.getElementById("error-message-div").innerText=o,document.getElementById("error-description-div").innerText=u,document.getElementById("error-mailto-anchor").innerText="Email the issue to craig.gidney@gmail.com",document.getElementById("error-mailto-anchor").href=["mailto:craig.gidney@gmail.com?subject=",encodeURIComponent("Quirk had an error: "+o),"&body=",encodeURIComponent("\n\n\n"+u)].join(""),document.getElementById("error-github-anchor").href=["https://github.com/Strilanc/Quirk/issues/new?title=",encodeURIComponent("Encountered error: "+o),"&body=",encodeURIComponent("\n\n\n"+u)].join(""),document.getElementById("error-image-pre").src=h(),setTimeout(function(){document.getElementById("error-image-post").src=h()},0),void 0===s?(document.getElementById("error-report-div").style.display="block",document.getElementById("error-known-div").style.display="none"):(document.getElementById("error-report-div").style.display="none",document.getElementById("error-known-div").style.display="block",document.getElementById("error-known-issue-anchor").href=s)):i())},h=function(){var e=document.getElementById("drawCanvas");return void 0===e?"#":e.toDataURL("image/png")},u=function(e){return e.replace(/http.+?\/src\.min\.js/g,"src.min.js")},s=function(e){var t=document.getElementById("drawCanvas");if(void 0!==t){var r=t.getContext("2d");r.font="12px monospace";var n=e.split("\n"),i=0,a=!0,o=!1,u=void 0;try{for(var s,l=n[Symbol.iterator]();!(a=(s=l.next()).done);a=!0)var c=s.value,i=Math.max(i,r.measureText(c).width)}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}var d=12*n.length,m=(t.clientWidth-i)/2,f=(t.clientHeight-d)/2;r.fillStyle="white",r.globalAlpha=.9,r.fillRect(m-10,f-10,i+20,20+d),r.globalAlpha=1,r.strokeStyle="red",r.strokeRect(m-10,f-10,i+20,20+d),r.fillStyle="red";for(var h=0,g=0;g<n.length;g++)h+=3,r.fillText(n[g],m,f+h),h+=9}};function n(e,t,r,n,i){try{var a=u((i instanceof Object?i.stack:void 0)||t+":"+r+":"+n),o=["URL",document.location,"","BROWSER",window.navigator.userAgent,window.navigator.appName,window.navigator.appVersion,"","ERROR OBJECT",i instanceof Object&&void 0!==i.toString?i.toString():String(i),"","ERROR LOCATION",u(a)].join("\n");c("An error happened. :(",e,o,"(Unexpected) "+e+" @ "+a.substr(0,200)+"[...]"),s(["An error is happening. :(","",e,"","Scroll down for more information"].join("\n"))}catch(e){console.error("Caused an exception when handling unexpected error.",e)}return!1}return{get hookErrorHandler(){return e},get notifyAboutRecoveryFromUnexpectedError(){return t},get onErrorHandler(){return n},get notifyAboutKnownIssue(){return r}}}),$traceurRuntime.registerModule("src/gates/AllGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ArithmeticGates.js","src/gates/AllGates.js")).ArithmeticGates,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AmplitudeDisplay.js","src/gates/AllGates.js")).AmplitudeDisplayFamily,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/BitCountGates.js","src/gates/AllGates.js")).BitCountGates,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/BlochSphereDisplay.js","src/gates/AllGates.js")).BlochSphereDisplay,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ComparisonGates.js","src/gates/AllGates.js")).ComparisonGates,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Controls.js","src/gates/AllGates.js")).Controls,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/CountingGates.js","src/gates/AllGates.js")).CountingGates,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/CycleBitsGates.js","src/gates/AllGates.js")).CycleBitsGates,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/DensityMatrixDisplay.js","src/gates/AllGates.js")).DensityMatrixDisplayFamily,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Debug_ErrorInjectionGate.js","src/gates/AllGates.js")).ErrorInjectionGate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ExponentiatingGates.js","src/gates/AllGates.js")).ExponentiatingGates,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/FourierTransformGates.js","src/gates/AllGates.js")).FourierTransformGates,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/HalfTurnGates.js","src/gates/AllGates.js")).HalfTurnGates,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_ImaginaryGate.js","src/gates/AllGates.js")),h=f.ImaginaryGate,g=f.AntiImaginaryGate,p=f.SqrtImaginaryGate,v=f.AntiSqrtImaginaryGate,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/IncrementGates.js","src/gates/AllGates.js")).IncrementGates,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/InputGates.js","src/gates/AllGates.js")).InputGates,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/InterleaveBitsGates.js","src/gates/AllGates.js")).InterleaveBitsGates,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/MeasurementGate.js","src/gates/AllGates.js")).MeasurementGate,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ModularIncrementGates.js","src/gates/AllGates.js")).ModularIncrementGates,_=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ModularAdditionGates.js","src/gates/AllGates.js")).ModularAdditionGates,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ModularMultiplicationGates.js","src/gates/AllGates.js")).ModularMultiplicationGates,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ModularMultiplyAccumulateGates.js","src/gates/AllGates.js")).ModularMultiplyAccumulateGates,T=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/MultiplicationGates.js","src/gates/AllGates.js")).MultiplicationGates,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/MultiplyAccumulateGates.js","src/gates/AllGates.js")).MultiplyAccumulateGates,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_NeGate.js","src/gates/AllGates.js")).NeGate,E=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ParametrizedRotationGates.js","src/gates/AllGates.js")).ParametrizedRotationGates,I=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/PhaseGradientGates.js","src/gates/AllGates.js")).PhaseGradientGates,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/PivotFlipGates.js","src/gates/AllGates.js")).PivotFlipGates,$=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/PostSelectionGates.js","src/gates/AllGates.js")).PostSelectionGates,P=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/PoweringGates.js","src/gates/AllGates.js")).PoweringGates,G=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ProbabilityDisplay.js","src/gates/AllGates.js")).ProbabilityDisplayFamily,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/QuarterTurnGates.js","src/gates/AllGates.js")).QuarterTurnGates,N=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ReverseBitsGate.js","src/gates/AllGates.js")).ReverseBitsGateFamily,D=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/SampleDisplay.js","src/gates/AllGates.js")).SampleDisplayFamily,F=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Detector.js","src/gates/AllGates.js")).Detectors,O=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/SpacerGate.js","src/gates/AllGates.js")).SpacerGate,z=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/SwapGateHalf.js","src/gates/AllGates.js")).SwapGateHalf,B=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Impossible_UniversalNotGate.js","src/gates/AllGates.js")).UniversalNotGate,L=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/VariousXGates.js","src/gates/AllGates.js")).VariousXGates,U=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/VariousYGates.js","src/gates/AllGates.js")).VariousYGates,W=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/VariousZGates.js","src/gates/AllGates.js")).VariousZGates,H=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/XorGates.js","src/gates/AllGates.js")).XorGates,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_ZeroGate.js","src/gates/AllGates.js")).ZeroGate,X=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/gates/AllGates.js")).seq,Y={};Y.Special={Measurement:w,SwapHalf:z},Y.Displays={AmplitudeDisplayFamily:t,ProbabilityDisplayFamily:G,SampleDisplayFamily:D,DensityMatrixDisplayFamily:s,BlochSphereDisplay:n},Y.Arithmetic=e,Y.BitCountGates=r,Y.ComparisonGates=i,Y.Controls=a,Y.CountingGates=o,Y.CycleBitsGates=u,Y.Displays.DensityMatrixDisplay=s.ofSize(1),Y.Displays.DensityMatrixDisplay2=s.ofSize(2),Y.Displays.ChanceDisplay=Y.Displays.ProbabilityDisplayFamily.ofSize(1),Y.ErrorInjection=l,Y.Exponentiating=c,Y.FourierTransformGates=d,Y.HalfTurns=m,Y.ImaginaryGate=h,Y.AntiImaginaryGate=g,Y.SqrtImaginaryGate=p,Y.AntiSqrtImaginaryGate=v,Y.IncrementGates=y,Y.InputGates=b,Y.InterleaveBitsGates=R,Y.ModularIncrementGates=M,Y.ModularAdditionGates=_,Y.ModularMultiplicationGates=x,Y.ModularMultiplyAccumulateGates=S,Y.MultiplicationGates=T,Y.MultiplyAccumulateGates=A,Y.NeGate=C,Y.OtherX=L,Y.OtherY=U,Y.OtherZ=W,Y.ParametrizedRotationGates=E,Y.PhaseGradientGates=I,Y.PivotFlipGates=j,Y.PostSelectionGates=$,Y.Powering=P,Y.QuarterTurns=k,Y.ReverseBitsGateFamily=N,Y.Detectors=F,Y.SpacerGate=O,Y.UniversalNot=B,Y.XorGates=H,Y.ZeroGate=q,Y.KnownToSerializer=$traceurRuntime.spread(a.all,b.all,[w,z,O,B,l,q,C,h,g,p,v],t.all,G.all,D.all,s.all,[n],e.all,r.all,i.all,o.all,u.all,F.all,c.all,d.all,m.all,y.all,R.all,_.all,M.all,x.all,S.all,T.all,A.all,k.all,E.all,I.all,j.all,$.all,P.all,N.all,L.all,U.all,W.all,H.all);var K=X(Y.KnownToSerializer).keyedBy(function(e){return e.serializedId});Y.findKnownGateById=function(e,t){return K.has(e)?K.get(e):t.findGateWithSerializedId(e)},Y.TopToolboxGroups=[{hint:"Probes",gates:[w,void 0,$.PostSelectOff,$.PostSelectOn,a.AntiControl,a.Control]},{hint:"Displays",gates:[void 0,void 0,s.ofSize(1),n,G.ofSize(1),t.ofSize(2)]},{hint:"Half Turns",gates:[m.Z,z,m.Y,void 0,m.X,m.H]},{hint:"Quarter Turns",gates:[k.SqrtZForward,k.SqrtZBackward,k.SqrtYForward,k.SqrtYBackward,k.SqrtXForward,k.SqrtXBackward]},{hint:"Eighth Turns",gates:[W.Z4,W.Z4i,U.Y4,U.Y4i,L.X4,L.X4i]},{hint:"Spinning",gates:[P.ZForward,P.ZBackward,P.YForward,P.YBackward,P.XForward,P.XBackward]},{hint:"Formulaic",gates:[E.FormulaicRotationZ,E.FormulaicRotationRz,E.FormulaicRotationY,E.FormulaicRotationRy,E.FormulaicRotationX,E.FormulaicRotationRx]},{hint:"Parametrized",gates:[E.ZToA,E.ZToMinusA,E.YToA,E.YToMinusA,E.XToA,E.XToMinusA]},{hint:"Sampling",gates:[F.ZDetector,F.ZDetectControlClear,F.YDetector,F.YDetectControlClear,F.XDetector,F.XDetectControlClear]},{hint:"Parity",gates:[a.ZParityControl,void 0,a.YParityControl,void 0,a.XParityControl,void 0]}],Y.BottomToolboxGroups=[{hint:"X/Y Probes",gates:[a.XAntiControl,a.XControl,a.YAntiControl,a.YControl,$.PostSelectAntiX,$.PostSelectX,$.PostSelectAntiY,$.PostSelectY]},{hint:"Order",gates:[o.CountingFamily.ofSize(3),o.UncountingFamily.ofSize(3),N.ofSize(2),void 0,u.CycleBitsFamily.ofSize(3),u.ReverseCycleBitsFamily.ofSize(3),R.InterleaveBitsGateFamily.ofSize(6),R.DeinterleaveBitsGateFamily.ofSize(6)]},{hint:"Frequency",gates:[d.FourierTransformFamily.ofSize(2),d.InverseFourierTransformFamily.ofSize(2),void 0,void 0,I.PhaseGradientFamily.ofSize(2),I.PhaseDegradientFamily.ofSize(2),I.DynamicPhaseGradientFamily.ofSize(2),I.DynamicPhaseDegradientFamily.ofSize(2)]},{hint:"Inputs",gates:[b.InputAFamily.ofSize(2),b.SetA,b.InputBFamily.ofSize(2),b.SetB,b.InputRFamily.ofSize(2),b.SetR,void 0,void 0]},{hint:"Arithmetic",gates:[y.IncrementFamily.ofSize(2),y.DecrementFamily.ofSize(2),e.PlusAFamily.ofSize(2),e.MinusAFamily.ofSize(2),A.MultiplyAddInputsFamily.ofSize(2),A.MultiplySubtractInputsFamily.ofSize(2),T.TimesAFamily.ofSize(2),T.TimesAInverseFamily.ofSize(2)]},{hint:"Compare",gates:[i.ALessThanB,i.AGreaterThanB,i.ALessThanOrEqualToB,i.AGreaterThanOrEqualToB,i.AEqualToB,i.ANotEqualToB,void 0,void 0]},{hint:"Modular",gates:[M.IncrementModRFamily.ofSize(2),M.DecrementModRFamily.ofSize(2),_.PlusAModRFamily.ofSize(2),_.MinusAModRFamily.ofSize(2),x.TimesAModRFamily.ofSize(2),x.TimesAModRInverseFamily.ofSize(2),x.TimesBToTheAModRFamily.ofSize(2),x.TimesInverseBToTheAModRFamily.ofSize(2)]},{hint:"Scalar",gates:[O,q,C,void 0,h,g,p,v]}];var V=new Map([[void 0,[]],["1",[Y.HalfTurns.X]],["+",[Y.HalfTurns.H]],["-",[Y.HalfTurns.H,Y.HalfTurns.Z]],["i",[Y.HalfTurns.H,Y.QuarterTurns.SqrtZForward]],["-i",[Y.HalfTurns.H,Y.QuarterTurns.SqrtZBackward]]]);return{get Gates(){return Y},get INITIAL_STATES_TO_GATES(){return V}}}),$traceurRuntime.registerModule("src/gates/AmplitudeDisplay.js",[],function(){"use strict";var v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/AmplitudeDisplay.js")).Config,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/gates/AmplitudeDisplay.js")).CircuitShaders,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/AmplitudeDisplay.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/AmplitudeDisplay.js")).GatePainting,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/gates/AmplitudeDisplay.js")).GateShaders,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/gates/AmplitudeDisplay.js")).Format,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/AmplitudeDisplay.js")).MathPainter,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/AmplitudeDisplay.js")),P=r.Matrix,o=r.complexVectorToReadableJson,u=r.realVectorToReadableJson,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ProbabilityDisplay.js","src/gates/AmplitudeDisplay.js")).probabilityStatTexture,_=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/AmplitudeDisplay.js")).Point,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/AmplitudeDisplay.js")).Util,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/gates/AmplitudeDisplay.js")).Shaders,n=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/AmplitudeDisplay.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/gates/AmplitudeDisplay.js"))),i=n.Inputs,a=n.Outputs,T=n.currentShaderCoder,s=n.makePseudoShaderWithInputsAndOutputAndCode,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/gates/AmplitudeDisplay.js")).WglTexturePool,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/gates/AmplitudeDisplay.js")).WglTextureTrader;function l(e,t,r,n,i){var a=M(e,r,n,i),o=new C(e);o.dontDeallocCurrentTexture();var u=T().vec2.arrayPowerSizeOfTexture(e),s=x.numberOfSetBits(t.inclusionMask),l=x.numberOfSetBits(t.inclusionMask&(1<<n)-1),c=u-s,d=c-i;o.shadeAndTrade(function(e){return b.controlSelect(t,e)},A.takeVec2Tex(c)),o.shadeAndTrade(function(e){return R.cycleAllBits(e,l-n)});var m=o.dontDeallocCurrentTexture();o.shadeAndTrade(E,A.takeVecFloatTex(c));for(var f=0;f<i;f++)o.shadeHalveAndTrade(S.sumFoldFloatAdjacents);o.shadeAndTrade(I,A.takeVec2Tex(d));for(var h=0;h<d;h++)o.shadeHalveAndTrade(j);o.shadeAndTrade(function(e){return $(m,e)},A.takeVec2Tex(i));var g=o.dontDeallocCurrentTexture();o.shadeAndTrade(function(e){return G(e,m)},A.takeVec2Tex(c)),m.deallocByDepositingInPool("ketJustAfterCycle in makeAmplitudeSpanPipeline");for(var p=0;p<i;p++)o.shadeHalveAndTrade(S.sumFoldVec2Adjacents);o.shadeAndTrade(E,A.takeVecFloatTex(d));for(var v=0;v<d;v++)o.shadeHalveAndTrade(S.sumFoldFloat);T().float.needRearrangingToBeInVec4Format&&o.shadeHalveAndTrade(S.packFloatIntoVec4);var y=o.currentTexture;return o.currentTexture=g,T().vec2.needRearrangingToBeInVec4Format&&o.shadeHalveAndTrade(S.packVec2IntoVec4),[o.currentTexture,y,a]}function c(e,t,r){var n,i,a=(i=(n=t[Symbol.iterator]()).next()).done?void 0:i.value,o=(i=n.next()).done?void 0:i.value,u=(i=n.next()).done?void 0:i.value,s=o[0],l=1<<e,c=2==l?2:1<<Math.floor(Math.round(Math.log2(l))/2),d=l/c,m=0,f=!0,h=!1,g=void 0;try{for(var p,v=a[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var y=p.value;m+=y*y}}catch(e){h=!0,g=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw g}}for(var b=new Float32Array(c*d*2),R=0,w=0;w<l;w++)R+=u[w];for(var M=0;M<l;M++)b[M<<1]=Math.sqrt(u[M]/R);if(isNaN(R)||R<1e-6)return{quality:0,ket:P.zero(c,d).times(NaN),phaseLockIndex:0,incoherentKet:P.zero(c,d).times(NaN)};for(var _=s/m/R,x=e===r.numWires?void 0:function(e){for(var t=0,r=0,n=0;n<e.length;n+=2){var i=e[n],a=e[n+1],o=i*i+a*a;1e4*r<o&&(r=o,t=n>>1)}return t}(a),S=void 0===x?0:Math.atan2(a[2*x+1],a[2*x]),T=Math.cos(S),A=-Math.sin(S),C=new Float32Array(2*l),E=Math.sqrt(m),I=0;I<l;I++){var j=a[2*I]/E,$=a[2*I+1]/E;C[2*I]=j*T+$*-A,C[2*I+1]=j*A+$*T}return{quality:_,ket:new P(c,d,C),phaseLockIndex:x,incoherentKet:new P(c,d,b)}}var E=s([i.vec2("input")],a.float(),"float outputFor(float k) {\n        vec2 ri = read_input(k);\n        return dot(ri, ri);\n    }"),I=s([i.float("input")],a.vec2(),"vec2 outputFor(float k) {\n        return vec2(float(k), read_input(k));\n    }"),j=s([i.vec2("input")],a.vec2(),"vec2 outputFor(float k) {\n        vec2 a = read_input(k);\n        vec2 b = read_input(k + len_output());\n        return a.y >= b.y ? a : b;\n    }"),$=s([i.vec2("input"),i.vec2("indexed_mag")],a.vec2(),"vec2 outputFor(float k) {\n        return read_input(k + read_indexed_mag(0.0).x * len_output());\n    }"),G=s([i.vec2("small_input"),i.vec2("large_input")],a.vec2(),"\n    vec2 cmul_conj(vec2 c1, vec2 c2) {\n        return mat2(c1.x, -c1.y, c1.y, c1.x) * c2;\n    }\n    vec2 outputFor(float k) {\n        vec2 in1 = read_small_input(floor(mod(k + 0.5, len_small_input())));\n        vec2 in2 = read_large_input(k);\n        return cmul_conj(in1, in2);\n    }\n    "),d=t.makeDisplayDrawer(function(r){var e=r.gate.height,t=r.customStats||{ket:(1===e?P.zero(2,1):P.zero(1<<Math.floor(e/2),1<<Math.ceil(e/2))).times(NaN),quality:1,phaseLockIndex:0,incoherentKet:void 0},n=t.quality,i=t.ket,a=t.phaseLockIndex,o=n<.99,u=o?t.incoherentKet:i,s=r.rect.w-r.rect.h*i.width()/i.height(),l=r.rect.skipLeft(s/2).skipRight(s/2),c=Math.min(1,Math.max(0,(n-.9999)/1e-4));w.paintMatrix(r.painter,u,l,v.SUPERPOSITION_MID_COLOR,"black",v.SUPERPOSITION_FORE_COLOR,v.SUPERPOSITION_BACK_COLOR,"rgba(0, 0, 0, "+c+")");var d,m,f,h,g,p;o?w.paintMatrixTooltip(r.painter,u,l,r.focusPoints,function(e,t){return"Chance of |"+x.bin(t*u.width()+e,r.gate.height)+"⟩ (decimal "+(t*u.width()+e)+") [amplitude not defined]"},function(e,t,r){return"raw: "+(100*r.norm2()).toFixed(4)+"%, log: "+(10*Math.log10(r.norm2())).toFixed(1)+" dB"},function(e,t,r){return"[entangled with other qubits]"}):(w.paintMatrixTooltip(r.painter,u,l,r.focusPoints,function(e,t){return"Amplitude of |"+x.bin(t*u.width()+e,r.gate.height)+"⟩ (decimal "+(t*u.width()+e)+")"},function(e,t,r){return"val:"+r.toString(new y(!1,0,5,", "))},function(e,t,r){return"mag²:"+(100*r.norm2()).toFixed(4)+"%, phase:"+((0<=(n=180*r.phase()/Math.PI)?"+":"")+n.toFixed(2))+"°";var n}),void 0!==a&&(d=l.w/u.width(),m=l.h/u.height(),f=a%u.width(),h=Math.floor(a/u.width()),g=l.x+d*(.5+f),p=l.y+m*(h+.5),r.painter.strokeLine(new _(g,p),new _(g+d/2,p),"rgba(255,0,0,"+c+")",2),r.painter.print("fixed",g+.5*d,p,"right","bottom","rgba(255,0,0,"+c+")","12px monospace",.5*d,.5*m))),function(e,t){var r=void 0,n=e.positionInCircuit,i=n.col,a=n.row;0!=(e.stats.circuitDefinition.colIsMeasuredMask(i)>>a&(1<<e.gate.height)-1)?(t=0,r=e.gate.width<=2?"(w/ measure defer)":"(assuming measurement deferred)"):t<.999&&(r="incoherent");void 0!==r&&e.painter.print(r,e.rect.x+e.rect.w/2,e.rect.y+e.rect.h,"center","hanging","rgba(255,0,0,"+(1-t)+")","12px sans-serif",e.rect.w,e.rect.h,void 0)}(r,c)});function m(e){var t=e.quality,r=e.ket,n=e.phaseLockIndex,i=e.incoherentKet,a=r.width()*r.height();return{coherence_measure:t,superposition_phase_locked_state_index:void 0===n?null:n,ket:o(new P(1,a,r.rawBuffer()).getColumn(0)),incoherentKet:u(new P(1,a,i.rawBuffer()).getColumn(0))}}var f=e.buildFamily(1,16,function(r,e){return e.setSerializedId("Amps"+r).setSymbol("Amps").setTitle("Amplitude Display").setBlurb("Shows the amplitudes of some wires, if separable.\nUse controls to see conditional amplitudes.").setWidth(1===r?2:r%2==0?r:Math.ceil(r/2)).promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0}).setStatTexturesMaker(function(e){return l(e.stateTrader.currentTexture,e.controls,e.controlsTexture,e.row,r)}).setStatPixelDataPostProcessor(function(e,t){return c(r,e,t)}).setProcessedStatsToJsonFunc(m).setDrawer(d)});return{get AmplitudeDisplayFamily(){return f},get AMPS_TO_SQUARED_MAGS_SHADER(){return E},get MAGS_TO_INDEXED_MAGS_SHADER(){return I},get FOLD_MAX_INDEXED_MAG_SHADER(){return j},get LOOKUP_KET_AT_INDEXED_MAG_SHADER(){return $},get POINTWISE_CMUL_CONJ_SHADER(){return G},get amplitudeDisplayStatTextures(){return l}}}),$traceurRuntime.registerModule("src/gates/ArithmeticGates.js",[],function(){"use strict";function r(a,o){return function(e){var t=Math.floor(a/2),r=Math.ceil(a/2),n=e&(1<<t)-1,i=e>>t;return i+=n*o,n+((i&=(1<<r)-1)<<t)}}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ArithmeticGates.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/ArithmeticGates.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ArithmeticGates.js")),i=t.ketArgs,a=t.ketShaderPermute,o=t.ketInputGateShaderCode,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/ArithmeticGates.js")).WglArg,s={},l=a("\n        uniform float factor;\n        "+o("A")+"\n    ","\n        float d = read_input_A();\n        d *= factor;\n        d = mod(d, span);\n        return mod(out_id + span - d, span);");return s.Legacy_AdditionFamily=e.buildFamily(2,16,function(t,e){return e.setSerializedId("add"+t).setSymbol("b+=a").setTitle("Addition Gate").setBlurb("Adds a little-endian number into another.").setDrawer(n.SECTIONED_DRAWER_MAKER(["a","b+=a"],[Math.floor(t/2)/t])).setActualEffectToUpdateFunc(function(e){return s.PlusAFamily.ofSize(Math.ceil(t/2)).customOperation(e.withRow(e.row+Math.floor(t/2)).withInputSetToRange("A",e.row,Math.floor(t/2)))}).setKnownEffectToPermutation(r(t,1))}),s.Legacy_SubtractionFamily=e.buildFamily(2,16,function(t,e){return e.setAlternateFromFamily(s.Legacy_AdditionFamily).setSerializedId("sub"+t).setSymbol("b-=a").setTitle("Subtraction Gate").setBlurb("Subtracts a little-endian number from another.").setDrawer(n.SECTIONED_DRAWER_MAKER(["a","b-=a"],[Math.floor(t/2)/t])).setActualEffectToUpdateFunc(function(e){return s.MinusAFamily.ofSize(Math.ceil(t/2)).customOperation(e.withRow(e.row+Math.floor(t/2)).withInputSetToRange("A",e.row,Math.floor(t/2)))}).setKnownEffectToPermutation(r(t,-1))}),s.PlusAFamily=e.buildFamily(1,16,function(r,e){return e.setSerializedId("+=A"+r).setSymbol("+A").setTitle("Addition Gate [input A]").setBlurb("Adds input A into the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(i(e,r,["A"]),[u.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e+t&(1<<r)-1})}),s.MinusAFamily=e.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(s.PlusAFamily).setSerializedId("-=A"+r).setSymbol("−A").setTitle("Subtraction Gate [input A]").setBlurb("Subtracts input A out of the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(i(e,r,["A"]),[u.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e-t&(1<<r)-1})}),s.all=$traceurRuntime.spread(s.Legacy_AdditionFamily.all,s.Legacy_SubtractionFamily.all,s.PlusAFamily.all,s.MinusAFamily.all),{get ArithmeticGates(){return s}}}),$traceurRuntime.registerModule("src/gates/BitCountGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/BitCountGates.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/BitCountGates.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/BitCountGates.js")),n=r.ketArgs,i=r.ketShaderPermute,a=r.ketInputGateShaderCode,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/BitCountGates.js")).Util,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/BitCountGates.js")).WglArg,s={},l=i("\n        uniform float factor;\n        "+a("A")+"\n    ","\n        float d = read_input_A();\n        float popcnt = 0.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            popcnt += mod(d, 2.0);\n            d = floor(d / 2.0);\n        }\n        float offset = mod(popcnt * factor, span);\n        return mod(out_id + span - offset, span);");return s.PlusBitCountAFamily=t.buildFamily(1,16,function(r,e){return e.setSerializedIdAndSymbol("+cntA"+r).setSymbol("+1s(A)").setTitle("Bit Count Gate").setBlurb("Counts the number of ON bits in input A and adds that into this output.").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(n(e,r,["A"]),[u.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e+o.numberOfSetBits(t)&(1<<r)-1})}),s.MinusBitCountAFamily=t.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(s.PlusBitCountAFamily).setSerializedIdAndSymbol("-cntA"+r).setSymbol("-1s(A)").setTitle("Bit Un-Count Gate").setBlurb("Counts the number of ON bits in input A and subtracts that into this output.").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(n(e,r,["A"]),[u.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e-o.numberOfSetBits(t)&(1<<r)-1})}),s.all=$traceurRuntime.spread(s.PlusBitCountAFamily.all,s.MinusBitCountAFamily.all),{get BitCountGates(){return s}}}),$traceurRuntime.registerModule("src/gates/BlochSphereDisplay.js",[],function(){"use strict";var X=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/BlochSphereDisplay.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/BlochSphereDisplay.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/BlochSphereDisplay.js")).GatePainting,Y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/BlochSphereDisplay.js")).MathPainter,K=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/BlochSphereDisplay.js")).Point;function a(e,t,r){var n,i,a,o,u=void 0!==arguments[3]?arguments[3]:[],s=void 0!==arguments[4]?arguments[4]:X.DISPLAY_GATE_BACK_COLOR,l=void 0!==arguments[5]?arguments[5]:X.DISPLAY_GATE_FORE_COLOR,c=r.center(),d=Math.min(r.w,r.h)/2,m=Y.coordinateSystem(d),f=m.dx,h=m.dy,g=m.dz;e.fillCircle(c,d,s),e.trace(function(e){e.circle(c.x,c.y,d),e.ellipse(c.x,c.y,h.x,f.y),e.ellipse(c.x,c.y,f.x,g.y);var t=!0,r=!1,n=void 0;try{for(var i,a=[f,h,g][Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.line(c.x-o.x,c.y-o.y,c.x+o.x,c.y+o.y)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}).thenStroke("#BBB");var p,v,y,b,R,w,M,_,x,S,T,A,C,E,I,j,$,P,G,k,N,D,F,O,z,B,L,U,W=(i=(n=[NaN,NaN,NaN][Symbol.iterator]()).next()).done?void 0:i.value,H=(i=n.next()).done?void 0:i.value,q=(i=n.next()).done?void 0:i.value;t.hasNaN()?e.printParagraph("NaN",r,new K(.5,.5),"red"):(W=(o=(a=t.qubitDensityMatrixToBlochVector()[Symbol.iterator]()).next()).done?void 0:o.value,H=(o=a.next()).done?void 0:o.value,q=(o=a.next()).done?void 0:o.value,p=e,v=W,y=H,b=q,w=l,M=(R=r).center(),_=Math.min(R.w,R.h)/2,x=Y.coordinateSystem(_),S=x.dx,T=x.dy,A=x.dz,C=M.plus(S.times(v)).plus(T.times(y)).plus(A.times(b)),E=3.8/(1+v/6),p.strokeLine(M,C,"black",1.5),p.fillCircle(C,E,w),p.ctx.save(),p.ctx.globalAlpha*=Math.min(1,Math.max(0,1-v*v-y*y-b*b)),p.fillCircle(C,E,"yellow"),p.ctx.restore(),p.strokeCircle(C,E,"black"),p.ctx.save(),p.ctx.globalAlpha*=Math.min(1,Math.max(0,.5+5*v)),p.strokeLine(M,C,"black",2),p.ctx.restore()),I=e,$=W,P=H,G=q,k=u,L=(j=r).center(),U=Math.min(j.w,j.h)/2,k.every(function(e){return e.distanceTo(L)>=U})||(N=2*Math.PI,D=function(e){return(0<=e?"+":"")+(360*e/N).toFixed(2)+"°"},F=function(e){return(0<=e?"+":"")+e.toFixed(4)},O=Math.sqrt($*$+P*P+G*G),z=Math.atan2(P,-$),B=Math.max(0,Math.PI/2-Math.atan2(-G,Math.sqrt(P*P+$*$))),I.strokeCircle(L,U,"orange",2),Y.paintDeferredValueTooltip(I,L.x+U*Math.sqrt(.5),L.y-U*Math.sqrt(.5),"Bloch sphere representation of local state","r:"+F(O)+", ϕ:"+D(z)+", θ:"+D(B),"x:"+F(-$)+", y:"+F(P)+", z:"+F(-G)))}var r=(new e).setSerializedIdAndSymbol("Bloch").setTitle("Bloch Sphere Display").setBlurb("Shows a wire's local state as a point on the Bloch Sphere.\nUse controls to see conditional states.").markAsDrawerNeedsSingleQubitDensityStats().setDrawer(t.makeDisplayDrawer(function(e){var t=e.positionInCircuit,r=t.row,n=t.col,i=e.stats.qubitDensityMatrix(n,r);a(e.painter,i,e.rect,e.focusPoints)})).promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0}).gate;return{get paintBlochSphereDisplay(){return a},get BlochSphereDisplay(){return r}}}),$traceurRuntime.registerModule("src/gates/ComparisonGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ComparisonGates.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ComparisonGates.js")),r=t.ketArgs,n=t.ketShaderPermute,i=t.ketInputGateShaderCode,a=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/ComparisonGates.js")).WglConfiguredShader,{});function o(e){var t=n("\n            "+i("A")+"\n            "+i("B")+"\n        ","\n            float lhs = read_input_A();\n            float rhs = read_input_B();\n            return mod(out_id + (("+e+") ? 1.0 : 0.0), 2.0);");return function(e){return t.withArgs.apply(t,$traceurRuntime.spread(r(e,1,["A","B"])))}}return a.ALessThanB=(new e).setSerializedId("^A<B").setSymbol("⊕A<B").setTitle("Less-Than Gate").setBlurb("Toggles a qubit if input A is less than input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs < rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(t<r?1:0)}).gate,a.ALessThanOrEqualToB=(new e).setSerializedId("^A<=B").setSymbol("⊕A≤B").setTitle("At-Most Gate").setBlurb("Toggles a qubit if input A is at most input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs <= rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(t<=r?1:0)}).gate,a.AGreaterThanB=(new e).setAlternate(a.ALessThanOrEqualToB).setSerializedId("^A>B").setSymbol("⊕A>B").setTitle("Greater-Than Gate").setBlurb("Toggles a qubit if input A is greater than input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs > rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(r<t?1:0)}).gate,a.AGreaterThanOrEqualToB=(new e).setAlternate(a.ALessThanB).setSerializedId("^A>=B").setSymbol("⊕A≥B").setTitle("At-Least Gate").setBlurb("Toggles a qubit if input A is at least input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs >= rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(r<=t?1:0)}).gate,a.AEqualToB=(new e).setSerializedId("^A=B").setSymbol("⊕A=B").setTitle("Equality Gate").setBlurb("Toggles a qubit if input A is equal to input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs == rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(t===r?1:0)}).gate,a.ANotEqualToB=(new e).setAlternate(a.AEqualToB).setSerializedId("^A!=B").setSymbol("⊕A≠B").setTitle("Inequality Gate").setBlurb("Toggles a qubit if input A isn't equal to input B.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(o("lhs != rhs")).setKnownEffectToParametrizedPermutation(function(e,t,r){return e^(t!==r?1:0)}).gate,a.all=[a.ALessThanB,a.AGreaterThanB,a.AEqualToB,a.ANotEqualToB,a.ALessThanOrEqualToB,a.AGreaterThanOrEqualToB],{get ComparisonGates(){return a}}}),$traceurRuntime.registerModule("src/gates/Controls.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Controls.js")).GateBuilder,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Controls.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/gates/Controls.js")).GateShaders,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/HalfTurnGates.js","src/gates/Controls.js")).HalfTurnGates,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/QuarterTurnGates.js","src/gates/Controls.js")).QuarterTurnGates,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/Controls.js")).Config,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/Controls.js")),u=o.ketArgs,s=o.ketShaderPermute,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/Controls.js")).WglArg,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/Controls.js")).Util,d={};d.Control=(new e).setSerializedIdAndSymbol("•").setTitle("Control").setBlurb("Conditions on a qubit being ON.\nGates in the same column only apply to states meeting the condition.").promiseHasNoNetEffectOnStateVector().markAsControlExpecting(!0).promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e)),e.painter.fillCircle(e.rect.center(),5,"black")}).gate,d.AntiControl=(new e).setAlternate(d.Control).setSerializedIdAndSymbol("◦").setTitle("Anti-Control").setBlurb("Conditions on a qubit being OFF.\nGates in the same column only apply to states meeting the condition.").promiseHasNoNetEffectOnStateVector().markAsControlExpecting(!1).promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center();e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5)}).gate,d.XAntiControl=(new e).setSerializedId("⊕").setSymbol("⊖").setTitle("X-Axis Anti-Control").setBlurb("Conditions on a qubit being ON+OFF.\nGates in the same column only apply to states meeting the condition.").markAsControlExpecting(!1).setSetupCleanupEffectToUpdateFunc(r.H.customOperation,r.H.customOperation).setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center();e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5),e.painter.strokeLine(t.offsetBy(-5,0),t.offsetBy(5,0))}).gate,d.XControl=(new e).setAlternate(d.XAntiControl).setSerializedId("⊖").setSymbol("⊕").setTitle("X-Axis Control").setBlurb("Conditions on a qubit being ON-OFF.\nGates in the same column only apply to states meeting the condition.").markAsControlExpecting(!0).setSetupCleanupEffectToUpdateFunc(r.H.customOperation,r.H.customOperation).setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center();e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5),e.painter.strokeLine(t.offsetBy(0,-5),t.offsetBy(0,5)),e.painter.strokeLine(t.offsetBy(-5,0),t.offsetBy(5,0))}).gate,d.YAntiControl=(new e).setSerializedId("⊗").setSymbol("(/)").setTitle("Y-Axis Anti-Control").setBlurb("Conditions on a qubit being ON+iOFF.\nGates in the same column only apply to states meeting the condition.").markAsControlExpecting(!1).setSetupCleanupEffectToUpdateFunc(function(e){return t.applyMatrixOperation(e,i.SqrtXForward._knownMatrix)},function(e){return t.applyMatrixOperation(e,i.SqrtXBackward._knownMatrix)}).setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center();e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5);var r=5*Math.sqrt(.5)*1.1;e.painter.strokeLine(t.offsetBy(+r,-r),t.offsetBy(-r,+r)),(e.isInToolbox||e.isHighlighted)&&n.paintOutline(e)}).gate,d.YControl=(new e).setAlternate(d.YAntiControl).setSerializedId("(/)").setSymbol("⊗").setTitle("Y-Axis Control").setBlurb("Conditions on a qubit being ON-iOFF.\nGates in the same column only apply to states meeting the condition.").markAsControlExpecting(!0).setSetupCleanupEffectToUpdateFunc(function(e){return t.applyMatrixOperation(e,i.SqrtXForward._knownMatrix)},function(e){return t.applyMatrixOperation(e,i.SqrtXBackward._knownMatrix)}).setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().setDrawer(function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.center();e.painter.fillCircle(t,5),e.painter.strokeCircle(t,5);var r=5*Math.sqrt(.5);e.painter.strokeLine(t.offsetBy(+r,+r),t.offsetBy(-r,-r)),e.painter.strokeLine(t.offsetBy(+r,-r),t.offsetBy(-r,+r)),(e.isInToolbox||e.isHighlighted)&&n.paintOutline(e)}).gate;var m=s("\n        uniform float parityMask;\n    ","\n        float bitPos = 1.0;\n        float result = 0.5;\n        for (int i = 0; i < "+a.MAX_WIRE_COUNT+"; i++) {\n            float maskBit = mod(floor(parityMask/bitPos), 2.0);\n            float posBit = mod(floor(full_out_id/bitPos), 2.0);\n            float flip = maskBit * posBit;\n            result += flip;\n            bitPos *= 2.0;\n        }\n        return mod(result, 2.0) - 0.5;",1);function f(e,t){var r=e.rawControls,n=2<<e.row>r.parityMask,i=1<<e.row==(r.parityMask&~(r.parityMask-1));(t?n:i)&&e.applyOperation(m.withArgs.apply(m,$traceurRuntime.spread(u(e.withRow(c.ceilLg2(r.parityMask&r.inclusionMask))),[l.float("parityMask",r.parityMask)])))}function h(r){return function(e){(e.isInToolbox||e.isHighlighted)&&(n.paintBackground(e),n.paintOutline(e));var t=e.rect.paddedBy(-10);e.painter.fillRect(t),e.painter.strokeRect(t),e.painter.fillRect(t.paddedBy(-4).skipBottom(-6).skipTop(-6)),e.painter.printLine(r,t,.5,void 0,void 0,void 0,0),e.painter.printLine("par",t,.5,"red",10,void 0,1)}}return d.XParityControl=(new e).setSerializedIdAndSymbol("xpar").setTitle("Parity Control (X)").setBlurb("Includes a qubit's X observable in the column parity control.\nGates in the same column only apply if an odd number of parity controls are satisfied.").setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().markAsControlExpecting("parity").setSetupCleanupEffectToUpdateFunc(function(e){r.H.customOperation(e),f(e,!0)},function(e){f(e,!1),r.H.customOperation(e)}).setDrawer(h("X")).gate,d.YParityControl=(new e).setSerializedIdAndSymbol("ypar").setTitle("Parity Control (Y)").setBlurb("Includes a qubit's Y observable in the column parity control.\nGates in the same column only apply if an odd number of parity controls are satisfied.").setActualEffectToUpdateFunc(function(){}).promiseEffectIsStable().promiseEffectIsUnitary().markAsControlExpecting("parity").setSetupCleanupEffectToUpdateFunc(function(e){t.applyMatrixOperation(e,i.SqrtXForward._knownMatrix),f(e,!0)},function(e){f(e,!1),t.applyMatrixOperation(e,i.SqrtXBackward._knownMatrix)}).setDrawer(h("Y")).gate,d.ZParityControl=(new e).setSerializedIdAndSymbol("zpar").setTitle("Parity Control (Z)").setBlurb("Includes a qubit's Z observable in the column parity control.\nGates in the same column only apply if an odd number of parity controls are satisfied.").promiseHasNoNetEffectOnStateVector().markAsControlExpecting("parity").setSetupCleanupEffectToUpdateFunc(function(e){return f(e,!0)},function(e){return f(e,!1)}).setActualEffectToUpdateFunc(function(){}).promiseEffectIsUnitary().setDrawer(h("Z")).gate,d.all=[d.Control,d.AntiControl,d.XAntiControl,d.XControl,d.YAntiControl,d.YControl,d.XParityControl,d.YParityControl,d.ZParityControl],{get Controls(){return d}}}),$traceurRuntime.registerModule("src/gates/CountingGates.js",[],function(){"use strict";function p(e){e=Math.min(128,e);for(var t=[],r=0;r<e;r++){var n=r/e,i=r/(e-1);e<128&&t.push(new b(n,i)),t.push(new b(n+1/e,i))}return t}function t(f,h){var g=void 0!==arguments[2]&&arguments[2];return function(e){var t,r;if(y.MAKE_HIGHLIGHTED_DRAWER(v.TIME_DEPENDENT_HIGHLIGHT_COLOR)(e),!e.isInToolbox||e.isHighlighted){var n=(e.stats.time+f)%1,i=e.rect.y+3,a=e.rect.bottom(),o=e.rect.bottom()-3;g||(t=[o,i][Symbol.iterator](),i=(r=t.next()).done?void 0:r.value,o=(r=t.next()).done?void 0:r.value,a=e.rect.y);var u=e.rect.x,s=e.rect.right(),l=function(e){return Math.min(Math.max(u+(s-u)*e,u),s)},c=function(e){return o+(i-o)*e},d=[];d.push(new b(u,a)),d.push.apply(d,$traceurRuntime.spread(p(h).map(function(e){return new b(l(e.x-n),c(e.y))}))),d.push.apply(d,$traceurRuntime.spread(p(h).map(function(e){return new b(l(e.x+1-n),c(e.y))}))),d.push(new b(s,a)),e.painter.ctx.save(),e.painter.ctx.globalAlpha*=.3,e.painter.fillPolygon(d,"yellow");for(var m=1;m<d.length-2;m++)e.painter.strokeLine(d[m],d[m+1],"black");2===h&&n<.5&&(e.painter.fillRect(e.rect,"white"),e.painter.fillRect(e.rect,"white"),e.painter.fillRect(e.rect,"white")),e.painter.ctx.restore()}}}var v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/CountingGates.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/CountingGates.js")),r=e.Gate,n=e.GateBuilder,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/CountingGates.js")).GatePainting,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/CountingGates.js")).Matrix,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/CountingGates.js")).Point,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/CountingGates.js")).ketArgs,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/CountingGates.js")).WglArg,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/IncrementGates.js","src/gates/CountingGates.js")).offsetShader,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/CycleBitsGates.js","src/gates/CountingGates.js")),l=s.makeCycleBitsPermutation,c=s.cycleBitsShader,d={};function m(e,t,r,n){return n+Math.floor(e*(1<<r))*t&(1<<r)-1}function f(e,t,r,n){var i=Math.floor(e*r)*t;return l(i,r)(n)}return d.ClockPulseGate=(new n).setSerializedIdAndSymbol("X^⌈t⌉").setTitle("Clock Pulse Gate").setBlurb("Xors a square wave into the target wire.").setDrawer(t(0,2)).setEffectToTimeVaryingMatrix(function(e){return e%1<.5?i.identity(2):i.PAULI_X}).promiseEffectOnlyPermutesAndPhases().gate,d.QuarterPhaseClockPulseGate=(new n).setSerializedIdAndSymbol("X^⌈t-¼⌉").setTitle("Clock Pulse Gate (Quarter Phase)").setBlurb("Xors a quarter-phased square wave into the target wire.").setDrawer(t(.75,2)).setEffectToTimeVaryingMatrix(function(e){return(e+.75)%1<.5?i.identity(2):i.PAULI_X}).promiseEffectOnlyPermutesAndPhases().gate,d.CountingFamily=r.buildFamily(1,16,function(r,e){return e.setSerializedId("Counting"+r).setSymbol("+⌈t⌉").setTitle("Counting Gate").setBlurb("Adds an increasing little-endian count into a block of qubits.").setDrawer(t(0,1<<r)).setActualEffectToShaderProvider(function(e){return u.withArgs.apply(u,$traceurRuntime.spread(a(e,r),[o.float("amount",Math.floor(e.time*(1<<r)))]))}).setKnownEffectToTimeVaryingPermutation(function(e,t){return m(e,1,r,t)})}),d.UncountingFamily=r.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(d.CountingFamily).setSerializedId("Uncounting"+r).setSymbol("-⌈t⌉").setTitle("Down Counting Gate").setBlurb("Subtracts an increasing little-endian count from a block of qubits.").setDrawer(t(0,1<<r,!0)).setActualEffectToShaderProvider(function(e){return u.withArgs.apply(u,$traceurRuntime.spread(a(e,r),[o.float("amount",-Math.floor(e.time*(1<<r)))]))}).setKnownEffectToTimeVaryingPermutation(function(e,t){return m(e,-1,r,t)})}),d.RightShiftRotatingFamily=r.buildFamily(2,16,function(r,e){return e.setSerializedId(">>t"+r).setSymbol("↟⌈t⌉").setTitle("Right-Shift Cycling Gate").setBlurb("Right-rotates a block of bits by more and more.").setDrawer(t(0,r,!0)).setActualEffectToShaderProvider(function(e){return c(e,r,-Math.floor(e.time*r))}).setKnownEffectToTimeVaryingPermutation(function(e,t){return f(e,-1,r,t)})}),d.LeftShiftRotatingFamily=r.buildFamily(2,16,function(r,e){return e.setSerializedId("<<t"+r).setSymbol("↡⌈t⌉").setTitle("Left-Shift Cycling Gate").setBlurb("Left-rotates a block of bits by more and more.").setDrawer(t(0,r)).setActualEffectToShaderProvider(function(e){return c(e,r,Math.floor(e.time*r))}).setKnownEffectToTimeVaryingPermutation(function(e,t){return f(e,1,r,t)})}),d.all=$traceurRuntime.spread([d.ClockPulseGate,d.QuarterPhaseClockPulseGate],d.CountingFamily.all,d.UncountingFamily.all,d.RightShiftRotatingFamily.all,d.LeftShiftRotatingFamily.all),{get CountingGates(){return d}}}),$traceurRuntime.registerModule("src/gates/CycleBitsGates.js",[],function(){"use strict";function r(e,t,r){return g.withArgs.apply(g,$traceurRuntime.spread(o(e,t),[f.float("amount",1<<m.properMod(-r,t))]))}function n(t,r){return function(e){return e<<(t=m.properMod(t,r))&(1<<r)-1|e>>r-t}}function i(e,t){return s.generateTransition(1<<t,n(e,t))}function a(s){return function(e){if(void 0===e.positionInCircuit){c.paintBackground(e),c.paintOutline(e),c.paintResizeTab(e);for(var t=e.rect.x+6,r=e.rect.right()-6,n=e.rect.center().y-l.GATE_RADIUS+6,i=2*(l.GATE_RADIUS-6)/2,a=0;a<3;a++){var o=n+a*i,u=n+(a+(s?2:1))%3*i;e.painter.strokePath([new d(t,o),new d(t+8,o),new d(r-8,u),new d(r,u)])}}else c.PERMUTATION_DRAWER(e)}}var l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/CycleBitsGates.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/CycleBitsGates.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/CycleBitsGates.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/CycleBitsGates.js")),o=t.ketArgs,u=t.ketShaderPermute,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/CycleBitsGates.js")).Matrix,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/CycleBitsGates.js")).Point,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/CycleBitsGates.js")).Util,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/CycleBitsGates.js")).WglArg,h=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/CycleBitsGates.js")).WglConfiguredShader,{}),g=u("uniform float amount;","out_id *= amount; return mod(out_id, span) + floor(out_id / span);");return h.CycleBitsFamily=e.buildFamily(2,16,function(t,e){return e.setSerializedId("<<"+t).setSymbol("<<<").setTitle("Left Rotate").setBlurb("Rotates bits downward.").setDrawer(a(!1)).setTooltipMatrixFunc(function(){return i(1,t)}).setActualEffectToShaderProvider(function(e){return r(e,t,1)}).setKnownEffectToBitPermutation(function(e){return(e+1)%t})}),h.ReverseCycleBitsFamily=e.buildFamily(2,16,function(t,e){return e.setAlternateFromFamily(h.CycleBitsFamily).setSerializedId(">>"+t).setSymbol(">>>").setTitle("Right Rotate").setBlurb("Rotates bits upward.").setDrawer(a(!0)).setTooltipMatrixFunc(function(){return i(-1,t)}).setActualEffectToShaderProvider(function(e){return r(e,t,-1)}).setKnownEffectToBitPermutation(function(e){return(e+t-1)%t})}),h.all=$traceurRuntime.spread(h.CycleBitsFamily.all,h.ReverseCycleBitsFamily.all),{get CycleBitsGates(){return h},get cycleBitsShader(){return r},get makeCycleBitsPermutation(){return n}}}),$traceurRuntime.registerModule("src/gates/Debug_ErrorInjectionGate.js",[],function(){"use strict";var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/gates/Debug_ErrorInjectionGate.js")).DetailedError,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Debug_ErrorInjectionGate.js")).GateBuilder,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Debug_ErrorInjectionGate.js")).GatePainting,n=(new e).setSerializedId("__error__").setSymbol("ERR!").setTitle("Error Injection Gate").setBlurb("Throws an exception during circuit stat computations, for testing error paths.").setDrawer(r.MAKE_HIGHLIGHTED_DRAWER("red","red")).setActualEffectToUpdateFunc(function(e){throw new t("Applied an Error Injection Gate",{qubit:e.row})}).promiseEffectIsStable().gate;return{get ErrorInjectionGate(){return n}}}),$traceurRuntime.registerModule("src/gates/DensityMatrixDisplay.js",[],function(){"use strict";var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/gates/DensityMatrixDisplay.js")).CircuitShaders,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/DensityMatrixDisplay.js")),t=e.Gate,r=(e.GateBuilder,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/DensityMatrixDisplay.js")).GatePainting),d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/gates/DensityMatrixDisplay.js")).GateShaders,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/DensityMatrixDisplay.js")).MathPainter,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/DensityMatrixDisplay.js")).Matrix,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/gates/DensityMatrixDisplay.js")).Shaders,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/DensityMatrixDisplay.js")).Util,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/DensityMatrixDisplay.js")).WglArg,i=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/DensityMatrixDisplay.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/gates/DensityMatrixDisplay.js"))),o=i.Inputs,u=i.Outputs,g=i.currentShaderCoder,s=i.makePseudoShaderWithInputsAndOutputAndCode,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/gates/DensityMatrixDisplay.js")).WglTexturePool,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/gates/DensityMatrixDisplay.js")).WglTextureTrader;var y=function(e,t){return l(e,n.float("qubitSpan",1<<t))},l=s([o.vec2("input")],u.vec2(),"\n    uniform float qubitSpan;\n\n    vec2 outputFor(float k) {\n        float k_ket = mod(k, qubitSpan);\n        float k_bra = mod(floor(k / qubitSpan), qubitSpan);\n        float k_rest = floor(k / qubitSpan / qubitSpan);\n        float offset = k_rest*qubitSpan;\n\n        vec2 ampKet = read_input(k_ket + offset);\n        vec2 ampBra = read_input(k_bra + offset);\n        float r = dot(ampKet, ampBra);\n        float i = dot(ampKet, vec2(-ampBra.y, ampBra.x));\n\n        return vec2(r, i);\n    }");function b(e,t,r,n){for(var i=e.length>>1,a=Math.round(Math.sqrt(i)),o=0,u=0;u<a;u++)o+=e[2*u*(a+1)];if(isNaN(o)||o<1e-6)return m.zero(a,a).times(NaN);for(var s=0;s<e.length;s++)e[s]/=o;var l=t.colIsMeasuredMask(r)>>n;return function(e,t){if(0===t)return e;for(var r=new Float32Array(e.rawBuffer()),n=e.width(),i=0;i<n;i++)for(var a,o=0;o<n;o++){0!=((i^o)&t)&&(r[a=2*(i*n+o)]=0,r[1+a]=0)}return new m(n,n,r)}(new m(a,a,e),l).transpose()}function R(e){return e.setSymbol("Density").setTitle("Density Matrix Display").setBlurb("Shows the density matrix of the local mixed state of some wires.\nUse controls to see conditional states.").promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})}function w(t,e){return R(e).setSerializedId("Density"+t).setWidth(t).setDrawer(M).setProcessedStatsToJsonFunc(function(e){return{density_matrix:e.toReadableJson()}}).setStatTexturesMaker(function(e){return function(e,t,r,n,i){var a=new v(e);a.dontDeallocCurrentTexture();var o=g().vec2.arrayPowerSizeOfTexture(e),u=h.numberOfSetBits(r.inclusionMask),s=h.numberOfSetBits(r.inclusionMask&(1<<n)-1);a.shadeAndTrade(function(e){return c.controlSelect(r,e)},p.takeVec2Tex(o-u)),a.shadeAndTrade(function(e){return d.cycleAllBits(e,s-n)});var l=t-u+i;for(a.shadeAndTrade(function(e){return y(e,i)},p.takeVec2Tex(l));2*i<l;)l--,a.shadeHalveAndTrade(f.sumFoldVec2);return g().vec2.needRearrangingToBeInVec4Format&&a.shadeHalveAndTrade(f.packVec2IntoVec4),a.currentTexture}(e.stateTrader.currentTexture,e.wireCount,e.controls,e.row,t)}).setStatPixelDataPostProcessor(b)}var M=r.makeDisplayDrawer(function(e){var t=e.gate.height,r=e.customStats||m.zero(1<<t,1<<t).times(NaN);a.paintDensityMatrix(e.painter,r,e.rect,e.focusPoints)}),_=t.buildFamily(1,8,function(e,t){return 1===e?R(t).setSerializedId("Density").markAsDrawerNeedsSingleQubitDensityStats().setDrawer(r.makeDisplayDrawer(function(e){var t=e.positionInCircuit,r=t.col,n=t.row,i=e.stats.qubitDensityMatrix(r,n).transpose();a.paintDensityMatrix(e.painter,i,e.rect,e.focusPoints)})):w(e,t)});return{get DensityMatrixDisplayFamily(){return _},get amplitudesToCouplings(){return y}}}),$traceurRuntime.registerModule("src/gates/Detector.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Detector.js")).GateBuilder,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ProbabilityDisplay.js","src/gates/Detector.js")).amplitudesToProbabilities,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/gates/Detector.js")).WglTexturePool,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/gates/Detector.js")).WglTextureTrader,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/gates/Detector.js")).Shaders,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/gates/Detector.js")),l=e.currentShaderCoder,t=e.Inputs,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/gates/Detector.js")).CircuitShaders,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/gates/Detector.js")).Controls,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/Detector.js")).WglArg,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/Detector.js")).Config,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Detector.js")).GatePainting,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/gates/Detector.js")),h=f.makePseudoShaderWithInputsAndOutputAndCode,g=f.Outputs,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/Detector.js")).Matrix,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/gates/Detector.js")).GateShaders,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/Detector.js")).Point,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/gates/Detector.js")).DetailedError,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/QuarterTurnGates.js","src/gates/Detector.js")).QuarterTurnGates,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/HalfTurnGates.js","src/gates/Detector.js")).HalfTurnGates;function M(e,t){var r=l().vec2.arrayPowerSizeOfTexture(e.stateTrader.currentTexture);return n.controlMask(t).toBoolTexture(r)}function _(e,t){var r=l().vec2.arrayPowerSizeOfTexture(e),n=new u(e);n.dontDeallocCurrentTexture(),n.shadeAndTrade(function(e){return a(e,t)},o.takeVecFloatTex(r));for(var i=l().vec2.arrayPowerSizeOfTexture(e);0<i;)--i,n.shadeHalveAndTrade(s.sumFoldFloat);return n.shadeAndTrade(s.packFloatIntoVec4,o.takeVec4Tex(0)),n.currentTexture}function x(e){var t=M(e,e.controls.and(c.bit(e.row,!0)));try{return _(e.stateTrader.currentTexture,t,!0)}finally{t.deallocByDepositingInPool("textureWithTotalWeightMatchingPositiveMeasurement:mask")}}var S=h([t.float("total_weight"),t.float("detection_weight"),t.bool("classification"),t.vec2("ket")],g.vec2(),"\n        uniform float rnd;\n    \n        vec2 outputFor(float k) {\n            float detectChance = read_detection_weight(0.0) / read_total_weight(0.0);\n            float detection_type = float(rnd < detectChance);\n            float own_type = read_classification(k);\n            if (detection_type == own_type) {\n                float matchChance = detectChance * own_type + (1.0 - own_type) * (1.0 - detectChance);\n                return read_ket(k) / sqrt(matchChance);\n            } else {\n                return vec2(0.0, 0.0);\n            }\n        }\n    ");function T(e,t,r){switch(t){case"X":v.applyMatrixOperation(e,w.H.knownMatrixAt(0));break;case"Y":r?v.applyMatrixOperation(e,R.SqrtXBackward.knownMatrixAt(0)):v.applyMatrixOperation(e,R.SqrtXForward.knownMatrixAt(0));break;case"Z":break;default:throw new b("Unrecognized axis.",{axis:t})}}function A(e){var t=M(e,c.NONE),r=M(e,e.controls.and(c.bit(e.row,!0))),n=_(e.stateTrader.currentTexture,t),i=_(e.stateTrader.currentTexture,r);e.applyOperation(S(n,i,r,e.stateTrader.currentTexture,d.float("rnd",Math.random()))),i.deallocByDepositingInPool(),n.deallocByDepositingInPool(),r.deallocByDepositingInPool(),t.deallocByDepositingInPool()}function C(e){(e.isHighlighted||e.isInToolbox)&&(e.painter.fillRect(e.rect,e.isHighlighted?m.HIGHLIGHTED_GATE_FILL_COLOR:m.GATE_FILL_COLOR),i.paintOutline(e))}function E(e,t){var r=2*Math.PI,n=Math.min(e.rect.h/2,e.rect.w)-1,i=e.rect.center(),a=i.x,o=i.y;a-=.5*n,a+=.5,o+=.5,e.painter.trace(function(e){e.ctx.arc(a,o,n,3*r/4,r/4),e.ctx.lineTo(a,o-n-1)}).thenStroke("black",2).thenFill(m.TIME_DEPENDENT_HIGHLIGHT_COLOR),e.painter.printLine(t,e.rect,.5,void 0,void 0,void 0,.5)}function I(e,t){var r;e.customStats&&(r=Math.min(e.rect.h/2,e.rect.w),e.painter.ctx.save(),e.painter.ctx.translate(e.rect.center().x,e.rect.center().y),e.painter.ctx.rotate(void 0===t?Math.PI/3:Math.PI/4),e.painter.ctx.strokeStyle="white",e.painter.ctx.lineWidth=3,e.painter.print("*click*",0,void 0===t?0:-5,"center","middle","black","bold 16px sans-serif",2.8*r,2.8*r,void 0,!0),void 0!==t&&e.painter.print(t,0,10,"center","middle","black","bold 16px sans-serif",2.8*r,2.8*r,void 0,!0),e.painter.ctx.restore())}function j(e,t){!function(e){if(void 0===e.positionInCircuit||e.isHighlighted)return;var t=e.painter,r=e.positionInCircuit.col,n=Math.round(e.rect.center().x-.5)+.5,i=e.stats.circuitDefinition;i.columns[r].hasGatesWithGlobalEffects()&&(t.ctx.save(),t.ctx.setLineDash([1,4]),t.strokeLine(new y(n,e.rect.y),new y(n,e.rect.bottom())),t.ctx.restore());var a=e.positionInCircuit.row,o=!0,u=!1,s=void 0;try{for(var l=void 0,c=i.controlLinesRanges(r)[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var d,m,f=l.value,h=f.first,g=f.last,p=f.measured;h<=a&&a<=g&&(d=h===a?e.rect.center().y:e.rect.y,m=g===a?e.rect.center().y:e.rect.bottom(),p?(t.strokeLine(new y(n+1,d),new y(n+1,m)),t.strokeLine(new y(n-1,d),new y(n-1,m))):t.strokeLine(new y(n,d),new y(n,m)))}}catch(e){u=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(u)throw s}}}(e);var r=e.rect.center();switch(t){case"X":e.painter.fillCircle(r,5),e.painter.strokeCircle(r,5),e.painter.strokeLine(r.offsetBy(0,-5),r.offsetBy(0,5)),e.painter.strokeLine(r.offsetBy(-5,0),r.offsetBy(5,0));break;case"Y":e.painter.fillCircle(r,5),e.painter.strokeCircle(r,5);var n=5*Math.sqrt(.5)*1.1;e.painter.strokeLine(r.offsetBy(+n,-n),r.offsetBy(-n,+n)),e.painter.strokeLine(r.offsetBy(-n,-n),r.offsetBy(+n,+n));break;case"Z":e.painter.fillCircle(r,5,"black");break;default:throw new b("Unrecognized axis.",{axis:t})}}function $(n){return function(e){var t=e.controls,r=e.controlsTexture;try{return e.controls=c.NONE,e.controlsTexture=M(e,e.controls),n(e)}finally{e.controlsTexture.deallocByDepositingInPool("withClearedControls"),e.controlsTexture=r,e.controls=t}}}function P(u){var e=(new r).setSerializedIdAndSymbol(u+"DetectControlReset").setTitle(u+" Detect-Control-Reset").setBlurb("Does a sampled "+u+"-axis measurement.\nControls operations with the result.\nResets the target to |0⟩.").setDrawer(function(e){return r=u,n=(t=e).rect,i=n.leftHalf(),a=n.rightHalf(),(o=n.rightHalf()).y+=o.h/2-2,o.h=5,t.painter.fillRect(o,"white"),C(t),t.painter.printLine("|0⟩",a,1,void 0,void 0,void 0,.5),t.rect=i,E(t,r),t.rect=n,j(t,r),t.rect=i,I(t,void 0),void(t.rect=n);var t,r,n,i,a,o}).markAsControlExpecting(!0,!0).markAsReachingOtherWires().setActualEffectToUpdateFunc(function(){}).setStatTexturesMaker($(x)).setSetupCleanupEffectToUpdateFunc($(function(e){T(e,u,!1),A(e)}),$(function(e){v.applyMatrixOperation(e,p.square(1,1,0,0))})).setStatPixelDataPostProcessor(function(e,t,r,n){return 0<e[0]});return"Z"===u&&e.promiseEffectIsDiagonal(),e.gate}function G(n){var e=new Map([["X","|0⟩-|1⟩"],["Y","|0⟩-i|1⟩"],["Z","|1⟩"]]).get(n),t=(new r).setSerializedIdAndSymbol(n+"Detector").setTitle(n+" Axis Detector").setBlurb("Sampled "+n+"-axis measurement.\nShows *click* when the target qubit is "+e+" and controls are satisfied.").setDrawer(function(e){return r=n,C(t=e),E(t,r),void I(t,r);var t,r}).markAsReachingOtherWires().setSetupCleanupEffectToUpdateFunc(function(e){return T(e,n,!1)},function(e){return T(e,n,!0)}).setActualEffectToUpdateFunc(A).setStatTexturesMaker(x).setStatPixelDataPostProcessor(function(e,t,r,n){return 0<e[0]});return"Z"===n&&t.promiseEffectIsDiagonal(),t.gate}var k={};return k.XDetector=G("X"),k.YDetector=G("Y"),k.ZDetector=G("Z"),k.XDetectControlClear=P("X"),k.YDetectControlClear=P("Y"),k.ZDetectControlClear=P("Z"),k.all=[k.XDetector,k.YDetector,k.ZDetector,k.XDetectControlClear,k.YDetectControlClear,k.ZDetectControlClear],{get Detectors(){return k}}}),$traceurRuntime.registerModule("src/gates/ExponentiatingGates.js",[],function(){"use strict";function t(e){var t=Math.cos(u*e),r=Math.sin(u*e);return new a(2,2,new Float32Array([t,0,0,-r,0,-r,t,0]))}function r(e){var t=Math.cos(u*e),r=Math.sin(u*e);return new a(2,2,new Float32Array([t,0,-r,0,r,0,t,0]))}function n(e){var t=Math.cos(u*e),r=Math.sin(u*e);return new a(2,2,new Float32Array([t,-r,0,0,0,0,t,r]))}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ExponentiatingGates.js")).GateBuilder,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/ExponentiatingGates.js")).GatePainting,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/ExponentiatingGates.js")).Matrix,o={},u=2*Math.PI;return o.XForward=(new e).setSerializedIdAndSymbol("e^-iXt").setTitle("X-Exponentiating Gate (forward)").setBlurb("Right-hand rotation around the X axis.\nPasses through ±iX instead of X.").setDrawer(i.makeCycleDrawer(1,1,2)).setEffectToTimeVaryingMatrix(t).promiseEffectIsUnitary().gate,o.XBackward=(new e).setAlternate(o.XForward).setSerializedIdAndSymbol("e^iXt").setTitle("X-Exponentiating Gate (backward)").setBlurb("Left-hand rotation around the X axis.\nPasses through ±iX instead of X.").setDrawer(i.makeCycleDrawer(-1,1,2)).setEffectToTimeVaryingMatrix(function(e){return t(-e)}).promiseEffectIsUnitary().gate,o.YForward=(new e).setSerializedIdAndSymbol("e^-iYt").setTitle("Y-Exponentiating Gate (forward)").setBlurb("Right-hand rotation around the Y axis.\nPasses through ±iY instead of Y.").setDrawer(i.makeCycleDrawer(.5,1,2)).setEffectToTimeVaryingMatrix(r).promiseEffectIsUnitary().gate,o.YBackward=(new e).setAlternate(o.YForward).setSerializedIdAndSymbol("e^iYt").setTitle("Y-Exponentiating Gate (backward)").setBlurb("Left-hand rotation around the Y axis.\nPasses through ±iY instead of Y.").setDrawer(i.makeCycleDrawer(-.5,1,2)).setEffectToTimeVaryingMatrix(function(e){return r(-e)}).promiseEffectIsUnitary().gate,o.ZForward=(new e).setSerializedIdAndSymbol("e^-iZt").setTitle("Z-Exponentiating Gate (forward)").setBlurb("Right-hand rotation around the Z axis.\nPasses through ±iZ instead of Z.").setDrawer(i.makeCycleDrawer(-1,-.5,2)).setEffectToTimeVaryingMatrix(n).promiseEffectOnlyPhases().gate,o.ZBackward=(new e).setAlternate(o.ZForward).setSerializedIdAndSymbol("e^iZt").setTitle("Z-Exponentiating Gate (backward)").setBlurb("Left-hand rotation around the Z axis.\nPasses through ±iZ instead of Z.").setDrawer(i.makeCycleDrawer(1,-.5,2)).setEffectToTimeVaryingMatrix(function(e){return n(-e)}).promiseEffectOnlyPhases().gate,o.all=[o.XBackward,o.YBackward,o.ZBackward,o.XForward,o.YForward,o.ZForward],{get ExponentiatingGates(){return o},get XExp(){return t},get YExp(){return r},get ZExp(){return n}}}),$traceurRuntime.registerModule("src/gates/FourierTransformGates.js",[],function(){"use strict";var n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/FourierTransformGates.js")).Complex,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/FourierTransformGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/FourierTransformGates.js")),i=t.ketArgs,r=t.ketShaderPhase,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/FourierTransformGates.js")).Matrix,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/HalfTurnGates.js","src/gates/FourierTransformGates.js")).HalfTurnGates,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ReverseBitsGate.js","src/gates/FourierTransformGates.js")).reverseShaderForSize,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/FourierTransformGates.js")).WglArg;function l(e,t){var r=void 0!==arguments[2]?arguments[2]:1;e.applyOperation(d.withArgs.apply(d,$traceurRuntime.spread(i(e,t),[s.float("factor",r)])))}function c(r){return a.generate(1<<r,1<<r,function(e,t){return n.polar(Math.pow(.5,r/2),2*Math.PI*e*t/(1<<r))})}var d=r("uniform float factor;","\n        float hold = floor(out_id * 2.0 / span);\n        float step = mod(out_id, span / 2.0);\n        return hold * step * factor * 6.2831853071795864769 / span;\n    "),m={};return m.FourierTransformFamily=e.buildFamily(1,16,function(t,e){return e.setSerializedId("QFT"+t).setSymbol("QFT").setTitle("Fourier Transform Gate").setBlurb("Transforms to/from phase frequency space.").setActualEffectToUpdateFunc(function(e){return function(e,t){1<t&&e.applyOperation(u(t));for(var r=0;r<t;r++)0<r&&l(e,r+1,1),o.H.customOperation(e.withRow(e.row+r))}(e,t)}).promiseEffectIsUnitary().setTooltipMatrixFunc(function(){return c(t)})}),m.InverseFourierTransformFamily=e.buildFamily(1,16,function(t,e){return e.setSerializedId("QFT†"+t).setSymbol("QFT^†").setAlternateFromFamily(m.FourierTransformFamily).setTitle("Inverse Fourier Transform Gate").setBlurb("Transforms from/to phase frequency space.").setActualEffectToUpdateFunc(function(e){return function(e,t){for(var r=t-1;0<=r;r--)o.H.customOperation(e.withRow(e.row+r)),0<r&&l(e,r+1,-1);1<t&&e.applyOperation(u(t))}(e,t)}).promiseEffectIsUnitary().setTooltipMatrixFunc(function(){return c(t).adjoint()})}),m.all=$traceurRuntime.spread(m.FourierTransformFamily.all,m.InverseFourierTransformFamily.all),{get applyControlledPhaseGradient(){return l},get FourierTransformGates(){return m}}}),$traceurRuntime.registerModule("src/gates/HalfTurnGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/HalfTurnGates.js")),t=(e.Gate,e.GateBuilder),i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/HalfTurnGates.js")).GatePainting,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/HalfTurnGates.js")).Matrix,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/HalfTurnGates.js")).Point,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/HalfTurnGates.js")),o=n.ketArgs,u=n.ketShader,s=n.ketShaderPermute,l={};var c=s("","return 1.0-out_id;",1);l.X=(new t).setSerializedIdAndSymbol("X").setTitle("Pauli X Gate").setBlurb("The NOT gate.\nToggles between ON and OFF.").setDrawer(function(e){var t,r,n;e.isHighlighted?i.DEFAULT_DRAWER(e):(void 0===e.positionInCircuit&&(i.paintBackground(e),i.paintOutline(e)),t=e.rect.scaledOutwardBy(.6),e.painter.fillCircle(t.center(),t.w/2),e.painter.strokeCircle(t.center(),t.w/2),r=void 0!==e.positionInCircuit&&e.stats.circuitDefinition.colHasSingleWireControl(e.positionInCircuit.col),n=void 0!==e.positionInCircuit&&e.stats.circuitDefinition.colHasDoubleWireControl(e.positionInCircuit.col),!r&&n||e.painter.strokeLine(t.topCenter(),t.bottomCenter()),n&&(e.painter.strokeLine(t.topCenter().offsetBy(-1,0),t.bottomCenter().offsetBy(-1,0)),e.painter.strokeLine(t.topCenter().offsetBy(1,0),t.bottomCenter().offsetBy(1,0))),void 0!==e.positionInCircuit&&e.stats.circuitDefinition.locIsMeasured(new a(e.positionInCircuit.col,e.positionInCircuit.row))?(e.painter.strokeLine(t.centerLeft().offsetBy(0,-1),t.centerRight().offsetBy(0,-1)),e.painter.strokeLine(t.centerLeft().offsetBy(0,1),t.centerRight().offsetBy(0,1))):e.painter.strokeLine(t.centerLeft(),t.centerRight()))}).setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(o(e)))}).setKnownEffectToMatrix(r.PAULI_X).gate;var d=u("","vec2 v = inp(1.0-out_id); return (out_id*2.0 - 1.0)*vec2(-v.y, v.x);",1);l.Y=(new t).setSerializedIdAndSymbol("Y").setTitle("Pauli Y Gate").setBlurb("A combination of the X and Z gates.").setActualEffectToShaderProvider(function(e){return d.withArgs.apply(d,$traceurRuntime.spread(o(e)))}).setKnownEffectToMatrix(r.PAULI_Y).gate;var m=u("","return amp*(1.0 - out_id*2.0);",1);l.Z=(new t).setSerializedIdAndSymbol("Z").setTitle("Pauli Z Gate").setBlurb("The phase flip gate.\nNegates phases when the qubit is ON.").setActualEffectToShaderProvider(function(e){return m.withArgs.apply(m,$traceurRuntime.spread(o(e)))}).setKnownEffectToMatrix(r.PAULI_Z).gate;var f=u("","return 0.7071067811865476*(amp*(1.0-2.0*out_id) + inp(1.0-out_id));",1);return l.H=(new t).setSerializedIdAndSymbol("H").setTitle("Hadamard Gate").setBlurb("Creates simple superpositions.\nMaps ON to ON + OFF.\nMaps OFF to ON - OFF.").setActualEffectToShaderProvider(function(e){return f.withArgs.apply(f,$traceurRuntime.spread(o(e)))}).setKnownEffectToMatrix(r.HADAMARD).gate,l.all=[l.X,l.Y,l.Z,l.H],{get HalfTurnGates(){return l}}}),$traceurRuntime.registerModule("src/gates/Impossible_UniversalNotGate.js",[],function(){"use strict";function e(e){return a.withArgs.apply(a,$traceurRuntime.spread(n(e)))}var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Impossible_UniversalNotGate.js")).GateBuilder,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/Impossible_UniversalNotGate.js")),n=r.ketArgs,i=r.ketShader,a=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/Impossible_UniversalNotGate.js")).WglConfiguredShader,i("","vec2 other = inp(1.0 - out_id); return vec2(other.x, -other.y) * (1.0 - 2.0 * out_id);",1)),o=(new t).setSerializedId("__unstable__UniversalNot").setSymbol("UniNot").setTitle("Universal Not Gate").setBlurb("Mirrors through the origin of the Bloch sphere.\nImpossible in practice.").setActualEffectToShaderProvider(e).promiseEffectIsStable().gate;return{get universalNot(){return e},get UniversalNotGate(){return o}}}),$traceurRuntime.registerModule("src/gates/IncrementGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/IncrementGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/IncrementGates.js")),r=t.ketArgs,n=t.ketShaderPermute,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/IncrementGates.js")).WglArg,a={},o=n("uniform float amount;","return mod(out_id - amount + span, span);");return a.IncrementFamily=e.buildFamily(1,16,function(t,e){return e.setSerializedId("inc"+t).setSymbol("+1").setTitle("Increment Gate").setBlurb("Adds 1 to the little-endian number represented by a block of qubits.").setActualEffectToShaderProvider(function(e){return o.withArgs.apply(o,$traceurRuntime.spread(r(e,t),[i.float("amount",1)]))}).setKnownEffectToPermutation(function(e){return e+1&(1<<t)-1})}),a.DecrementFamily=e.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(a.IncrementFamily).setSerializedId("dec"+t).setSymbol("−1").setTitle("Decrement Gate").setBlurb("Subtracts 1 from the little-endian number represented by a block of qubits.").setActualEffectToShaderProvider(function(e){return o.withArgs.apply(o,$traceurRuntime.spread(r(e,t),[i.float("amount",-1)]))}).setKnownEffectToPermutation(function(e){return e-1&(1<<t)-1})}),a.all=$traceurRuntime.spread(a.IncrementFamily.all,a.DecrementFamily.all),{get IncrementGates(){return a},get offsetShader(){return o}}}),$traceurRuntime.registerModule("src/gates/InputGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/InputGates.js")),t=e.Gate,r=e.GateBuilder,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/InputGates.js")).GatePainting,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ReverseBitsGate.js","src/gates/InputGates.js")).reverseShaderForSize,n={};function a(r,n){return t.buildFamily(1,16,function(t,e){return e.setSerializedId((n?"rev":"")+"input"+r+t).setSymbol((n?"rev ":"")+"input "+r).setTitle("Input Gate ["+r+"]"+(n?" [reversed]":"")).setBlurb("Temporarily uses some qubits as input "+r+(n?", in big-endian order":"")+".").setDrawer(function(e){return function(e,t,r){o.paintBackground(e,"#DDD","#DDD"),e.isInToolbox?o.paintOutline(e):e.painter.strokeRect(e.rect,"#888"),o.paintResizeTab(e);var n=e.rect.center(),i=n.x,a=n.y;e.painter.print("input",i,a-2,"center","bottom","black","16px sans-serif",e.rect.w-2,e.rect.h/2),e.painter.print(t+(r?"[::-1]":""),i,a+2,"center","top","black","16px sans-serif",e.rect.w-2,e.rect.h/2)}(e,r,n)}).promiseHasNoNetEffectOnStateVector().markAsNotInterestedInControls().setSetupCleanupEffectsToShaderProviders(n&&1<t?i(t):void 0,n&&1<t?i(t):void 0).setContextProvider(function(e){return[{key:"Input Range "+r,val:{offset:e,length:t}}]})})}function u(n){return(new r).setSerializedIdAndSymbol("set"+n).setTitle("Set Default "+n).setBlurb("Sets a default value for input "+n+", for when an inline input isn't given.").setWidth(2).setHeight(2).promiseHasNoNetEffectOnStateVector().markAsNotInterestedInControls().markAsReachingOtherWires().setStickyContextProvider(function(e,t){return[{key:"Input Default "+n,val:t.param,sticky:!0}]}).setDrawer(function(e){o.paintLocationIndependentFrame(e,"#EEE","#EEE"),e.isInToolbox?o.paintGateSymbol(e,n+"=#\ndefault"):o.paintGateSymbol(e,n+"="+e.gate.param),o.paintGateButton(e)}).setOnClickGateFunc(function(e){var t=prompt("Enter new fallback value for input "+n+" (between 0 and 65535).",""+e.param);if(null===t||""===t.trim())return e;var r=parseInt(t);return!Number.isInteger(r)||r<0||65536<=r?(alert("'"+t+"' isn't an integer between 0 and 65535. Keeping "+e.param+"."),e):e.withParam(r)}).setExtraDisableReasonFinder(function(e){var t=e.gate.param;if(!Number.isInteger(t)||t<0||65536<t)return"bad\nvalue"}).gate.withParam(2)}return n.InputAFamily=a("A",!1),n.InputBFamily=a("B",!1),n.InputRFamily=a("R",!1),n.InputRevAFamily=a("A",!0),n.InputRevBFamily=a("B",!0),n.SetA=u("A"),n.SetB=u("B"),n.SetR=u("R"),n.Letters=["A","B","R"],n.all=$traceurRuntime.spread(n.InputAFamily.all,n.InputBFamily.all,n.InputRFamily.all,n.InputRevAFamily.all,n.InputRevBFamily.all,[n.SetA,n.SetB,n.SetR]),{get InputGates(){return n}}}),$traceurRuntime.registerModule("src/gates/InterleaveBitsGates.js",[],function(){"use strict";var h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/InterleaveBitsGates.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/InterleaveBitsGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/InterleaveBitsGates.js")),n=t.ketArgs,i=t.ketShaderPermute,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/InterleaveBitsGates.js")).GatePainting,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/InterleaveBitsGates.js")).Point,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/gates/InterleaveBitsGates.js")).Seq,a={};function v(e,t){var r=Math.ceil(t/2);return 2*(e%r)+Math.floor(e/r)}function o(e,t){var r=Math.ceil(t/2);return Math.floor(e/2)+e%2*r}function u(e,t){for(var r=[],n=0;n<e;n++)r.push("r += mod(floor(out_id / "+(1<<t(n,e))+".0), 2.0) * "+(1<<n)+".0;");return i("","\n            float r = 0.0;\n            "+r.join("\n            ")+"\n            return r;\n        ",e)}function s(f){return function(e){var t,r;if(void 0===e.positionInCircuit){g.paintBackground(e),g.paintOutline(e),g.paintResizeTab(e);for(var n=e.rect.x+6,i=e.rect.right()-6,a=e.rect.center().y-h.GATE_RADIUS+6,o=(2*(h.GATE_RADIUS-6)-14)/5,u=0;u<6;u++){var s=v(u,6),l=a+u*o+14*Math.floor(u/3),c=a+s*o+7*Math.floor(s/2),d=(r=(t=(f?[c,l]:[l,c])[Symbol.iterator]()).next()).done?void 0:r.value,m=(r=t.next()).done?void 0:r.value;e.painter.strokePath([new p(n,d),new p(n+8,d),new p(i-8,m),new p(i,m)])}}else g.PERMUTATION_DRAWER(e)}}var l=r.range(h.MAX_WIRE_COUNT+1).skip(2).toMap(function(e){return e},function(e){return u(e,v)}),c=r.range(h.MAX_WIRE_COUNT+1).skip(2).toMap(function(e){return e},function(e){return u(e,o)});return a.InterleaveBitsGateFamily=e.buildFamily(4,16,function(r,e){return e.setSerializedId("weave"+r).setSymbol("Interleave").setTitle("Interleave").setBlurb("Re-orders blocks of bits into stripes of bits.").setWidth(r<=8?1:2).setDrawer(s(!1)).setActualEffectToShaderProvider(function(e){var t;return(t=l.get(r)).withArgs.apply(t,$traceurRuntime.spread(n(e,r)))}).setKnownEffectToBitPermutation(function(e){return v(e,r)})}),a.DeinterleaveBitsGateFamily=e.buildFamily(4,16,function(r,e){return e.setAlternateFromFamily(a.InterleaveBitsGateFamily).setSerializedId("split"+r).setSymbol("Deinterleave").setTitle("Deinterleave").setBlurb("Re-orders stripes of bits into blocks of bits.").setWidth(r<=8?1:2).setDrawer(s(!0)).setActualEffectToShaderProvider(function(e){var t;return(t=c.get(r)).withArgs.apply(t,$traceurRuntime.spread(n(e,r)))}).setKnownEffectToBitPermutation(function(e){return o(e,r)})}),a.all=$traceurRuntime.spread(a.InterleaveBitsGateFamily.all,a.DeinterleaveBitsGateFamily.all),{get InterleaveBitsGates(){return a},get interleaveBit(){return v},get deinterleaveBit(){return o},get shaderFromBitPermutation(){return u}}}),$traceurRuntime.registerModule("src/gates/Joke_ImaginaryGate.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Joke_ImaginaryGate.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/Joke_ImaginaryGate.js")).Matrix,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/Joke_ImaginaryGate.js")).Complex,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Joke_ImaginaryGate.js")).GatePainting,i=(new e).setSerializedIdAndSymbol("i").setTitle("Imaginary Gate").setBlurb("Phases everything by i.").setDrawer(function(e){n.paintLocationIndependentFrame(e),n.paintGateSymbol(e)}).setKnownEffectToMatrix(t.square(r.I,0,0,r.I)).gate,a=(new e).setAlternate(i).setSerializedIdAndSymbol("-i").setTitle("Anti-Imaginary Gate").setBlurb("Phases everything by -i.").setDrawer(function(e){n.paintLocationIndependentFrame(e),n.paintGateSymbol(e)}).setKnownEffectToMatrix(t.square(r.I.neg(),0,0,r.I.neg())).gate,o=(new e).setSerializedIdAndSymbol("√i").setTitle("Half Imaginary Gate").setBlurb("Phases everything by √i.").setDrawer(function(e){n.paintLocationIndependentFrame(e),n.paintGateSymbol(e)}).setKnownEffectToMatrix(t.square(1,0,0,1).times(new r(Math.sqrt(.5),Math.sqrt(.5)))).gate,u=(new e).setAlternate(o).setSerializedIdAndSymbol("√-i").setTitle("Half Anti-Imaginary Gate").setBlurb("Phases everything by √-i.").setDrawer(function(e){n.paintLocationIndependentFrame(e),n.paintGateSymbol(e)}).setKnownEffectToMatrix(t.square(1,0,0,1).times(new r(Math.sqrt(.5),-Math.sqrt(.5)))).gate;return{get AntiImaginaryGate(){return a},get ImaginaryGate(){return i},get SqrtImaginaryGate(){return o},get AntiSqrtImaginaryGate(){return u}}}),$traceurRuntime.registerModule("src/gates/Joke_MysteryGate.js",[],function(){"use strict";function e(e){return(new n).setSerializedIdAndSymbol("?").setTitle("Mystery Gate").setBlurb("Different every time.\n(Use shift+drag to copy circuit gates.)").setDrawer(i.MATRIX_SYMBOL_DRAWER_EXCEPT_IN_TOOLBOX).setKnownEffectToMatrix(e).gate}function t(){return e(a.square(new r(Math.random()-.5,Math.random()-.5),new r(Math.random()-.5,Math.random()-.5),new r(Math.random()-.5,Math.random()-.5),new r(Math.random()-.5,Math.random()-.5)).closestUnitary(1e-5))}var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/Joke_MysteryGate.js")).Complex,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Joke_MysteryGate.js")).GateBuilder,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Joke_MysteryGate.js")).GatePainting,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/Joke_MysteryGate.js")).Matrix;return{get MysteryGateSymbol(){return"?"},get MysteryGateMaker(){return t},get MysteryGateMakerWithMatrix(){return e}}}),$traceurRuntime.registerModule("src/gates/Joke_NeGate.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Joke_NeGate.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/Joke_NeGate.js")).Matrix,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/Joke_NeGate.js")).Point,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Joke_NeGate.js")).GatePainting,r=(new e).setSerializedId("NeGate").setTitle("Ne-Gate").setBlurb("Negates all amplitudes.").setDrawer(function(e){a.paintLocationIndependentFrame(e);var t=e.rect.center(),r=t.x,n=t.y;e.painter.strokeLine(new i(r-6,n),new i(r+6,n),"black",2)}).setKnownEffectToMatrix(t.square(-1,0,0,-1)).gate;return{get NeGate(){return r}}}),$traceurRuntime.registerModule("src/gates/Joke_ZeroGate.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Joke_ZeroGate.js")).GateBuilder,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Joke_ZeroGate.js")).GatePainting,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/Joke_ZeroGate.js")).Matrix,n=(new e).setSerializedIdAndSymbol("0").setTitle("Nothing Gate").setBlurb("Destroys the universe.").setDrawer(t.makeLocationIndependentGateDrawer("#666")).setKnownEffectToMatrix(r.square(0,0,0,0)).gate;return{get ZeroGate(){return n}}}),$traceurRuntime.registerModule("src/gates/MeasurementGate.js",[],function(){"use strict";var p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/MeasurementGate.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/MeasurementGate.js")).GateBuilder,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/MeasurementGate.js")).GatePainting;var t=(new e).setSerializedIdAndSymbol("Measure").setTitle("Measurement Gate").setBlurb("Measures whether a qubit is ON or OFF, without conditioning on the result.").promiseHasNoNetEffectOnStateVector().setDrawer(function(e){var t,r,n,i,a=p.GATE_FILL_COLOR;e.isHighlighted&&(a=p.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.fillRect(e.rect,a),v.paintOutline(e);var o=2*Math.PI,u=.4*e.rect.w,s=e.rect.center(),l=s.x,c=s.y;c+=.6*u;var d=-o/6,m=(r=(t=[Math.cos(d)*u*1.5,Math.sin(d)*u*1.5][Symbol.iterator]()).next()).done?void 0:r.value,f=(r=t.next()).done?void 0:r.value,h=(i=(n=[l+m,c+f][Symbol.iterator]()).next()).done?void 0:i.value,g=(i=n.next()).done?void 0:i.value;e.painter.trace(function(e){e.ctx.arc(l,c,u,o/2,o),e.line(l,c,h,g)}).thenStroke("black"),e.painter.trace(function(e){return e.arrowHead(h,g,.3*u,d,o/4)}).thenFill("black")}).setExtraDisableReasonFinder(function(e){if(e.isNested)return"can't\nnest\nmeasure\n(sorry)";var t=0!=(e.measuredMask&1<<e.outerRow);return e.innerColumn.hasControl()&&!t?"can't\ncontrol\n(sorry)":void 0}).gate;return{get MeasurementGate(){return t}}}),$traceurRuntime.registerModule("src/gates/ModularAdditionGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ModularAdditionGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ModularAdditionGates.js")),r=t.ketArgs,n=t.ketShaderPermute,i=t.ketInputGateShaderCode,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/ModularAdditionGates.js")).Util,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/ModularAdditionGates.js")).WglArg,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ModularIncrementGates.js","src/gates/ModularAdditionGates.js")).modulusTooBigChecker,s={},l=n("\n        uniform float factor;\n        "+i("A")+"\n        "+i("R")+"\n    ","\n        float r = read_input_R();\n        if (out_id >= r) {\n            return out_id;\n        }\n        float d = read_input_A();\n        d *= factor;\n        d = floor(mod(d + 0.5, r));\n        return floor(mod(out_id + r - d + 0.5, r));\n    ");return s.PlusAModRFamily=e.buildFamily(1,16,function(t,e){return e.setSerializedId("+AmodR"+t).setSymbol("+A\nmod R").setTitle("Modular Addition Gate").setBlurb("Adds input A into the target, mod input R.\nOnly affects values below R.").setRequiredContextKeys("Input Range A","Input Range R").setExtraDisableReasonFinder(u("R",t)).setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(r(e,t,["A","R"]),[o.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r){return e<r?(e+t)%r:e})}),s.MinusAModRFamily=e.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(s.PlusAModRFamily).setSerializedId("-AmodR"+t).setSymbol("−A\nmod R").setTitle("Modular Subtraction Gate").setBlurb("Subtracts input A out of the target, mod input R.\nOnly affects values below R.").setRequiredContextKeys("Input Range A","Input Range R").setExtraDisableReasonFinder(u("R",t)).setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(r(e,t,["A","R"]),[o.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r){return e<r?a.properMod(e-t,r):e})}),s.all=$traceurRuntime.spread(s.PlusAModRFamily.all,s.MinusAModRFamily.all),{get ModularAdditionGates(){return s}}}),$traceurRuntime.registerModule("src/gates/ModularIncrementGates.js",[],function(){"use strict";function r(n,i){var a=void 0!==arguments[2]?arguments[2]:"mod";return function(e){var t=e.context.get("Input Range "+n),r=e.context.get("Input Default "+n);return void 0!==t&&t.length>i||void 0===t&&void 0!==r&&1<<i<r?a+"\ntoo\nbig":void 0}}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ModularIncrementGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ModularIncrementGates.js")),n=t.ketArgs,i=t.ketShaderPermute,a=t.ketInputGateShaderCode,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/ModularIncrementGates.js")).Util,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/ModularIncrementGates.js")).WglArg,s={},l=i("\n        uniform float amount;\n        "+a("R")+"\n    ","\n        float r = read_input_R();\n        return out_id >= r\n            ? out_id\n            // HACK: sometimes mod(value-equal-to-r, r) returns r instead of 0. The perturbation works around it.\n            : floor(mod(out_id + r - amount, r - 0.000001));");return s.IncrementModRFamily=e.buildFamily(1,16,function(t,e){return e.setSerializedId("incmodR"+t).setSymbol("+1\nmod R").setTitle("Modular Increment Gate").setBlurb("Adds 1 into the target, but wraps R-1 to 0.\nOnly affects values less than R.").setRequiredContextKeys("Input Range R").setExtraDisableReasonFinder(r("R",t)).setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(n(e,t,["R"]),[u.float("amount",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e<t?(e+1)%t:e})}),s.DecrementModRFamily=e.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(s.IncrementModRFamily).setSerializedId("decmodR"+t).setSymbol("−1\nmod R").setTitle("Modular Decrement Gate").setBlurb("Subtracts 1 out of the target, but wraps 0 to R-1.\nOnly affects values less than R.").setRequiredContextKeys("Input Range R").setExtraDisableReasonFinder(r("R",t)).setActualEffectToShaderProvider(function(e){return l.withArgs.apply(l,$traceurRuntime.spread(n(e,t,["R"]),[u.float("amount",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t){return e<t?o.properMod(e-1,t):e})}),s.all=$traceurRuntime.spread(s.IncrementModRFamily.all,s.DecrementModRFamily.all),{get ModularIncrementGates(){return s},get modulusTooBigChecker(){return r}}}),$traceurRuntime.registerModule("src/gates/ModularMultiplicationGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/ModularMultiplicationGates.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ModularMultiplicationGates.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ModularMultiplicationGates.js")),n=r.ketArgs,i=r.ketShaderPermute,a=r.ketInputGateShaderCode,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ModularIncrementGates.js","src/gates/ModularMultiplicationGates.js")).modulusTooBigChecker,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/MultiplyAccumulateGates.js","src/gates/ModularMultiplicationGates.js")).BIG_MUL_MOD_SHADER_CODE,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/ModularMultiplicationGates.js")).Util,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/ModularMultiplicationGates.js")).WglArg,c={},d="\n    vec2 _mod_mul_step(vec2 v, float q) {\n        return vec2(v.y - q * v.x, v.x);\n    }\n    \n    "+u+"\n\n    float modular_multiplicative_inverse(float value, float modulus) {\n        vec2 s = vec2(0.0, 1.0);\n        vec2 t = vec2(1.0, 0.0);\n        vec2 r = vec2(modulus, value);\n        float q;\n        // For values up to x, a number of iterations n satisfying phi^n > x should be sufficient.\n        for (int repeat = 0; repeat < "+Math.ceil(e.MAX_WIRE_COUNT/(Math.log2(1+Math.sqrt(5))-1))+"; repeat++) {\n            if (r.x != 0.0) {\n                q = floor(r.y / r.x);\n                r = _mod_mul_step(r, q);\n                s = _mod_mul_step(s, q);\n                t = _mod_mul_step(t, q);\n            }\n        }\n        if (r.y != 1.0) {\n            return -1.0;\n        }\n        return floor(mod(floor(mod(s.y + 0.5, modulus)) + modulus + 0.5, modulus));\n    }\n",m="\n    "+d+"\n\n    float pow_mod(float base, float exponent, float modulus) {\n        float base_inverse = modular_multiplicative_inverse(base, modulus);\n        if (base_inverse == -1.0) {\n            return -1.0;\n        }\n\n        if (exponent < 0.0) {\n            base = base_inverse;\n            exponent = -exponent;\n        }\n\n        float f = 1.0;\n        for (int k = 0; k < "+e.MAX_WIRE_COUNT+"; k++) {\n            if (floor(mod(exponent + 0.5, 2.0)) == 1.0) {\n                exponent -= 1.0;\n                f = big_mul_mod(f, base, modulus);\n            }\n            base = big_mul_mod(base, base, modulus);\n            exponent /= 2.0;\n        }\n        return f;\n    }\n";function f(e,t,r){return r<=e||0===(t=s.properMod(t,r))||1!==s.extended_gcd(t,r).gcd?e:e*t%r}function h(e,t,r){if(r<=e)return e;if(0===(t=s.properMod(t,r)))return e;var n=s.modular_multiplicative_inverse(t,r);return void 0===n?e:e*n%r}function g(e,t,r,n){if(n<=e)return e;t=s.properMod(t,n);var i=s.modular_multiplicative_inverse(t,n);if(void 0===i)return e;for(r<0&&(r=-r,t=i);0<r;)0!=(1&r)&&(e=e*t%n),t=t*t%n,r>>=1;return e}var p=i("\n        "+d+"\n        "+a("A")+"\n        "+a("R")+"\n    ","\n        float input_a = read_input_A();\n        float modulus = read_input_R();\n        input_a = floor(mod(input_a + 0.5, modulus));\n        float v = modular_multiplicative_inverse(input_a, modulus);\n        if (v == -1.0 || out_id >= modulus) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, v, modulus);\n    "),v=i("\n        "+d+"\n        "+a("A")+"\n        "+a("R")+"\n    ","\n        float input_a = read_input_A();\n        float modulus = read_input_R();\n        input_a = floor(mod(input_a + 0.5, modulus));\n        if (modular_multiplicative_inverse(input_a, modulus) == -1.0 || out_id >= modulus) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, input_a, modulus);\n    "),y=i("\n        uniform float factor;\n        "+a("A")+"\n        "+a("B")+"\n        "+a("R")+"\n        "+m+"\n    ","\n        float exponent = -read_input_A() * factor;\n        float base = read_input_B();\n        float modulus = read_input_R();\n        float f = pow_mod(base, exponent, modulus);\n        if (f == -1.0 || out_id >= modulus) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, f, modulus);\n    ");return c.TimesAModRFamily=t.buildFamily(1,16,function(t,e){return e.setSerializedId("*AmodR"+t).setSymbol("×A\nmod R").setTitle("Modular Multiplication Gate").setBlurb("Multiplies the target by input A mod input R.\nOnly affects values less than R.\nNo effect if the multiplication would be irreversible.").setRequiredContextKeys("Input Range A","Input Range R").setExtraDisableReasonFinder(o("R",t)).setActualEffectToShaderProvider(function(e){return p.withArgs.apply(p,$traceurRuntime.spread(n(e,t,["A","R"])))}).setKnownEffectToParametrizedPermutation(f)}),c.TimesAModRInverseFamily=t.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(c.TimesAModRFamily).setSerializedId("/AmodR"+t).setSymbol("×A^-1\nmod R").setTitle("Modular Division Gate").setBlurb("Inverse-multiplies the target by input A mod input R.\nOnly affects values less than R.\nNo effect if the multiplication would be irreversible.").setRequiredContextKeys("Input Range A","Input Range R").setExtraDisableReasonFinder(o("R",t)).setActualEffectToShaderProvider(function(e){return v.withArgs.apply(v,$traceurRuntime.spread(n(e,t,["A","R"])))}).setKnownEffectToParametrizedPermutation(h)}),c.TimesBToTheAModRFamily=t.buildFamily(1,16,function(t,e){return e.setSerializedId("*BToAmodR"+t).setSymbol("×B^A\nmod R").setTitle("Modular Power Multiplication Gate").setBlurb("Multiplies the target by input B raised to the input A mod input R.\nOnly affects values less than R.\nNo effect if the multiplication would be irreversible.").setRequiredContextKeys("Input Range A","Input Range B","Input Range R").setExtraDisableReasonFinder(o("R",t)).setActualEffectToShaderProvider(function(e){return y.withArgs.apply(y,$traceurRuntime.spread(n(e,t,["A","B","R"]),[l.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r,n){return g(e,r,t,n)})}),c.TimesInverseBToTheAModRFamily=t.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(c.TimesBToTheAModRFamily).setSerializedId("/BToAmodR"+t).setSymbol("×B^-A\nmod R").setTitle("Modular Power Division Gate").setBlurb("Inverse-multiplies the target by input B raised to the input A mod input R.\nOnly affects values less than R.\nNo effect if the multiplication would be irreversible.").setRequiredContextKeys("Input Range A","Input Range B","Input Range R").setExtraDisableReasonFinder(o("R",t)).setActualEffectToShaderProvider(function(e){return y.withArgs.apply(y,$traceurRuntime.spread(n(e,t,["A","B","R"]),[l.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r,n){return g(e,r,-t,n)})}),c.all=$traceurRuntime.spread(c.TimesAModRFamily.all,c.TimesAModRInverseFamily.all,c.TimesBToTheAModRFamily.all,c.TimesInverseBToTheAModRFamily.all),{get ModularMultiplicationGates(){return c},get MODULAR_INVERSE_SHADER_CODE(){return d},get POW_MOD_SHADER_CODE(){return m},get modularMultiply(){return f},get modularUnmultiply(){return h},get modularPowerMultiply(){return g}}}),$traceurRuntime.registerModule("src/gates/ModularMultiplyAccumulateGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/MultiplyAccumulateGates.js","src/gates/ModularMultiplyAccumulateGates.js")).BIG_MUL_MOD_SHADER_CODE,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ModularMultiplyAccumulateGates.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ModularMultiplyAccumulateGates.js")),n=r.ketArgs,i=r.ketShaderPermute,a=r.ketInputGateShaderCode,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ModularIncrementGates.js","src/gates/ModularMultiplyAccumulateGates.js")).modulusTooBigChecker,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/ModularMultiplyAccumulateGates.js")).Util,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/ModularMultiplyAccumulateGates.js")).WglArg,l={},c=i("\n        uniform float factor;\n        "+a("A")+"\n        "+a("B")+"\n        "+a("R")+"\n        "+e+"\n    ","\n        float r = read_input_R();\n        float a = read_input_A();\n        float b = read_input_B();\n\n        float d = big_mul_mod(factor * a, b, r);\n\n        float in_id = floor(mod(out_id - d + 0.5, r));\n        if (in_id < 0.0) {\n            in_id += r;\n        }\n        if (in_id >= r) {\n            in_id -= r;\n        }\n\n        return out_id >= r ? out_id : in_id;\n    ");return l.PlusABModRFamily=t.buildFamily(1,16,function(t,e){return e.setSerializedId("+ABmodR"+t).setSymbol("+AB\nmod R").setTitle("Modular Multiply-Add Gate").setBlurb("Adds input A times input B into the target, mod input R.\nOnly affects values below R.").setRequiredContextKeys("Input Range A","Input Range B","Input Range R").setExtraDisableReasonFinder(o("R",t)).setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(n(e,t,["A","B","R"]),[s.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r,n){return e<n?(e+t*r)%n:e})}),l.MinusABModRFamily=t.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(l.PlusABModRFamily).setSerializedId("-ABmodR"+t).setSymbol("−AB\nmod R").setTitle("Modular Multiply-Subtract Gate").setBlurb("Subtracts input A times input B out of the target, mod input R.\nOnly affects values below R.").setRequiredContextKeys("Input Range A","Input Range B","Input Range R").setExtraDisableReasonFinder(o("R",t)).setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(n(e,t,["A","B","R"]),[s.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r,n){return e<n?u.properMod(e-t*r,n):e})}),l.all=$traceurRuntime.spread(l.PlusABModRFamily.all,l.MinusABModRFamily.all),{get ModularMultiplyAccumulateGates(){return l}}}),$traceurRuntime.registerModule("src/gates/MultiplicationGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/MultiplicationGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/MultiplicationGates.js")),n=t.ketArgs,r=t.ketShaderPermute,i=t.ketInputGateShaderCode,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ModularMultiplicationGates.js","src/gates/MultiplicationGates.js")),o=a.modularMultiply,u=a.modularUnmultiply,s=a.MODULAR_INVERSE_SHADER_CODE,l={},c=r("\n        "+s+"\n        "+i("A")+"\n    ","\n        float input_a = read_input_A();\n        input_a = mod(input_a, span);\n        float v = modular_multiplicative_inverse(input_a, span);\n        if (v == -1.0) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, v, span);\n    "),d=r("\n        "+s+"\n        "+i("A")+"\n    ","\n        float input_a = read_input_A();\n        input_a = mod(input_a, span);\n        if (modular_multiplicative_inverse(input_a, span) == -1.0) {\n            return out_id;\n        }\n        return big_mul_mod(out_id, input_a, span);\n    ");return l.TimesAFamily=e.buildFamily(1,16,function(r,e){return e.setSerializedId("*A"+r).setSymbol("×A").setTitle("Multiplication Gate").setBlurb("Multiplies the target by input A.\nNo effect if the input is even (would be irreversible).").setRequiredContextKeys("Input Range A").setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(n(e,r,["A"])))}).setKnownEffectToParametrizedPermutation(function(e,t){return o(e,t,1<<r)})}),l.TimesAInverseFamily=e.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(l.TimesAFamily).setSerializedId("/A"+r).setSymbol("×A^-1").setTitle("Inverse Multiplication Gate").setBlurb("Inverse-multiplies the target by input A (modulo 2^n).\nNo effect if the input is even (would be irreversible).").setRequiredContextKeys("Input Range A").setKnownEffectToParametrizedPermutation(function(e,t){return u(e,t,1<<r)}).setActualEffectToShaderProvider(function(e){return d.withArgs.apply(d,$traceurRuntime.spread(n(e,r,["A"])))})}),l.all=$traceurRuntime.spread(l.TimesAFamily.all,l.TimesAInverseFamily.all),{get MultiplicationGates(){return l},get MODULAR_INVERSE_SHADER_CODE(){return s}}}),$traceurRuntime.registerModule("src/gates/MultiplyAccumulateGates.js",[],function(){"use strict";function d(e){var t=Math.ceil(e/2),r=Math.ceil((e-t)/2),n=Math.max(e-t-r,1);return[n,r,e-n-r]}function t(l,c){return function(e){var t,r,n=(r=(t=d(l)[Symbol.iterator]()).next()).done?void 0:r.value,i=(r=t.next()).done?void 0:r.value,a=(r=t.next()).done?void 0:r.value,o=e&(1<<n)-1,u=e>>n&(1<<i)-1,s=e>>n+i;return s+=o*u*c,o|u<<n|(s&=(1<<a)-1)<<n+i}}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/MultiplyAccumulateGates.js")).Config,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/MultiplyAccumulateGates.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/MultiplyAccumulateGates.js")).GatePainting,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/MultiplyAccumulateGates.js")),a=i.ketArgs,o=i.ketShaderPermute,u=i.ketInputGateShaderCode,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/MultiplyAccumulateGates.js")).WglArg,l={},c="\n    // Avoids large multiplications that lose precision.\n    float big_mul_mod(float b, float f, float modulus) {\n        float t = 0.0;\n        float r;\n        for (int k = 0; k < "+Math.ceil(e.MAX_WIRE_COUNT/6)+"; k++) {\n            r = floor(mod(f + 0.5, 64.0));\n            f -= r;\n            t = floor(mod(t + b*r + 0.5, modulus));\n            b = floor(mod(b * 64.0 + 0.5, modulus));\n            f /= 64.0;\n        }\n        return t;\n    }\n",m=o("\n        uniform float factor;\n        "+u("A")+"\n        "+u("B")+"\n        "+c+"\n    ","\n        float d1 = read_input_A();\n        float d2 = read_input_B();\n        float d = floor(mod(big_mul_mod(d1, d2, span)*factor + 0.5, span));\n        return mod(out_id + span - d, span);");return l.Legacy_MultiplyAddFamily=r.buildFamily(3,16,function(o,e){return e.setSerializedId("c+=ab"+o).setSymbol("c+=ab").setTitle("Multiply-Add Gate").setBlurb("Adds the product of two numbers into a third.").setDrawer(n.SECTIONED_DRAWER_MAKER(["a","b","c+=ab"],d(o).slice(0,2).map(function(e){return e/o}))).setActualEffectToUpdateFunc(function(e){var t,r,n=(r=(t=d(o)[Symbol.iterator]()).next()).done?void 0:r.value,i=(r=t.next()).done?void 0:r.value,a=(r=t.next()).done?void 0:r.value;return l.MultiplyAddInputsFamily.ofSize(a).customOperation(e.withRow(e.row+n+i).withInputSetToRange("A",e.row,n).withInputSetToRange("B",e.row+n,i))}).setKnownEffectToPermutation(t(o,1))}),l.Legacy_MultiplySubtractFamily=r.buildFamily(3,16,function(o,e){return e.setAlternateFromFamily(l.Legacy_MultiplyAddFamily).setSerializedId("c-=ab"+o).setSymbol("c-=ab").setTitle("Multiply-Subtract Gate").setBlurb("Subtracts the product of two numbers from a third.").setDrawer(n.SECTIONED_DRAWER_MAKER(["a","b","c-=ab"],d(o).slice(0,2).map(function(e){return e/o}))).setActualEffectToUpdateFunc(function(e){var t,r,n=(r=(t=d(o)[Symbol.iterator]()).next()).done?void 0:r.value,i=(r=t.next()).done?void 0:r.value,a=(r=t.next()).done?void 0:r.value;return l.MultiplySubtractInputsFamily.ofSize(a).customOperation(e.withRow(e.row+n+i).withInputSetToRange("A",e.row,n).withInputSetToRange("B",e.row+n,i))}).setKnownEffectToPermutation(t(o,-1))}),l.MultiplyAddInputsFamily=r.buildFamily(1,16,function(n,e){return e.setSerializedId("+=AB"+n).setSymbol("+AB").setTitle("Multiply-Add Gate [Inputs A, B]").setBlurb("Adds the product of inputs A and B into the qubits covered by this gate.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(function(e){return m.withArgs.apply(m,$traceurRuntime.spread(a(e,n,["A","B"]),[s.float("factor",1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r){return e+t*r&(1<<n)-1})}),l.MultiplySubtractInputsFamily=r.buildFamily(1,16,function(n,e){return e.setAlternateFromFamily(l.MultiplyAddInputsFamily).setSerializedId("-=AB"+n).setSymbol("−AB").setTitle("Multiply-Subtract Gate [Inputs A, B]").setBlurb("Subtracts the product of inputs A and B out of the qubits covered by this gate.").setRequiredContextKeys("Input Range A","Input Range B").setActualEffectToShaderProvider(function(e){return m.withArgs.apply(m,$traceurRuntime.spread(a(e,n,["A","B"]),[s.float("factor",-1)]))}).setKnownEffectToParametrizedPermutation(function(e,t,r){return e-t*r&(1<<n)-1})}),l.SquareAddInputFamily=r.buildFamily(1,16,function(r,e){return e.setSerializedId("+=AA"+r).setSymbol("+A^2").setTitle("Square-Add Gate [Input A]").setBlurb("Adds the square of input A into the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setActualEffectToUpdateFunc(function(e){return l.MultiplyAddInputsFamily.ofSize(r).customOperation(e.withInputSetToOtherInput("B","A"))}).setKnownEffectToParametrizedPermutation(function(e,t){return e+t*t&(1<<r)-1})}),l.SquareSubtractInputFamily=r.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(l.SquareAddInputFamily).setSerializedId("-=AA"+r).setSymbol("-A^2").setTitle("Square-Subtract Gate [Input A]").setBlurb("Subtracts the square of input A out of the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setActualEffectToUpdateFunc(function(e){return l.MultiplySubtractInputsFamily.ofSize(r).customOperation(e.withInputSetToOtherInput("B","A"))}).setKnownEffectToParametrizedPermutation(function(e,t){return e-t*t&(1<<r)-1})}),l.all=$traceurRuntime.spread(l.Legacy_MultiplyAddFamily.all,l.Legacy_MultiplySubtractFamily.all,l.MultiplyAddInputsFamily.all,l.MultiplySubtractInputsFamily.all,l.SquareAddInputFamily.all,l.SquareSubtractInputFamily.all),{get MultiplyAccumulateGates(){return l},get BIG_MUL_MOD_SHADER_CODE(){return c},get MUL_STEP(){return 6}}}),$traceurRuntime.registerModule("src/gates/ParametrizedRotationGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ParametrizedRotationGates.js")).GateBuilder,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/ParametrizedRotationGates.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/ParametrizedRotationGates.js")),a=t.Complex,o=t.PARSE_COMPLEX_TOKEN_MAP_RAD,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/ParametrizedRotationGates.js")).Matrix,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ParametrizedRotationGates.js")),i=r.ketArgs,u=r.ketShader,l=r.ketShaderPhase,c=r.ketInputGateShaderCode,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/ParametrizedRotationGates.js")).WglArg,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/ParametrizedRotationGates.js")).Util,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/FormulaParser.js","src/gates/ParametrizedRotationGates.js")).parseFormula,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ExponentiatingGates.js","src/gates/ParametrizedRotationGates.js")),g=h.XExp,p=h.YExp,v=h.ZExp,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/ParametrizedRotationGates.js")).Config,b={};function R(i,e,a){var o=[1,.5,-1][e],u=[1,1,-.5][e];return function(e){s.paintBackground(e,y.TIME_DEPENDENT_HIGHLIGHT_COLOR),s.paintOutline(e);var t=i;e.isInToolbox||(t=t.split("f(t)").join(e.gate.param)),s.paintGateSymbol(e,t,-1!==i.indexOf("^")),s.paintGateButton(e);var r,n=e.gate.stableDuration()===1/0;e.isInToolbox&&!e.isHighlighted||n||(r=a*S(e.gate.param,2*e.stats.time-1,!1)||0,s.paintCycleState(e,r,o,u))}}function w(e){var t=e.getGateContext("Input Range A"),r=void 0===t?"ⁿ":m.digits_to_superscript_digits(""+t.length),n=e.gate.symbol.replace("ⁿ",r);s.paintBackground(e),s.paintOutline(e),s.paintGateSymbol(e,n)}var M=u("\n        uniform float factor;\n        "+c("A")+"\n    ","\n        float angle = read_input_A() * factor / _gen_input_span_A;\n        float c = cos(angle) * 0.5;\n        float s = sin(angle) * 0.5;\n        vec2 u = vec2(0.5 + c, s);\n        vec2 v = vec2(0.5 - c, -s);\n        // multiply state by the matrix [[u, v], [v, u]]\n        vec2 amp2 = inp(1.0-out_id);\n        return cmul(u, amp) + cmul(v, amp2);\n    "),_=u("\n        uniform float factor;\n        "+c("A")+"\n    ","\n        float angle = read_input_A() * factor / _gen_input_span_A;\n        float c = cos(angle) * 0.5;\n        float s = sin(angle) * 0.5;\n        vec2 u = vec2(c + 0.5, s);\n        vec2 v = vec2(s, 0.5 - c);\n        // multiply state by the matrix [[u, v], [-v, u]]\n        vec2 amp2 = inp(1.0-out_id);\n        vec2 vs = v * (-1.0 + 2.0 * out_id);\n        return cmul(u, amp) + cmul(vs, amp2);\n    "),x=l("\n        uniform float factor;\n        "+c("A")+"\n    ","\n        return read_input_A() * out_id * factor / _gen_input_span_A;\n    ");function S(e,t,r){var n=new Map($traceurRuntime.spread(o.entries()));void 0!==t&&n.set("t",t);try{var i=a.from(f(e,n));if(1e-4<Math.abs(i.imag))throw new Error("Non-real angle: "+e+" = "+i);return i.real}catch(e){return void(r&&console.warn(e))}}function T(e){if("number"==typeof e.gate.param)return e.gate.param;if("string"!=typeof e.gate.param)return"bad\nvalue";var t=!0,r=!1,n=void 0;try{for(var i,a=[.01,.63,.98][Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(void 0===S(e.gate.param,o,!1))return"bad\nformula"}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}function A(e){var t=void 0!==S(e.param,void 0,!1);e._stableDuration=t?1/0:0,"string"==typeof e.param?(e.width=Math.ceil((e.param.length+1)/5),e.alternate=e._copy(),(e.alternate.alternate=e).param.startsWith("-(")&&e.param.endsWith(")")?e.alternate.param=e.param.substring(2,e.param.length-1):e.alternate.param="-("+e.param+")"):(e.width=1,e.alternate=e)}function C(r){return function(e){var t=prompt("Enter a formula to use for the "+r+".\n\nThe formula can depend on the time variable t.\nTime t starts at -1, grows to +1 over time, then jumps back to -1.\nInvalid results will default to 0.\n\nAvailable constants: e, pi\nAvailable functions: cos, sin, acos, asin, tan, atan, ln, sqrt, exp\nAvailable operators: + * / - ^",""+e.param);return null===t||""===t.trim()?e:e.withParam(t)}}return b.XToA=(new e).setSerializedId("X^(A/2^n)").setSymbol("X^A/2ⁿ").setTitle("Parametrized X Gate").setBlurb("Rotates the target by input A / 2ⁿ'th of a half turn around the X axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(w).setActualEffectToShaderProvider(function(e){return M.withArgs.apply(M,$traceurRuntime.spread(i(e,1,["A"]),[d.float("factor",Math.PI)]))}).promiseEffectIsStable().promiseEffectIsUnitary().gate,b.XToMinusA=(new e).setAlternate(b.XToA).setSerializedId("X^(-A/2^n)").setSymbol("X^-A/2ⁿ").setTitle("Parametrized -X Gate").setBlurb("Counter-rotates the target by input A / 2ⁿ'th of a half turn around the X axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(w).setActualEffectToShaderProvider(function(e){return M.withArgs.apply(M,$traceurRuntime.spread(i(e,1,["A"]),[d.float("factor",-Math.PI)]))}).promiseEffectIsStable().promiseEffectIsUnitary().gate,b.YToA=(new e).setSerializedId("Y^(A/2^n)").setSymbol("Y^A/2ⁿ").setTitle("Parametrized Y Gate").setBlurb("Rotates the target by input A / 2ⁿ'th of a half turn around the Y axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(w).setActualEffectToShaderProvider(function(e){return _.withArgs.apply(_,$traceurRuntime.spread(i(e,1,["A"]),[d.float("factor",Math.PI)]))}).promiseEffectIsStable().promiseEffectIsUnitary().gate,b.YToMinusA=(new e).setAlternate(b.YToA).setSerializedId("Y^(-A/2^n)").setSymbol("Y^-A/2ⁿ").setTitle("Parametrized -Y Gate").setBlurb("Counter-rotates the target by input A / 2ⁿ'th of a half turn around the Y axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(w).setActualEffectToShaderProvider(function(e){return _.withArgs.apply(_,$traceurRuntime.spread(i(e,1,["A"]),[d.float("factor",-Math.PI)]))}).promiseEffectIsStable().promiseEffectIsUnitary().gate,b.ZToA=(new e).setSerializedId("Z^(A/2^n)").setSymbol("Z^A/2ⁿ").setTitle("Parametrized Z Gate").setBlurb("Rotates the target by input A / 2ⁿ'th of a half turn around the Z axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(w).setActualEffectToShaderProvider(function(e){return x.withArgs.apply(x,$traceurRuntime.spread(i(e,1,["A"]),[d.float("factor",Math.PI)]))}).promiseEffectIsStable().promiseEffectOnlyPhases().gate,b.ZToMinusA=(new e).setAlternate(b.ZToA).setSerializedId("Z^(-A/2^n)").setSymbol("Z^-A/2ⁿ").setTitle("Parametrized -Z Gate").setBlurb("Counter-rotates the target by input A / 2ⁿ'th of a half turn around the Z axis.\nn is the number of qubits in input A.").setRequiredContextKeys("Input NO_DEFAULT Range A").setDrawer(w).setActualEffectToShaderProvider(function(e){return x.withArgs.apply(x,$traceurRuntime.spread(i(e,1,["A"]),[d.float("factor",-Math.PI)]))}).promiseEffectIsStable().promiseEffectOnlyPhases().gate,b.FormulaicRotationX=(new e).setSerializedIdAndSymbol("X^ft").setTitle("Formula X Rotation").setBlurb("Rotates around X by an amount determined by a formula.").setDrawer(R("X^f(t)",0,Math.PI)).setWidth(2).setExtraDisableReasonFinder(T).setOnClickGateFunc(C("X gate's exponent")).setEffectToTimeVaryingMatrix(function(e,t){var r=S(t,2*e-1,!0)||0;return n.fromPauliRotation(r/2,0,0)}).setWithParamPropertyRecomputeFunc(A).promiseEffectIsUnitary().gate.withParam("sin(pi t)"),b.FormulaicRotationY=(new e).setSerializedIdAndSymbol("Y^ft").setTitle("Formula Y Rotation").setBlurb("Rotates around Y by an amount determined by a formula.").setDrawer(R("Y^f(t)",1,Math.PI)).setWidth(2).setExtraDisableReasonFinder(T).setOnClickGateFunc(C("Y gate's exponent")).setEffectToTimeVaryingMatrix(function(e,t){var r=S(t,2*e-1,!0)||0;return n.fromPauliRotation(0,r/2,0)}).setWithParamPropertyRecomputeFunc(A).promiseEffectIsUnitary().gate.withParam("sin(pi t)"),b.FormulaicRotationZ=(new e).setSerializedIdAndSymbol("Z^ft").setTitle("Formula Z Rotation").setBlurb("Rotates around Z by an amount determined by a formula.").setDrawer(R("Z^f(t)",2,Math.PI)).setWidth(2).setExtraDisableReasonFinder(T).setOnClickGateFunc(C("Z gate's exponent")).setEffectToTimeVaryingMatrix(function(e,t){var r=S(t,2*e-1,!0)||0;return n.fromPauliRotation(0,0,r/2)}).setWithParamPropertyRecomputeFunc(A).promiseEffectOnlyPhases().gate.withParam("sin(pi t)"),b.FormulaicRotationRx=(new e).setSerializedIdAndSymbol("Rxft").setTitle("Formula Rx Gate").setBlurb("Rotates around X by an angle in radians determined by a formula.").setDrawer(R("Rx(f(t))",0,1)).setWidth(2).setExtraDisableReasonFinder(T).setOnClickGateFunc(C("Rx gate's angle in radians")).setEffectToTimeVaryingMatrix(function(e,t){return g((S(t,2*e-1,!0)||0)/Math.PI/4)}).setWithParamPropertyRecomputeFunc(A).promiseEffectIsUnitary().gate.withParam("pi t^2"),b.FormulaicRotationRy=(new e).setSerializedIdAndSymbol("Ryft").setTitle("Formula Ry Gate").setBlurb("Rotates around Y by an angle in radians determined by a formula.").setDrawer(R("Ry(f(t))",1,1)).setWidth(2).setExtraDisableReasonFinder(T).setOnClickGateFunc(C("Ry gate's angle in radians")).setEffectToTimeVaryingMatrix(function(e,t){return p((S(t,2*e-1,!0)||0)/Math.PI/4)}).setWithParamPropertyRecomputeFunc(A).promiseEffectIsUnitary().gate.withParam("pi t^2"),b.FormulaicRotationRz=(new e).setSerializedIdAndSymbol("Rzft").setTitle("Formula Rz Gate").setBlurb("Rotates around Z by an angle in radians determined by a formula.").setDrawer(R("Rz(f(t))",2,1)).setWidth(2).setExtraDisableReasonFinder(T).setOnClickGateFunc(C("Rz gate's angle in radians")).setEffectToTimeVaryingMatrix(function(e,t){return v((S(t,2*e-1,!0)||0)/Math.PI/4)}).setWithParamPropertyRecomputeFunc(A).promiseEffectOnlyPhases().gate.withParam("pi t^2"),b.all=[b.XToA,b.XToMinusA,b.YToA,b.YToMinusA,b.ZToA,b.ZToMinusA,b.FormulaicRotationX,b.FormulaicRotationY,b.FormulaicRotationZ,b.FormulaicRotationRx,b.FormulaicRotationRy,b.FormulaicRotationRz],{get ParametrizedRotationGates(){return b}}}),$traceurRuntime.registerModule("src/gates/PhaseGradientGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/PhaseGradientGates.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/PhaseGradientGates.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/PhaseGradientGates.js")).GatePainting,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/PhaseGradientGates.js")),i=r.ketArgs,a=r.ketShaderPhase,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/MultiplyAccumulateGates.js","src/gates/PhaseGradientGates.js")).MUL_STEP,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/PhaseGradientGates.js")).WglArg,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/PhaseGradientGates.js")).Matrix,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/PhaseGradientGates.js")).Complex,c=a("\n        uniform float factor;\n\n        /// Scales an angle by an integer factor.\n        /// Performs the multiplication gradually, to avoid losing precision.\n        float angle_mul(float base_angle, float whole_factor) {\n            float result = 0.0;\n            for (int k = 0; k < "+Math.ceil(e.MAX_WIRE_COUNT/o)+"; k++) {\n                result += base_angle * mod(whole_factor, "+(1<<o)+".0);\n                result = mod(result, 6.283185307179586476925286766559);\n                whole_factor = floor(whole_factor / "+(1<<o)+".0);\n                base_angle = mod(base_angle * "+(1<<o)+".0, 6.283185307179586476925286766559);\n            }\n            return result;\n        }\n    ","\n        return angle_mul(factor, out_id);\n    "),d={};return d.PhaseGradientFamily=t.buildFamily(1,16,function(t,e){return e.setSerializedId("PhaseGradient"+t).setSymbol("Grad^½").setTitle("Half Gradient Gate").setBlurb("Phases the target by an amount proportional its value.").setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(i(e,t),[u.float("factor",Math.PI/(1<<t))]))}).setKnownEffectToPhaser(function(e){return e/(2<<t)})}),d.PhaseDegradientFamily=t.buildFamily(1,16,function(t,e){return e.setAlternateFromFamily(d.PhaseGradientFamily).setSerializedId("PhaseUngradient"+t).setSymbol("Grad^-½").setTitle("Inverse Half Gradient Gate").setBlurb("Counter-phases the target by an amount proportional its value.").setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(i(e,t),[u.float("factor",-Math.PI/(1<<t))]))}).setKnownEffectToPhaser(function(e){return-e/(2<<t)})}),d.DynamicPhaseGradientFamily=t.buildFamily(1,16,function(r,e){return e.setSerializedId("grad^t"+r).setSymbol("Grad^t").setTitle("Cycling Gradient Gate").setBlurb("Phases the target by a cycling amount proportional its value.").setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(i(e,r),[u.float("factor",e.time*Math.PI*2)]))}).setEffectToTimeVaryingMatrix(function(t){return s.generateDiagonal(1<<r,function(e){return l.polar(1,2*t*Math.PI*e)})}).promiseEffectOnlyPhases().setDrawer(n.makeCycleDrawer(-1,-1,1,-Math.PI/2))}),d.DynamicPhaseDegradientFamily=t.buildFamily(1,16,function(r,e){return e.setAlternateFromFamily(d.DynamicPhaseGradientFamily).setSerializedId("grad^-t"+r).setSymbol("Grad^-t").setTitle("Inverse Cycling Gradient Gate").setBlurb("Counter-phases the target by a cycling amount proportional its value.").setActualEffectToShaderProvider(function(e){return c.withArgs.apply(c,$traceurRuntime.spread(i(e,r),[u.float("factor",-e.time*Math.PI*2)]))}).setEffectToTimeVaryingMatrix(function(t){return s.generateDiagonal(1<<r,function(e){return l.polar(1,2*t*Math.PI*-e)})}).promiseEffectOnlyPhases().setDrawer(n.makeCycleDrawer(1,-1,1,Math.PI/2))}),d.all=$traceurRuntime.spread(d.PhaseGradientFamily.all,d.PhaseDegradientFamily.all,d.DynamicPhaseGradientFamily.all,d.DynamicPhaseDegradientFamily.all),{get PhaseGradientGates(){return d},get PHASE_GRADIENT_SHADER(){return c}}}),$traceurRuntime.registerModule("src/gates/PivotFlipGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/PivotFlipGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/PivotFlipGates.js")),r=t.ketArgs,n=t.ketShaderPermute,i=t.ketInputGateShaderCode,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ModularIncrementGates.js","src/gates/PivotFlipGates.js")).modulusTooBigChecker,o={},u=n("\n        "+i("A")+"\n    ","\n        float a = read_input_A();\n        return out_id >= a ? out_id : a - out_id - 1.0;\n    ");return o.FlipUnderA=e.buildFamily(1,16,function(t,e){return e.setSerializedId("Flip<A"+t).setSymbol("Flip\n< A").setTitle("Pivot-Flip Gate").setBlurb("Reverses the order of states below the pivot value.").setRequiredContextKeys("Input Range A").setExtraDisableReasonFinder(a("A",t,"pivot")).setActualEffectToShaderProvider(function(e){return u.withArgs.apply(u,$traceurRuntime.spread(r(e,t,["A"])))}).setKnownEffectToParametrizedPermutation(function(e,t){return t<=e?e:t-e-1})}),o.all=$traceurRuntime.spread(o.FlipUnderA.all),{get PivotFlipGates(){return o}}}),$traceurRuntime.registerModule("src/gates/PostSelectionGates.js",[],function(){"use strict";function e(e){var t,r,n,i,a;e.isInToolbox||e.isHighlighted?o.DEFAULT_DRAWER(e):(e.painter.fillRect(e.rect,"white"),o.paintGateSymbol(e)),e.isInToolbox||(r=(t=e.rect).x,n=t.y,i=t.w,a=t.h,e.painter.print("post-",r+i/2,n,"center","hanging","red","10px sans-serif",i,a/2),e.painter.print("select",r+i/2,n+a,"center","bottom","red","10px sans-serif",i,a/2))}var t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/PostSelectionGates.js")).Complex,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/PostSelectionGates.js")).GateBuilder,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/PostSelectionGates.js")).GatePainting,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/PostSelectionGates.js")).Matrix,i={};return i.PostSelectOff=(new r).setSerializedIdAndSymbol("|0⟩⟨0|").setTitle("Postselect Off").setBlurb("Keeps OFF states, discards/retries ON states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,0,0,0)).gate,i.PostSelectOn=(new r).setAlternate(i.PostSelectOff).setSerializedIdAndSymbol("|1⟩⟨1|").setTitle("Postselect On").setBlurb("Keeps On states, discards/retries Off states.").setDrawer(e).setKnownEffectToMatrix(n.square(0,0,0,1)).gate,i.PostSelectAntiX=(new r).setSerializedId("|+⟩⟨+|").setSymbol("|+⟩⟨+|").setTitle("Postselect X-Off").setBlurb("Keeps ON+OFF states, discards/retries ON-OFF states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,1,1,1).times(.5)).gate,i.PostSelectX=(new r).setAlternate(i.PostSelectAntiX).setSerializedId("|-⟩⟨-|").setSymbol("|-⟩⟨-|").setTitle("Postselect X-On").setBlurb("Keeps ON-OFF states, discards/retries ON+OFF states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,-1,-1,1).times(.5)).gate,i.PostSelectAntiY=(new r).setSerializedId("|X⟩⟨X|").setSymbol("|i⟩⟨i|").setTitle("Postselect Y-Off").setBlurb("Keeps ON+iOFF states, discards ON-iOFF states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,t.I.neg(),t.I,1).times(.5)).gate,i.PostSelectY=(new r).setAlternate(i.PostSelectAntiY).setSerializedId("|/⟩⟨/|").setSymbol("|-i⟩⟨-i|").setTitle("Postselect Y-On").setBlurb("Keeps ON-iOFF states, discards/retries ON+iOFF states.").setDrawer(e).setKnownEffectToMatrix(n.square(1,t.I,t.I.neg(),1).times(.5)).gate,i.all=[i.PostSelectOff,i.PostSelectOn,i.PostSelectAntiX,i.PostSelectX,i.PostSelectAntiY,i.PostSelectY],{get PostSelectionGates(){return i}}}),$traceurRuntime.registerModule("src/gates/PoweringGates.js",[],function(){"use strict";function t(e){var t=Math.cos(u*e)/2,r=Math.sin(u*e)/2;return new a(2,2,new Float32Array([.5+t,r,.5-t,-r,.5-t,-r,.5+t,r]))}function r(e){var t=Math.cos(u*e)/2,r=Math.sin(u*e)/2;return new a(2,2,new Float32Array([.5+t,r,-r,t-.5,r,.5-t,.5+t,r]))}function n(e){var t=Math.cos(u*e),r=Math.sin(u*e);return new a(2,2,new Float32Array([1,0,0,0,0,0,t,r]))}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/PoweringGates.js")).GateBuilder,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/PoweringGates.js")).GatePainting,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/PoweringGates.js")).Matrix,o={},u=2*Math.PI;return o.XForward=(new e).setSerializedIdAndSymbol("X^t").setTitle("X-Raising Gate (forward)").setBlurb("Right-handed cycle from no-op to X.").setDrawer(i.makeCycleDrawer(1,1)).setEffectToTimeVaryingMatrix(t).promiseEffectIsUnitary().gate,o.XBackward=(new e).setAlternate(o.XForward).setSerializedIdAndSymbol("X^-t").setTitle("X-Raising Gate (backward)").setBlurb("Left-handed cycle from no-op to X.").setDrawer(i.makeCycleDrawer(-1,1)).setEffectToTimeVaryingMatrix(function(e){return t(-e)}).promiseEffectIsUnitary().gate,o.YForward=(new e).setSerializedIdAndSymbol("Y^t").setTitle("Y-Raising Gate (forward)").setBlurb("Right-handed cycle from no-op to Y.").setDrawer(i.makeCycleDrawer(.5,1)).setEffectToTimeVaryingMatrix(r).promiseEffectIsUnitary().gate,o.YBackward=(new e).setAlternate(o.YForward).setSerializedIdAndSymbol("Y^-t").setTitle("Y-Raising Gate (backward)").setBlurb("Left-handed cycle from no-op to Y.").setDrawer(i.makeCycleDrawer(-.5,1)).setEffectToTimeVaryingMatrix(function(e){return r(-e)}).promiseEffectIsUnitary().gate,o.ZForward=(new e).setSerializedIdAndSymbol("Z^t").setTitle("Z-Raising Gate (forward)").setBlurb("Right-handed cycle from no-op to Z.").setDrawer(i.makeCycleDrawer(-1,-.5)).setEffectToTimeVaryingMatrix(n).promiseEffectOnlyPhases().gate,o.ZBackward=(new e).setAlternate(o.ZForward).setSerializedIdAndSymbol("Z^-t").setTitle("Z-Raising Gate (backward)").setBlurb("Left-handed cycle from no-op to Z.").setDrawer(i.makeCycleDrawer(1,-.5)).setEffectToTimeVaryingMatrix(function(e){return n(-e)}).promiseEffectOnlyPhases().gate,o.all=[o.XForward,o.YForward,o.ZForward,o.XBackward,o.YBackward,o.ZBackward],{get PoweringGates(){return o}}}),$traceurRuntime.registerModule("src/gates/ProbabilityDisplay.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/ProbabilityDisplay.js")).Complex,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/ProbabilityDisplay.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ProbabilityDisplay.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/ProbabilityDisplay.js")).GatePainting,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/gates/ProbabilityDisplay.js")).GateShaders,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/ProbabilityDisplay.js")).MathPainter,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/ProbabilityDisplay.js")).Matrix,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/ProbabilityDisplay.js")).Point,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/gates/ProbabilityDisplay.js")).Rect,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/gates/ProbabilityDisplay.js")).Seq,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/gates/ProbabilityDisplay.js")).Shaders,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/ProbabilityDisplay.js")).Util,t=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/ProbabilityDisplay.js")).WglConfiguredShader,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/gates/ProbabilityDisplay.js"))),l=t.Inputs,c=t.Outputs,d=t.currentShaderCoder,m=t.makePseudoShaderWithInputsAndOutputAndCode,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/gates/ProbabilityDisplay.js")).WglTexturePool,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/gates/ProbabilityDisplay.js")).WglTextureTrader;function p(e,t,r,n){var i=new g(e);i.dontDeallocCurrentTexture();var a=d().vec2.arrayPowerSizeOfTexture(e);for(i.shadeAndTrade(function(e){return v(e,t)},f.takeVecFloatTex(a)),i.shadeAndTrade(function(e){return o.cycleAllBitsFloat(e,-r)});n<a;)--a,i.shadeHalveAndTrade(s.sumFoldFloat);return d().float.needRearrangingToBeInVec4Format&&i.shadeQuarterAndTrade(s.packFloatIntoVec4),i.currentTexture}var v=function(e,t){return w(e,t)},w=m([l.vec2("input"),l.bool("control")],c.float(),"float outputFor(float k) {\n        vec2 amp = read_input(k);\n        return dot(amp, amp) * read_control(k);\n    }");function M(e,t){for(var r=1<<t,n=0,i=0;i<r;i++)n+=e[i];if(isNaN(n)||n<1e-6)return u.zero(1,r).times(NaN);for(var a=new Float32Array(2*r),o=0;o<r;o++)a[2*o]=e[o]/n;return new u(1,r,a)}function _(t){return{probabilities:a.range(t.height()).map(function(e){return r.realPartOf(t.cell(0,e))}).toArray()}}function x(e){!function(e){var t=e.painter,r=e.rect,n=r.x,i=r.y,a=r.w,o=r.h,u=1<<e.gate.height,s=o/u;if(t.fillRect(e.rect,h.DISPLAY_GATE_BACK_COLOR),s<1)return e.painter.ctx.save(),e.painter.ctx.globalAlpha*=.2,t.fillRect(e.rect,"lightgray"),e.painter.ctx.restore();var l=e.gate.height-5;t.trace(function(e){for(var t=1;t<u;t++)e.line(n,i+s*t,n+a,i+s*t)}).thenStroke("lightgray",l<=0?1:1/l),t.strokeRect(e.rect,"lightgray")}(e);var t,r=e.customStats;void 0===r||r.hasNaN()?e.painter.printParagraph("NaN",e.rect,new i(.5,.5),"red"):((t=8<e.rect.h/r.height())||function(e){var t=e.painter,r=e.rect,n=r.x,i=r.y,a=r.w,o=r.h,u=e.customStats,s=1<<e.gate.height,l=o/s,c=Math.max(l,1);t.ctx.save(),t.ctx.beginPath(),t.ctx.moveTo(n,i);for(var d=1/(4+Math.max(8,e.gate.height)),m=0;m<s;m++){var f=u.rawBuffer()[2*m],h=n+a*Math.min(1,Math.max(0,1+Math.log(f)*d)),g=i+l*m;t.ctx.lineTo(h,g),t.ctx.lineTo(h,g+c)}t.ctx.lineTo(n,i+o),t.ctx.lineWidth=1,t.ctx.strokeStyle="#CCC",t.ctx.stroke(),t.ctx.restore()}(e),function(e){var t=e.painter,r=e.rect,n=r.x,i=r.y,a=r.w,o=r.h,u=e.customStats,s=1<<e.gate.height,l=o/s,c=Math.max(l,1);t.ctx.save(),t.ctx.beginPath(),t.ctx.moveTo(n,i);for(var d=0;d<s;d++){var m=n+a*u.rawBuffer()[2*d],f=i+l*d;t.ctx.lineTo(m,f),t.ctx.lineTo(m,f+c)}t.ctx.lineTo(n,i+o),t.ctx.lineTo(n,i),t.ctx.strokeStyle="gray",t.ctx.lineWidth=1,t.ctx.stroke(),t.ctx.fillStyle=h.DISPLAY_GATE_FORE_COLOR,t.ctx.fill(),t.ctx.restore()}(e),t&&function(e){for(var t=e.painter,r=e.rect,n=r.x,i=r.y,a=r.w,o=r.h,u=e.customStats,s=o/u.height(),l=0;l<u.height();l++){var c=u.rawBuffer()[2*l];t.print((100*c).toFixed(1)+"%",n+a-2,i+s*(l+.5),"right","middle","black","8pt monospace",a-4,s)}}(e)),function(e){var t=e.painter,r=e.rect,n=r.x,i=r.y,a=r.w,o=r.h,u=e.customStats,s=1<<e.gate.height,l=o/s,c=!0,d=!1,m=void 0;try{for(var f,h=e.focusPoints[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var g,p=f.value,v=Math.floor((p.y-i)/l);e.rect.containsPoint(p)&&0<=v&&v<s&&(g=void 0===u?NaN:u.rawBuffer()[2*v],t.strokeRect(new b(n,i+v*l,a,l),"orange",2),y.paintDeferredValueTooltip(t,n+a,i+v*l,"Chance of |"+R.bin(v,e.gate.height)+"⟩ (decimal "+v+") if measured","raw: "+(100*g).toFixed(4)+"%","log: "+(10*Math.log10(g)).toFixed(1)+" dB"))}}catch(e){d=!0,m=e}finally{try{c||null==h.return||h.return()}finally{if(d)throw m}}}(e)}function S(e){return e.setSymbol("Chance").setTitle("Probability Display").setBlurb("Shows chances of outcomes if a measurement was performed.\nUse controls to see conditional probabilities.").promiseHasNoNetEffectOnStateVector().setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})}var T=e.buildFamily(1,16,function(e,t){return 1===e?S(t).setSerializedId("Chance").markAsDrawerNeedsSingleQubitDensityStats().setDrawer(n.makeDisplayDrawer(function(e){var t=e.positionInCircuit,r=t.row,n=t.col;y.paintProbabilityBox(e.painter,e.stats.controlledWireProbabilityJustAfter(r,n),e.rect,e.focusPoints)})):(r=e,S(t).setSerializedId("Chance"+r).setStatTexturesMaker(function(e){return p(e.stateTrader.currentTexture,e.controlsTexture,e.row,r)}).setStatPixelDataPostProcessor(function(e){return M(e,r)}).setProcessedStatsToJsonFunc(_).setDrawer(n.makeDisplayDrawer(x)));var r});return{get ProbabilityDisplayFamily(){return T},get probabilityStatTexture(){return p},get probabilityPixelsToColumnVector(){return M},get amplitudesToProbabilities(){return v},get probabilityDataToJson(){return _}}}),$traceurRuntime.registerModule("src/gates/QuarterTurnGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/QuarterTurnGates.js")),t=(e.Gate,e.GateBuilder),r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/QuarterTurnGates.js")).Matrix,n={};return n.SqrtXForward=(new t).setSerializedIdAndSymbol("X^½").setTitle("√X Gate").setBlurb("Principle square root of Not.").setKnownEffectToMatrix(r.fromPauliRotation(.25,0,0)).gate,n.SqrtXBackward=(new t).setAlternate(n.SqrtXForward).setSerializedIdAndSymbol("X^-½").setTitle("X^-½ Gate").setBlurb("Adjoint square root of Not.").setKnownEffectToMatrix(r.fromPauliRotation(.75,0,0)).gate,n.SqrtYForward=(new t).setSerializedIdAndSymbol("Y^½").setTitle("√Y Gate").setBlurb("Principle square root of Y.").setKnownEffectToMatrix(r.fromPauliRotation(0,.25,0)).gate,n.SqrtYBackward=(new t).setAlternate(n.SqrtYForward).setSerializedIdAndSymbol("Y^-½").setTitle("Y^-½ Gate").setBlurb("Adjoint square root of Y.").setKnownEffectToMatrix(r.fromPauliRotation(0,.75,0)).gate,n.SqrtZForward=(new t).setSerializedId("Z^½").setSymbol("S").setTitle("√Z Gate").setBlurb("Principle square root of Z.\nAlso known as the 'S' gate.").setKnownEffectToMatrix(r.fromPauliRotation(0,0,.25)).gate,n.SqrtZBackward=(new t).setAlternate(n.SqrtZForward).setSerializedId("Z^-½").setSymbol("S^-1").setTitle("Z^-½ Gate").setBlurb("Adjoint square root of Z.").setKnownEffectToMatrix(r.fromPauliRotation(0,0,.75)).gate,n.all=[n.SqrtXForward,n.SqrtYForward,n.SqrtZForward,n.SqrtXBackward,n.SqrtYBackward,n.SqrtZBackward],{get QuarterTurnGates(){return n}}}),$traceurRuntime.registerModule("src/gates/ReverseBitsGate.js",[],function(){"use strict";function r(r){return function(e){var t;return(t=o[r]).withArgs.apply(t,$traceurRuntime.spread(i(e,r)))}}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/ReverseBitsGate.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ReverseBitsGate.js")).Gate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ReverseBitsGate.js")),i=n.ketArgs,a=n.ketShaderPermute,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/gates/ReverseBitsGate.js")).Seq.range(e.MAX_WIRE_COUNT+1).map(function(e){return e<2?void 0:a("","\n        float rev = 0.0;\n        for (int k = 0; k < "+e+"; k++) {\n            rev *= 2.0;\n            rev += mod(out_id, 2.0);\n            out_id = floor(out_id*0.5);\n        }\n        return rev;\n    ",e)}).toArray(),u=t.buildFamily(2,16,function(t,e){return e.setSerializedId("rev"+t).setSymbol("Reverse").setTitle("Reverse Order").setBlurb("Swaps bits into the opposite order.").setKnownEffectToBitPermutation(function(e){return t-1-e}).setActualEffectToShaderProvider(r(t))});return{get ReverseBitsGateFamily(){return u},get reverseShaderForSize(){return r}}}),$traceurRuntime.registerModule("src/gates/SampleDisplay.js",[],function(){"use strict";var w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/SampleDisplay.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/SampleDisplay.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/SampleDisplay.js")).GatePainting,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/SampleDisplay.js")).MathPainter,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/SampleDisplay.js")).Point,_=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/gates/SampleDisplay.js")).Rect,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/SampleDisplay.js")).Util,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ProbabilityDisplay.js","src/gates/SampleDisplay.js")),i=t.probabilityStatTexture,a=t.probabilityPixelsToColumnVector,o=t.probabilityDataToJson;function u(e){for(var t=e.painter,r=e.rect,n=r.x,i=r.y,a=r.w,o=r.h,u=w.WIRE_SPACING,s=i+o/2-u*e.gate.height/2,l=function(e){for(var t=e.customStats,r=t.rawBuffer(),n=e.painter.rng.random(),i=t.height(),a=0;;a++){var o=r[2*a];if(n-=o,a===i-1||n<1e-5)return{i:a,p:o}}}(e),c=l.i,d=l.p,m=0;m<e.gate.height;m++){var f=0!=(c>>m&1);f&&t.fillRect(new _(n,s+u*m+5,a,u-10),w.OPERATION_FORE_COLOR),t.print(f?"on":"off",n+a/2,s+u*(m+.5),"center","middle","black","16px sans-serif",a,u)}var h=!0,g=!1,p=void 0;try{for(var v,y=e.focusPoints[Symbol.iterator]();!(h=(v=y.next()).done);h=!0){var b=v.value,R=Math.floor(2*(b.y-i)/u)/2;e.rect.containsPoint(b)&&M.paintDeferredValueTooltip(t,n+a,i+R*u,"Sampled |"+x.bin(c,e.gate.height)+"⟩","decimal: |"+c+"⟩","chance: "+(100*d).toFixed(4)+"%",w.OPERATION_BACK_COLOR)}}catch(e){g=!0,p=e}finally{try{h||null==y.return||y.return()}finally{if(g)throw p}}}function s(e){e.painter.fillRect(e.rect,w.OPERATION_BACK_COLOR);var t=e.customStats;void 0===t||t.hasNaN()?e.painter.printParagraph("NaN",e.rect,new n(.5,.5),"red"):u(e),e.painter.strokeRect(e.rect,"lightgray")}var l=e.buildFamily(1,16,function(t,e){return e.setSerializedId("Sample"+t).setSymbol("Sample").setTitle("Sampled Results Display").setBlurb("Shows a random sample of possible measurement outcomes.\nUse controls to see conditional samples.").setStatTexturesMaker(function(e){return i(e.stateTrader.currentTexture,e.controlsTexture,e.row,t)}).setStatPixelDataPostProcessor(function(e){return a(e,t)}).promiseHasNoNetEffectOnStateVectorButStillRequiresDynamicRedraw().setProcessedStatsToJsonFunc(o).setDrawer(r.makeDisplayDrawer(s)).setExtraDisableReasonFinder(function(e){return e.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})});return{get SampleDisplayFamily(){return l}}}),$traceurRuntime.registerModule("src/gates/SpacerGate.js",[],function(){"use strict";var o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/SpacerGate.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/SpacerGate.js")).GateBuilder,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/SpacerGate.js")).GatePainting,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/gates/SpacerGate.js")).Rect,t=(new e).setSerializedIdAndSymbol("…").setTitle("Spacer").setBlurb("A gate with no effect.").markAsNotInterestedInControls().promiseHasNoNetEffectOnStateVector().setDrawer(function(e){var t,r,n,i,a;e.isInToolbox||e.isHighlighted?(t=o.GATE_FILL_COLOR,e.isHighlighted&&(t=o.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.fillRect(e.rect,t),u.paintOutline(e)):(n=(r=e.rect.center()).x,i=r.y,a=new s(n-14,i-2,28,4),e.painter.fillRect(a,o.BACKGROUND_COLOR_CIRCUIT)),e.painter.fillCircle(e.rect.center().offsetBy(7,0),2,"black"),e.painter.fillCircle(e.rect.center(),2,"black"),e.painter.fillCircle(e.rect.center().offsetBy(-7,0),2,"black")}).gate;return{get SpacerGate(){return t}}}),$traceurRuntime.registerModule("src/gates/SwapGateHalf.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/SwapGateHalf.js")).GateBuilder,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/SwapGateHalf.js")).GatePainting,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/SwapGateHalf.js")).Matrix,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/gates/SwapGateHalf.js")).Rect,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/gates/SwapGateHalf.js")).Seq,u=(new e).setSerializedIdAndSymbol("Swap").setTitle("Swap Gate [Half]").setBlurb("Swaps the values of two qubits.\n(Place two in the same column.)").setKnownEffectToMatrix(t.square(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1)).setDrawer(function(e){var t;e.isInToolbox||e.isHighlighted?r.DEFAULT_DRAWER(e):(t=n.centeredSquareWithRadius(e.rect.center(),e.rect.w/6),e.painter.strokeLine(t.topLeft(),t.bottomRight()),e.painter.strokeLine(t.topRight(),t.bottomLeft()))}).setExtraDisableReasonFinder(function(t){var r=t.innerColumn,e=o.range(r.gates.length).filter(function(e){return r.gates[e]===u}),n=e.count();if(1===n)return"need\nother\nswap";if(2<n)return"too\nmany\nswap";var i=e.any(function(e){return 0!=(t.measuredMask&1<<e)}),a=e.any(function(e){return 0==(t.measuredMask&1<<e)});return i&&r.hasCoherentControl(t.measuredMask)||i&&a&&r.hasControl()?"no\nremix\n(sorry)":void 0}).gate;return{get SwapGateHalf(){return u}}}),$traceurRuntime.registerModule("src/gates/VariousXGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/VariousXGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/VariousXGates.js")).Matrix,r={};return r.X3=e.fromKnownMatrix("X^⅓",t.fromPauliRotation(1/6,0,0),"X^⅓ Gate","Principle third root of X."),r.X3i=e.fromKnownMatrix("X^-⅓",t.fromPauliRotation(-1/6,0,0),"X^-⅓ Gate","Adjoint third root of X.",void 0,r.X3),r.X4=e.fromKnownMatrix("X^¼",t.fromPauliRotation(1/8,0,0),"X^¼ Gate","Principle fourth root of X."),r.X4i=e.fromKnownMatrix("X^-¼",t.fromPauliRotation(-1/8,0,0),"X^-¼ Gate","Adjoint fourth root of X.",void 0,r.X4),r.X8=e.fromKnownMatrix("X^⅛",t.fromPauliRotation(1/16,0,0),"X^⅛ Gate","Principle eighth root of X."),r.X8i=e.fromKnownMatrix("X^-⅛",t.fromPauliRotation(-1/16,0,0),"X^-⅛ Gate","Adjoint eighth root of X.",void 0,r.X8),r.X16=e.fromKnownMatrix("X^⅟₁₆",t.fromPauliRotation(1/32,0,0),"X^⅟₁₆ Gate","Principle sixteenth root of X."),r.X16i=e.fromKnownMatrix("X^-⅟₁₆",t.fromPauliRotation(-1/32,0,0),"X^-⅟₁₆ Gate","Adjoint sixteenth root of X.",void 0,r.X16),r.X32=e.fromKnownMatrix("X^⅟₃₂",t.fromPauliRotation(1/64,0,0),"X^⅟₃₂ Gate","Principle 32'nd root of X."),r.X32i=e.fromKnownMatrix("X^-⅟₃₂",t.fromPauliRotation(-1/64,0,0),"X^-⅟₃₂ Gate","Adjoint 32'nd root of X.",void 0,r.X32),r.all=[r.X3,r.X4,r.X8,r.X16,r.X32,r.X3i,r.X4i,r.X8i,r.X16i,r.X32i],{get VariousXGates(){return r}}}),$traceurRuntime.registerModule("src/gates/VariousYGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/VariousYGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/VariousYGates.js")).Matrix,r={};return r.Y3=e.fromKnownMatrix("Y^⅓",t.fromPauliRotation(0,1/6,0),"Y^⅓ Gate","Principle third root of Y."),r.Y3i=e.fromKnownMatrix("Y^-⅓",t.fromPauliRotation(0,-1/6,0),"Y^-⅓ Gate","Adjoint third root of Y.",void 0,r.Y3),r.Y4=e.fromKnownMatrix("Y^¼",t.fromPauliRotation(0,1/8,0),"Y^¼ Gate","Principle fourth root of Y."),r.Y4i=e.fromKnownMatrix("Y^-¼",t.fromPauliRotation(0,-1/8,0),"Y^-¼ Gate","Adjoint fourth root of Y.",void 0,r.Y4),r.Y8=e.fromKnownMatrix("Y^⅛",t.fromPauliRotation(0,1/16,0),"Y^⅛ Gate","Principle eighth root of Y."),r.Y8i=e.fromKnownMatrix("Y^-⅛",t.fromPauliRotation(0,-1/16,0),"Y^-⅛ Gate","Adjoint eighth root of Y.",void 0,r.Y8),r.Y16=e.fromKnownMatrix("Y^⅟₁₆",t.fromPauliRotation(0,1/32,0),"Y^⅟₁₆ Gate","Principle sixteenth root of Y."),r.Y16i=e.fromKnownMatrix("Y^-⅟₁₆",t.fromPauliRotation(0,-1/32,0),"Y^-⅟₁₆ Gate","Adjoint sixteenth root of Y.",void 0,r.Y16),r.Y32=e.fromKnownMatrix("Y^⅟₃₂",t.fromPauliRotation(0,1/64,0),"Y^⅟₃₂ Gate","Principle 32'nd root of Y."),r.Y32i=e.fromKnownMatrix("Y^-⅟₃₂",t.fromPauliRotation(0,-1/64,0),"Y^-⅟₃₂ Gate","Adjoint 32'nd root of Y.",void 0,r.Y32),r.all=[r.Y3,r.Y4,r.Y8,r.Y16,r.Y32,r.Y3i,r.Y4i,r.Y8i,r.Y16i,r.Y32i],{get VariousYGates(){return r}}}),$traceurRuntime.registerModule("src/gates/VariousZGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/VariousZGates.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/VariousZGates.js")).Matrix,r={};return r.Z3=e.fromKnownMatrix("Z^⅓",t.fromPauliRotation(0,0,1/6),"Z^⅓ Gate","Principle third root of Z."),r.Z3i=e.fromKnownMatrix("Z^-⅓",t.fromPauliRotation(0,0,-1/6),"Z^-⅓ Gate","Adjoint third root of Z.",void 0,r.Z3),r.Z4=e.fromKnownMatrix("T",t.fromPauliRotation(0,0,1/8),"Z^¼ Gate","Principle fourth root of Z.","Z^¼"),r.Z4i=e.fromKnownMatrix("T^-1",t.fromPauliRotation(0,0,-1/8),"Z^-¼ Gate","Adjoint fourth root of Z.","Z^-¼",r.Z4),r.Z8=e.fromKnownMatrix("Z^⅛",t.fromPauliRotation(0,0,1/16),"Z^⅛ Gate","Principle eighth root of Z."),r.Z8i=e.fromKnownMatrix("Z^-⅛",t.fromPauliRotation(0,0,-1/16),"Z^-⅛ Gate","Adjoint eighth root of Z.",void 0,r.Z8),r.Z16=e.fromKnownMatrix("Z^⅟₁₆",t.fromPauliRotation(0,0,1/32),"Z^⅟₁₆ Gate","Principle 16'th root of Z."),r.Z16i=e.fromKnownMatrix("Z^-⅟₁₆",t.fromPauliRotation(0,0,-1/32),"Z^-⅟₁₆ Gate","Adjoint 16'th root of Z.",void 0,r.Z16),r.Z32=e.fromKnownMatrix("Z^⅟₃₂",t.fromPauliRotation(0,0,1/64),"Z^⅟₃₂ Gate","Principle 32'nd root of Z."),r.Z64=e.fromKnownMatrix("Z^⅟₆₄",t.fromPauliRotation(0,0,1/128),"Z^⅟₆₄ Gate","Principle 64'th root of Z."),r.Z128=e.fromKnownMatrix("Z^⅟₁₂₈",t.fromPauliRotation(0,0,1/256),"Z^⅟₁₂₈ Gate","Principle 128'th root of Z."),r.all=[r.Z3,r.Z4,r.Z8,r.Z16,r.Z32,r.Z64,r.Z128,r.Z3i,r.Z4i,r.Z8i,r.Z16i],{get VariousZGates(){return r}}}),$traceurRuntime.registerModule("src/gates/XorGates.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/XorGates.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/XorGates.js")).Gate,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/XorGates.js")),n=r.ketArgs,i=r.ketShaderPermute,a=r.ketInputGateShaderCode,o={},u=i(a("A"),"\n        float srcMask = mod(read_input_A(), span);\n        float bitPos = 1.0;\n        float result = 0.0;\n        for (int i = 0; i < "+e.MAX_WIRE_COUNT+"; i++) {\n            float srcBit = mod(floor(srcMask/bitPos), 2.0);\n            float dstBit = mod(floor(out_id/bitPos), 2.0);\n            result += (dstBit + srcBit - dstBit * srcBit * 2.0) * bitPos;\n            bitPos *= 2.0;\n        }\n        return result;");return o.XorAFamily=t.buildFamily(1,16,function(r,e){return e.setSerializedId("^=A"+r).setSymbol("⊕A").setTitle("Xor Gate [input A]").setBlurb("Xors input A into the qubits covered by this gate.").setRequiredContextKeys("Input Range A").setKnownEffectToParametrizedPermutation(function(e,t){return e^t&(1<<r)-1}).setActualEffectToShaderProvider(function(e){return u.withArgs.apply(u,$traceurRuntime.spread(n(e,r,["A"])))})}),o.all=$traceurRuntime.spread(o.XorAFamily.all),{get XorGates(){return o}}}),$traceurRuntime.registerModule("src/issues.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/issues.js")).notifyAboutKnownIssue,t=document.createElement("canvas"),r=t.getContext("webgl")||t.getContext("experimental-webgl");function n(){null==r&&e("Can't simulate circuits. Your browser doesn't support WebGL, or has it disabled.","https://github.com/Strilanc/Quirk/issues/168",[/Computing circuit values failed/,/Error creating WebGL context./])}return{get doDetectIssues(){return n},get canvasCreatedForTesting(){return t},get webglContextCreatedForTesting(){return r}}}),$traceurRuntime.registerModule("src/main.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/Polyfills.js","src/main.js")),(0,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/main.js")).hookErrorHandler)(),(0,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/issues.js","src/main.js")).doDetectIssues)();var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitStats.js","src/main.js")).CircuitStats,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/CooldownThrottle.js","src/main.js")).CooldownThrottle,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/main.js")).Config,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedInspector.js","src/main.js")).DisplayedInspector,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/main.js")).Painter,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/main.js")).Rect,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/RestartableRng.js","src/main.js")).RestartableRng,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Revision.js","src/main.js")).Revision,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/main.js")),l=s.initSerializer,c=s.fromJsonText_CircuitDefinition,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/TouchScrollBlocker.js","src/main.js")).TouchScrollBlocker,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/main.js")).Util,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/main.js")).initializedWglContext,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/MouseWatcher.js","src/main.js")),g=h.watchDrags,p=h.isMiddleClicking,v=h.eventPosRelativeTo,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/main.js")),b=y.ObservableValue,R=y.ObservableSource,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/exports.js","src/main.js")),M=w.initExports,_=w.obsExportsIsShowing,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/forge.js","src/main.js")),S=x.initForge,T=x.obsForgeIsShowing,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/menu.js","src/main.js")),C=A.initMenu,E=A.obsMenuIsShowing,I=A.closeMenu,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/undo.js","src/main.js")).initUndoRedo,$=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/clear.js","src/main.js")).initClear,P=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/url.js","src/main.js")).initUrlCircuitSync,G=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/title.js","src/main.js")).initTitleSync,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/sim.js","src/main.js")).simulate,N=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/main.js")).GatePainting,D=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedCircuit.js","src/main.js")).GATE_CIRCUIT_DRAWER,F=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/main.js")).GateColumn,O=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/main.js")).Point;l(N.LABEL_DRAWER,N.MATRIX_DRAWER,D,N.LOCATION_INDEPENDENT_GATE_DRAWER);var z=document.getElementById("canvasDiv"),B=document.getElementById("drawCanvas");if(!B)throw new Error("Couldn't find 'drawCanvas'");B.width=z.clientWidth,B.height=.9*window.innerHeight;var L,U,W=!1,H=(L={cur:new o},(U=function(){L.cur=new o,setTimeout(U,.99*r.SEMI_STABLE_RANDOM_VALUE_LIFETIME_MILLIS)})(),L),q=document.getElementById("inspectorDiv"),X=new b(n.empty(new a(0,0,B.clientWidth,B.clientHeight))),Y=new b(e.EMPTY),K=u.startingAt(X.get().snapshot());K.latestActiveCommit().subscribe(function(e){var t=c(e),r=X.get().withCircuitDefinition(t);X.set(r)});function V(e){return{w:Math.max(z.clientWidth,e.desiredWidth()),h:e.desiredHeight()}}function Z(e){var t=V(e);return e.updateArea(new a(0,0,t.w,t.h)),e}X.observable().map(function(e){return e.displayedCircuit.circuitDefinition}).whenDifferent(m.CUSTOM_IS_EQUAL_TO_EQUALITY).subscribe(function(){var e=document.getElementById("error-div").style;e.opacity*=.9,e.opacity<.06&&(e.display="None")});function Q(){var e,t,r,n;W&&(e=Z(X.get()).previewDrop(),X.get().hand.isHoldingSomething()&&!e.hand.isHoldingSomething()&&(e=e.withHand(e.hand.withHeldGateColumn(new F([]),new O(0,0)))),t=k(e.displayedCircuit.circuitDefinition),Y.set(t),r=V(e),B.width=r.w,B.height=r.h,n=new i(B,H.cur.restarted()),e.updateArea(n.paintableArea()),e.paint(n,t),n.paintDeferred(),X.get().hand.paintCursor(n),J.setBlockers(n.touchBlockers,n.desiredCursorStyle),B.style.cursor=n.desiredCursorStyle||"auto",X.get().stableDuration()<1/0&&window.requestAnimationFrame(function(){return ee.trigger()}))}var J=new d(z),ee=new t(Q,r.REDRAW_COOLDOWN_MILLIS,.1,!0);window.addEventListener("resize",function(){return ee.trigger()},!1),X.observable().subscribe(function(){return ee.trigger()});var te=void 0;z.addEventListener("click",function(e){var t,r=v(e,z),n=X.get();n.tryGetHandOverButtonKey()!==te||void 0!==(t=Z(n.withHand(n.hand.withPos(r))).tryClick())&&K.commit(t.afterTidyingUp().snapshot())}),g(z,function(e,t){var r=X.get(),n=r.hand.withPos(e),i=Z(r.withHand(n));void 0===(te=t.ctrlKey||t.metaKey||t.shiftKey||t.altKey?void 0:i.tryGetHandOverButtonKey())?(i=i.afterGrabbing(t.shiftKey,t.ctrlKey||t.metaKey),!X.get().isEqualTo(i)&&i.hand.isBusy()&&(K.startedWorkingOnCommit(),X.set(Z(r.withHand(n).withJustEnoughWires(i.hand,1)).afterGrabbing(t.shiftKey,t.ctrlKey||t.metaKey,!1,t.altKey)),t.preventDefault())):X.set(i)},function(e){K.cancelCommitBeingWorkedOn(),e.preventDefault()},function(e,t){var r,n;X.get().hand.isBusy()&&(r=X.get().hand.withPos(e),n=X.get().withHand(r),X.set(n),t.preventDefault())},function(e,t){var r,n,i,a;X.get().hand.isBusy()&&(r=X.get().hand.withPos(e),i=(n=Z(X.get()).withHand(r).afterDropping().afterTidyingUp()).hand.withPos(void 0),a=n.withJustEnoughWires(i,0),K.commit(a.snapshot()),t.preventDefault())}),z.addEventListener("mousedown",function(e){var t,r,n,i,a;p(e)&&(r=(t=Z(X.get())).tryGetHandOverButtonKey(),n=t.hand.withPos(v(e,B)),a=void 0!==r&&r.startsWith("wire-init-")?(i=t.displayedCircuit.circuitDefinition.withSwitchedInitialStateOn(parseInt(r.substr(10)),0),t.withCircuitDefinition(i).withHand(n).afterTidyingUp()):t.withHand(n).afterGrabbing(!1,!1,!0,!1).withHand(n).afterTidyingUp().withJustEnoughWires(n,0),X.get().isEqualTo(a)||(K.commit(a.snapshot()),e.preventDefault()))}),z.addEventListener("mousemove",function(e){var t,r;X.get().hand.isBusy()||(t=X.get().hand.withPos(v(e,B)),r=X.get().withHand(t),X.set(r))}),z.addEventListener("mouseleave",function(){var e,t;X.get().hand.isBusy()||(e=X.get().hand.withPos(void 0),t=X.get().withHand(e),X.set(t))});var re=new R;return P(K),M(K,Y,re.observable()),S(K,re.observable()),j(K,re.observable()),$(K,re.observable()),C(K,re.observable()),G(K),T.zipLatest(_,function(e,t){return e||t}).zipLatest(E,function(e,t){return e||t}).whenDifferent().subscribe(function(e){re.send(e),z.tabIndex=e?-1:0}),W=!0,setTimeout(function(){q.style.display="block",Q(),document.getElementById("loading-div").style.display="none",document.getElementById("close-menu-button").style.display="block",X.get().displayedCircuit.circuitDefinition.isEmpty()||I();try{f().onContextRestored=function(){return ee.trigger()}}catch(e){console.error(e)}},0),{}}),$traceurRuntime.registerModule("src/math/Axis.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/math/Axis.js")).DetailedError,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/math/Axis.js")).UNICODE_FRACTIONS,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/FormulaParser.js","src/math/Axis.js")).parseFormula,i=new Map,t=$traceurRuntime.createClass(s,{toString:function(){return this.x+"X + "+this.y+"Y + "+this.z+"Z"},isEqualTo:function(e){return e instanceof s&&e.x===this.x&&e.y===this.y&&e.z===this.z}},{parse:function(e){var t=n(e,i);if(!(t instanceof s))throw new r("Not an axis.",{text:e,result:t});return t},classify:function(e){if("number"==typeof e)return!1;if(e instanceof s)return!0;throw new r("Not an axis or a number",{v:e})},op:function(e,t,r,n,i,a){var o=s.classify(e),u=s.classify(t);return(o&&u?a:o||u?o?n:i:r)(e,t)},times:function(e,t){return s.op(e,t,function(e,t){return e*t},function(e,t){return new s(e.x*t,e.y*t,e.z*t)},function(e,t){return new s(t.x*e,t.y*e,t.z*e)},function(e,t){throw new r("Can't multiply axes.",{a:e,b:t})})},add:function(e,t){return s.op(e,t,function(e,t){return e+t},function(e,t){throw new r("Can't add axes to numbers.",{a:e,b:t})},function(e,t){throw new r("Can't add axes to numbers.",{a:e,b:t})},function(e,t){return new s(e.x+t.x,e.y+t.y,e.z+t.z)})},negate:function(e){return s.classify(e)?new s(-e.x,-e.y,-e.z):-e},subtract:function(e,t){return s.op(e,t,function(e,t){return e-t},function(e,t){throw new r("Can't subtract axes and numbers.",{a:e,b:t})},function(e,t){throw new r("Can't subtract axes and numbers.",{a:e,b:t})},function(e,t){return new s(e.x-t.x,e.y-t.y,e.z-t.z)})},divide:function(e,t){return s.op(e,t,function(e,t){return e/t},function(e,t){return new s(e.x/t,e.y/t,e.z/t)},function(e,t){throw new r("Can't divide by an axis.",{a:e,b:t})},function(e,t){throw new r("Can't divide by an axis.",{a:e,b:t})})},raisedTo:function(e,t){return s.op(e,t,function(e,t){return Math.pow(e,t)},function(e,t){throw new r("Can't raise an axis to a power.",{a:e,b:t})},function(e,t){throw new r("Can't raise to an axis power.",{a:e,b:t})},function(e,t){throw new r("Can't raise to an axis power.",{a:e,b:t})})}});function s(e,t,r){this.x=e,this.y=t,this.z=r}i.set("x",new t(1,0,0)),i.set("y",new t(0,1,0)),i.set("z",new t(0,0,1)),i.set("(","("),i.set(")",")");var a=!0,o=!1,u=void 0;try{for(var l,c=e[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value,m=d.character,f=d.value;i.set(m,f)}}catch(e){o=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw u}}return i.set("sqrt",{unary_action:function(e){return t.raisedTo(e,.5)},priority:4}),i.set("^",{binary_action:t.raisedTo,priority:3}),i.set("*",{binary_action:t.times,priority:2}),i.set("/",{binary_action:t.divide,priority:2}),i.set("-",{unary_action:t.negate,binary_action:t.subtract,priority:1}),i.set("+",{unary_action:function(e){return e},binary_action:t.add,priority:1}),i.set("√",i.get("sqrt")),{get Axis(){return t}}}),$traceurRuntime.registerModule("src/math/Complex.js",[],function(){"use strict";var e,t,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/math/Complex.js")).DetailedError,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/math/Complex.js")),i=n.Format,a=n.UNICODE_FRACTIONS,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/math/Complex.js")).Util,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/FormulaParser.js","src/math/Complex.js")).parseFormula,s=new Map,l=new Map,c=new Map,d=$traceurRuntime.createClass(m,{isEqualTo:function(e){return e instanceof m?this.real===e.real&&this.imag===e.imag:"number"==typeof e&&(this.real===e&&0===this.imag)},isApproximatelyEqualTo:function(e,t){if(e instanceof m||"number"==typeof e){var r=this.minus(m.from(e));return Math.abs(r.real)<=t&&Math.abs(r.imag)<=t&&r.abs()<=t}return!1},toString:function(e){return(e=e||i.EXACT).allowAbbreviation?this._toString_allowSingleValue(e):this._toString_bothValues(e)},_toString_allowSingleValue:function(e){return Math.abs(this.imag)<=e.maxAbbreviationError?e.formatFloat(this.real):Math.abs(this.real)<=e.maxAbbreviationError?Math.abs(this.imag-1)<=e.maxAbbreviationError?"i":Math.abs(this.imag+1)<=e.maxAbbreviationError?"-i":e.formatFloat(this.imag)+"i":this._toString_bothValues(e)},_toString_bothValues:function(e){var t=0<=this.imag?"+":"-",r=e.allowAbbreviation&&Math.abs(Math.abs(this.imag)-1)<=e.maxAbbreviationError?"":e.formatFloat(Math.abs(this.imag));return(e.allowAbbreviation||void 0===e.fixedDigits||this.real<0?"":"+")+e.formatFloat(this.real)+t+r+"i"},norm2:function(){return this.real*this.real+this.imag*this.imag},abs:function(){return Math.sqrt(this.norm2())},conjugate:function(){return new m(this.real,-this.imag)},neg:function(){return new m(-this.real,-this.imag)},phase:function(){return Math.atan2(this.imag,this.real)},unit:function(){var e=this.norm2();return e<1e-5?m.polar(1,this.phase()):this.dividedBy(Math.sqrt(e))},plus:function(e){var t=m.from(e);return new m(this.real+t.real,this.imag+t.imag)},minus:function(e){var t=m.from(e);return new m(this.real-t.real,this.imag-t.imag)},times:function(e){var t=m.from(e);return new m(this.real*t.real-this.imag*t.imag,this.real*t.imag+this.imag*t.real)},dividedBy:function(e){var t=m.from(e),r=t.norm2();if(0===r)throw new Error("Division by Zero");var n=this.times(t.conjugate());return new m(n.real/r,n.imag/r)},sqrts:function(){var e,t,r=(t=(e=[this.real,this.imag][Symbol.iterator]()).next()).done?void 0:t.value,n=(t=e.next()).done?void 0:t.value,i=Math.sqrt(Math.sqrt(r*r+n*n));if(0===i)return[m.ZERO];if(0===n&&r<0)return[new m(0,i),new m(0,-i)];var a=this.phase()/2,o=m.polar(i,a);return[o,o.times(-1)]},exp:function(){return m.polar(Math.exp(this.real),this.imag)},cos:function(){var e=this.times(m.I);return e.exp().plus(e.neg().exp()).times(.5)},sin:function(){var e=this.times(m.I);return e.exp().minus(e.neg().exp()).dividedBy(new m(0,2))},tan:function(){return this.sin().dividedBy(this.cos())},ln:function(){return new m(Math.log(this.abs()),this.phase())},raisedTo:function(e){return.5===e&&0===this.imag&&0<=this.real?new m(Math.sqrt(this.real),0):m.ZERO.isEqualTo(e)?m.ONE:this.isEqualTo(m.ZERO)?m.ZERO:this.ln().times(m.from(e)).exp()}},{from:function(e){if(e instanceof m)return e;if("number"==typeof e)return new m(e,0);throw new r("Unrecognized value type.",{v:e})},polar:function(e,t){var r,n;return new m(e*((n=(r=o.snappedCosSin(t)[Symbol.iterator]()).next()).done?void 0:n.value),e*((n=r.next()).done?void 0:n.value))},realPartOf:function(e){if(e instanceof m)return e.real;if("number"==typeof e)return e;throw new r("Unrecognized value type.",{v:e})},imagPartOf:function(e){if(e instanceof m)return e.imag;if("number"==typeof e)return 0;throw new r("Unrecognized value type.",{v:e})},parse:function(e){return m.from(u(e,c))},rootsOfQuadratic:function(e,t,r){if(e=m.from(e),t=m.from(t),r=m.from(r),e.isEqualTo(0)){if(!t.isEqualTo(0))return[r.times(-1).dividedBy(t)];if(!r.isEqualTo(0))return[];throw Error("Degenerate")}var n=t.times(t).minus(e.times(r).times(4)).sqrts(),i=t.times(-1),a=e.times(2);return n.map(function(e){return i.minus(e).dividedBy(a)})}});function m(e,t){this.real=e,this.imag=t}d.ZERO=new d(0,0),d.ONE=new d(1,0),d.I=new d(0,1),s.set("i",d.I),s.set("e",d.from(Math.E)),s.set("pi",d.from(Math.PI)),s.set("(","("),s.set(")",")");var f=!0,h=!1,g=void 0;try{for(var p,v=a[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var y=p.value,b=y.character,R=y.value;s.set(b,R)}}catch(e){h=!0,g=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw g}}s.set("sqrt",{unary_action:function(e){return d.from(e).raisedTo(.5)},priority:4}),s.set("exp",{unary_action:function(e){return d.from(e).exp()},priority:4}),s.set("ln",{unary_action:function(e){return d.from(e).ln()},priority:4}),s.set("^",{binary_action:function(e,t){return d.from(e).raisedTo(t)},priority:3}),s.set("*",{binary_action:function(e,t){return d.from(e).times(t)},priority:2}),s.set("/",{binary_action:function(e,t){return d.from(e).dividedBy(t)},priority:2}),s.set("-",{unary_action:function(e){return d.from(e).neg()},binary_action:function(e,t){return d.from(e).minus(t)},priority:1}),s.set("+",{unary_action:function(e){return e},binary_action:function(e,t){return d.from(e).plus(t)},priority:1}),s.set("√",s.get("sqrt")),c.set("cos",{unary_action:function(e){return new d(Math.PI/180,0).times(e).cos()},priority:4}),c.set("sin",{unary_action:function(e){return new d(Math.PI/180,0).times(e).sin()},priority:4}),c.set("asin",{unary_action:function(e){if(0!==d.imagPartOf(e))throw new r("asin input out of range",{e:e});return d.from(180*Math.asin(d.realPartOf(e))/Math.PI)},priority:4}),c.set("acos",{unary_action:function(e){if(0!==d.imagPartOf(e))throw new r("acos input out of range",{e:e});return d.from(180*Math.acos(d.realPartOf(e))/Math.PI)},priority:4}),c.set("arccos",c.get("acos")),c.set("arcsin",c.get("asin")),l.set("cos",{unary_action:function(e){return d.from(e).cos()},priority:4}),l.set("sin",{unary_action:function(e){return d.from(e).sin()},priority:4}),l.set("tan",{unary_action:function(e){return d.from(e).tan()},priority:4}),l.set("asin",{unary_action:function(e){if(0!==d.imagPartOf(e))throw new r("asin input out of range",{e:e});return d.from(Math.asin(d.realPartOf(e)))},priority:4}),l.set("acos",{unary_action:function(e){if(0!==d.imagPartOf(e))throw new r("acos input out of range",{e:e});return d.from(Math.acos(d.realPartOf(e)))},priority:4}),l.set("atan",{unary_action:function(e){if(0!==d.imagPartOf(e))throw new r("atan input out of range",{e:e});return d.from(Math.atan(d.realPartOf(e)))},priority:4});var w=!0,M=!1,_=void 0;try{for(var x,S=s.entries()[Symbol.iterator]();!(w=(x=S.next()).done);w=!0){var T=(t=(e=x.value[Symbol.iterator]()).next()).done?void 0:t.value,A=(t=e.next()).done?void 0:t.value;c.set(T,A),l.set(T,A)}}catch(e){M=!0,_=e}finally{try{w||null==S.return||S.return()}finally{if(M)throw _}}return{get Complex(){return d},get PARSE_COMPLEX_TOKEN_MAP_DEG(){return c},get PARSE_COMPLEX_TOKEN_MAP_RAD(){return l}}}),$traceurRuntime.registerModule("src/math/FormulaParser.js",[],function(){"use strict";var g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/math/FormulaParser.js")).DetailedError,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/math/FormulaParser.js")).seq;function p(e){return function(e){for(var t=(e=$traceurRuntime.spread(e)).indexOf("e",1);-1!==t;t=e.indexOf("e",t+1)){var r=t-1,n=t+1;e[r].match(/[0-9]/)&&((e[n]+"").match(/[+-]/)&&(n+=1),(e[n]+"").match(/[0-9]/)&&(n+=1,e.splice(r,n-r,e.slice(r,n).join("")),--t))}return e}(t(e.toLowerCase().split(/\s/)).flatMap(function(e){return t(e).segmentBy(function(e){return""===e.trim()?" ":e.match(/[\.0-9]/)?"#":e.match(/[_a-z]/)?"a":NaN}).map(function(e){return e.join("")})}).filter(function(e){return""!==e.trim()}).toArray())}function e(n,i){var e=p(n).map(function(e){return function(e,t){if(e.match(/[0-9]+(\.[0-9]+)?/))return parseFloat(e);if(t.has(e))return t.get(e);throw new g("Unrecognized token",{token:e})}(e,i)});0<e.length&&void 0!==e[e.length-1].priority&&(e=e.slice(0,e.length-1));function r(e){if("("===e)throw new g("Bad expression: unmatched '('",{text:n});if(u.length<2)throw new g("Bad expression: operated on nothing",{text:n});var t=u.pop(),r=u.pop();u.push(e.f(r,t))}function a(e){for(;0<o.length&&2<=u.length&&void 0!==u[u.length-1];){var t=o[o.length-1];if(void 0===t.w||t.w<e)break;r(o.pop())}}var t,o=[],u=[],s=!1,l=!0,c=!1,d=void 0;try{for(var m,f=e[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var h=m.value;!function(e,r){var t=i.get("*");if(e&&void 0===r.binary_action&&")"!==r&&(a(t.priority),o.push({f:t.binary_action,w:t.priority})),e&&void 0!==r.binary_action)a(r.priority),o.push({f:r.binary_action,w:r.priority});else if(void 0!==r.unary_action)a(r.priority),u.push(void 0),o.push({f:function(e,t){return r.unary_action(t)},w:1/0});else if(void 0!==r.binary_action)throw new g("Bad expression: binary op in bad spot",{text:n})}(s,h),s="("!==(t=h)&&void 0===t.priority,"("===h?o.push("("):")"===h?function(){for(;;){if(0===o.length)throw new g("Bad expression: unmatched ')'",{text:n});var e=o.pop();if("("===e)break;r(e)}}():s&&u.push(h)}}catch(e){c=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw d}}if(a(-1/0),1!==u.length||0!==o.length)throw new g("Incomplete expression",{text:n});return u[0]}return{get parseFormula(){return e}}}),$traceurRuntime.registerModule("src/math/Matrix.js",[],function(){"use strict";var y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/math/Matrix.js")).Complex,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/math/Matrix.js")).DetailedError,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/math/Matrix.js")).Format,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/math/Matrix.js")),b=e.seq,M=e.Seq,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/math/Matrix.js")).Util,t=$traceurRuntime.createClass(E,{cell:function(e,t){if(e<0||t<0||e>=this._width||t>=this._height)throw new w("Cell out of range",{col:e,row:t,width:this._width,height:this._height});var r=2*(this._width*t+e);return new y(this._buffer[r],this._buffer[1+r])},rawBuffer:function(){return this._buffer},toReadableJson:function(){return b(this.rows()).map(r).toArray()},rows:function(){var r=this;return M.range(this._height).map(function(t){return M.range(r._width).map(function(e){return r.cell(e,t)}).toArray()}).toArray()},isEqualTo:function(e){var t=this;if(this===e)return!0;if(!(e instanceof E))return!1;var r=e;return this._width===r._width&&this._height===r._height&&M.range(this._buffer.length).every(function(e){return t._buffer[e]===r._buffer[e]})},isApproximatelyEqualTo:function(e,t){return e instanceof E&&this._width===e._width&&this._height===e._height&&Math.sqrt(this.minus(e).norm2())<=t},toString:function(){var t=void 0!==arguments[0]?arguments[0]:f.EXACT;return"{{"+this.rows().map(function(e){return e.map(function(e){return e.toString(t)}).join(t.itemSeparator)}).join("}"+t.itemSeparator+"{")+"}}"},width:function(){return this._width},height:function(){return this._height},isUnitary:function(e){var t=this.width();return this.height()===t&&this.times(this.adjoint()).isApproximatelyEqualTo(E.identity(t),e)},isLowerTriangular:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this._height;t++)for(var r=t+1;r<this._width;r++){var n=2*(t*this._width+r),i=this._buffer[n],a=this._buffer[1+n];if(isNaN(i)||isNaN(a)||e*e<i*i+a*a)return!1}return!0},isUpperTriangular:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this._height;t++)for(var r=0;r<t&&r<this._width;r++){var n=2*(t*this._width+r),i=this._buffer[n],a=this._buffer[1+n];if(isNaN(i)||isNaN(a)||e*e<i*i+a*a)return!1}return!0},isPhasedPermutation:function(){var e=void 0!==arguments[0]?arguments[0]:0;if(this._width!==this._height)return!1;for(var t=this._width,r=new Uint32Array(t),n=new Uint32Array(t),i=0;i<t;i++)for(var a=0;a<t;a++){var o=2*(a*t+i),u=Math.max(Math.abs(this._buffer[o]),Math.abs(this._buffer[1+o]));(isNaN(u)||e<u)&&(r[i]+=1,n[a]+=1)}return b(r).concat(n).every(function(e){return e<=1})},isApproximatelyHermitian:function(e){if(this._width!==this._height)return!1;for(var t=0;t<this._width;t++)for(var r=0;r<this._height;r++){var n=2*(this._width*r+t),i=2*(this._width*t+r);if(Math.abs(this._buffer[n]-this._buffer[i])>e)return!1;if(Math.abs(this._buffer[1+n]+this._buffer[1+i])>e)return!1}return!0},isIdentity:function(){var e=void 0!==arguments[0]?arguments[0]:0;if(this._width!==this._height)return!1;for(var t=0;t<this._width;t++)for(var r=0;r<this._height;r++){var n=2*(this._width*r+t),i=Math.abs(this._buffer[n]-(r===t?1:0)),a=Math.abs(this._buffer[1+n]);if(Math.max(i,a)>e)return!1}return!this.hasNaN()},isScaler:function(){var e=void 0!==arguments[0]?arguments[0]:0;if(this._width!==this._height)return!1;for(var t=this._buffer[0],r=this._buffer[1],n=0;n<this._width;n++)for(var i=0;i<this._height;i++){var a=2*(this._width*i+n),o=Math.abs(this._buffer[a]-(i===n?t:0)),u=Math.abs(this._buffer[1+a]-(i===n?r:0));if(Math.max(o,u)>e)return!1}return!this.hasNaN()},hasNaN:function(){for(var e=0;e<this._buffer.length;e++)if(isNaN(this._buffer[e]))return!0;return!1},isDiagonal:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=0;t<this._width;t++)for(var r=0;r<this._height;r++)if(r!==t){var n=2*(this._width*r+t),i=Math.abs(this._buffer[n]),a=Math.abs(this._buffer[1+n]),o=Math.max(i,a);if(isNaN(o)||e<o)return!1}return this._width===this._height},adjoint:function(){for(var e=this._height,t=this._width,r=new Float64Array(e*t*2),n=0;n<t;n++)for(var i=0;i<e;i++){var a=2*(i*this._width+n),o=2*(n*e+i);r[o]=this._buffer[a],r[1+o]=-this._buffer[1+a]}return new E(e,t,r)},transpose:function(){for(var e=this._height,t=this._width,r=new Float64Array(e*t*2),n=0;n<t;n++)for(var i=0;i<e;i++){var a=2*(i*this._width+n),o=2*(n*e+i);r[o]=this._buffer[a],r[1+o]=this._buffer[1+a]}return new E(e,t,r)},trace:function(){for(var e=0,t=0,r=2*this._width+2,n=0;n<this._buffer.length;n+=r)e+=this._buffer[n],t+=this._buffer[n+1];return new y(e,t)},_timesScalar:function(e){for(var t=new Float64Array(this._buffer.length),r=y.realPartOf(e),n=y.imagPartOf(e),i=0;i<t.length;i+=2){var a=this._buffer[i],o=this._buffer[i+1];t[i]=a*r-o*n,t[i+1]=a*n+o*r}return new E(this._width,this._height,t)},plus:function(e){var t=this._width,r=this._height,n=this._buffer,i=e._buffer;C.need(e._width===t&&e._height===r,"Matrix.plus: compatible sizes");for(var a=new Float64Array(this._buffer.length),o=0;o<a.length;o++)a[o]=n[o]+i[o];return new E(t,r,a)},minus:function(e){var t=this._width,r=this._height,n=this._buffer,i=e._buffer;C.need(e._width===t&&e._height===r,"Matrix.minus: compatible sizes");for(var a=new Float64Array(this._buffer.length),o=0;o<a.length;o++)a[o]=n[o]-i[o];return new E(t,r,a)},_timesMatrix:function(e){if(this._width!==e._height)throw new w("Incompatible sizes.",{this:this,other:e});for(var t=e._width,r=this._height,n=this._width,i=new Float64Array(t*r*2),a=0;a<r;a++)for(var o=0;o<t;o++)for(var u=2*(a*t+o),s=0;s<n;s++){var l=2*(a*n+s),c=2*(s*t+o),d=this._buffer[l],m=this._buffer[1+l],f=e._buffer[c],h=e._buffer[1+c],g=d*f-m*h,p=d*h+f*m;i[u]+=g,i[1+u]+=p}return new E(t,r,i)},times:function(e){return e instanceof E?this._timesMatrix(e):this._timesScalar(e)},expandedForQubitInRegister:function(e,t,r){for(var n=Math.round(Math.log2(this._width)),i=E.identity(1<<t-e-n).tensorProduct(this).tensorProduct(E.identity(1<<e))._clone(),a=0;a<i._width;a++)for(var o,u=0;u<i._height;u++){r.allowsState(a)&&r.allowsState(u)||(o=2*(a+u*i._width),i._buffer[o]=a===u?1:0,i._buffer[1+o]=0)}return i},applyToStateVectorAtQubitWithControls:function(e,t,r){for(var n=2*this._width,i=e._buffer.slice(0,n),a=2<<t,o=a*n>>1,u=e._buffer.slice(),s=0;s<u.length;s+=o)for(var l=0;l<a;l+=2)if(r.allowsState((s|l)>>1)){for(var c=s+l,d=0;d<i.length;d+=2)i[d]=e._buffer[c],i[d+1]=e._buffer[c+1],c+=a;for(var m=this.times(new E(1,i.length>>1,i)),c=s+l,f=0;f<i.length;f+=2)u[c]=m._buffer[f],u[c+1]=m._buffer[f+1],c+=a}return new E(1,e.height(),u)},norm2:function(){var e=0,t=!0,r=!1,n=void 0;try{for(var i,a=this._buffer[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e+=o*o}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return e},tensorProduct:function(e){for(var t=this._width,r=this._height,n=e._width,i=e._height,a=t*n,o=r*i,u=new Float64Array(a*o*2),s=0;s<r;s++)for(var l=0;l<i;l++)for(var c=0;c<t;c++)for(var d=0;d<n;d++){var m=2*(s*t+c),f=2*(l*n+d),h=2*((s*i+l)*a+(c*n+d)),g=this._buffer[m],p=this._buffer[1+m],v=e._buffer[f],y=e._buffer[1+f],b=g*v-p*y,R=g*y+p*v;u[h]=b,u[1+h]=R}return new E(a,o,u)},timesQubitOperation:function(e,t,r,n){var i,a;C.need(0==(r&1<<t),"Matrix.timesQubitOperation: self-controlled"),C.need(2===e._width&&2===e._height,"Matrix.timesQubitOperation: not 2x2");var o=this._width,u=this._height,s=this._buffer,l=(a=(i=e._buffer[Symbol.iterator]()).next()).done?void 0:a.value,c=(a=i.next()).done?void 0:a.value,d=(a=i.next()).done?void 0:a.value,m=(a=i.next()).done?void 0:a.value,f=(a=i.next()).done?void 0:a.value,h=(a=i.next()).done?void 0:a.value,g=(a=i.next()).done?void 0:a.value,p=(a=i.next()).done?void 0:a.value;C.need(2<<t<=u,"Matrix.timesQubitOperation: qubit index out of range");for(var v=new Float64Array(s),y=0,b=0;b<u;b++)for(var R,w,M,_,x,S=0!=(r&b^n),T=0!=(b&1<<t),A=0;A<o;A++){S||T||(R=y+2*(1<<t)*o,w=v[y],M=v[y+1],_=v[R],x=v[R+1],v[y]=w*l-M*c+_*d-x*m,v[y+1]=w*c+M*l+_*m+x*d,v[R]=w*f-M*h+_*g-x*p,v[R+1]=w*h+M*f+_*p+x*g),y+=2}return new E(o,u,v)},tensorPower:function(e){if(!Number.isInteger(e)||e<0)throw new w("Bad exponent",{exponent:e});for(var t=E.identity(1),r=this,n=1;n<=e;n*=2)0!=(n&e)&&(t=t.tensorProduct(r)),r=r.tensorProduct(r);return t},transformRealAndImagComponentsWith:function(e){for(var t=this._buffer.slice(),r=0;r<t.length;r++)t[r]=e(t[r]);return new E(this._width,this._height,t)},_inline_rowScale_preMultiply:function(e,t){for(var r=0;r<this._width;r++){var n=this.cell(r,e).times(t),i=2*(e*this._width+r);this._buffer[i]=n.real,this._buffer[1+i]=n.imag}},_inline_colScale_postMultiply:function(e,t){for(var r=0;r<this._height;r++){var n=this.cell(e,r).times(t),i=2*(r*this._width+e);this._buffer[i]=n.real,this._buffer[1+i]=n.imag}},_inline_rowMix_preMultiply:function(e,t,r){for(var n,i,a=(i=(n=r._2x2Breakdown()[Symbol.iterator]()).next()).done?void 0:i.value,o=(i=n.next()).done?void 0:i.value,u=(i=n.next()).done?void 0:i.value,s=(i=n.next()).done?void 0:i.value,l=0;l<this._width;l++){var c=this.cell(l,e),d=this.cell(l,t),m=c.times(a).plus(d.times(o)),f=c.times(u).plus(d.times(s)),h=2*(e*this._width+l),g=2*(t*this._width+l);this._buffer[h]=m.real,this._buffer[1+h]=m.imag,this._buffer[g]=f.real,this._buffer[1+g]=f.imag}},_inline_colMix_postMultiply:function(e,t,r){for(var n,i,a=(i=(n=r._2x2Breakdown()[Symbol.iterator]()).next()).done?void 0:i.value,o=(i=n.next()).done?void 0:i.value,u=(i=n.next()).done?void 0:i.value,s=(i=n.next()).done?void 0:i.value,l=0;l<this._width;l++){var c=this.cell(e,l),d=this.cell(t,l),m=c.times(a).plus(d.times(u)),f=c.times(o).plus(d.times(s)),h=2*(l*this._width+e),g=2*(l*this._width+t);this._buffer[h]=m.real,this._buffer[1+h]=m.imag,this._buffer[g]=f.real,this._buffer[1+g]=f.imag}},_clone:function(){return new E(this._width,this._height,this._buffer.slice())},qrDecomposition:function(){if(this._width!==this._height)throw new w("Expected a square matrix.",this);for(var e=E.identity(this._width),t=this._clone(),r=0;r<this._height;r++){for(var n=0;n<r&&n<this._width;n++){var i,a,o,u,s,l,c=t.cell(n,r),d=t.cell(n,n),m=d.abs(),f=c.abs();0!==f&&(i=-Math.atan2(f,m),a=Math.cos(i),o=Math.sin(i),u=d.unit().conjugate(),s=c.unit().conjugate(),l=E.square(u.times(a),s.times(-o),u.times(o),s.times(a)),t._inline_rowMix_preMultiply(n,r,l),e._inline_colMix_postMultiply(n,r,l.adjoint()))}var h=t.cell(r,r).unit();t._inline_rowScale_preMultiply(r,h.conjugate()),e._inline_colScale_postMultiply(r,h)}return{Q:e,R:t}},lqDecomposition:function(){var e=this.adjoint().qrDecomposition(),t=e.Q;return{L:e.R.adjoint(),Q:t.adjoint()}},eigenvalueMagnitudes:function(e){var t=void 0!==arguments[1]?arguments[1]:1e3;if(this._width!==this._height)throw new w("Expected a square matrix.",this);for(var r=0,n=this;!n.isUpperTriangular(e)&&r<t;){var i=n.qrDecomposition(),a=i.Q,o=i.R;if(o.isIdentity(e))return M.repeat(1,this._width).toArray();n=o.times(a),r++}return M.range(this._width).map(function(e){return n.cell(e,e).abs()}).sortedBy(function(e){return-e}).toArray()},eigenDecomposition:function(){var e,t;if(2!==this.width()||2!==this.height())throw new Error("Not implemented: non-2x2 eigen decomposition");var s=(t=(e=this._2x2Breakdown()[Symbol.iterator]()).next()).done?void 0:t.value,l=(t=e.next()).done?void 0:t.value,c=(t=e.next()).done?void 0:t.value,d=(t=e.next()).done?void 0:t.value,r=y.rootsOfQuadratic(y.ONE,s.plus(d).times(-1),s.times(d).minus(l.times(c)));if(0===r.length)throw new Error("Degenerate");return 1===r.length?[{val:r[0],vec:E.col(1,0)},{val:r[0],vec:E.col(0,1)}]:r.map(function(e){var t,r,n,i,a=(r=(t=[l.times(-1),s.minus(e)][Symbol.iterator]()).next()).done?void 0:r.value,o=(r=t.next()).done?void 0:r.value;a.isEqualTo(0)&&o.isEqualTo(0)&&(a=(i=(n=[e.minus(d),c][Symbol.iterator]()).next()).done?void 0:i.value,o=(i=n.next()).done?void 0:i.value),a.isEqualTo(0)||(o=o.dividedBy(a),a=y.ONE);var u=Math.sqrt(a.norm2()+o.norm2());if(0===u)throw new Error("Unexpected degenerate");return{val:e,vec:E.col(a,o).times(1/u)}})},liftApply:function(e){var t=this.times(0),r=!0,n=!1,i=void 0;try{for(var a,o=this.eigenDecomposition()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)var u=a.value,s=u.val,l=u.vec,c=e(s),d=l.times(l.adjoint()),t=t.plus(d.times(c))}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t},qubitDensityMatrixToBlochVector:function(){var e,t;if(2!==this._width||2!==this._height)throw new w("Need a 2x2 density matrix.",this);if(!this.isApproximatelyHermitian(.01))throw new w("Density matrix should be Hermitian.",this);if(!this.trace().isApproximatelyEqualTo(1,.01))throw new w("Density matrix should have unit trace.",this);var r=(t=(e=this._buffer[Symbol.iterator]()).next()).done?void 0:t.value,n=((t=e.next()).done||t.value,(t=e.next()).done?void 0:t.value),i=(t=e.next()).done?void 0:t.value,a=(t=e.next()).done?void 0:t.value,o=(t=e.next()).done?void 0:t.value,u=(t=e.next()).done?void 0:t.value;(t=e.next()).done||t.value;return[-a-n,i-o,u-r]},determinant:function(){var n=this;C.need(this.width()===this.height(),"Must be square");var e=this.width();return 1===e?this.cell(0,0):M.range(e).map(function(r){return E.generate(e-1,e-1,function(e,t){return n.cell(t+(t<r?0:1),e+1)}).determinant().times(n.cell(r,0)).times(Math.pow(-1,r))}).aggregate(y.ZERO,function(e,t){return e.plus(t)})},_2x2Breakdown:function(){return[new y(this._buffer[0],this._buffer[1]),new y(this._buffer[2],this._buffer[3]),new y(this._buffer[4],this._buffer[5]),new y(this._buffer[6],this._buffer[7])]},qubitOperationToAngleAxisRotation:function(){var e,t;C.need(2===this.width()&&2===this.height(),"Need a 2x2 matrix."),C.need(this.isUnitary(.01),"Need a unitary matrix.");var r=(t=(e=this._2x2Breakdown()[Symbol.iterator]()).next()).done?void 0:t.value,n=(t=e.next()).done?void 0:t.value,i=(t=e.next()).done?void 0:t.value,a=(t=e.next()).done?void 0:t.value,o=r.plus(a),u=n.plus(i).dividedBy(y.I),s=n.minus(i),l=r.minus(a).dividedBy(y.I),c=b([o,u,s,l]).maxBy(function(e){return e.abs()}).unit().times(2),d=Math.min(1,Math.max(-1,o.dividedBy(c).real)),m=u.dividedBy(c).real,f=s.dividedBy(c).real,h=l.dividedBy(c).real,g=-2*Math.acos(d),p=Math.sqrt(m*m+f*f+h*h);return p<1e-7?{axis:[1,0,0],angle:0,phase:c.phase()}:(m/=p,f/=p,h/=p,g<=-Math.PI&&(g+=2*Math.PI,c=c.times(-1)),m+f+h<0&&(m=-m,f=-f,h=-h,g=-g),{axis:[m,f,h],angle:g,phase:c.phase()})},cross3:function(u){var s=this;return C.need(1===this.width()&&3===this.height(),"This isn't a 3d column vector."),C.need(1===u.width()&&3===u.height(),"Other's not a 3d column vector."),E.generate(1,3,function(e){var t,r,n=(r=(t=[(e+1)%3,(e+2)%3][Symbol.iterator]()).next()).done?void 0:r.value,i=(r=t.next()).done?void 0:r.value,a=s.cell(0,n).times(u.cell(0,i)),o=s.cell(0,i).times(u.cell(0,n));return a.minus(o)})},_unordered_singularValueDecomposition_2x2:function(){var e,t,r=E.identity(2),n=this.lqDecomposition(),i=n.L,a=n.Q,o=i.cell(0,0).unit(),u=i.cell(0,1).unit();r._inline_colScale_postMultiply(0,o),r._inline_colScale_postMultiply(1,u),i._inline_rowScale_preMultiply(0,o.conjugate()),i._inline_rowScale_preMultiply(1,u.conjugate());var s=i.cell(1,1).unit();i._inline_colScale_postMultiply(1,s.conjugate()),a._inline_rowScale_preMultiply(1,s);var l=(t=(e=i._buffer[Symbol.iterator]()).next()).done?void 0:t.value,c=(e.next(),(t=e.next()).done?void 0:t.value),d=(e.next(),(t=e.next()).done?void 0:t.value),m=(e.next(),(t=e.next()).done?void 0:t.value),f=l+m,h=c+d,g=c-d,p=l-m,v=Math.atan2(h,f)/2,y=Math.atan2(g,p)/2,b=Math.sqrt(f*f+h*h)/2,R=Math.sqrt(p*p+g*g)/2;return r._inline_colMix_postMultiply(0,1,E.rotation(v-y)),a._inline_rowMix_preMultiply(0,1,E.rotation(v+y)),{U:r,S:i=E.square(b+R,0,0,b-R),V:a}},_unordered_singularValueDecomposition_iterative:function(){for(var e=void 0!==arguments[0]?arguments[0]:0,t=void 0!==arguments[1]?arguments[1]:100,r=E.identity(this._width),n=this._clone(),i=E.identity(this._width),a=0;!n.isDiagonal(e)&&a++<t;)var o=n.qrDecomposition(),u=o.Q,s=o.R.lqDecomposition(),l=s.L,c=s.Q,r=r.times(u),n=l,i=c.times(i);return{U:r,S:n,V:i}},singularValueDecomposition:function(){var e,t,r,n,i,a,o,u,s=void 0!==arguments[0]?arguments[0]:0,l=void 0!==arguments[1]?arguments[1]:100;if(this._width!==this._height)throw new w("Expected a square matrix.",this);for(var c=2===this._width?this._unordered_singularValueDecomposition_2x2():this._unordered_singularValueDecomposition_iterative(s,l),d=c.U,m=c.S,f=c.V,h=M.range(this._width).sortedBy(function(e){return-m.cell(e,e).norm2()}).toArray(),g=0;g<m._width;g++){var p,v,y,b=h.indexOf(g);g!==b&&(d._inline_colMix_postMultiply(g,b,E.PAULI_X),f._inline_rowMix_preMultiply(g,b,E.PAULI_X),p=g*(m._width+1)*2,v=b*(m._width+1)*2,y=[m._buffer[v],m._buffer[p]],m._buffer[p]=(t=(e=y[Symbol.iterator]()).next()).done?void 0:t.value,m._buffer[v]=(t=e.next()).done?void 0:t.value,r=[m._buffer[1+v],m._buffer[1+p]],m._buffer[1+p]=(i=(n=r[Symbol.iterator]()).next()).done?void 0:i.value,m._buffer[1+v]=(i=n.next()).done?void 0:i.value,a=[h[g],h[b]],h[b]=(u=(o=a[Symbol.iterator]()).next()).done?void 0:u.value,h[g]=(u=o.next()).done?void 0:u.value)}for(var R=0;R<m._width;R++)d._inline_colScale_postMultiply(R,m.cell(R,R).unit());return{U:d,S:m=E.generateDiagonal(m._width,function(e){return m.cell(e,e).abs()}),V:f}},getColumn:function(e){C.need(0<=e&&e<=this.width(),"colIndex >= 0 && colIndex <= this.width()");for(var t=[],r=0;r<this._height;r++)t.push(this.cell(e,r));return t},getRow:function(e){C.need(0<=e&&e<=this.height(),"rowIndex >= 0 && rowIndex <= this.height()");for(var t=[],r=0;r<this._width;r++)t.push(this.cell(r,e));return t},closestUnitary:function(){var e=void 0!==arguments[0]?arguments[0]:0,t=void 0!==arguments[1]?arguments[1]:100,r=this.singularValueDecomposition(e,t);return r.U.times(r.V)}},{fromRows:function(e){C.need(Array.isArray(e)&&e.every(Array.isArray),"array rows",e),C.need(0<e.length,"non-zero height",arguments);var t=b(e),r=e.length,n=t.map(function(e){return e.length}).distinct().single(null);if(null===n)throw new w("Inconsistent row widths.",{rows:e});var i=new Float64Array(n*r*2),a=0,o=!0,u=!1,s=void 0;try{for(var l,c=e[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var d=l.value,m=!0,f=!1,h=void 0;try{for(var g,p=d[Symbol.iterator]();!(m=(g=p.next()).done);m=!0){var v=g.value;i[a]=y.realPartOf(v),i[a+1]=y.imagPartOf(v),a+=2}}catch(e){f=!0,h=e}finally{try{m||null==p.return||p.return()}finally{if(f)throw h}}}}catch(e){u=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(u)throw s}}return new E(n,r,i)},parse:function(e){if((e=e.replace(/\s/g,"")).length<4||"{{"!==e.substr(0,2)||"}}"!==e.substr(e.length-2,2))throw new Error("Not surrounded by {{}}.");return E.fromRows(e.substr(2,e.length-4).split("},{").map(function(e){return e.split(",").map(y.parse)}))},generate:function(e,t,r){for(var n=new Float64Array(e*t*2),i=0;i<t;i++)for(var a=0;a<e;a++){var o=2*(i*e+a),u=r(i,a);n[o]=y.realPartOf(u),n[1+o]=y.imagPartOf(u)}return new E(e,t,n)},generateDiagonal:function(e,t){for(var r=new Float64Array(e*e*2),n=0;n<e;n++){var i=n*(e+1)*2,a=t(n);r[i]=y.realPartOf(a),r[1+i]=y.imagPartOf(a)}return new E(e,e,r)},generateTransition:function(e,t){for(var r=new Float64Array(e*e*2),n=0;n<e;n++){r[2*(t(n)*e+n)]=1}return new E(e,e,r)},zero:function(e,t){return new E(e,t,new Float64Array(e*t*2))},solo:function(e){return new E(1,1,new Float64Array([y.realPartOf(e),y.imagPartOf(e)]))},square:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];C.need(Array.isArray(r),"Array.isArray(coefs)",arguments);var n=Math.round(Math.sqrt(r.length));return C.need(n*n===r.length,"Matrix.square: non-square number of arguments"),E.generate(n,n,function(e,t){return r[e*n+t]})},col:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return C.need(Array.isArray(t),"Array.isArray(coefs)",arguments),E.generate(1,t.length,function(e){return t[e]})},row:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return C.need(Array.isArray(r),"Array.isArray(coefs)",arguments),E.generate(r.length,1,function(e,t){return r[t]})},fromPauliRotation:function(e,t,r){function n(e){return Math.abs(e)<2e-4?1-e*e/6:Math.sin(e)/e}var i,a,o=0<=-11*(e=-e*Math.PI*2)+-13*(t=-t*Math.PI*2)+-17*(r=-r*Math.PI*2)?1:-1,u=Math.sqrt(e*e+t*t+r*r),s=E.PAULI_X.times(e).plus(E.PAULI_Y.times(t)).plus(E.PAULI_Z.times(r)),l=(a=(i=C.snappedCosSin(o*u)[Symbol.iterator]()).next()).done?void 0:a.value,c=(a=i.next()).done?void 0:a.value,d=new y(1+l,c).times(.5),m=new y(Math.sin(u/2)*n(u/2),-o*n(u)).times(.5*o);return E.identity(2).times(d).minus(s.times(m)).transformRealAndImagComponentsWith(function(e){return f.simplifyByRounding(e,1e-13)})},fromWireSwap:function(e,i,a){return E.generateTransition(1<<e,function(e){var t=1<<i,r=1<<a,n=e&~(t|r);return 0!=(e&t)&&(n|=r),0!=(e&r)&&(n|=t),n})},identity:function(e){if(!Number.isInteger(e)||e<=0)throw new w("Bad size",{size:e});for(var t=new Float64Array(e*e*2),r=0;r<e;r++)t[r*(e+1)*2]=1;return new E(e,e,t)},rotation:function(e){var t=Math.cos(e),r=Math.sin(e);return E.square(t,-r,r,t)},fromAngleAxisPhaseRotation:function(e,t,r){var n,i,a,o,u=(i=(n=t[Symbol.iterator]()).next()).done?void 0:i.value,s=(i=n.next()).done?void 0:i.value,l=(i=n.next()).done?void 0:i.value;C.need(Math.abs(u*u+s*s+l*l-1)<1e-6,"Not a unit axis.");var c=E.PAULI_X.times(u).plus(E.PAULI_Y.times(s)).plus(E.PAULI_Z.times(l)),d=(o=(a=C.snappedCosSin(-e/2)[Symbol.iterator]()).next()).done?void 0:o.value,m=(o=a.next()).done?void 0:o.value;return E.identity(2).times(d).plus(c.times(new y(0,m))).times(y.polar(1,r))}});function E(e,t,r){if(e*t*2!==r.length)throw new w("width*height*2 !== buffer.length",{width:e,height:t,len:r.length});this._width=e,this._height=t,this._buffer=r}function r(e){return b(e).map(function(e){return{r:y.realPartOf(e),i:y.imagPartOf(e)}}).toArray()}function n(e){return b(e).map(y.realPartOf).toArray()}return t.PAULI_X=t.square(0,1,1,0),t.PAULI_Y=t.square(0,new y(0,-1),y.I,0),t.PAULI_Z=t.square(1,0,0,-1),t.HADAMARD=t.square(1,1,1,-1).times(Math.sqrt(.5)),{get Matrix(){return t},get complexVectorToReadableJson(){return r},get realVectorToReadableJson(){return n}}}),$traceurRuntime.registerModule("src/math/Point.js",[],function(){"use strict";var e=$traceurRuntime.createClass(r,{isEqualTo:function(e){if(!(e instanceof r))return!1;return e.x===this.x&&e.y===this.y},toString:function(){return"(x: "+this.x+", y: "+this.y+")"},offsetBy:function(e,t){return new r(this.x+e,this.y+t)},plus:function(e){return new r(this.x+e.x,this.y+e.y)},minus:function(e){return new r(this.x-e.x,this.y-e.y)},times:function(e){return new r(this.x*e,this.y*e)},distanceTo:function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)}},{});function r(e,t){this.x=e,this.y=t}return{get Point(){return e}}}),$traceurRuntime.registerModule("src/math/Rect.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/math/Rect.js")).Point,t=$traceurRuntime.createClass(i,{isEqualTo:function(e){if(!(e instanceof i))return!1;return e.x===this.x&&e.y===this.y&&e.w===this.w&&e.h===this.h},isApproximatelyEqualTo:function(e,t){if(!(e instanceof i))return!1;var r=e;return Math.abs(r.x-this.x)<=t&&Math.abs(r.y-this.y)<=t&&Math.abs(r.right()-this.right())<=t&&Math.abs(r.bottom()-this.bottom())<=t},toString:function(){return"["+this.x+":"+this.right()+"]x["+this.y+":"+this.bottom()+"]"},center:function(){return new e(this.x+this.w/2,this.y+this.h/2)},topLeft:function(){return new e(this.x,this.y)},topRight:function(){return new e(this.x+this.w,this.y)},bottomLeft:function(){return new e(this.x,this.y+this.h)},bottomRight:function(){return new e(this.x+this.w,this.y+this.h)},centerLeft:function(){return new e(this.x,this.y+this.h/2)},centerRight:function(){return new e(this.x+this.w,this.y+this.h/2)},topCenter:function(){return new e(this.x+this.w/2,this.y)},bottomCenter:function(){return new e(this.x+this.w/2,this.y+this.h)},right:function(){return this.x+this.w},bottom:function(){return this.y+this.h},skipLeft:function(e){var t=Math.min(e,this.w);return new i(this.x+t,this.y,this.w-t,this.h)},skipRight:function(e){var t=Math.min(e,this.w);return new i(this.x,this.y,this.w-t,this.h)},skipTop:function(e){var t=Math.min(e,this.h);return new i(this.x,this.y+t,this.w,this.h-t)},skipBottom:function(e){var t=Math.min(e,this.h);return new i(this.x,this.y,this.w,this.h-t)},takeLeft:function(e){var t=Math.max(e,0);return new i(this.x,this.y,t,this.h)},takeRight:function(e){var t=Math.max(e,0);return new i(this.x+this.w-t,this.y,t,this.h)},takeTop:function(e){var t=Math.max(e,0);return new i(this.x,this.y,this.w,t)},takeBottom:function(e){var t=Math.max(e,0);return new i(this.x,this.y+this.h-t,this.w,t)},paddedBy:function(e){return new i(this.x-e,this.y-e,this.w+2*e,this.h+2*e)},scaledOutwardBy:function(e){var t=this.center(),r=this.w*e,n=this.h*e;return new i(t.x-r/2,t.y-n/2,r,n)},containsPoint:function(e){return e.x>=this.x&&e.x<this.x+this.w&&e.y>=this.y&&e.y<this.y+this.h},takeLeftProportion:function(e){return this.takeLeft(this.w*e)},takeRightProportion:function(e){return this.takeRight(this.w*e)},takeTopProportion:function(e){return this.takeTop(this.h*e)},takeBottomProportion:function(e){return this.takeBottom(this.h*e)},leftHalf:function(){return this.skipRight(this.w/2)},rightHalf:function(){return this.skipLeft(this.w/2)},topHalf:function(){return this.skipBottom(this.h/2)},bottomHalf:function(){return this.skipTop(this.h/2)},shiftedBy:function(e,t){return new i(this.x+e,this.y+t,this.w,this.h)},proportionalShiftedBy:function(e,t){return this.shiftedBy(e*this.w,t*this.h)},withX:function(e){return new i(e,this.y,this.w,this.h)},withY:function(e){return new i(this.x,e,this.w,this.h)},withW:function(e){return new i(this.x,this.y,e,this.h)},withH:function(e){return new i(this.x,this.y,this.w,e)},snapInside:function(e){var t=Math.min(e.w,this.w),r=Math.min(e.h,this.h);return new i(Math.max(Math.min(this.x,e.right()-t),e.x),Math.max(Math.min(this.y,e.bottom()-r),e.y),t,r)}},{centeredSquareWithRadius:function(e,t){return new i(e.x-t,e.y-t,2*t,2*t)}});function i(e,t,r,n){this.x=e,this.y=t,this.w=r,this.h=n}return{get Rect(){return t}}}),$traceurRuntime.registerModule("src/ui/clear.js",[],function(){"use strict";function e(n,e){var i='{"cols":[]}',a=document.getElementById("clear-all-button");n.latestActiveCommit().zipLatest(e,function(e,t){return{r:e,v:t}}).subscribe(function(e){var t=e.r,r=e.v;a.disabled=t===i||r}),a.addEventListener("click",function(){return n.commit(i)});var o=document.getElementById("clear-circuit-button");n.latestActiveCommit().zipLatest(e,function(e,t){return{r:e,v:t}}).subscribe(function(e){var t=e.r,r=e.v;o.disabled=t===u(n)||r}),o.addEventListener("click",function(){return n.commit(u(n))})}function u(e){var t=JSON.parse(e.peekActiveCommit());return t.cols=[],JSON.stringify(t)}return{get initClear(){return e}}}),$traceurRuntime.registerModule("src/ui/DisplayedCircuit.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/CachablePainting.js","src/ui/DisplayedCircuit.js")).CachablePainting,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/DisplayedCircuit.js")).CircuitDefinition,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitStats.js","src/ui/DisplayedCircuit.js")).CircuitStats,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/DisplayedCircuit.js")).Config,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/ui/DisplayedCircuit.js")).DetailedError,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Equate.js","src/ui/DisplayedCircuit.js")).equate,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/ui/DisplayedCircuit.js")).Format,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/ui/DisplayedCircuit.js")).GateColumn,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/ui/DisplayedCircuit.js")).GateDrawParams,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/ui/DisplayedCircuit.js")).GatePainting,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/Hand.js","src/ui/DisplayedCircuit.js")).Hand,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/ui/DisplayedCircuit.js")).MathPainter,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/ui/DisplayedCircuit.js")).Point,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/ui/DisplayedCircuit.js")).Matrix,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/ui/DisplayedCircuit.js")).Rect,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/ui/DisplayedCircuit.js")).Util,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/ui/DisplayedCircuit.js")),R=r.seq,i=r.Seq,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/BlochSphereDisplay.js","src/ui/DisplayedCircuit.js")).paintBlochSphereDisplay,M=$traceurRuntime.createClass(_,{isBeingEdited:function(){return void 0!==this._extraWireStartIndex},_groundedWireCount:function(){var e=void 0!==this._extraWireStartIndex&&this._extraWireStartIndex!==m.MAX_WIRE_COUNT?1:0,t=Math.max(m.MIN_WIRE_COUNT,this.circuitDefinition.numWires)-e;return Math.max(t,this.circuitDefinition.minimumRequiredWireCount())},desiredHeight:function(){return void 0!==arguments[0]&&arguments[0]?this.circuitDefinition.numWires*m.WIRE_SPACING:this._groundedWireCount()*m.WIRE_SPACING+55},desiredWidth:function(){return void 0!==arguments[0]&&arguments[0]?this.opRect(this.circuitDefinition.columns.length-1).right()+35:this._rectForSuperpositionDisplay().right()+101},wireRect:function(e){if(e<0)throw new o("Bad wireIndex",{wireIndex:e});return new b(0,this.top+m.WIRE_SPACING*e,1/0,m.WIRE_SPACING)},wireIndexAt:function(e){return Math.floor((e-this.top)/m.WIRE_SPACING)},toColumnSpaceCoordinate:function(e){return(e-30)/(10+2*m.GATE_RADIUS)-.5},indexOfDisplayedRowAt:function(e){var t=Math.floor((e-this.top)/m.WIRE_SPACING);if(!(t<0||t>=this.circuitDefinition.numWires))return t},indexOfDisplayedColumnAt:function(e){var t=this.toColumnSpaceCoordinate(e),r=void 0===this._compressedColumnIndex||t<this._compressedColumnIndex-.75?Math.round(t):t<this._compressedColumnIndex-.25?this._compressedColumnIndex:Math.round(t)-1;if(!(r<0||r>=this.circuitDefinition.columns.length))return r},findOpHalfColumnAt:function(e){if(!(e.x<0||e.y<this.top||e.y>this.top+this.desiredHeight()))return Math.max(-.5,Math.round(2*this.toColumnSpaceCoordinate(e.x))/2)},_findModificationIndex_helperColRow:function(e){if(void 0!==e.pos&&void 0!==e.heldGate){var t=e.pos.minus(e.holdOffset).plus(new y(m.GATE_RADIUS,m.GATE_RADIUS)),r=this.findOpHalfColumnAt(t),n=this.indexOfDisplayedRowAt(t.y);if(void 0!==r&&void 0!==n)return{col:Math.ceil(r),row:n,halfColIndex:r}}},findModificationIndex:function(e){var t=this._findModificationIndex_helperColRow(e);if(void 0!==t){var r=t.col,n=t.row,i=t.halfColIndex,a=.5===Math.abs(i%1);return r>=this.circuitDefinition.columns.length?{col:r,row:n,isInsert:a}:(a||this.circuitDefinition.isSlotRectCoveredByGateInSameColumn(r,n,e.heldGate.height)&&(a=!0,e.pos.x>this.opRect(r).center().x&&(r+=1)),{col:r,row:n,isInsert:a})}},opRect:function(e){var t=2*m.GATE_RADIUS,r=10+t,n=0;return void 0!==this._compressedColumnIndex&&e===this._compressedColumnIndex&&(n=r/2),void 0!==this._compressedColumnIndex&&e>this._compressedColumnIndex&&(n=r),new b(r*e-n+35,this.top,t,this.desiredHeight())},gateRect:function(e,t){var r=void 0!==arguments[2]?arguments[2]:1,n=void 0!==arguments[3]?arguments[3]:1,i=this.opRect(t),a=this.wireRect(e),o=new b(i.center().x-m.GATE_RADIUS,a.center().y-m.GATE_RADIUS,2*m.GATE_RADIUS+(r-1)*m.WIRE_SPACING,2*m.GATE_RADIUS+(n-1)*m.WIRE_SPACING);return new b(Math.round(o.x-.5)+.5,Math.round(o.y-.5)+.5,Math.round(o.w),Math.round(o.h))},afterTidyingUp:function(){return this.withCircuit(this.circuitDefinition.withUncoveredColumnsRemoved().withHeightOverlapsFixed().withWidthOverlapsFixed().withUncoveredColumnsRemoved().withTrailingSpacersIncluded())._withCompressedColumnIndex(void 0)._withExtraWireStartIndex(void 0)._withHighlightedSlot(void 0)},isEqualTo:function(e){return this===e||e instanceof _&&this.top===e.top&&this.circuitDefinition.isEqualTo(e.circuitDefinition)&&this._compressedColumnIndex===e._compressedColumnIndex&&this._extraWireStartIndex===e._extraWireStartIndex&&t(this._highlightedSlot,e._highlightedSlot)},paint:function(e,t,r){var n=void 0!==arguments[3]&&arguments[3];void 0!==arguments[4]&&!arguments[4]||this._drawWires(e,!n,t);for(var i=0;i<this.circuitDefinition.columns.length;i++)this._drawColumn(e,this.circuitDefinition.columns[i],i,t,r);n||(this._drawOutputDisplays(e,r,t),this._drawHintLabels(e,r)),this._drawRowDragHighlight(e)},_drawWires:function(u,s,e){var l=this,t=Math.min(this.circuitDefinition.numWires,(this._extraWireStartIndex||1/0)+1);if(s)for(var r=0;r<t;r++){var n=this.wireRect(r).center().y,i=this.circuitDefinition.customInitialValues.get(r);void 0===i&&(i="0");var a=this._wireInitialStateClickableRect(r);u.noteTouchBlocker({rect:a,cursor:"pointer"}),void 0===this._highlightedSlot&&void 0!==e.pos&&a.containsPoint(e.pos)&&u.fillRect(a,m.HIGHLIGHTED_GATE_FILL_COLOR),u.print("|"+i+"⟩",20,n,"right","middle","black","14px sans-serif",20,m.WIRE_SPACING)}u.ctx.save();for(var c=this,o=0;o<t;o++)!function(o){o===c._extraWireStartIndex&&(u.ctx.globalAlpha*=.5),u.trace(function(e){for(var t=l.wireRect(o),r=Math.round(t.center().y-.5)+.5,n=s?25:5,i=0;s?n<u.canvas.width:i<=l.circuitDefinition.columns.length;i++){var a=l.opRect(i).center().x;l.circuitDefinition.locIsMeasured(new y(i,o))?(e.line(n,r-1,a,r-1),e.line(n,r+1,a,r+1)):e.line(n,r,a,r),n=a}}).thenStroke("black")}(o);u.ctx.restore(),void 0!==this._extraWireStartIndex&&this.circuitDefinition.numWires===m.MAX_WIRE_COUNT&&u.print("(Max wires. Qubit limit is "+m.MAX_WIRE_COUNT+".)",5,this.wireRect(m.MAX_WIRE_COUNT).y,"left","top","red","16px bold monospace",400,m.WIRE_SPACING)},_highlightStatusAt:function(n,i,e){var a=this;if(void 0!==this._highlightedSlot&&this._highlightedSlot.col===n&&this._highlightedSlot.row===i)return{isResizeShowing:!0,isResizeHighlighted:this._highlightedSlot.resizeStyle,isHighlighted:!this._highlightedSlot.resizeStyle};var t=this.circuitDefinition.gateInSlot(n,i);if(void 0===t||void 0!==this._highlightedSlot)return{isResizeShowing:!1,isResizeHighlighted:!1,isHighlighted:!1};var r=this.gateRect(i,n,t.width,t.height),o=g.rectForResizeTab(r),u=t.canChangeInSize()&&R(e).any(function(e){return t=e,(void 0===(r=a.findGateOverlappingPos(t))||r.col===n&&r.row===i)&&o.containsPoint(e);var t,r}),s=!u&&R(e).any(function(e){var t=a.findGateOverlappingPos(e);return void 0!==t&&t.col===n&&t.row===i});return{isHighlighted:s,isResizeShowing:t.canChangeInSize()&&(u||s),isResizeHighlighted:u}},_drawGate_disabledReason:function(e,t,r,n,i){var a,o=this.circuitDefinition.gateAtLocIsDisabledReason(t,r);void 0!==o&&(e.ctx.save(),i&&(e.ctx.globalAlpha*=.3),e.ctx.globalAlpha*=.5,e.fillRect(n.paddedBy(5),"yellow"),e.ctx.globalAlpha*=2,e.strokeLine(n.topLeft(),n.bottomRight(),"orange",3),a=e.printParagraph(o,n.paddedBy(5),new y(.5,.5),"red"),e.ctx.globalAlpha*=.5,e.fillRect(a.paddedBy(2),"yellow"),e.ctx.globalAlpha*=2,e.printParagraph(o,n.paddedBy(5),new y(.5,.5),"red"),e.ctx.restore())},_drawColumn:function(e,t,r,n,i){this._drawColumnControlWires(e,r),this._drawColumnDragHighlight(e,r);for(var a,o,u,s,l,c,d,m=0;m<this.circuitDefinition.numWires;m++){void 0!==t.gates[m]&&(a=t.gates[m],o=this.gateRect(m,r,a.width,a.height),s=(u=this._highlightStatusAt(r,m,n.hoverPoints())).isHighlighted,l=u.isResizeShowing,c=u.isResizeHighlighted,d=a.customDrawer||g.DEFAULT_DRAWER,e.noteTouchBlocker({rect:o,cursor:"pointer"}),a.canChangeInSize()&&e.noteTouchBlocker({rect:g.rectForResizeTab(o),cursor:"ns-resize"}),d(new h(e,n,!1,s&&!c,l,c,o,a,i,{row:m,col:r},void 0===this._highlightedSlot?n.hoverPoints():[],i.customStatsForSlot(r,m))),this._drawGate_disabledReason(e,r,m,o,s))}this._drawColumnSurvivalRate(e,t,r,i)},_drawColumnSurvivalRate:function(e,t,r,n){var i,a,o,u,s,l;void 0!==t.indexOfNonUnitaryGate()&&(i=n.survivalRate(r-1),a=(n.survivalRate(r)-i)/i,isNaN(a)||Math.abs(a)<=.005||(s=a<0?(o=Math.round(100*-a),u=(-1==a?"100":o<100?o:">99")+"%","omits"):(u=Math.round(100*a+100)+"%","gains"),l=this.opRect(r).bottomCenter(),e.print(s,l.x,l.y-28,"center","bottom","red","14px sans-serif",800,50),e.print(u,l.x,l.y-13,"center","bottom","red","14px sans-serif",800,50)))},_drawColumnDragHighlight:function(e,t){var r;void 0!==this._highlightedSlot&&this._highlightedSlot.col===t&&void 0===this._highlightedSlot.row&&(r=this.gateRect(0,t,1,this._groundedWireCount()).paddedBy(3),e.fillRect(r,"rgba(255, 196, 112, 0.7)"),e.strokeRect(r,"black"))},_drawRowDragHighlight:function(e){var t,r,n;void 0!==this._highlightedSlot&&void 0===this._highlightedSlot.col&&void 0!==this._highlightedSlot.row&&(t=this._highlightedSlot.row,r=this.gateRect(t,this.clampedCircuitColCount()+1).x,n=this.wireRect(t).takeLeft(r),e.fillRect(n,"rgba(255, 196, 112, 0.7)"),e.strokeRect(n,"black"))},_drawColumnControlWires:function(e,t){var r=Math.round(this.opRect(t).center().x-.5)+.5;this.circuitDefinition.columns[t].hasGatesWithGlobalEffects()&&(e.ctx.save(),e.ctx.setLineDash([1,4]),e.strokeLine(new y(r,this.gateRect(0,0).y),new y(r,this.opRect(0).bottom()-40)),e.ctx.restore());var n=!0,i=!1,a=void 0;try{for(var o,u=this.circuitDefinition.controlLinesRanges(t)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,l=s.first,c=s.last,d=s.measured,m=this.wireRect(l).center().y,f=this.wireRect(c).center().y;d?(e.strokeLine(new y(r+1,m),new y(r+1,f)),e.strokeLine(new y(r-1,m),new y(r-1,f))):e.strokeLine(new y(r,m),new y(r,f))}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}},previewDrop:function(e){return void 0!==e.heldRow?this._previewDropMovedRow(e):void 0!==e.heldColumn?this._previewDropMovedGateColumn(e):void 0!==e.heldGate?this._previewDropMovedGate(e):this._previewResizedGate(e)},_previewDropMovedRow:function(e){if(void 0===e.pos)return this;if((a=this.wireIndexAt(e.pos.y))<0||a>=this.circuitDefinition.numWires)return this;for(var t=R(e.heldRow.gates).map(function(e){return void 0===e?1:e.height}).max(1),a=Math.min(a,this.circuitDefinition.numWires-t),r=[],n=0;n<this.circuitDefinition.columns.length;n++){var i=$traceurRuntime.spread(this.circuitDefinition.columns[n].gates);i.splice(a,0,e.heldRow.gates[n]),i.pop(),r.push(new f(i))}var o=R(this.circuitDefinition.customInitialValues.entries()).map(function(e){var t,r,n=(r=(t=e[Symbol.iterator]()).next()).done?void 0:r.value,i=(r=t.next()).done?void 0:r.value;return[n+(a<=n?1:0),i]}).toMap(function(e){var t,r,n=(r=(t=e[Symbol.iterator]()).next()).done?void 0:r.value;(r=t.next()).done||r.value;return n},function(e){var t,r;(r=(t=e[Symbol.iterator]()).next()).done||r.value;return(r=t.next()).done?void 0:r.value});void 0!==e.heldRow.initialState&&o.set(a,e.heldRow.initialState);var u=this.circuitDefinition.withColumns(r).withInitialStates(o);return this.withCircuit(u)._withHighlightedSlot({row:a,col:void 0,resizeStyle:!1})},_previewDropMovedGateColumn:function(e){if(void 0===e.pos)return this;var t=this.wireIndexAt(e.pos.y);if(t<0||t>=m.MAX_WIRE_COUNT||e.pos.x<=1)return this;var r=this.findOpHalfColumnAt(new y(e.pos.x,this.top));r%1!=0||void 0===this.circuitDefinition.columns[r]||this.circuitDefinition.columns[r].isEmpty()||(r+=e.pos.x>this.opRect(r).center().x?.5:-.5);var n=Math.ceil(r),i=r%1!=0,a=Math.round((e.pos.y-e.holdOffset.y-this.top)/m.WIRE_SPACING),o=this._shiftAndSpliceColumn(a,$traceurRuntime.spread(e.heldColumn.gates),n,i);return this.withCircuit(o)._withHighlightedSlot({row:void 0,col:n,resizeStyle:!1})._withCompressedColumnIndex(i?n:void 0)},_shiftAndSpliceColumn:function(e,t,r,n){for(;e<0&&void 0===t[0];)t.shift(),t.push(void 0),e+=1;for(;0<e&&new f(t).minimumRequiredWireCount()<m.MAX_WIRE_COUNT;)t.unshift(void 0),new f(t).minimumRequiredWireCount()<t.length&&t.pop(),--e;for(var i=this.circuitDefinition.withWireCount(t.length),a=$traceurRuntime.spread(i.columns);a.length<r;)a.push(f.empty(i.numWires));return a.splice(r,n?0:1,new f(t)),i.withColumns(a).withTrailingSpacersIncluded()},_previewDropMovedGate:function(e){var t=this.findModificationIndex(e);if(void 0===t)return this;var r=Math.floor(e.holdOffset.y/m.WIRE_SPACING);if(t.row+r>=this.circuitDefinition.numWires)return this;var n=e.heldGate,i=f.empty(this.circuitDefinition.numWires),a=t.col,o=t.isInsert,u=Math.min(t.row,Math.max(0,m.MAX_WIRE_COUNT-n.height)),s=R(this.circuitDefinition.columns).padded(a,i).ifThen(o,function(e){return e.withInsertedItem(a,i)}).padded(a+n.width,i).withTransformedItem(a,function(e){return e.withGatesAdded(u,new f([n]))}).toArray(),l=Math.max(this._extraWireStartIndex||0,Math.max(this.circuitDefinition.numWires,n.height+u));if(l>m.MAX_WIRE_COUNT)return this;var c=this.circuitDefinition.withColumns(s).withWireCount(l);return this.withCircuit(c)._withHighlightedSlot({row:u,col:t.col,resizeStyle:!1})._withCompressedColumnIndex(o?a:void 0)._withFallbackExtraWireStartIndex(this.circuitDefinition.numWires)},_previewResizedGate:function(t){if(void 0===t.resizingGateSlot||void 0===t.pos)return this;var e=this.circuitDefinition.gateInSlot(t.resizingGateSlot.x,t.resizingGateSlot.y);if(void 0===e)return this;var r=Math.min(this.wireIndexAt(t.pos.y-t.holdOffset.y),m.MAX_WIRE_COUNT-1),n=R(e.gateFamily).minBy(function(e){return Math.abs(e.height-(r-t.resizingGateSlot.y+1))}),i=Math.min(m.MAX_WIRE_COUNT,Math.max(this.circuitDefinition.numWires,n.height+t.resizingGateSlot.y)),a=R(this.circuitDefinition.columns).withTransformedItem(t.resizingGateSlot.x,function(e){return new f(R(e.gates).withOverlayedItem(t.resizingGateSlot.y,n).toArray())}).toArray(),o=this.circuitDefinition.withColumns(a).withWireCount(i),u=o.withHeightOverlapsFixed(),s=u.withTrailingSpacersIncluded();return this.withCircuit(s)._withHighlightedSlot(this._highlightedSlot)._withCompressedColumnIndex(o.isEqualTo(u)?void 0:t.resizingGateSlot.x+1)._withFallbackExtraWireStartIndex(this.circuitDefinition.numWires)},afterDropping:function(e){return this.previewDrop(e)._withCompressedColumnIndex(void 0)},withCircuit:function(e){return new _(this.top,e,this._compressedColumnIndex,this._highlightedSlot,this._extraWireStartIndex)},_withCompressedColumnIndex:function(e){return new _(this.top,this.circuitDefinition,e,this._highlightedSlot,this._extraWireStartIndex)},_withHighlightedSlot:function(e){return new _(this.top,this.circuitDefinition,this._compressedColumnIndex,e,this._extraWireStartIndex)},_withExtraWireStartIndex:function(e){return new _(this.top,this.circuitDefinition,this._compressedColumnIndex,this._highlightedSlot,e)},_withFallbackExtraWireStartIndex:function(e){return this._withExtraWireStartIndex(this._extraWireStartIndex||e)},withJustEnoughWires:function(e,t){var r=void 0!==e.heldGate?e.heldGate.height:0,n=this.circuitDefinition.minimumRequiredWireCount(),i=Math.min(m.MAX_WIRE_COUNT,Math.max(Math.min(1,r),Math.max(m.MIN_WIRE_COUNT,n)+t));return this.withCircuit(this.circuitDefinition.withWireCount(i))._withExtraWireStartIndex(0===t?void 0:this.circuitDefinition.numWires)},findGateOverlappingPos:function(e){var t=this.indexOfDisplayedColumnAt(e.x),r=this.indexOfDisplayedRowAt(e.y);if(void 0!==t&&void 0!==r){var n=this.circuitDefinition.findGateCoveringSlot(t,r);if(void 0!==n){var i=this.gateRect(n.row,n.col,n.gate.width,n.gate.height);if(i.containsPoint(e))return{col:n.col,row:n.row,offset:e.minus(i.topLeft())}}}},findGateWithButtonContaining:function(e){var t=this.findGateOverlappingPos(e);if(void 0!==t){var r=this.circuitDefinition.gateInSlot(t.col,t.row);if(void 0!==r.onClickGateFunc)if(g.gateButtonRect(this.gateRect(t.row,t.col,r.width,r.height)).containsPoint(e))return{col:t.col,row:t.row,gate:r}}},_wireInitialStateClickableRect:function(e){var t=this.wireRect(e);return t.x=0,t.y+=5,t.w=30,t.h-=10,t},findWireWithInitialStateAreaContaining:function(e){if(!(e.x<0||30<e.x)){var t=this.wireIndexAt(e.y);if(!(t<0||t>=this.circuitDefinition.numWires))if(this._wireInitialStateClickableRect(t).containsPoint(e))return t}},tryClick:function(e){if(void 0!==e.pos&&void 0===e.heldGate){var t=this.findWireWithInitialStateAreaContaining(e.pos);if(void 0!==t)return this.withCircuit(this.circuitDefinition.withSwitchedInitialStateOn(t));var r=this.findGateWithButtonContaining(e.pos);if(void 0!==r){var n=r.gate.onClickGateFunc(r.gate),i=$traceurRuntime.spread(this.circuitDefinition.columns),a=i[r.col],o=$traceurRuntime.spread(a.gates);return o.splice(r.row,1,n),i.splice(r.col,1,new f(o)),this.withCircuit(this.circuitDefinition.withColumns(i))}}},tryGrab:function(e){var t=void 0!==arguments[1]&&arguments[1],r=void 0!==arguments[3]&&arguments[3],n=void 0!==arguments[4]&&arguments[4];if(void 0!==arguments[2]&&arguments[2]){var i=this._tryGrabRow(e,n);return void 0!==i?i:this._tryGrabWholeColumn(e,t,n)||{newCircuit:this,newHand:e}}var a,o=e,u=this;return r||void 0!==(a=this._tryGrabResizeTab(e))&&(o=a.newHand,u=a.newCircuit),u._tryGrabGate(o,t,n)||{newCircuit:u,newHand:o}},_tryGrabRow:function(e,t){if(void 0!==e.pos){var r=this.wireIndexAt(e.pos.y);if(!(r<0||r>=this.circuitDefinition.numWires)){var n=this._wireInitialStateClickableRect(r);if(n.containsPoint(e.pos)){var i=this._cutRow(r),a=i.newCircuit,o=i.initialState,u=i.rowGates,s=new y(0,e.pos.y-n.y);return t&&(u=u.map(function(e){return void 0===e?e:e.alternate})),{newCircuit:this.withCircuit(a),newHand:e.withHeldRow({initialState:o,gates:u},s)}}}}},_cutRow:function(a){for(var e=[],t=[],r=0;r<this.circuitDefinition.columns.length;r++){var n=$traceurRuntime.spread(this.circuitDefinition.columns[r].gates);e.push(n[a]),n.splice(a,1),n.push(void 0),t.push(new f(n))}var i=R(this.circuitDefinition.customInitialValues.entries()).filter(function(e){var t,r,n=(r=(t=e[Symbol.iterator]()).next()).done?void 0:r.value;(r=t.next()).done||r.value;return n!==a}).map(function(e){var t,r,n=(r=(t=e[Symbol.iterator]()).next()).done?void 0:r.value,i=(r=t.next()).done?void 0:r.value;return[n-(a<n?1:0),i]}).toMap(function(e){var t,r,n=(r=(t=e[Symbol.iterator]()).next()).done?void 0:r.value;(r=t.next()).done||r.value;return n},function(e){var t,r;(r=(t=e[Symbol.iterator]()).next()).done||r.value;return(r=t.next()).done?void 0:r.value});return{newCircuit:this.circuitDefinition.withColumns(t).withInitialStates(i),rowGates:e,initialState:this.circuitDefinition.customInitialValues.get(a)}},_tryGrabGate:function(e,t,r){if(!e.isBusy()&&void 0!==e.pos){var n=this.findGateOverlappingPos(e.pos);if(void 0!==n){var i=n.col,a=n.row,o=n.offset,u=this.circuitDefinition.columns[i].gates[a];r&&(u=u.alternate);var s=R(this.circuitDefinition.columns[i].gates).toArray();t||(s[a]=void 0);var l=R(this.circuitDefinition.columns).withOverlayedItem(i,new f(s)).toArray();return{newCircuit:new _(this.top,this.circuitDefinition.withColumns(l),void 0,void 0,this._extraWireStartIndex),newHand:e.withHeldGate(u,o)}}}},_tryGrabResizeTab:function(e){if(!e.isBusy()&&void 0!==e.pos)for(var t=0;t<this.circuitDefinition.columns.length;t++)for(var r=0;r<this.circuitDefinition.numWires;r++){var n=this.circuitDefinition.columns[t].gates[r];if(void 0!==n)if(this._highlightStatusAt(t,r,e.hoverPoints()).isResizeHighlighted){var i=e.pos.minus(this.gateRect(r+n.height-1,t,1,1).center());return{newCircuit:this._withHighlightedSlot({col:t,row:r,resizeStyle:!0}),newHand:e.withResizeSlot(new y(t,r),i)}}}},_tryGrabWholeColumn:function(e,t,r){if(!e.isBusy()&&void 0!==e.pos){var n=Math.round(this.toColumnSpaceCoordinate(e.pos.x));if(!(n<0||n>=this.circuitDefinition.columns.length||this.circuitDefinition.columns[n].isEmpty())){var i=$traceurRuntime.spread(this.circuitDefinition.columns);t||i.splice(n,1,f.empty(this.circuitDefinition.numWires));var a=new y(0,this.wireIndexAt(e.pos.y)*m.WIRE_SPACING+m.WIRE_SPACING/2),o=this.circuitDefinition.columns[n];return r&&(o=new f(o.gates.map(function(e){return void 0===e?e:e.alternate}))),{newCircuit:this.withCircuit(this.circuitDefinition.withColumns(i)),newHand:e.withHeldGateColumn(o,a)}}}},stableDuration:function(){return this.circuitDefinition.stableDuration()},importantWireCount:function(){return Math.max(this.circuitDefinition.numWires-(this._extraWireStartIndex===m.MAX_WIRE_COUNT?0:1),m.MIN_WIRE_COUNT,this.circuitDefinition.minimumRequiredWireCount())},_drawOutputDisplays:function(e,t,r){for(var n=this.clampedCircuitColCount()+1,i=n+1,a=this.importantWireCount(),o=0;o<a;o++){var u=t.controlledWireProbabilityJustAfter(o,1/0);v.paintProbabilityBox(e,u,this.gateRect(o,n),r.hoverPoints());var s=t.qubitDensityMatrix(1/0,o);void 0!==s&&w(e,s,this.gateRect(o,i),r.hoverPoints())}var l=this.wireRect(a-1).bottom(),c=this.opRect(n-1).x;e.printParagraph("Local wire states\n(Chance/Bloch)",new b(c,l+4,190,40),new y(.5,0),"gray"),this._drawOutputSuperpositionDisplay(e,t,r)},clampedCircuitColCount:function(){return Math.max(this.circuitDefinition.columns.length,m.MIN_COL_COUNT+(void 0!==this._compressedColumnIndex?1:0))},_drawOutputSuperpositionDisplay:function(e,t,r){var n=this._outputStateAsMatrix(t),i=this._rectForSuperpositionDisplay(),a=this.importantWireCount();v.paintMatrix(e,n,i,a<m.SIMPLE_SUPERPOSITION_DRAWING_WIRE_THRESHOLD?m.SUPERPOSITION_MID_COLOR:void 0,"black",a<m.SIMPLE_SUPERPOSITION_DRAWING_WIRE_THRESHOLD?m.SUPERPOSITION_FORE_COLOR:void 0,m.SUPERPOSITION_BACK_COLOR);v.paintMatrixTooltip(e,n,i,r.hoverPoints(),function(e,t){return"Amplitude of |"+l.bin(t*n.width()+e,a)+"⟩ (decimal "+(t*n.width()+e)+")"},function(e,t,r){return"val:"+r.toString(new u(!1,0,5,", "))},function(e,t,r){return"mag²:"+(100*r.norm2()).toFixed(4)+"%, phase:"+((0<=(n=180*r.phase()/Math.PI)?"+":"")+n.toFixed(2))+"°";var n}),this._drawOutputSuperpositionDisplay_labels(e)},_drawOutputSuperpositionDisplay_labels:function(e){var t=this._rectForSuperpositionDisplay(),r=this.importantWireCount();S.paint(t.right(),t.y,e,r),T.paint(t.x,t.bottom(),e,r)},_outputStateAsMatrix:function(e){var t,r,n,i,a,o=this.importantWireCount(),u=e.finalState.rawBuffer();e.circuitDefinition.numWires!==o&&((a=new Float32Array(2<<o)).set(u.slice(0,a.length)),u=a);var s=(i=(n=[1<<((r=(t=[Math.floor(o/2),Math.ceil(o/2)][Symbol.iterator]()).next()).done?void 0:r.value),1<<((r=t.next()).done?void 0:r.value)][Symbol.iterator]()).next()).done?void 0:i.value,l=(i=n.next()).done?void 0:i.value;return new c(s,l,u)},_rectForSuperpositionDisplay:function(){var e,t,r,n,i=this.clampedCircuitColCount()+2+1,a=this.importantWireCount(),o=(n=(r=[1<<((t=(e=[Math.floor(a/2),Math.ceil(a/2)][Symbol.iterator]()).next()).done?void 0:t.value),1<<((t=e.next()).done?void 0:t.value)][Symbol.iterator]()).next()).done?void 0:n.value,u=(n=r.next()).done?void 0:n.value,s=this.gateRect(0,i),l=this.gateRect(a-1,i),c=new b(s.x,s.y,0,l.bottom()-s.y);return c.withW(c.h*(o/u))},_drawHintLabels:function(e,t){var r=this._rectForSuperpositionDisplay();e.print("Final amplitudes",r.right()+3,r.bottom()+3,"left","top","gray","12px sans-serif",100,20),0!==this.circuitDefinition.colIsMeasuredMask(1/0)&&e.printParagraph("(assuming measurement deferred)",new b(r.right()+3,r.bottom()+20,100,75),new y(.5,0),"red");var n,i,a=t.survivalRate(1/0);.01<Math.abs(a-1)&&(i=a<1?(n=Math.round(100*a),"kept: "+(0===a?"0":0<n?n:"<1")+"%"):"over-unity: "+Math.round(100*a)+"%",e.print(i,this._rectForSuperpositionDisplay().x-5,r.bottom()+50,"right","bottom","red","14px sans-serif",800,50))}},{empty:function(e){return new _(e,new a(m.MIN_WIRE_COUNT,[]),void 0,void 0,void 0)},fromTextDiagram:function(r,n){var t=n.split("\n").map(function(e){var t=e.split("|");if(2!==t.length)throw new o("Bad diagram",{diagramText:n,gateMap:r});return t[1]}),e=R(t).skip(1).stride(2).map(function(e){return R(e).skip(1).stride(2).join("")}).join("\n");return{circuit:new _(10,a.fromTextDiagram(r,e),void 0,void 0,void 0),pts:i.naturals().takeWhile(function(e){return-1!==n.indexOf(e)}).map(function(r){var e=R(t).mapWithIndex(function(e,t){return{row:t,col:e.indexOf(r)}}).filter(function(e){return-1!==e.col}).single();return"^"===t[e.row][e.col+1]&&(--e.row,e.col+=1),new y(e.col*m.WIRE_SPACING/2+35.5,e.row*m.WIRE_SPACING/2+10.5)}).toArray()}}});function _(e,t,r,n,i){if(!Number.isFinite(e))throw new o("Bad top",{top:e,circuitDefinition:t});if(!(t instanceof a))throw new o("Bad circuitDefinition",{top:e,circuitDefinition:t});this.top=e,this.circuitDefinition=t,this._compressedColumnIndex=r,this._highlightedSlot=n,this._extraWireStartIndex=i}function n(e,t,r,n,i){var a=new M(0,t,void 0,void 0,void 0),o=a.desiredWidth(!0),u=a.desiredHeight(!0),s=r.w/o,l=r.h/u;n&&(l=s=Math.min(s,l));var c=d.withNanDataFromCircuitAtTime(t,i);try{e.ctx.save(),e.ctx.translate(r.x,r.y),e.ctx.scale(Math.min(1,s),Math.min(1,l)),e.ctx.translate(0,0),a.paint(e,p.EMPTY,c,!0,n)}finally{e.ctx.restore()}return{maxW:o*s,maxH:u*l}}function s(e){var t;void 0!==e.gate.knownCircuit&&""===e.gate.symbol?(t=e.gate.stableDuration()===1/0?m.GATE_FILL_COLOR:m.TIME_DEPENDENT_HIGHLIGHT_COLOR,g.paintBackground(e,t),n(e.painter,e.gate.knownCircuitNested,e.rect,!1,e.stats.time),g.paintOutline(e),e.isHighlighted&&(e.painter.ctx.save(),e.painter.ctx.globalAlpha*=.9,e.painter.fillRect(e.rect,m.HIGHLIGHTED_GATE_FILL_COLOR),e.painter.ctx.restore()),g.paintOutline(e)):e.gate.stableDuration()===1/0?g.DEFAULT_DRAWER(e):g.makeCycleDrawer()(e)}function x(e,t,r,n,i){var a=e.ctx;a.save(),a.textAlign="left",a.textBaseline="middle",e.ctx.font="12px monospace";var o=Math.max(e.ctx.measureText(n(0)).width,e.ctx.measureText(n(r-1)).width),u=2.5*a.measureText("0").width,s=Math.min(Math.min((i-2)/o,t/u),1),l=t/s,c=1/s;if(a.scale(s,s),a.translate(0,.5*t/s-.5*u),a.fillStyle="lightgray",u<.95*l)for(var d=0;d<r;d++)a.fillRect(0,l*d,o+2*c,u);else a.fillRect(0,0,o+2*c,l*r);a.fillStyle="black";for(var m=0;m<r;m++)a.fillText(n(m),c,.5*u+l*m);a.restore()}var S=new e(function(e){return{width:50,height:(e-1)*m.WIRE_SPACING+2*m.GATE_RADIUS}},function(e,t){var r,n,i=(n=(r=[Math.floor(t/2),Math.ceil(t/2)][Symbol.iterator]()).next()).done?void 0:n.value,a=(n=r.next()).done?void 0:n.value,o=1<<a,u=i<4?"_".repeat(i):"_..";x(e,e.canvas.height/o,o,function(e){return l.bin(e,a)+u},50)}),T=new e(function(e){var t,r,n,i,a=(i=(n=[1<<((r=(t=[Math.floor(e/2),Math.ceil(e/2)][Symbol.iterator]()).next()).done?void 0:r.value),1<<((r=t.next()).done?void 0:r.value)][Symbol.iterator]()).next()).done?void 0:i.value,o=(i=n.next()).done?void 0:i.value;return{width:a*(((e-1)*m.WIRE_SPACING+2*m.GATE_RADIUS)/o),height:50}},function(e,t){var r,n,i=(n=(r=[Math.floor(t/2),Math.ceil(t/2)][Symbol.iterator]()).next()).done?void 0:n.value,a=(n=r.next()).done?void 0:n.value,o=1<<i,u=e.canvas.width/o;e.ctx.translate(o*u,0),e.ctx.rotate(Math.PI/2);var s=a<4?"_".repeat(a):".._";x(e,u,o,function(e){return s+l.bin(o-1-e,i)},50)});return{get DisplayedCircuit(){return M},get drawCircuitTooltip(){return n},get GATE_CIRCUIT_DRAWER(){return s}}}),$traceurRuntime.registerModule("src/ui/DisplayedInspector.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/DisplayedInspector.js")).CircuitDefinition,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitStats.js","src/ui/DisplayedInspector.js")).CircuitStats;var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/DisplayedInspector.js")).Config,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedCircuit.js","src/ui/DisplayedInspector.js")).DisplayedCircuit,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedToolbox.js","src/ui/DisplayedInspector.js")).DisplayedToolbox,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/ui/DisplayedInspector.js")).GateDrawParams,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/ui/DisplayedInspector.js")).GatePainting,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/ui/DisplayedInspector.js")).Gates,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/Hand.js","src/ui/DisplayedInspector.js")).Hand,d=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/ui/DisplayedInspector.js")).Painter,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/ui/DisplayedInspector.js")).Rect),e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/DisplayedInspector.js")).Serializer,t=$traceurRuntime.createClass(m,{desiredWidth:function(){return Math.max(this.displayedToolboxTop.desiredWidth(),Math.max(this.displayedCircuit.desiredWidth(),this.displayedToolboxBottom.desiredWidth()))},updateArea:function(e){this.drawArea=e,this.displayedToolboxTop=this.displayedToolboxTop.withTop(0),this.displayedToolboxBottom=this.displayedToolboxBottom.withTop(this.drawArea.bottom()-this.displayedToolboxBottom.desiredHeight())},paint:function(e,t){e.fillRect(this.drawArea,a.BACKGROUND_COLOR),this.displayedToolboxTop.paint(e,t,this.hand),this.displayedToolboxBottom.paint(e,t,this.hand),this.displayedCircuit.paint(e,this.hand,t),this._paintHand(e,t),this._drawHint(e)},_paintHand:function(e,t){var r,n,i;void 0!==this.hand.pos&&void 0!==this.hand.heldGate&&(r=this.hand.heldGate,n=this.hand.pos.minus(this.hand.holdOffset),i=new d(Math.round(n.x-.5)+.5,Math.round(n.y-.5)+.5,2*a.GATE_RADIUS+a.WIRE_SPACING*(r.width-1),2*a.GATE_RADIUS+a.WIRE_SPACING*(r.height-1)),(r.customDrawer||s.DEFAULT_DRAWER)(new u(e,this.hand,!1,!0,!0,!1,i,r,t,void 0,[],void 0)))},tryGetHandOverButtonKey:function(){if(void 0!==this.hand.pos){var e=this.displayedCircuit.findGateWithButtonContaining(this.hand.pos);if(void 0!==e)return"gate-button-"+e.col+":"+e.row;var t=this.displayedCircuit.findWireWithInitialStateAreaContaining(this.hand.pos);return void 0!==t?"wire-init-"+t:void 0}},tryClick:function(){var e=this.displayedCircuit.tryClick(this.hand);return void 0===e?void 0:this.withDisplayedCircuit(e)},afterGrabbing:function(){var e=void 0!==arguments[0]&&arguments[0],t=void 0!==arguments[1]&&arguments[1],r=void 0!==arguments[2]&&arguments[2],n=void 0!==arguments[3]&&arguments[3],i=this.hand,a=this.displayedCircuit,i=this.displayedToolboxTop.tryGrab(i);i=this.displayedToolboxBottom.tryGrab(i);var o=a.tryGrab(i,e,t,r,n);return i=o.newHand,a=o.newCircuit,new m(this.drawArea,a,this.displayedToolboxTop,this.displayedToolboxBottom,i)},isEqualTo:function(e){return this===e||e instanceof m&&this.drawArea.isEqualTo(e.drawArea)&&this.displayedCircuit.isEqualTo(e.displayedCircuit)&&this.displayedToolboxTop.isEqualTo(e.displayedToolboxTop)&&this.displayedToolboxBottom.isEqualTo(e.displayedToolboxBottom)&&this.hand.isEqualTo(e.hand)},withDisplayedCircuit:function(e){return e===this.displayedCircuit?this:new m(this.drawArea,e,this.displayedToolboxTop,this.displayedToolboxBottom,this.hand)},withJustEnoughWires:function(e,t){return this.withDisplayedCircuit(this.displayedCircuit.withJustEnoughWires(e,t))},afterTidyingUp:function(){return this.withDisplayedCircuit(this.displayedCircuit.afterTidyingUp())},previewDrop:function(){if(!this.hand.isBusy())return this;var e=this.hand,t=this.displayedCircuit,r=t.previewDrop(e),n=r===t?e:e.withDrop();return this.withHand(n).withDisplayedCircuit(r)},afterDropping:function(){return this.withDisplayedCircuit(this.displayedCircuit.afterDropping(this.hand)).withHand(this.hand.withDrop())},stableDuration:function(){return Math.min(this.displayedToolboxTop.stableDuration(this.hand),this.displayedToolboxBottom.stableDuration(this.hand),this.hand.stableDuration(),this.displayedCircuit.stableDuration())},withHand:function(e){return new m(this.drawArea,this.displayedCircuit,this.displayedToolboxTop,this.displayedToolboxBottom,e)},withCircuitDefinition:function(e){return new m(this.drawArea,i.empty(this.displayedToolboxTop.desiredHeight()).withCircuit(e),this.displayedToolboxTop,this.displayedToolboxBottom,this.hand.withDrop())},desiredHeight:function(){var e=this.displayedToolboxBottom.desiredHeight()+this.displayedToolboxTop.desiredHeight()+this.displayedCircuit.desiredHeight();return Math.max(a.MINIMUM_CANVAS_HEIGHT,e)},snapshot:function(){return JSON.stringify(e.toJson(this.displayedCircuit.circuitDefinition),null,0)},_drawHint:function(e){this._drawHint_dragGatesOntoCircuit(e),this._drawHint_watchOutputsChange(e),this._drawHint_useControls(e)},_drawHint_watchOutputsChange:function(e){var t=this._hintVisibility();t<=0||(e.ctx.save(),e.ctx.globalAlpha*=Math.min(1,t),e.ctx.translate(this.displayedCircuit.opRect(this.displayedCircuit.clampedCircuitColCount()).x-280,15),e.ctx.save(),e.ctx.translate(268,250),e.ctx.rotate(.02*Math.PI),e.ctx.fillStyle="red",e.ctx.textAlign="right",e.ctx.font="16px sans-serif",e.ctx.fillText("outputs change",0,0),e.ctx.restore(),e.ctx.beginPath(),e.ctx.moveTo(270,245),e.ctx.bezierCurveTo(300,245,315,235,325,225),e.ctx.strokeStyle="red",e.ctx.lineWidth=3,e.ctx.stroke(),e.trace(function(e){e.arrowHead(330,219,10,-.265*Math.PI,1.3)}).thenFill("red"),e.ctx.restore())},_hintVisibility:function(){return 0<this.displayedCircuit.circuitDefinition.columns.length?0:void 0===this.hand.pos||!this.hand.isBusy()||void 0!==this.hand.heldGate&&this.hand.heldGate.isControl()?1:(150-this.hand.pos.y)/50},_drawHint_dragGatesOntoCircuit:function(e){var t=this._hintVisibility();t<=0||(e.ctx.save(),e.ctx.globalAlpha*=Math.min(1,t),e.ctx.save(),e.ctx.translate(130,195),e.ctx.rotate(.05*Math.PI),e.ctx.fillStyle="red",e.ctx.font="16px sans-serif",e.ctx.fillText("drag gates onto circuit",0,0),e.ctx.restore(),e.ctx.beginPath(),e.ctx.moveTo(268,132),e.ctx.bezierCurveTo(260,170,235,175,217,187),e.ctx.strokeStyle="red",e.ctx.lineWidth=3,e.ctx.stroke(),e.trace(function(e){e.arrowHead(210,190,10,.84*Math.PI,1.3)}).thenFill("red"),e.ctx.restore())},_drawHint_useControls:function(e){var t,r,n=this._hintVisibility();n<=0||(e.ctx.save(),e.ctx.globalAlpha*=Math.min(1,n),r=(t=void 0===this.displayedCircuit.circuitDefinition.gateInSlot(0,0))?173:223,e.ctx.save(),e.ctx.translate(70,r-3),e.ctx.rotate(-.01*Math.PI),e.ctx.fillStyle="red",e.ctx.font="16px sans-serif",e.ctx.fillText("use controls",0,0),e.ctx.restore(),e.ctx.beginPath(),t?(e.ctx.moveTo(90,125),e.ctx.bezierCurveTo(60,140,48,160,55,r)):(e.ctx.moveTo(100,125),e.ctx.bezierCurveTo(115,150,105,170,55,r)),e.ctx.strokeStyle="red",e.ctx.lineWidth=3,e.ctx.stroke(),e.ctx.beginPath(),e.ctx.arc(55,r,5,0,2*Math.PI),e.ctx.fillStyle="red",e.ctx.fill(),e.ctx.restore())}},{empty:function(e){var t=new o("Toolbox",0,l.TopToolboxGroups,!0),r=i.empty(t.desiredHeight()),n=new o("Toolbox₂",r.top+r.desiredHeight(),l.BottomToolboxGroups,!1);return new m(e,r,t,n,c.EMPTY)}});function m(e,t,r,n,i){this.displayedCircuit=t,this.displayedToolboxTop=r,this.displayedToolboxBottom=n.withCustomGatesInserted(t.circuitDefinition.customGateSet),this.hand=i,this.drawArea=new d(0,0,0,0),this.updateArea(e)}return{get DisplayedInspector(){return t}}}),$traceurRuntime.registerModule("src/ui/DisplayedToolbox.js",[],function(){"use strict";var h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/CachablePainting.js","src/ui/DisplayedToolbox.js")).CachablePainting,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitStats.js","src/ui/DisplayedToolbox.js")).CircuitStats,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/DisplayedToolbox.js")).Config,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/ui/DisplayedToolbox.js")).GateDrawParams,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/ui/DisplayedToolbox.js")).GatePainting,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/Hand.js","src/ui/DisplayedToolbox.js")).Hand,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_MysteryGate.js","src/ui/DisplayedToolbox.js")),n=e.MysteryGateSymbol,i=e.MysteryGateMaker,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/ui/DisplayedToolbox.js")).Rect,a=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/ui/DisplayedToolbox.js")).Painter,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/ui/DisplayedToolbox.js")).Point),r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/ui/DisplayedToolbox.js")).seq,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/WidgetPainter.js","src/ui/DisplayedToolbox.js")).WidgetPainter,t=$traceurRuntime.createClass(f,{withCustomGatesInserted:function(e){for(var t=$traceurRuntime.spread(this._originalGroups),r=0;r<Math.max(1,e.gates.length);r+=2*this.groupHeight){for(var n={hint:"Custom Gates",gates:[void 0,void 0,void 0,void 0,void 0,void 0]},i=0;i<2*this.groupHeight&&r+i<e.gates.length;i++)n.gates[i]=e.gates[r+i];t.push(n)}return new f(this.name,this.top,t,this.labelsOnTop,this._originalGroups,this._standardApperance)},gateDrawRect:function(e,t){var r=t%2,n=Math.floor(t/2),i=o.TOOLBOX_MARGIN_X+r*o.TOOLBOX_GATE_SPAN+e*o.TOOLBOX_GROUP_SPAN,a=this.top+(this.labelsOnTop?o.TOOLBOX_MARGIN_Y:3)+n*o.TOOLBOX_GATE_SPAN;return new d(Math.round(i-.5)+.5,Math.round(a-.5)+.5,2*o.GATE_RADIUS,2*o.GATE_RADIUS)},groupLabelRect:function(e){if(this.labelsOnTop){var t=this.gateDrawRect(e,0),r=new a(t.x+o.TOOLBOX_GATE_SPAN-o.TOOLBOX_GATE_SPACING/2,t.y-18);return new d(r.x-o.TOOLBOX_GATE_SPAN,r.y,2*o.TOOLBOX_GATE_SPAN,20)}var n=this.gateDrawRect(e,2*this.groupHeight-2),i=new a(n.x+o.TOOLBOX_GATE_SPAN-o.TOOLBOX_GATE_SPACING/2,n.bottom());return new d(i.x-o.TOOLBOX_GATE_SPAN,i.y+2,2*o.TOOLBOX_GATE_SPAN,20)},findGateAt:function(e){if(void 0!==e)for(var t=0;t<this.toolboxGroups.length;t++)for(var r=this.toolboxGroups[t],n=0;n<r.gates.length;n++){var i=r.gates[n],a=this.gateDrawRect(t,n);if(void 0!==i&&a.containsPoint(e))return{groupIndex:t,gateIndex:n,gate:i,rect:a}}},isEqualTo:function(e){return e instanceof f&&this.name===e.name&&this.top===e.top&&this.toolboxGroups===e.toolboxGroups&&this.labelsOnTop===e.labelsOnTop},withTop:function(e){return new f(this.name,e,this.toolboxGroups,this.labelsOnTop,this._originalGroups,this._standardApperance)},curArea:function(e){return new d(0,this.top,e,this.desiredHeight())},paint:function(e,t,r){e.fillRect(this.curArea(e.canvas.width),o.BACKGROUND_COLOR_TOOLBOX),this._standardApperance.paint(0,this.top,e),this._paintDeviations(e,t,r)},_paintStandardContents:function(e){for(var t=0;t<this.toolboxGroups.length;t++)this._paintGatesInGroup(e,c.EMPTY,t);var r=this.curArea(o.TOOLBOX_MARGIN_X),n=r.center(),i=n.x,a=n.y;e.ctx.save(),e.ctx.translate(i,a),e.ctx.rotate(-Math.PI/2),e.printLine(this.name,new d(-r.h/2,-r.w/2,r.h,r.w),.5,"black",24),e.ctx.restore()},_paintDeviations:function(e,t,r){for(var n=0;n<this.toolboxGroups.length;n++){n>=this._originalGroups.length&&this._paintGatesInGroup(e,r,n);for(var i=this.toolboxGroups[n],a=0;a<i.gates.length;a++)void 0!==i.gates[a]&&e.noteTouchBlocker({rect:this.gateDrawRect(n,a),cursor:"pointer"})}this._paintFocus(e,t,r)},_paintGatesInGroup:function(e,t,r){var n=this.toolboxGroups[r],i=this.groupLabelRect(r);e.print(n.hint,i.x+i.w/2,i.y+i.h/2,"center","middle","black","16px sans-serif",i.w,i.h);for(var a=0;a<n.gates.length;a++){var o,u=n.gates[a];void 0!==u&&(o=this.gateDrawRect(r,a),f._paintGate(e,t,u,o,!1,s.EMPTY))}},_paintFocus:function(e,t,r){var n,i,a,o,u,s,l=this.findGateAt(r.pos);void 0===l||void 0!==r.heldGate&&l.gate.symbol!==r.heldGate.symbol||(f._paintGate(e,r,l.gate,l.rect,!0,t),e.ctx.save(),e.ctx.globalAlpha=0,e.ctx.translate(-1e4,-1e4),i=(n=m.paintGateTooltip(e,new d(0,0,500,300),l.gate,t.time,!0)).maxW,a=n.maxH,o=500<=i||300<=a,e.ctx.restore(),u=l.rect.right()+1,s=new d(u,l.rect.center().y,i,a).snapInside(e.paintableArea().skipRight(10).skipBottom(20)),e.defer(function(){return m.paintGateTooltip(e,s,l.gate,t.time,o)}))},desiredWidth:function(){return this.gateDrawRect(this.toolboxGroups.length-1,5).right()+5},desiredHeight:function(){return(1+this.groupHeight)*(2*o.GATE_RADIUS+2)-o.GATE_RADIUS},tryGrab:function(e){var t=this;if(void 0===e.pos||e.isBusy())return e;var r=this.findGateAt(e.pos);return void 0===r?e:(r.gate.symbol===n&&setTimeout(function(){t.toolboxGroups[r.groupIndex].gates[r.gateIndex]=i()},.1),e.withHeldGate(r.gate,new a(o.GATE_RADIUS,o.GATE_RADIUS)))},stableDuration:function(e){var t=this;return r(e.hoverPoints()).map(function(e){return t.findGateAt(e)}).filter(function(e){return void 0!==e}).map(function(e){return e.gate.stableDuration()}).min(1/0)}},{_paintGate:function(e,t,r,n,i,a){var o=r.customDrawer||l.DEFAULT_DRAWER;e.startIgnoringIncomingTouchBlockers(),o(new u(e,t,!0,i,!1,!1,n,r,a,void 0,[],void 0)),e.stopIgnoringIncomingTouchBlockers()}});function f(e,t,r,n){var i=arguments[4],a=arguments[5],o=this;this.name=e,this.top=t,this.toolboxGroups=r,this.labelsOnTop=n,this._originalGroups=i||this.toolboxGroups,this._standardApperance=a||new h(function(){return{width:o.desiredWidth(),height:o.desiredHeight()}},function(e){e.ctx.save(),e.ctx.translate(0,-o.top),o._paintStandardContents(e),e.ctx.restore()});var u=!0,s=!(this.groupHeight=1),l=void 0;try{for(var c,d=r[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var m=c.value,f=Math.ceil(m.gates.length/2);this.groupHeight=Math.max(this.groupHeight,f)}}catch(e){s=!0,l=e}finally{try{u||null==d.return||d.return()}finally{if(s)throw l}}}return{get DisplayedToolbox(){return t}}}),$traceurRuntime.registerModule("src/ui/exports.js",[],function(){"use strict";var x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/exports.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/ui/exports.js")).ObservableValue,S=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/exports.js")).Serializer,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/Clipboard.js","src/ui/exports.js")).selectAndCopyToClipboard),T=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/exports.js")).fromJsonText_CircuitDefinition,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/SaveFile.js","src/ui/exports.js")).saveFile,C=new e(!1),E=C.observable().whenDifferent();function t(e,t,r){var n,i,a;n=document.getElementById("export-button"),i=document.getElementById("export-overlay"),a=document.getElementById("export-div"),n.addEventListener("click",function(){return C.set(!0)}),r.subscribe(function(e){n.disabled=e}),i.addEventListener("click",function(){return C.set(!1)}),document.addEventListener("keydown",function(e){27===e.keyCode&&C.set(!1)}),E.subscribe(function(e){a.style.display=e?"block":"none",e&&document.getElementById("export-link-copy-button").focus()});function o(e,t,r){var n=arguments[3];return e.addEventListener("click",function(){void 0!==n&&(t.innerText=n());try{S(t),r.innerText="Done!"}catch(e){r.innerText="It didn't work...",console.warn("Clipboard copy failed.",e)}e.disabled=!0,setTimeout(function(){r.innerText="",e.disabled=!1},1e3)})}function u(e){var t,l={X:"x",Y:"y",Z:"z",H:"h","Z^½":"s","Z^¼":"t","Z^-½":"sdg","Z^-¼":"tdg",Swap:"swap","•":"c",Rxft:"rx",Ryft:"ry",Rzft:"rz","X^½":"sx","X^-½":"sxdg",Measure:"measure"},i='OPENQASM 2.0;include "qelib1.inc";';try{var r=JSON.parse(e).cols;if(0===r.length)return"Empty circuit";var n=(t=Math).max.apply(t,$traceurRuntime.spread(r.map(function(e){return e.length}))),a=r.filter(function(e){return e.includes("Measure")}).length;i+="qreg q["+n+"];",0<a&&(i+="creg c["+a+"];");var o=0;r.forEach(function(n){if(n.includes("Rxft")||n.includes("Ryft")||n.includes("Rzft"))throw new Error("R*ft gates not supported, please provide a time-independent parameter");n.includes("•")?i+=function(n){var i="",a={1:["H","X","Y","Z","Rxft","Ryft","Rzft","X^½","Swap"],2:["X"]},o=n.filter(function(e){return"•"==e}).length;if(2<o)throw new Error("Too many controls (max 2)");if(0===n.filter(function(e){return"•"!==e&&1!==e}).length)throw new Error("Invalid circuit - controlled operation not specified!");var u="c".repeat(o),s=" q["+n.indexOf("•")+"],"+(2==o?"q["+n.lastIndexOf("•")+"],":"");return n.forEach(function(e,t){if("•"!=e&&1!=e)if("string"==typeof e){if(!a[o].includes(e))throw new Error("Unsupported control gate ("+(u+e)+")");var r;if("Swap"==e){if(2!=n.filter(function(e){return"Swap"==e}).length)throw new Error("Wrong number of swaps!");r="q["+n.indexOf("Swap")+"],q["+n.lastIndexOf("Swap")+"];",n[n.lastIndexOf("Swap")]=n[n.indexOf("Swap")]=1}else r="q["+t+"];";i=i+u+l[e]+s+r}else{if(!a[o].includes(e.id))throw new Error("Unsupported control gate ("+(u+e.id)+")");i=i+u+(l[e.id]+"("+e.arg)+")"+s+"q["+t+"];"}}),i}(n):n.forEach(function(e,t){if(1!=e)if("string"==typeof e){if(!Object.keys(l).includes(e))throw new Error("Unsupported gate!");if("Measure"==e)return i+="measure q["+t+"]->c["+o+"];",void(o+=1);if("Swap"==e){if(2!=n.filter(function(e){return"Swap"==e}).length)throw new Error("Wrong number of swaps!");var r=" q["+n.indexOf("Swap")+"],q["+n.lastIndexOf("Swap")+"];";return n[n.lastIndexOf("Swap")]=n[n.indexOf("Swap")]=1,void(i+=l[e]+r)}i+=l[e]+" q["+t+"];"}else if("object"==(void 0===e?"undefined":$traceurRuntime.typeof(e))){if(!Object.keys(l).includes(e.id))throw new Error("Unsupported gate!");i+=l[e.id]+"("+e.arg+") q["+t+"];"}})})}catch(e){return console.error(e),"Invalid Circuit JSON."}return i}var s,l,c,d,m,f,h,g,p,v,y,b,R,w,M;function _(e){try{var t=T(e);if(!t.isEmpty())return"Quirk with Circuit - "+t.readableHash()+".html"}catch(e){}return"Quirk.html"}s=document.getElementById("export-escaped-anchor"),l=document.getElementById("export-link-copy-button"),c=document.getElementById("export-link-copy-result"),o(l,s,c),e.latestActiveCommit().subscribe(function(e){var t="#"+x.URL_CIRCUIT_PARAM_KEY+"="+encodeURIComponent(e);s.href=t,s.innerText=document.location.href.split("#")[0]+t}),d=document.getElementById("export-circuit-json-pre"),m=document.getElementById("export-json-copy-button"),f=document.getElementById("export-json-copy-result"),o(m,d,f),e.latestActiveCommit().subscribe(function(t){try{var e=JSON.parse(t);d.innerText=JSON.stringify(e,null,"  ")}catch(e){d.innerText=t}}),h=document.getElementById("export-qasm-pre"),g=document.getElementById("export-qasm-copy-button"),p=document.getElementById("export-qasm-copy-result"),o(g,h,p),e.latestActiveCommit().subscribe(function(t){try{var e=u(t);h.innerText=e}catch(e){console.error("ERROR"),h.innerText=t}}),v=document.getElementById("export-amplitudes-pre"),y=document.getElementById("export-amplitudes-button"),b=document.getElementById("export-amplitudes-result"),R=document.getElementById("export-amplitudes-use-amps"),r.subscribe(function(e){v.innerText="[not generated yet]"}),o(y,v,b,function(){return JSON.stringify(t.get().toReadableJson(!R.checked),null," ").replace(/{\s*"r": /g,'{"r":').replace(/,\s*"i":\s*([-e\d\.]+)\s*}/g,',"i":$1}')}),M=document.getElementById("download-offline-copy-button"),e.latestActiveCommit().subscribe(function(e){M.innerText='Download "'+_(e)+'"',w=e}),M.addEventListener("click",function(){M.disabled=!0,setTimeout(function(){M.disabled=!1},1e3);var e,t=document.QUIRK_QUINE_ALL_HTML_ORIGINAL,r="//DEFAULT_CIRCUIT_START\n",n=t.indexOf(r),i=t.indexOf("//DEFAULT_CIRCUIT_END\n",n),a=t.substring(0,n)+r+"document.DEFAULT_CIRCUIT = "+JSON.stringify(w)+";\n"+t.substring(i),o="\x3c!-- Start Analytics --\x3e\n",u=a.indexOf(o);-1===u||-1!==(e=a.indexOf("\x3c!-- End Analytics --\x3e\n",u))&&(a=a.substring(0,u)+o+a.substring(e)),A(_(w),a)})}return{get initExports(){return t},get obsExportsIsShowing(){return E}}}),$traceurRuntime.registerModule("src/ui/forge.js",[],function(){"use strict";var y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Axis.js","src/ui/forge.js")).Axis,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/forge.js")).CircuitDefinition,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitComputeUtil.js","src/ui/forge.js")).setGateBuilderEffectToCircuit,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/ui/forge.js")).Complex,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/forge.js")).Config,R=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/ui/forge.js")).DetailedError,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedCircuit.js","src/ui/forge.js")).drawCircuitTooltip,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/ui/forge.js")).Format,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/ui/forge.js")),p=(e.Gate,e.GateBuilder),v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/ui/forge.js")).GateColumn,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/sim.js","src/ui/forge.js")).getCircuitCycleTime,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/ui/forge.js")).MathPainter,M=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/ui/forge.js")).Matrix,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/ui/forge.js")),_=r.Observable,x=r.ObservableValue,S=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/ui/forge.js")).Painter,T=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/ui/forge.js")).Point,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/ui/forge.js")).Rect,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/forge.js")),C=n.fromJsonText_CircuitDefinition,a=n.Serializer,E=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/ui/forge.js")).seq,I=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/EventUtil.js","src/ui/forge.js")).textEditObservable,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/ui/forge.js")).Util,o=new x(!1),j=o.observable().whenDifferent();function u(n,e){var d,t,r,i,m=j.filter(function(e){return!0===e});function u(t,e,r){r.disabled=!0;var n=new S(t);n.clear();var i=Math.min((t.width-5)/2,t.height),a=new A(0,0,i,i),o=new A(i+5,0,i,i);try{var u=e();c.paintMatrix(n,u,a,l.OPERATION_FORE_COLOR,"black",void 0,l.OPERATION_BACK_COLOR,void 0,"transparent"),u.isUnitary(.009)?2!==u.width()?n.printParagraph("(Not a 1-qubit rotation)",o,new T(.5,.5),"#666",20):c.paintBlochSphereRotation(n,u,o,l.OPERATION_BACK_COLOR,l.OPERATION_FORE_COLOR):n.printParagraph("NOT UNITARY",o,new T(.5,.5),"red",24);var s=(a.right()+o.x)/2;n.strokeLine(new T(s,0),new T(s,t.height),"black",2),u.hasNaN()||(r.disabled=!1)}catch(e){n.printParagraph(e+"",new A(0,0,t.width,t.height),new T(.5,.5),"red",24)}}function f(e,t){var r=t||C(d);n.commit(JSON.stringify(a.toJson(r.withCustomGate(e)),null,0)),o.set(!1)}n.latestActiveCommit().subscribe(function(e){d=e}),t=document.getElementById("gate-forge-button"),r=document.getElementById("gate-forge-overlay"),i=document.getElementById("gate-forge-div"),t.addEventListener("click",function(){return o.set(!0)}),r.addEventListener("click",function(){return o.set(!1)}),e.subscribe(function(e){t.disabled=e}),document.addEventListener("keydown",function(e){27===e.keyCode&&o.set(!1)}),j.subscribe(function(e){i.style.display=e?"block":"none",e&&document.getElementById("gate-forge-rotation-axis").focus()}),function(){var e=document.getElementById("gate-forge-rotation-canvas"),t=document.getElementById("gate-forge-rotation-button"),r=document.getElementById("gate-forge-rotation-axis"),n=document.getElementById("gate-forge-rotation-angle"),i=document.getElementById("gate-forge-rotation-phase"),a=document.getElementById("gate-forge-rotation-name");function o(){return s($(n),$(i),$(r))}m.subscribe(function(){a.value=""});_.of.apply(_,$traceurRuntime.spread([m],[i,r,n].map(I))).flatten().throttleLatest(100).subscribe(function(){return u(e,o,t)}),t.addEventListener("click",function(){var e;try{e=o()}catch(e){return void console.warn(e)}f((new p).setSerializedId("~"+Math.floor(Math.random()*(1<<20)).toString(32)).setSymbol(a.value).setTitle("Custom Rotation Gate").setKnownEffectToMatrix(e).gate)})}(),function(){var e=document.getElementById("gate-forge-matrix-canvas"),t=document.getElementById("gate-forge-matrix"),r=document.getElementById("gate-forge-matrix-fix"),n=document.getElementById("gate-forge-matrix-button"),i=document.getElementById("gate-forge-matrix-name");function a(){return k($(t),r.checked)}m.subscribe(function(){i.value=""});_.of(m,I(t),_.elementEvent(r,"change")).flatten().throttleLatest(100).subscribe(function(){return u(e,a,n)}),n.addEventListener("click",function(){var e;try{e=a()}catch(e){return void console.warn(e)}var t=i.value.trim(),r=Math.round(Math.log2(e.height()));f((new p).setSerializedId("~"+Math.floor(Math.random()*(1<<20)).toString(32)).setSymbol(t).setTitle("Custom Matrix Gate").setHeight(r).setWidth(""===t?r:1).setKnownEffectToMatrix(e).gate)})}(),function(){var n=document.getElementById("gate-forge-circuit-canvas"),t=document.getElementById("gate-forge-circuit-cols"),r=document.getElementById("gate-forge-circuit-rows"),i=document.getElementById("gate-forge-circuit-inputs"),a=document.getElementById("gate-forge-circuit-weight"),o=document.getElementById("gate-forge-circuit-button"),u=document.getElementById("gate-forge-circuit-name");function s(){var e=C(d);return{gate:D(e,$(t),$(r),u.value.trim()),circuit:e}}m.subscribe(function(){u.value=""});function l(e,t){return g(e,t.knownCircuitNested,new A(0,0,n.width,n.height),!0,w())}var c=new x(void 0);c.observable().zipLatest(j,function(e,t){return t?e:void 0}).map(function(t){return void 0===t||t.gate.stableDuration()===1/0?_.of():_.requestAnimationTicker().map(function(e){return t})}).flattenLatest().subscribe(function(e){var t=new S(n);t.clear(),l(t,e.gate)});_.of(m,I(t),I(r)).flatten().throttleLatest(100).subscribe(function(){o.disabled=!0;var t=new S(n);t.clear();try{var e=s().gate,r=e.getUnmetContextKeys();i.innerText=0===r.size?"(none)":$traceurRuntime.spread(r).map(function(e){return e.replace("Input Range ","").replace("Input NO_DEFAULT Range ","")}).join(", "),a.innerText=""+e.knownCircuit.gateWeight(),l(t,e),o.disabled=!1,c.set({gate:e})}catch(e){c.set(void 0),i.innerText="(err)",a.innerText="(err)",t.printParagraph(e+"",new A(0,0,n.width,n.height),new T(.5,.5),"red",24)}}),o.addEventListener("click",function(){try{var e=s();f(e.gate,e.circuit)}catch(e){console.warn(e)}})}()}function $(e){return""===e.value?e.placeholder:e.value}function P(e){var t=b.parse(e);if(0!==t.imag||isNaN(t.imag))throw new Error("You just had to make it complicated, didn't you?");return t.real*Math.PI/180}function G(e){return M.parse(e.toString(new t(!0,1e-7,7,",")))}function s(e,t,r){var n,i,a=P(e),o=P(t),u=y.parse(r),s=u.x,l=u.y,c=u.z,d=Math.sqrt(s*s+l*l+c*c);s/=d,l/=d,c/=d;var m=(i=(n=[M.identity(2),M.PAULI_X,M.PAULI_Y,M.PAULI_Z][Symbol.iterator]()).next()).done?void 0:i.value,f=(i=n.next()).done?void 0:i.value,h=(i=n.next()).done?void 0:i.value,g=(i=n.next()).done?void 0:i.value,p=f.times(s).plus(h.times(l)).plus(g.times(c)),v=m.times(Math.cos(a/2)).plus(p.times(b.I.neg()).times(Math.sin(a/2))).times(b.polar(1,o));if(v.hasNaN())throw new R("NaN",{x:s,y:l,z:c,result:v});return G(v)}function k(e,t){var r=function(e){if(e.match(/[\{}\[\]]/))return M.parse(e.split(/[\{\[]/).join("{").split(/[}\]]/).join("}"));(e=(e=e.split(/,?\s*\n\s*(?!$)/).join(",")).trim()).endsWith(",")&&(e=e.substring(0,e.length-1));var t=e.split(",").map(function(e){return""===e?0:b.parse(e)});1===t.length&&t.push(0,0,t[0]);var r=Math.max(4,1<<2*Math.max(1,i.floorLg2(Math.sqrt(t.length))));if(r<t.length&&(r<<=2),256<r)throw Error("Max custom matrix operation size is 4 qubits.");return M.square.apply(M,$traceurRuntime.spread(t,new Array(r-t.length).fill(0)))}(e);if(r.width()!==r.height()||r.width()<2||16<r.width()||!i.isPowerOf2(r.width()))throw Error("Matrix must be 2x2, 4x4, 8x8, or 16x16.");return t&&!r.hasNaN()&&(r=G(r=r.closestUnitary(1e-4))),r}function N(e,t){var r=e.split(":").map(function(e){return e.trim()});if(2<r.length)throw new Error("Too many colons.");var n=[void 0,"","∞"],i=parseInt(r[0]||"1"),a=-1!==n.indexOf(r[1])?1/0:parseInt(r[1]);if(isNaN(i))throw new Error("Not a number: "+r[0]);if(isNaN(a))throw new Error("Not a number: "+r[1]);var o=Math.min(t,Math.max(0,i-1));return{start:o,end:Math.min(t,Math.max(o,a))}}function D(e,t,r,n){var i=N(t,e.columns.length),a=N(r,e.numWires);if(a.end===a.start)throw new Error("Empty wire range.");var o,u,s,l=e.columns.slice(i.start,i.end).map(function(e){return new v(e.gates.slice(a.start,a.end))}),c=new f(a.end-a.start,l);if(u=(o=c).columns.length,s=o.numWires,0===(c=(c=o.withColumns(E(o.columns).mapWithIndex(function(e,r){return new v(E(e.gates).mapWithIndex(function(e,t){return void 0===e||r+e.width>u||t+e.height>s?void 0:e}).toArray())}).toArray())).withUncoveredColumnsRemoved()).columns.length)throw new Error("No gates in included range.");var d=n,m="~"+Math.floor(Math.random()*(1<<20)).toString(32);return h(new p,c).setSerializedId(m).setSymbol(d).setTitle(m).setBlurb("A custom gate.").gate}return{get initForge(){return u},get obsForgeIsShowing(){return j},get parseUserRotation(){return s},get parseUserMatrix(){return k},get parseUserGateFromCircuitRange(){return D}}}),$traceurRuntime.registerModule("src/ui/Hand.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/ui/Hand.js")).describe,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/ui/Hand.js")).DetailedError,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/ui/Hand.js")).Gate,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/ui/Hand.js")).GateColumn,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/ui/Hand.js")).Point,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/ui/Hand.js")).Util,r=$traceurRuntime.createClass(n,{isHoldingSomething:function(){return void 0!==this.heldGate||void 0!==this.heldColumn||void 0!==this.heldRow},paintCursor:function(e){void 0!==this.heldGate||void 0!==this.heldColumn?e.setDesiredCursor("move"):void 0!==this.resizingGateSlot&&e.setDesiredCursor("ns-resize")},isBusy:function(){return void 0!==this.heldGate||void 0!==this.heldColumn||void 0!==this.resizingGateSlot||void 0!==this.heldRow},hoverPoints:function(){return void 0===this.pos||this.isBusy()?[]:[this.pos]},isEqualTo:function(e){return this===e||e instanceof n&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.pos,e.pos)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.holdOffset,e.holdOffset)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.heldGate,e.heldGate)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.heldColumn,e.heldColumn)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.heldRow,e.heldRow)&&t.CUSTOM_IS_EQUAL_TO_EQUALITY(this.resizingGateSlot,e.resizingGateSlot)},toString:function(){return"Hand("+e({pos:this.pos,heldGate:this.heldGate,holdOffset:this.holdOffset,heldColumn:this.heldColumn,heldRow:this.heldRow,resizingGateSlot:this.resizingGateSlot})},withPos:function(e){return new n(e,this.heldGate,this.holdOffset,this.heldColumn,this.heldRow,this.resizingGateSlot)},withDrop:function(){return new n(this.pos,void 0,void 0,void 0,void 0,void 0)},withHeldGate:function(e,t){return new n(this.pos,e,t,void 0,void 0,void 0)},withHeldGateColumn:function(e,t){return new n(this.pos,void 0,t,e,void 0,void 0)},withHeldRow:function(e,t){return new n(this.pos,void 0,t,void 0,e,void 0)},withResizeSlot:function(e,t){return new n(this.pos,void 0,t,void 0,void 0,e)},stableDuration:function(){return void 0!==this.heldGate?this.heldGate.stableDuration():void 0!==this.heldColumn?this.heldColumn.stableDuration():void 0!==this.heldRow?new l(this.heldRow.gates).stableDuration():1/0}},{});function n(e,t,r,n,i,a){var o={pos:e,heldGate:t,holdOffset:r,heldColumn:n,heldRow:i,resizingGateSlot:a};if(void 0!==e&&!(e instanceof c))throw new u("Bad pos",o);if(void 0!==t&&!(t instanceof s))throw new u("Bad heldGate",o);if(void 0!==r&&!(r instanceof c))throw new u("Bad holdOffset",o);if(void 0!==a&&!(a instanceof c))throw new u("Bad resizingGateSlot",o);if(void 0!==n&&!(n instanceof l))throw new u("Bad heldColumn",o);if(void 0!==i&&!Array.isArray(i.gates))throw new u("Bad heldRow",o);if(void 0!==t&&void 0!==this.resizingGateSlot)throw new u("Holding AND resizing",o);this.pos=e,this.heldGate=t,this.holdOffset=r,this.heldColumn=n,this.heldRow=i,this.resizingGateSlot=a}return r.EMPTY=new r(void 0,void 0,void 0,void 0,void 0,void 0),{get Hand(){return r}}}),$traceurRuntime.registerModule("src/ui/menu.js",[],function(){"use strict";function e(){return _.set(!1)}var _=new($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/ui/menu.js")).ObservableValue)(!0),x=_.observable().whenDifferent(),S={cols:[["X","X","X","X","X"],["H","H","H","H","H"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"]],gates:[{id:"~vn6c",name:"Oracle",circuit:{cols:[["Z","•","◦","•","•"]]}}]},T={cols:[[1,"H"],[1,"•",1,1,"X"],["…","…",1,1,"…"],["…","…",1,1,"…"],["~87lj"],["Bloch"],["•","X"],["H"],["Measure","Measure"],[1,"•",1,1,"X"],["•",1,1,1,"Z"],[1,1,1,1,"Bloch"],[1,1,1,1,"~f7c0"]],gates:[{id:"~87lj",name:"message",circuit:{cols:[["e^-iYt"],["X^t"]]}},{id:"~f7c0",name:"received",matrix:"{{1,0},{0,1}}"}]},A={cols:[[1,"H"],[1,"•",1,1,"X"],[1,"~slits","QFT7"],[1,1,"Measure","Measure","Measure","Measure","Measure","Measure","Measure"],["…","…","Chance7"],["…","…"],["…","…"],["…","…"],["H"],["Measure"],["~choice"],["•","X^½"],[1,"Measure"],[1,"~result",1,1,1,"~flat"],["◦","◦","Chance7"],["◦","•","Chance7"],[1,1,1,1,1,"~waves"],["•","◦","Chance7"],["•","•","Chance7"]],gates:[{id:"~choice",name:"choice",matrix:"{{1,0},{0,1}}"},{id:"~result",name:"result",matrix:"{{1,0},{0,1}}"},{id:"~flat",name:"flat",matrix:"{{1,0},{0,1}}"},{id:"~waves",name:"waves",matrix:"{{1,0},{0,1}}"},{id:"~slits",name:"slits",matrix:"{{1,0},{0,1}}"}]},C={cols:[["H"],["◦",1,1,1,"X"],["X^-¼"],["…","…","…","…","…"],["~da85","~5s2n",1,"~5s2n","~ahov"],[1,"H",1,"H"],[1,"Measure",1,"Measure"],["X^½","•"],[1,1,1,"•","X^½"],["Measure",1,1,1,"Measure"],["…","…","…","…","…"],[1,"•","X","•"],["•",1,"X"],[1,1,"X",1,"•"],[1,1,"Chance"],[1,1,"~q6e"]],gates:[{id:"~da85",name:"Alice",matrix:"{{1,0},{0,1}}"},{id:"~ahov",name:"Bob",matrix:"{{1,0},{0,1}}"},{id:"~5s2n",name:"Referee",matrix:"{{1,0},{0,1}}"},{id:"~q6e",name:"Win?",matrix:"{{1,0},{0,1}}"}]},E={cols:[["Counting5",1,1,1,1,1,1,1,"X"],["Chance5",1,1,1,1,"Chance5"],["X","X","X","X","•","X","X","X","X","X"],[1,1,1,1,"•","X"],["Swap",1,1,1,"Swap","•"],[1,1,1,1,"•",1,"X"],[1,"Swap",1,1,"Swap",1,"•"],[1,1,1,1,"•",1,1,"X"],[1,1,"Swap",1,"Swap",1,1,"•"],[1,1,1,1,"•",1,1,1,"X"],[1,1,1,"Swap","Swap",1,1,1,"•"],[1,1,1,1,"•",1,1,1,1,"X"],[1,1,1,"Swap","Swap",1,1,1,"•"],[1,1,1,"•",1,1,1,1,"X"],[1,1,"Swap",1,"Swap",1,1,"•"],[1,1,"•",1,1,1,1,"X"],[1,"Swap",1,1,"Swap",1,"•"],[1,"•",1,1,1,1,"X"],["Swap",1,1,1,"Swap","•"],["•",1,1,1,1,"X"],["X","X","X","X","•","X","X","X","X","X"],["Chance5",1,1,1,1,"Chance5"]]},I={cols:[["Counting8"],["Chance8"],["…","…","…","…","…","…","…","…"],["Swap",1,1,1,1,1,1,"Swap"],[1,"Swap",1,1,1,1,"Swap"],[1,1,"Swap",1,1,"Swap"],[1,1,1,"Swap","Swap"],["H"],["Z^½","•"],[1,"H"],["Z^¼","Z^½","•"],[1,1,"H"],["Z^⅛","Z^¼","Z^½","•"],[1,1,1,"H"],["Z^⅟₁₆","Z^⅛","Z^¼","Z^½","•"],[1,1,1,1,"H"],["Z^⅟₃₂","Z^⅟₁₆","Z^⅛","Z^¼","Z^½","•"],[1,1,1,1,1,"H"],["Z^⅟₆₄","Z^⅟₃₂","Z^⅟₁₆","Z^⅛","Z^¼","Z^½","•"],[1,1,1,1,1,1,"H"],["Z^⅟₁₂₈","Z^⅟₆₄","Z^⅟₃₂","Z^⅟₁₆","Z^⅛","Z^¼","Z^½","•"],[1,1,1,1,1,1,1,"H"]]},j={cols:[[1,1,"H"],[1,1,"•",1,1,1,"X"],["…","…","…","…","…","…","…"],["Counting2"],["Measure","Measure"],["~msg"],["Chance","Chance"],["~enc"],[1,"•","X"],["•",1,"Z"],[1,1,1,"~send"],[1,1,"Swap",1,1,"Swap"],[1,1,1,1,1,"~dec"],[1,1,1,1,1,"•","X"],[1,1,1,1,1,"H"],[1,1,1,1,1,"Measure","Measure"],[1,1,1,1,1,"~msg"],[1,1,1,1,1,"Chance","Chance"]],gates:[{id:"~msg",name:"message",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~enc",name:"encode",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~send",name:"send",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~dec",name:"decode",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"}]},$={cols:[["~tpqg",1,"~r2ku"],["…","…","…","…"],["H"],[1,1,"H"],["•","X"],[1,1,"•","X"],[1,"Swap",1,"Swap"],["•","X"],[1,1,"•","X"],["X^½","◦"],[1,1,"X^½","◦"],[1,"X^½"],[1,1,1,"X^½"],["Measure","Measure","Measure","Measure"],[1,"~57au"],["•",1,"Chance"],[1,"•",1,"Chance"],["◦",1,"Chance"],[1,"◦",1,"Chance"]],gates:[{id:"~tpqg",name:"Alice^1",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~r2ku",name:"Alice^2",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~57au",name:"disagree",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"}]},P={cols:[[1,1,1,1,1,1,1,1,1,1,"~input",1,1,1,"~guess"],[1,1,1,1,1,1,1,1,1,1,{id:"setR",arg:55},1,1,1,{id:"setB",arg:26}],[],["H","H","H","H","H","H","H","H","H","H","X"],["inputA10",1,1,1,1,1,1,1,1,1,"*BToAmodR6"],["QFT†10"],[1,1,1,1,"~out"],["Chance10"]],gates:[{id:"~guess",name:"guess:",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~input",name:"input:",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"},{id:"~out",name:"out:",matrix:"{{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}}"}]},G={cols:[["H","H","H","H","H"],[1,"Z","Z","Z",1,"⊖"],[1,"Z","Z",1,"Z",1,"⊖"],[1,"Z",1,"Z","Z",1,1,"⊖"],[1,1,"Z","Z","Z",1,1,1,"⊖"],["Z","Z","Z","Z","Z",1,1,1,1,"⊖"],["Z",1,1,"Z","Z",1,1,1,1,1,"⊖"],["Z",1,"Z",1,"Z",1,1,1,1,1,1,"⊖"],["Z","Z",1,1,"Z",1,1,1,1,1,1,1,"⊖"],["Z",1,"Z","Z",1,1,1,1,1,1,1,1,1,"⊖"],["Z","Z",1,"Z",1,1,1,1,1,1,1,1,1,1,"⊖"],["Z","Z","Z",1,1,1,1,1,1,1,1,1,1,1,1,"⊖"],[1,"Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼","Z^¼"],[1,"H","H","H","H","H","H","H","H","H","H","H","H","H","H","H"],[1,"Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure","Measure"],[1,"X","X","X",1,"•"],[1,"X","X",1,"X",1,"•"],[1,"X",1,"X","X",1,1,"•"],[1,1,"X","X","X",1,1,1,"•"],["Z","X","X","X","X",1,1,1,1,"•"],["Z",1,1,"X","X",1,1,1,1,1,"•"],["Z",1,"X",1,"X",1,1,1,1,1,1,"•"],["Z","X",1,1,"X",1,1,1,1,1,1,1,"•"],["Z",1,"X","X",1,1,1,1,1,1,1,1,1,"•"],["Z","X",1,"X",1,1,1,1,1,1,1,1,1,1,"•"],["Z","X","X",1,1,1,1,1,1,1,1,1,1,1,1,"•"],["X","Chance4"],["Amps1","|0⟩⟨0|","|0⟩⟨0|","|0⟩⟨0|","|0⟩⟨0|"]]};function t(i,e){var a,o,t,r,n,u;t=document.getElementById("menu-button"),r=document.getElementById("close-menu-button"),n=document.getElementById("menu-overlay"),u=document.getElementById("menu-div"),t.addEventListener("click",function(){return _.set(!0)}),e.subscribe(function(e){t.disabled=e}),n.addEventListener("click",function(){return _.set(!1)}),r.addEventListener("click",function(){return _.set(!1)}),document.addEventListener("keydown",function(e){27===e.keyCode&&_.set(!1)}),x.subscribe(function(e){u.style.display=e?"block":"none",e&&document.getElementById("export-link-copy-button").focus()});var s=document.getElementById("example-anchor-grover"),l=document.getElementById("example-anchor-teleport"),c=document.getElementById("example-anchor-delayed-eraser"),d=document.getElementById("example-addition"),m=document.getElementById("example-superdense-coding"),f=document.getElementById("example-symmetry-break"),h=document.getElementById("example-chsh-test"),g=document.getElementById("example-qft"),p=document.getElementById("example-anchor-shor"),v=document.getElementById("example-anchor-distill"),y=!0,b=!1,R=void 0;try{for(var w=void 0,M=[[s,S],[p,P],[l,T],[c,A],[d,E],[m,j],[f,$],[h,C],[g,I],[v,G]][Symbol.iterator]();!(y=(w=M.next()).done);y=!0)!function(){var e=w.value,t=(a=e[Symbol.iterator](),(o=a.next()).done?void 0:o.value),r=(o=a.next()).done?void 0:o.value,n=JSON.stringify(r);t.href="#circuit="+n,t.onclick=function(e){if(!(e.shiftKey||e.ctrlKey||e.altKey||1!==e.which))return i.commit(n),_.set(!1),!1}}()}catch(e){b=!0,R=e}finally{try{y||null==M.return||M.return()}finally{if(b)throw R}}}return{get initMenu(){return t},get obsMenuIsShowing(){return x},get closeMenu(){return e}}}),$traceurRuntime.registerModule("src/ui/sim.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/sim.js")).CircuitDefinition;var r,n,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/sim.js")).Config,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitStats.js","src/ui/sim.js")).CircuitStats,o=(r=0,n=performance.now(),function(){var e=performance.now(),t=(e-n)/i.CYCLE_DURATION_MS;return r+=t,n=e,r%=1}),u=void 0;function e(e){if(void 0!==u&&u.circuitDefinition.isEqualTo(e))return u.withTime(o());u=void 0;var t=a.fromCircuitAtTime(e,o());return e.stableDuration()===1/0&&(u=t),t}return{get simulate(){return e},get getCircuitCycleTime(){return o}}}),$traceurRuntime.registerModule("src/ui/title.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/title.js")).Config,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/title.js")).fromJsonText_CircuitDefinition;function e(e){e.latestActiveCommit().subscribe(function(e){setTimeout(function(){document.title=function(e){try{var t=n(e);if(!t.isEmpty())return"Quirk: "+t.readableHash()}catch(e){}return r.EMPTY_CIRCUIT_TITLE}(e)},0)})}return{get initTitleSync(){return e}}}),$traceurRuntime.registerModule("src/ui/undo.js",[],function(){"use strict";function e(c,e){var d=[document.getElementById("gate-forge-div"),document.getElementById("export-div")],t=document.getElementById("undo-button"),r=document.getElementById("redo-button");c.latestActiveCommit().zipLatest(e,function(e,t){return t}).subscribe(function(e){t.disabled=c.isAtBeginningOfHistory()||e,r.disabled=c.isAtEndOfHistory()||e}),t.addEventListener("click",function(){return c.undo()}),r.addEventListener("click",function(){return c.redo()}),document.addEventListener("keydown",function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=d[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if("NONE"!==o.style.display&&"none"!==o.style.display)return}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var u=90===e.keyCode&&e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey,s=90===e.keyCode&&e.ctrlKey&&e.shiftKey&&!e.altKey&&!e.metaKey,l=89===e.keyCode&&e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey;u&&(c.undo(),e.preventDefault()),(s||l)&&(c.redo(),e.preventDefault())})}return{get initUndoRedo(){return e}}}),$traceurRuntime.registerModule("src/ui/url.js",[],function(){"use strict";var s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/ui/url.js")).notifyAboutRecoveryFromUnexpectedError,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/url.js")).CircuitDefinition,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/url.js")).Config,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/HistoryPusher.js","src/ui/url.js")).HistoryPusher,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/url.js")),d=e.fromJsonText_CircuitDefinition,m=e.Serializer;function f(e){return-1===e.indexOf("%")&&-1===e.indexOf("&")||(e=encodeURIComponent(e)),"#"+c.URL_CIRCUIT_PARAM_KEY+"="+e}function r(o){function e(){try{u.currentStateIsMemorableButUnknown();var e,t=function(){var e=document.location.hash.substr(1),t=new Map;if(""!==e){var r=!0,n=!1,i=void 0;try{for(var a,o=e.split("&")[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u,s,l=a.value,c=l.indexOf("=");-1!==c&&(u=l.substring(0,c),s=decodeURIComponent(l.substring(c+1)),t.set(u,s))}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}return t}();t.has(c.URL_CIRCUIT_PARAM_KEY)||(e=document.DEFAULT_CIRCUIT||JSON.stringify(m.toJson(l.EMPTY)),t.set(c.URL_CIRCUIT_PARAM_KEY,e));var r=t.get(c.URL_CIRCUIT_PARAM_KEY);u.currentStateIsMemorableAndEqualTo(r);var n,i=d(r),a=JSON.stringify(m.toJson(i));o.clear(a),i.isEmpty()&&1===t.size?u.currentStateIsNotMemorable():(n=f(r),u.stateChange(r,n))}catch(e){s("Defaulted to an empty circuit. Failed to understand circuit from URL.",{document_location_hash:document.location.hash},e)}}var u=new t;window.addEventListener("popstate",e),e(),o.latestActiveCommit().whenDifferent().skip(1).subscribe(function(e){u.stateChange(e,f(e))})}return{get initUrlCircuitSync(){return r}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders_Base.js",[],function(){"use strict";var r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/ShaderCoders_Base.js")).WglArg,n=$traceurRuntime.createClass(function(e,t,r){this.code=e,this.libs=t,this.argsFor=r},{},{}),e=$traceurRuntime.createClass(function(e,t,r,n,i,a,o){this.inputPartGetter=e,this.outputPart=t,this.powerSizeOverhead=r,this.pixelType=n,this.dataToPixels=i,this.pixelsToData=a,this.needRearrangingToBeInVec4Format=o},{arrayPowerSizeOfTexture:function(e){return Math.max(0,e.sizePower()-this.powerSizeOverhead)}},{}),t=$traceurRuntime.createClass(function(e,t,r,n){this.bool=e,this.float=t,this.vec2=r,this.vec4=n},{},{});var i=new n("\n    ///////////// BOOL_OUTPUT_AS_FLOAT ////////////\n    bool outputFor(float k);\n\n    uniform vec2 _gen_output_size;\n    uniform float _gen_secret_half;\n\n    float len_output() {\n        return _gen_output_size.x * _gen_output_size.y;\n    }\n\n    void main() {\n        vec2 xy = gl_FragCoord.xy - vec2(_gen_secret_half, _gen_secret_half);\n        float k = xy.y * _gen_output_size.x + xy.x;\n        gl_FragColor = vec4(float(outputFor(k)), 0.0, 0.0, 0.0);\n    }",[],function(e){return[r.vec2("_gen_output_size",e.width,e.height),r.float("_gen_secret_half",.5)]}),a=new e(function(e){var t="_gen_"+e;return new n("\n        ///////////// boolInput("+e+") ////////////\n        uniform sampler2D "+t+"_tex;\n        uniform vec2 "+t+"_size;\n\n        float read_"+e+"(float k) {\n            vec2 uv = vec2(mod(k, "+t+"_size.x) + 0.5,\n                           floor(k / "+t+"_size.x) + 0.5) / "+t+"_size;\n            return float(texture2D("+t+"_tex, uv).x == 1.0);\n        }\n\n        float len_"+e+"() {\n            return "+t+"_size.x * "+t+"_size.y * 4.0;\n        }",[],function(e){return[r.texture(t+"_tex",e),r.vec2(t+"_size",e.width,e.height)]})},i,0,WebGLRenderingContext.UNSIGNED_BYTE,function(e){return e},function(e){return e},!1);return{get SingleTypeCoder(){return e},get ShaderCoder(){return t},get ShaderPart(){return n},get BOOL_TYPE_CODER(){return a}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders_intoBytes.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/ShaderCoders_intoBytes.js")).DetailedError,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/ShaderCoders_intoBytes.js")).WglArg,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/webgl/ShaderCoders_intoBytes.js")).Seq,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_Base.js","src/webgl/ShaderCoders_intoBytes.js")),u=e.ShaderPart,t=e.SingleTypeCoder,r=e.ShaderCoder,n=e.BOOL_TYPE_CODER;function s(e){if(e instanceof Float64Array)return new Uint8Array(new Float32Array(e).buffer,0,e.length<<2);if(e instanceof Float32Array)return new Uint8Array(e.buffer,0,e.length<<2);throw new i("Not a Float32Array or Float64Array",{type:void 0===e?"undefined":$traceurRuntime.typeof(e),floats:e})}function l(e){if(!(e instanceof Uint8Array))throw new i("Not a Uint8Array",{type:void 0===e?"undefined":$traceurRuntime.typeof(e),bytes:e});return new Float32Array(e.buffer,0,e.length>>2)}var c="\n    //////////// PACK_FLOAT_INTO_BYTES /////////////\n    vec4 _gen_packFloatIntoBytes(float val) {\n        if (val == 0.0) {\n            // If log2(0) returns -Infinity, then the logic below would work out just right and this IF block\n            // wouldn't be needed. Unfortunately, log2(0) isn't guaranteed to do that (it's undefined by the spec).\n            return vec4(0.0, 0.0, 0.0, 0.0);\n        }\n\n        float mag = abs(val);\n        float exponent = floor(log2(mag));\n        // Correct log2 approximation errors.\n        exponent += float(exp2(exponent) <= mag / 2.0);\n        exponent -= float(exp2(exponent) > mag);\n\n        float mantissa;\n        if (exponent > 100.0) {\n            // Not sure why this needs to be done in two steps for the largest float to work. Best guess is the\n            // optimizer is rewriting '/ exp2(e)' into '* exp2(-e)', but exp2(-128.0) is too small to represent.\n            mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n        } else {\n            mantissa = mag / float(exp2(exponent)) - 1.0;\n        }\n\n        exponent += 127.0;\n        float a = float(val < 0.0) * 128.0 + floor(exponent / 2.0);\n        mantissa *= 128.0;\n        float b = mod(exponent, 2.0) * 128.0 + floor(mantissa);\n        mantissa -= floor(mantissa);\n        mantissa *= 256.0;\n        float c = floor(mantissa);\n        mantissa -= c;\n        mantissa *= 256.0;\n        float d = floor(mantissa);\n\n        return vec4(d, c, b, a) / 255.0;\n    }",d="\n    //////////// UNPACK_BYTES_INTO_FLOAT_CODE /////////////\n    float _gen_unpackBytesIntoFloat(vec4 v) {\n        float d = floor(v.r * 255.0 + 0.5);\n        float c = floor(v.g * 255.0 + 0.5);\n        float b = floor(v.b * 255.0 + 0.5);\n        float a = floor(v.a * 255.0 + 0.5);\n\n        float sign = floor(a / 128.0);\n        sign = 1.0 - sign * 2.0;\n\n        float exponent = mod(a, 128.0) * 2.0 + floor(b / 128.0) - 127.0;\n        float mantissa = float(exponent > -127.0)\n                       + mod(b, 128.0) / 128.0\n                       + c / 32768.0\n                       + d / 8388608.0;\n        return sign * mantissa * exp2(exponent);\n    }";function m(e,t){var r=["float","vec2","vec3","vec4"][e-1],n="_gen_"+t;return new u("\n        ///////////// makeByteCoderInput("+e+", "+t+") ////////////\n        uniform sampler2D "+n+"_tex;\n        uniform vec2 "+n+"_size;\n\n        "+r+" read_"+t+"(float k) {\n            k *= "+e+".0;\n            vec2 uv = vec2(mod(k, "+n+"_size.x) + 0.5,\n                           floor(k / "+n+"_size.x) + 0.5) / "+n+"_size;\n\n            "+o.range(e).map(function(e){return"\n                vec2 uv"+e+" = uv + vec2("+e+".0 / "+n+"_size.x, 0.0);\n                vec4 bytes"+e+" = texture2D("+n+"_tex, uv"+e+");"}).join("")+"\n\n            return "+r+"("+o.range(e).map(function(e){return"\n                _gen_unpackBytesIntoFloat(bytes"+e+")"}).join(",")+");\n        }\n\n        float len_"+t+"() {\n            return "+n+"_size.x * "+n+"_size.y / "+e+".0;\n        }",[d],function(e){if(e.pixelType!==WebGLRenderingContext.UNSIGNED_BYTE)throw new i("vec2Input_Byte requires byte texture",{name:t,texture:e});return[a.texture(n+"_tex",e),a.vec2(n+"_size",e.width,e.height)]})}function f(e){var t=["float","vec2","vec3","vec4"][e-1];return new u("\n        ///////////// makeByteCoderOutput"+e+" ////////////\n        "+t+" outputFor(float k);\n\n        uniform vec2 _gen_output_size;\n        uniform float _gen_secret_half;\n\n        float len_output() {\n            return _gen_output_size.x * _gen_output_size.y / "+e+".0;\n        }\n\n        void main() {\n            vec2 xy = gl_FragCoord.xy - vec2(_gen_secret_half, _gen_secret_half);\n            float k = xy.y * _gen_output_size.x + xy.x;\n            float r = mod(k, "+e+".0);\n            "+(1===e?"float component = outputFor(k);":t+" result = outputFor(floor(k / "+e+".0));\n                 "+t+" picker = "+t+"("+o.range(e).map(function(e){return"float(r == "+e+".0)"}).join(", ")+");\n                 float component = dot(result, picker);")+"\n            gl_FragColor = _gen_packFloatIntoBytes(component);\n        }",[c],function(e){return[a.vec2("_gen_output_size",e.width,e.height),a.float("_gen_secret_half",.5)]})}var h=new r(n,new t(function(e){return m(1,e)},f(1),0,WebGLRenderingContext.UNSIGNED_BYTE,s,l,!1),new t(function(e){return m(2,e)},f(2),1,WebGLRenderingContext.UNSIGNED_BYTE,s,l,!1),new t(function(e){return m(4,e)},f(4),2,WebGLRenderingContext.UNSIGNED_BYTE,s,l,!1));return{get SHADER_CODER_BYTES(){return h},get floatsAsBytes(){return s},get bytesAsFloats(){return l},get UNPACK_BYTES_INTO_FLOAT_CODE(){return d},get PACK_FLOAT_INTO_BYTES_CODE(){return c}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders_intoFloats.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/ShaderCoders_intoFloats.js")).DetailedError,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_Base.js","src/webgl/ShaderCoders_intoFloats.js")),a=e.ShaderPart,t=e.SingleTypeCoder,r=e.ShaderCoder,n=e.BOOL_TYPE_CODER,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/ShaderCoders_intoFloats.js")).WglArg;function u(t,r){var n="_gen_"+r;return new a("\n        ///////////// makeFloatCoderInput("+t+", "+r+") ////////////\n        uniform sampler2D "+n+"_tex;\n        uniform vec2 "+n+"_size;\n\n        "+["float","vec2","vec3","vec4"][t-1]+" read_"+r+"(float k) {\n            vec2 uv = vec2(mod(k, "+n+"_size.x) + 0.5,\n                           floor(k / "+n+"_size.x) + 0.5) / "+n+"_size;\n            return texture2D("+n+"_tex, uv)."+"xyzw".substring(0,t)+";\n        }\n\n        float len_"+r+"() {\n            return "+n+"_size.x * "+n+"_size.y;\n        }",[],function(e){if(e.pixelType!==WebGLRenderingContext.FLOAT)throw new i("vecInput"+t+"_Float requires float texture",{name:r,texture:e});return[o.texture(n+"_tex",e),o.vec2(n+"_size",e.width,e.height)]})}function s(e){var t=["float","vec2","vec3","vec4"][e-1];return new a("\n        ///////////// makeFloatCoderOutput"+e+" ////////////\n        "+t+" outputFor(float k);\n\n        uniform vec2 _gen_output_size;\n        uniform float _gen_secret_half;\n\n        float len_output() {\n            return _gen_output_size.x * _gen_output_size.y;\n        }\n\n        void main() {\n            vec2 xy = gl_FragCoord.xy - vec2(_gen_secret_half, _gen_secret_half);\n            float k = xy.y * _gen_output_size.x + xy.x;\n\n            "+t+" v = outputFor(k);\n\n            gl_FragColor = "+["vec4(v, 0.0, 0.0, 0.0)","vec4(v.x, v.y, 0.0, 0.0)","vec4(v.x, v.y, v.z, 0.0)","v"][e-1]+";\n        }",[],function(e){return[o.vec2("_gen_output_size",e.width,e.height),o.float("_gen_secret_half",.5)]})}var l=new r(n,new t(function(e){return u(1,e)},s(1),0,WebGLRenderingContext.FLOAT,function(e){for(var t=new Float32Array(e.length<<2),r=0;r<e.length;r++)t[4*r]=e[r];return t},function(e){for(var t=new Float32Array(e.length>>2),r=0;r<t.length;r++)t[r]=e[4*r];return t},!0),new t(function(e){return u(2,e)},s(2),0,WebGLRenderingContext.FLOAT,function(e){for(var t=new Float32Array(e.length<<1),r=0;2*r<e.length;r++)t[4*r]=e[2*r],t[4*r+1]=e[2*r+1];return t},function(e){for(var t=new Float32Array(e.length>>1),r=0;2*r<t.length;r++)t[2*r]=e[4*r],t[2*r+1]=e[4*r+1];return t},!0),new t(function(e){return u(4,e)},s(4),0,WebGLRenderingContext.FLOAT,function(e){return e},function(e){return e},!1));return{get SHADER_CODER_FLOATS(){return l}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/ShaderCoders.js")).WglArg,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglShader.js","src/webgl/ShaderCoders.js")).WglShader,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/webgl/ShaderCoders.js")).WglTexture,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/webgl/ShaderCoders.js")).initializedWglContext,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/ShaderCoders.js")),r=e.provideWorkingShaderCoderToWglConfiguredShader,i=e.WglConfiguredShader,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_Base.js","src/webgl/ShaderCoders.js")).ShaderPart,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_intoBytes.js","src/webgl/ShaderCoders.js")).SHADER_CODER_BYTES,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_intoFloats.js","src/webgl/ShaderCoders.js")).SHADER_CODER_FLOATS,c=$traceurRuntime.createClass(function(e,t){this._partMaker=e,this.description=t},{toConcretePart:function(){var e=arguments[0];return this._partMaker(e||p)},toString:function(){return"ShaderPartDescription("+this.description+")"}},{}),d=$traceurRuntime.createClass(function(){},{},{bool:function(t){return new c(function(e){return e.bool.inputPartGetter(t)},"Inputs.bool("+t+")")},float:function(t){return new c(function(e){return e.float.inputPartGetter(t)},"Inputs.float("+t+")")},vec2:function(t){return new c(function(e){return e.vec2.inputPartGetter(t)},"Inputs.vec2("+t+")")},vec4:function(t){return new c(function(e){return e.vec4.inputPartGetter(t)},"Inputs.vec4("+t+")")}}),m=$traceurRuntime.createClass(function(){},{},{bool:function(){return new c(function(e){return e.bool.outputPart},"Outputs.bool()")},float:function(){return new c(function(e){return e.float.outputPart},"Outputs.float()")},vec2:function(){return new c(function(e){return e.vec2.outputPart},"Outputs.vec2()")},vec4:function(){return new c(function(e){return e.vec4.outputPart},"Outputs.vec4()")},vec4WithOutputCoder:function(){return new c(function(e){return v.vec4.outputPart},"Outputs.vec4WithOutputCoder()")}});function f(e,p){var v=e.map(function(t){return t instanceof n?new c(function(e){return t},"fixed"):t});return new o(function(){var e=new Set,t=!0,r=!1,n=void 0;try{for(var i,a=v[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,u=!0,s=!1,l=void 0;try{for(var c,d=o.toConcretePart().libs[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var m=c.value;e.add(m)}}catch(e){s=!0,l=e}finally{try{u||null==d.return||d.return()}finally{if(s)throw l}}}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var f=$traceurRuntime.spread(e,v.map(function(e){return e.toConcretePart().code})).join(""),h="\n//////// body ////////\n"+p+"\n",g=f.indexOf("void main()");return-1!==g?f.substring(0,g)+h+f.substring(g):f+h})}function h(i,a,e){var o=f($traceurRuntime.spread(i,[a]),e);return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=[],n=0;n<i.length;n++)r.push.apply(r,$traceurRuntime.spread(i[n].toConcretePart().argsFor(e[n])));return r.push.apply(r,$traceurRuntime.spread(e.slice(i.length))),g(o,a.toConcretePart(),r)}}function g(t,r,n){return new i(function(e){return t.withArgs.apply(t,$traceurRuntime.spread(n,r.argsFor(e))).renderTo(e)})}var p=l,v=s;function y(){return p}function b(){return v}function R(e){try{t().invalidateExistingResources()}catch(e){}v=p=e}function w(){var e=new u(1,1,WebGLRenderingContext.FLOAT),t=new o("void main() { gl_FragColor = vec4(2.0, 3.5, 7.0, -7654321.0); }");try{t.withArgs().renderTo(e);var r=e.readPixels(!1);return r instanceof Float32Array&&4===r.length&&2===r[0]&&3.5===r[1]&&7===r[2]&&-7654321===r[3]}catch(e){return console.warn(e),!1}finally{e.ensureDeinitialized(),t.ensureDeinitialized()}}var M=void 0;function _(){return void 0===M&&(M=w()),M}return v=w()?p=l:function(){var e=new u(1,1,WebGLRenderingContext.FLOAT),t=new u(1,1,WebGLRenderingContext.UNSIGNED_BYTE),r=new o("void main() { gl_FragColor = vec4(1.1, 3.0, 5.0, -7654321.0); }"),n=new o("uniform sampler2D t; void main() {\n        vec4 v = texture2D(t, gl_FragCoord.xy);\n        if (v == vec4(2.0, 3.0, 5.0, -7654321.0)) { // Testing that expected precision is present.\n            gl_FragColor = vec4(2.0, 3.0, 5.0, 254.0) / 255.0;\n        } else {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n    }");try{r.withArgs().renderTo(e),n.withArgs(a.texture("t",e)).renderTo(t);var i=t.readPixels(!1);return i instanceof Uint8Array&&4===i.length&&2===i[0]&&3===i[1]&&5===i[2]&&254===i[3]}catch(e){return void console.warn(e)}finally{e.ensureDeinitialized(),t.ensureDeinitialized(),r.ensureDeinitialized(),n.ensureDeinitialized()}}()?(console.warn("Wrote but failed to read a floating point texture. Falling back to float-as-byte output coding."),p=l,s):(console.warn("Failed to write a floating point texture. Falling back to float-as-byte coding everywhere."),p=s),r(y),{get combinedShaderPartsWithCode(){return f},get shaderWithOutputPartAndArgs(){return g},get currentShaderCoder(){return y},get makePseudoShaderWithInputsAndOutputAndCode(){return h},get changeShaderCoder(){return R},get Inputs(){return d},get Outputs(){return m},get outputShaderCoder(){return b},get canTestFloatShaders(){return _}}}),$traceurRuntime.registerModule("src/webgl/Shaders.js",[],function(){"use strict";var l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/Shaders.js")).DetailedError,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/Shaders.js")).WglArg,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/webgl/Shaders.js")).initializedWglContext,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglShader.js","src/webgl/Shaders.js")).WglShader,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/Shaders.js")).WglConfiguredShader,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/webgl/Shaders.js")),n=t.currentShaderCoder,i=t.Inputs,a=t.Outputs,o=t.makePseudoShaderWithInputsAndOutputAndCode,u=$traceurRuntime.createClass(function(){},{},{});u.color=function(e,t,r,n){return s.withArgs(c.vec4("color",e,t,r,n))};var s=new e("\n    uniform vec4 color;\n    void main() {\n        gl_FragColor = color;\n    }");u.passthrough=function(t){return new r(function(e){if(e.width!==t.width||e.height!==t.height||e.pixelType!==t.pixelType)throw new l("Expected same-shaped textures.",{inp:t,dst:e});m.withArgs(c.vec2("textureSize",t.width,t.height),c.texture("dataTexture",t)).renderTo(e)})};var m=new e("\n    uniform vec2 textureSize;\n    uniform sampler2D dataTexture;\n    void main() {\n        gl_FragColor = texture2D(dataTexture, gl_FragCoord.xy / textureSize.xy);\n    }");return u.data=function(s){return new r(function(e){var t,r,n=(r=(t=[e.width,e.height][Symbol.iterator]()).next()).done?void 0:r.value,i=(r=t.next()).done?void 0:r.value;if(s.length!==n*i*4)throw new l("rgbaData.length isn't w * h * 4",{w:n,h:i,len:s.length,rgbaData:s});var a=WebGLRenderingContext,o=d().gl,u=o.createTexture();try{o.bindTexture(WebGLRenderingContext.TEXTURE_2D,u),o.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),o.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),o.texImage2D(a.TEXTURE_2D,0,a.RGBA,n,i,0,a.RGBA,s instanceof Uint8Array?a.UNSIGNED_BYTE:a.FLOAT,s),m.withArgs(c.vec2("textureSize",n,i),c.webGlTexture("dataTexture",u)).renderTo(e)}finally{o.deleteTexture(u)}})},u.floatData=function(e){return u.data(n().float.dataToPixels(e))},u.vec2Data=function(e){return u.data(n().vec2.dataToPixels(e))},u.vec4Data=function(e){return u.data(n().vec4.dataToPixels(e))},u.packFloatIntoVec4=o([i.float("input")],a.vec4(),"vec4 outputFor(float k) {\n        return vec4(\n            read_input(k*4.0),\n            read_input(k*4.0 + 1.0),\n            read_input(k*4.0 + 2.0),\n            read_input(k*4.0 + 3.0));\n    }"),u.packVec2IntoVec4=o([i.vec2("input")],a.vec4(),"vec4 outputFor(float k) { return vec4(read_input(k*2.0), read_input(k*2.0 + 1.0)); }"),u.sumFoldFloat=o([i.float("input")],a.float(),"float outputFor(float k) {\n         return read_input(k) + read_input(k + len_output());\n     }"),u.sumFoldFloatAdjacents=o([i.float("input")],a.float(),"float outputFor(float k) {\n         return read_input(k*2.0) + read_input(k*2.0 + 1.0);\n     }"),u.sumFoldVec2=o([i.vec2("input")],a.vec2(),"vec2 outputFor(float k) {\n         return read_input(k) + read_input(k + len_output());\n     }"),u.sumFoldVec2Adjacents=o([i.vec2("input")],a.vec2(),"vec2 outputFor(float k) {\n         return read_input(k*2.0) + read_input(k*2.0 + 1.0);\n     }"),u.sumFoldVec4=o([i.vec4("input")],a.vec4(),"vec4 outputFor(float k) {\n        return read_input(k) + read_input(k + len_output());\n    }"),u.convertVec4CodingForOutput=o([i.vec4("input")],a.vec4WithOutputCoder(),"vec4 outputFor(float k) { return read_input(k); }"),{get Shaders(){return u}}}),$traceurRuntime.registerModule("src/webgl/WglArg.js",[],function(){"use strict";var e=$traceurRuntime.createClass(a,{toString:function(){return this.type+" "+this.name+" = "+JSON.stringify(this.value)}},{bool:function(e,t){return new a(a.BOOL_TYPE,e,t)},float:function(e,t){return new a(a.FLOAT_TYPE,e,t)},int:function(e,t){return new a(a.INT_TYPE,e,t)},vec2:function(e,t,r){return new a(a.VEC2_TYPE,e,[t,r])},float_array:function(e,t){return t instanceof Float64Array&&(t=new Float32Array(t)),new a(a.FLOAT_ARRAY_TYPE,e,t)},vec2_array:function(e,t){return t instanceof Float64Array&&(t=new Float32Array(t)),new a(a.VEC2_ARRAY_TYPE,e,t)},vec4_array:function(e,t){return t instanceof Float64Array&&(t=new Float32Array(t)),new a(a.VEC4_ARRAY_TYPE,e,t)},mat4_array:function(e,t){return t instanceof Float64Array&&(t=new Float32Array(t)),new a(a.MAT4_ARRAY_TYPE,e,t)},vec4:function(e,t,r,n,i){return new a(a.VEC4_TYPE,e,[t,r,n,i])},mat4:function(e,t){return new a(a.MAT4_TYPE,e,t)},texture:function(e,t){return new a(a.WGL_TEXTURE_TYPE,e,t)},webGlTexture:function(e,t){return new a(a.WEB_GL_TEXTURE_TYPE,e,t)}});function a(e,t,r){this.type=e,this.name=t,this.value=r}return e.BOOL_TYPE="bool",e.FLOAT_TYPE="float",e.INT_TYPE="int",e.VEC2_TYPE="vec2",e.FLOAT_ARRAY_TYPE="float[]",e.VEC2_ARRAY_TYPE="vec2[]",e.VEC4_ARRAY_TYPE="vec4[]",e.MAT4_ARRAY_TYPE="mat4[]",e.VEC4_TYPE="vec4",e.MAT4_TYPE="mat4",e.WGL_TEXTURE_TYPE="wgl_texture",e.WEB_GL_TEXTURE_TYPE="web_gl_texture",e.INPUT_ACTION_MAP=new Map([[e.BOOL_TYPE,function(e,t,r){return e.gl.uniform1f(t,r?1:0)}],[e.INT_TYPE,function(e,t,r){return e.gl.uniform1i(t,r)}],[e.FLOAT_TYPE,function(e,t,r){return e.gl.uniform1f(t,r)}],[e.VEC2_TYPE,function(e,t,r){var n,i,a=(i=(n=r[Symbol.iterator]()).next()).done?void 0:i.value,o=(i=n.next()).done?void 0:i.value;return e.gl.uniform2f(t,a,o)}],[e.FLOAT_ARRAY_TYPE,function(e,t,r){return e.gl.uniform1fv(t,r)}],[e.VEC2_ARRAY_TYPE,function(e,t,r){return e.gl.uniform2fv(t,r)}],[e.VEC4_ARRAY_TYPE,function(e,t,r){return e.gl.uniform4fv(t,r)}],[e.MAT4_ARRAY_TYPE,function(e,t,r){return e.gl.uniformMatrix4fv(t,!1,r)}],[e.VEC4_TYPE,function(e,t,r){var n,i,a=(i=(n=r[Symbol.iterator]()).next()).done?void 0:i.value,o=(i=n.next()).done?void 0:i.value,u=(i=n.next()).done?void 0:i.value,s=(i=n.next()).done?void 0:i.value;return e.gl.uniform4f(t,a,o,u,s)}],[e.MAT4_TYPE,function(e,t,r){return e.gl.uniformMatrix4fv(t,!1,r)}],[e.WGL_TEXTURE_TYPE,function(e,t,r,n){var i=n.coopTextureUnit++;if(i>=e.maxTextureUnits)throw new Error("Uniform texture argument uses texture unit "+i+" but max is "+e.maxTextureUnits+".");if(r.width>e.maxTextureSize||r.height>e.maxTextureSize)throw new Error("Uniform texture argument is "+r.width+"x"+r.height+", but max texture diameter is "+e.maxTextureSize+".");var a=e.gl;a.uniform1i(t,i),a.activeTexture(WebGLRenderingContext.TEXTURE0+i),a.bindTexture(WebGLRenderingContext.TEXTURE_2D,r.initializedTexture())}],[e.WEB_GL_TEXTURE_TYPE,function(e,t,r,n){var i=n.coopTextureUnit++;if(i>=e.maxTextureUnits)throw new Error("Uniform texture argument uses texture unit "+i+" but max is "+e.maxTextureUnits+".");var a=e.gl;a.uniform1i(t,i),a.activeTexture(WebGLRenderingContext.TEXTURE0+i),a.bindTexture(WebGLRenderingContext.TEXTURE_2D,r)}]]),{get WglArg(){return e}}}),$traceurRuntime.registerModule("src/webgl/WglConfiguredShader.js",[],function(){"use strict";var i,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/webgl/WglConfiguredShader.js")).Matrix,r=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/webgl/WglConfiguredShader.js")).WglTexture,void 0);function e(e){r=e}function n(e){i=e}var a=$traceurRuntime.createClass(o,{renderTo:function(e){if(this.renderToFunc(e)instanceof o)throw new Error("Returned a WglConfiguredShader instead of calling renderTo on it.")},_renderToElseDealloc:function(e){var t=!1;try{this.renderTo(e),t=!0}finally{t||e.deallocByDepositingInPool("_renderToElseDealloc")}},_renderReadDealloc:function(e){try{return this.renderTo(e),e.readPixels()}finally{e.deallocByDepositingInPool()}},toRawByteTexture:function(e){var t=i.takeRawByteTex(e);return this._renderToElseDealloc(t),t},toRawFloatTexture:function(e){var t=i.takeRawFloatTex(e);return this._renderToElseDealloc(t),t},readRawFloatOutputs:function(e){return this._renderReadDealloc(i.takeRawFloatTex(e))},readRawByteOutputs:function(e){return this._renderReadDealloc(i.takeRawByteTex(e))},readBoolOutputs:function(e){for(var t=this._renderReadDealloc(i.takeBoolTex(e)),r=new Uint8Array(t.length>>2),n=0;n<r.length;n++)r[n]=1&t[n<<2];return r},readVecFloatOutputs:function(e){return r().float.pixelsToData(this._renderReadDealloc(i.takeVecFloatTex(e)))},readVec2Outputs:function(e){return r().vec2.pixelsToData(this._renderReadDealloc(i.takeVec2Tex(e)))},readVec2OutputsAsKet:function(e){return new t(1,1<<e,this.readVec2Outputs(e))},readVec4Outputs:function(e){return r().vec4.pixelsToData(this._renderReadDealloc(i.takeVec4Tex(e)))},toVecFloatTexture:function(e){var t=i.takeVecFloatTex(e);return this._renderToElseDealloc(t),t},toVec2Texture:function(e){var t=i.takeVec2Tex(e);return this._renderToElseDealloc(t),t},toVec4Texture:function(e){var t=i.takeVec4Tex(e);return this._renderToElseDealloc(t),t},toBoolTexture:function(e){var t=i.takeBoolTex(e);return this._renderToElseDealloc(t),t}},{});function o(e){this.renderToFunc=e}return{get WglConfiguredShader(){return a},get provideWorkingShaderCoderToWglConfiguredShader(){return e},get provideWglTexturePoolToWglConfiguredShader(){return n}}}),$traceurRuntime.registerModule("src/webgl/WglContext.js",[],function(){"use strict";var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/issues.js","src/webgl/WglContext.js")),t=e.canvasCreatedForTesting,r=e.webglContextCreatedForTesting,n=$traceurRuntime.createClass(function(){var e=arguments[0],t=arguments[1],r=this;if(void 0===e&&(e=document.createElement("canvas"),t=void 0),void 0===t&&(t=e.getContext("webgl")||e.getContext("experimental-webgl")),this.canvas=e,this.gl=t,null===this.gl)throw new Error("Error creating WebGL context.");void 0===this.gl.getExtension("OES_texture_float")&&console.warn("OES_texture_float webgl extension not present."),void 0===this.gl.getExtension("WEBGL_color_buffer_float")&&console.warn("WEBGL_color_buffer_float webgl extension not present."),this.onContextRestored=void 0,this.lifetimeCounter=0,this.canvas.addEventListener("webglcontextrestored",function(e){e.preventDefault(),r.recomputeProperties(),void 0!==r.onContextRestored&&r.onContextRestored()},!1),this.canvas.addEventListener("webglcontextlost",function(e){e.preventDefault(),r.lifetimeCounter++},!1),this.recomputeProperties()},{invalidateExistingResources:function(){this.lifetimeCounter++},recomputeProperties:function(){this.lifetimeCounter++,this.maxTextureUnits=this.gl.getParameter(WebGLRenderingContext.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=this.gl.getParameter(WebGLRenderingContext.MAX_TEXTURE_SIZE),this.maximumShaderFloatPrecision=this._getMaximumShaderFloatPrecision()},_getMaximumShaderFloatPrecision:function(){function e(e,t){var r=n.getShaderPrecisionFormat(e,t);return n.getError()===i.NO_ERROR&&null!=r&&0<r.precision}var n=this.gl,i=WebGLRenderingContext;return e(i.VERTEX_SHADER,i.HIGH_FLOAT)&&e(i.FRAGMENT_SHADER,i.HIGH_FLOAT)?"highp":(console.warn("WebGL high precision not available."),e(i.VERTEX_SHADER,i.MEDIUM_FLOAT)&&e(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT)?"mediump":(console.warn("WebGL medium precision not available."),"lowp"))}},{}),i=void 0;function a(){return void 0===i&&(i=new n(t,r)),i}return{get initializedWglContext(){return a}}}),$traceurRuntime.registerModule("src/webgl/WglMortalValueSlot.js",[],function(){"use strict";var e=$traceurRuntime.createClass(function(e,t){this.initializer=e,this.deinitializer=t,this.lifetimeId=void 0,this.mortalValue=void 0},{initializedValue:function(e){return this.lifetimeId!==e&&(this.ensureDeinitialized(),this.mortalValue=this.initializer(),this.lifetimeId=e),this.mortalValue},ensureInitialized:function(e){this.initializedValue(e)},ensureDeinitialized:function(){var e;void 0!==this.lifetimeId&&(e=this.mortalValue,this.lifetimeId=void 0,this.mortalValue=void 0,this.deinitializer(e))}},{});return{get WglMortalValueSlot(){return e}}}),$traceurRuntime.registerModule("src/webgl/WglShader.js",[],function(){"use strict";var m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/webgl/WglShader.js")).Config,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/WglShader.js")).DetailedError,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/WglShader.js")).WglArg,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/webgl/WglShader.js")).initializedWglContext,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglMortalValueSlot.js","src/webgl/WglShader.js")).WglMortalValueSlot,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglUtil.js","src/webgl/WglShader.js")),o=e.checkGetErrorResult,u=e.checkFrameBufferStatusResult,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/webgl/WglShader.js")).Seq,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/WglShader.js")).WglConfiguredShader,s=new r(function(){var e=WebGLRenderingContext,t=h().gl,r=t.createBuffer(),n=new Float32Array([-1,1,1,1,-1,-1,1,-1]);t.bindBuffer(e.ARRAY_BUFFER,r),t.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW);var i=t.createBuffer(),a=new Uint16Array([0,2,1,2,3,1]);return t.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),t.bufferData(e.ELEMENT_ARRAY_BUFFER,a,e.STATIC_DRAW),{positionBuffer:r,indexBuffer:i}},function(){}),t=$traceurRuntime.createClass(function(e){var t;"string"==typeof e&&(t=e,e=function(){return t}),this.fragmentShaderSourceGenerator=e,this._compiledShaderSlot=void 0},{withArgs:function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var t,a=this;return void 0===this._compiledShaderSlot&&(t=i.map(function(e){return e.name}),this._compiledShaderSlot=new r(function(){return new l(a.fragmentShaderSourceGenerator(),t)},function(e){return e.free()})),new n(function(e){var t,r,n;0!==e.width&&0!==e.height&&(t=WebGLRenderingContext,n=(r=h()).gl,s.ensureInitialized(r.lifetimeCounter),n.bindFramebuffer(t.FRAMEBUFFER,e.initializedFramebuffer()),o(n,"framebufferTexture2D",!0),u(n,!0),a._compiledShaderSlot.initializedValue(r.lifetimeCounter).useWithArgs(i),n.viewport(0,0,e.width,e.height),n.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),o(n,"drawElements",!0),e.markRendered())})},ensureDeinitialized:function(){void 0!==this._compiledShaderSlot&&this._compiledShaderSlot.ensureDeinitialized()},toString:function(){return"WglShader(fragmentShaderSource: "+this.fragmentShaderSourceGenerator()+")"}},{}),l=$traceurRuntime.createClass(p,{useWithArgs:function(e){var t=h(),r=t.gl;r.useProgram(this.program);var n={coopTextureUnit:0},i=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value,c=this.uniformLocations.get(l.name);if(void 0===c)throw new d("Unexpected uniform argument",{arg:l,uniformArgs:e});f.INPUT_ACTION_MAP.get(l.type)(t,c,l.value,n)}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}r.enableVertexAttribArray(this.positionAttributeLocation),r.vertexAttribPointer(this.positionAttributeLocation,2,WebGLRenderingContext.FLOAT,!1,0,0)},free:function(){h().gl.deleteProgram(this.program)}},{compileShader:function(e,t,r){var n=e.createShader(t);e.shaderSource(n,r),e.compileShader(n);var i=e.getShaderInfoLog(n);if(""!==i){var a=!1,o=!0,u=!1,s=void 0;try{for(var l,c=m.IGNORED_WEBGL_INFO_TERMS[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var d=l.value;i.indexOf(d)&&(a=!0)}}catch(e){u=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(u)throw s}}a||(console.warn("WebGLShader: gl.getShaderInfoLog() wasn't empty: "+e.getShaderInfoLog(n)),console.warn("Source code was: "+r))}if(!1===e.getShaderParameter(n,WebGLRenderingContext.COMPILE_STATUS))throw new Error("WebGLShader: Shader compile failed.\n                Info: "+i+"\n                Source: "+r);return n}});function p(e,t){var r=h(),n=r.maximumShaderFloatPrecision,i="\n            precision "+n+" float;\n            precision "+n+" int;\n            attribute vec2 position;\n            void main() {\n              gl_Position = vec4(position, 0, 1);\n            }",a="\n            precision "+n+" float;\n            precision "+n+" int;\n            "+e,o=WebGLRenderingContext,u=r.gl,s=p.compileShader(u,o.VERTEX_SHADER,i),l=p.compileShader(u,o.FRAGMENT_SHADER,a),c=u.createProgram();u.attachShader(c,s),u.attachShader(c,l),u.linkProgram(c);var d=(u.getProgramInfoLog(c)||"").trim();if(""!==d&&"\0"!==d&&m.SUPPRESSED_GLSL_WARNING_PATTERNS.every(function(e){return!e.test(d)})&&console.warn("Shader compile caused warnings","gl.getProgramInfoLog()",d),!1===u.getProgramParameter(c,o.LINK_STATUS))throw new Error("Failed to link shader program.\n\ngl.VALIDATE_STATUS: "+u.getProgramParameter(c,o.VALIDATE_STATUS)+"\ngl.getError(): "+u.getError());u.deleteShader(s),u.deleteShader(l),this.uniformLocations=new g(t).toMap(function(e){return e},function(e){return u.getUniformLocation(c,e)}),this.positionAttributeLocation=u.getAttribLocation(c,"position"),this.program=c}return{get WglShader(){return t}}}),$traceurRuntime.registerModule("src/webgl/WglTexture.js",[],function(){"use strict";var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/WglTexture.js")).DetailedError,a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/webgl/WglTexture.js")).Util,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglMortalValueSlot.js","src/webgl/WglTexture.js")).WglMortalValueSlot,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/webgl/WglTexture.js")).initializedWglContext,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglUtil.js","src/webgl/WglTexture.js")),s=e.checkGetErrorResult,l=e.checkFrameBufferStatusResult,t=$traceurRuntime.createClass(c,{sizePower:function(){return 0===this.width?-1/0:Math.round(Math.log2(this.width*this.height))},toString:function(){return"Texture("+[this.width+"x"+this.height,this.pixelType===WebGLRenderingContext.FLOAT?"FLOAT":this.pixelType===WebGLRenderingContext.UNSIGNED_BYTE?"UNSIGNED_BYTE":this.pixelType,this._hasBeenRenderedTo?"rendered":"not rendered"].join(", ")+")"},markRendered:function(){this._hasBeenRenderedTo=!0},invalidateButMoveToNewInstance:function(e){var t=new c(this.width,this.height,this.pixelType);t._textureAndFrameBufferSlot=this._textureAndFrameBufferSlot;function r(){throw new i("WglTexture's value accessed after invalidation.",e)}return this._textureAndFrameBufferSlot=new o(r,r),t},initializedTexture:function(){if(!this._hasBeenRenderedTo)throw new Error("Called initializedTexture on a texture that hasn't been rendered to.");return this._textureAndFrameBufferSlot.initializedValue(u().lifetimeCounter).texture},initializedFramebuffer:function(){return this._textureAndFrameBufferSlot.initializedValue(u().lifetimeCounter).framebuffer},ensureDeinitialized:function(){this._textureAndFrameBufferSlot.ensureDeinitialized()},_textureAndFramebufferInitializer:function(){var e=WebGLRenderingContext,t=u().gl,r={texture:t.createTexture(),framebuffer:t.createFramebuffer()};t.bindTexture(e.TEXTURE_2D,r.texture),t.bindFramebuffer(e.FRAMEBUFFER,r.framebuffer);try{t.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),t.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),t.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),t.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,this.pixelType,null),s(t,"texImage2D"),t.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r.texture,0),s(t,"framebufferTexture2D"),l(t)}finally{t.bindTexture(e.TEXTURE_2D,null),t.bindFramebuffer(e.FRAMEBUFFER,null)}return r},readPixels:function(){var e,t=void 0===arguments[0]||arguments[0],r=WebGLRenderingContext;if(!this._hasBeenRenderedTo)throw new Error("Called readPixels on a texture that hasn't been rendered to.");switch(this.pixelType){case r.UNSIGNED_BYTE:e=new Uint8Array(this.width*this.height*4);break;case r.FLOAT:e=new Float32Array(this.width*this.height*4);break;default:throw new Error("Unrecognized pixel type.")}if(0===this.width||0===this.height)return e;var n=u().gl;return n.bindFramebuffer(r.FRAMEBUFFER,this.initializedFramebuffer()),s(n,"framebufferTexture2D",t),l(n,t),n.readPixels(0,0,this.width,this.height,r.RGBA,this.pixelType,e),s(n,"readPixels(..., RGBA, "+this.pixelType+", ...)",t),e}},{preferredWidthHeightForSizePower:function(e){var t=1<<Math.ceil(e/2),r=1<<Math.floor(e/2);return 2===t&&2===r&&(t=4,r=1),{w:t,h:r}},_deinitialize:function(e){var t=e.texture,r=e.framebuffer,n=u().gl;n.deleteTexture(t),n.deleteFramebuffer(r)}});function c(e,t){var r=void 0!==arguments[2]?arguments[2]:WebGLRenderingContext.FLOAT,n=this;if(0===e&&0===t)return this.width=0,this.height=0,this.pixelType=r,this._hasBeenRenderedTo=!0,void(this._textureAndFrameBufferSlot=new o(function(){throw new i("Touched a zero-size texture.",n)},function(){throw new i("Touched a zero-size texture.",n)}));if(!a.isPowerOf2(e)||!a.isPowerOf2(t))throw new i("Sizes must be a power of 2.",{width:e,height:t,pixelType:r});this.width=e,this.height=t,this.pixelType=r,this._hasBeenRenderedTo=!1,this._textureAndFrameBufferSlot=new o(function(){return n._textureAndFramebufferInitializer()},function(e){return c._deinitialize(e)})}return{get WglTexture(){return t}}}),$traceurRuntime.registerModule("src/webgl/WglTexturePool.js",[],function(){"use strict";var n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/WglTexturePool.js")).DetailedError,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/webgl/WglTexturePool.js")).WglTexture,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/WglTexturePool.js")).provideWglTexturePoolToWglConfiguredShader,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/webgl/WglTexturePool.js")).currentShaderCoder,i=[],a=[],u=0,r=$traceurRuntime.createClass(s,{},{_bucketFor:function(e,t){if(!Number.isInteger(e)||e<0||50<e)throw new n("Bad sizePower",{sizePower:e,pixelType:t});for(var r=t===WebGLRenderingContext.FLOAT?i:a;r.length<=e;)r.push([]);return r[e]},take:function(e,t){if(e===-1/0)return new o(0,0,t);var r=s._bucketFor(e,t);if(1e3<++u&&console.warn("High borrowed texture count: "+u+". (Maybe a leak?)"),0<r.length)return r.pop();var n=o.preferredWidthHeightForSizePower(e),i=n.w,a=n.h;return new o(i,a,t)},deposit:function(e){var t,r=void 0!==arguments[1]?arguments[1]:"[no dealloc details]";if(!(e instanceof o))throw new n("Not a texture",{texture:e,detailsShownWhenUsedAfterDone:r});0!==e.width&&(t=s._bucketFor(e.sizePower(),e.pixelType),u--,t.push(e.invalidateButMoveToNewInstance(r)))},takeSame:function(e){return s.take(e.sizePower(),e.pixelType)},getUnReturnedTextureCount:function(){return u},takeRawFloatTex:function(e){return s.take(e,WebGLRenderingContext.FLOAT)},takeRawByteTex:function(e){return s.take(e,WebGLRenderingContext.UNSIGNED_BYTE)},takeBoolTex:function(e){return s.take(e,WebGLRenderingContext.UNSIGNED_BYTE)},takeVecFloatTex:function(e){return s.take(e+t().float.powerSizeOverhead,t().float.pixelType)},takeVec2Tex:function(e){return s.take(e+t().vec2.powerSizeOverhead,t().vec2.pixelType)},takeVec4Tex:function(e){return s.take(e+t().vec4.powerSizeOverhead,t().vec4.pixelType)}});function s(){}return o.prototype.deallocByDepositingInPool=function(){var e=arguments[0];r.deposit(this,e)},e(r),{get WglTexturePool(){return r}}}),$traceurRuntime.registerModule("src/webgl/WglTextureTrader.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/WglTextureTrader.js")).WglConfiguredShader,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/webgl/WglTextureTrader.js")).WglTexture,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/webgl/WglTextureTrader.js")).WglTexturePool,n=$traceurRuntime.createClass(function(e){this.currentTexture=e,this._dontDeallocFlag=!1},{dontDeallocCurrentTexture:function(){return this._dontDeallocFlag=!0,this.currentTexture},shadeAndTrade:function(e){var t=arguments[1],r=this.currentTexture,n=!this._dontDeallocFlag,i=t||o.takeSame(r);(e instanceof a?e:e(r)).renderTo(i),this.currentTexture=i,this._dontDeallocFlag=!1,n&&r.deallocByDepositingInPool("WglTexturePool shadeAndTrade")},shadeHalveAndTrade:function(e){this.shadeAndTrade(e,o.take(Math.max(0,this.currentTexture.sizePower()-1),this.currentTexture.pixelType))},shadeQuarterAndTrade:function(e){this.shadeAndTrade(e,o.take(Math.max(0,this.currentTexture.sizePower()-2),this.currentTexture.pixelType))}},{});return e.prototype.tradeThrough=function(e){var t=void 0!==arguments[1]&&arguments[1],r=new n(this);return t&&r.dontDeallocCurrentTexture(),e(r),r.currentTexture},{get WglTextureTrader(){return n}}}),$traceurRuntime.registerModule("src/webgl/WglUtil.js",[],function(){"use strict";var u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/webgl/WglUtil.js")).Config;function e(e,t){var r;if(!(void 0!==arguments[2]&&arguments[2])||u.CHECK_WEB_GL_ERRORS_EVEN_ON_HOT_PATHS){var n=e.getError(),i=WebGLRenderingContext;if(n!==i.NO_ERROR){var a=(r={},Object.defineProperty(r,1280,{value:"INVALID_ENUM [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,1281,{value:"INVALID_VALUE [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,1282,{value:"INVALID_OPERATION [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,1285,{value:"OUT_OF_MEMORY [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,1286,{value:"INVALID_FRAMEBUFFER_OPERATION [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,37442,{value:"CONTEXT_LOST_WEBGL [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,i.INVALID_ENUM,{value:"INVALID_ENUM",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,i.INVALID_VALUE,{value:"INVALID_VALUE",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,i.INVALID_OPERATION,{value:"INVALID_OPERATION",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,i.OUT_OF_MEMORY,{value:"OUT_OF_MEMORY",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,i.INVALID_FRAMEBUFFER_OPERATION,{value:"INVALID_FRAMEBUFFER_OPERATION",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(r,i.CONTEXT_LOST_WEBGL,{value:"CONTEXT_LOST_WEBGL",configurable:!0,enumerable:!0,writable:!0}),r),o=void 0!==a[n]?a[n]:"?";throw new Error("gl.getError() returned 0x"+n.toString(16)+" ("+o+") after "+t+".")}}}function t(e){var t;if(!(void 0!==arguments[1]&&arguments[1])||u.CHECK_WEB_GL_ERRORS_EVEN_ON_HOT_PATHS){var r=WebGLRenderingContext,n=e.checkFramebufferStatus(r.FRAMEBUFFER);if(n!==r.FRAMEBUFFER_COMPLETE){var i=(t={},Object.defineProperty(t,0,{value:"Argument wasn't a frame buffer",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,1280,{value:"INVALID_ENUM [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,36054,{value:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,36055,{value:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,36057,{value:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,36061,{value:"FRAMEBUFFER_UNSUPPORTED [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.INVALID_ENUM,{value:"INVALID_ENUM",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT,{value:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT,{value:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS,{value:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,r.FRAMEBUFFER_UNSUPPORTED,{value:"FRAMEBUFFER_UNSUPPORTED",configurable:!0,enumerable:!0,writable:!0}),t),a=void 0!==i[n]?i[n]:"?";throw new Error("gl.checkFramebufferStatus() returned 0x"+n.toString(16)+" ("+a+").")}}}return{get checkGetErrorResult(){return e},get checkFrameBufferStatusResult(){return t}}}),$traceurRuntime.getModule("src/main.js");

        </script>
    </body>
</html>
